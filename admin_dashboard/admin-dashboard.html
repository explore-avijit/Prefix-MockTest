<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Prefix Admin Dashboard</title>
    <meta name="description"
        content="Prefix Admin Dashboard - Manage users, questions, exams, and platform analytics." />
    <meta property="og:title" content="Prefix Admin Dashboard" />
    <meta property="og:description"
        content="Manage users, questions, exams, and platform analytics on the Prefix Admin Dashboard." />
    <meta property="og:type" content="website" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#2b8cee",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                    },
                    fontFamily: {
                        "display": ["Inter"]
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
                },
            },
        }
        function toggleSidebarMode() {
            const aside = document.getElementById('main-sidebar');
            const dot = document.getElementById('sidebar-toggle-dot');
            const toggleBtn = document.getElementById('sidebar-mode-toggle');
            const mobileToggle = document.getElementById('mobile-menu-toggle');
            const isPinned = aside.classList.toggle('sidebar-pinned');

            if (isPinned) {
                // Red / Pinned Mode
                if (dot) {
                    dot.style.backgroundColor = '#ef4444';
                    dot.style.boxShadow = '0 0 15px rgba(239, 68, 68, 0.6)';
                }
                if (toggleBtn) toggleBtn.classList.add('pinned');
                if (mobileToggle) mobileToggle.classList.add('active');
                if (toggleBtn) toggleBtn.title = "Pinned Mode (Click to Animate)";
                localStorage.setItem('sidebarPinned', 'true');
            } else {
                // Green / Animated Mode
                if (dot) {
                    dot.style.backgroundColor = '#0bda5b';
                    dot.style.boxShadow = '0 0 15px rgba(11, 218, 91, 0.6)';
                }
                if (toggleBtn) toggleBtn.classList.remove('pinned');
                if (mobileToggle) mobileToggle.classList.remove('active');
                if (toggleBtn) toggleBtn.title = "Animated Mode (Click to Pin)";
                localStorage.setItem('sidebarPinned', 'false');
            }
        }

        // Hamburger toggles the mobile drawer with backdrop overlay
        function toggleMobileSidebar() {
            const aside = document.getElementById('main-sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const mobileToggle = document.getElementById('mobile-menu-toggle');
            
            const isActive = aside.classList.toggle('mobile-active');
            
            if (overlay) {
                if (isActive) {
                    overlay.classList.remove('hidden');
                    setTimeout(() => overlay.classList.remove('opacity-0'), 10);
                } else {
                    overlay.classList.add('opacity-0');
                    setTimeout(() => overlay.classList.add('hidden'), 500);
                }
            }
            
            if (mobileToggle) {
                mobileToggle.classList.toggle('active', isActive);
            }
        }

        // Initialize Sidebar State on Page Load
        document.addEventListener('DOMContentLoaded', () => {
            // Automatically green (Animated Mode) in responsive mode by skipping pinning
            if (localStorage.getItem('sidebarPinned') === 'true' && window.innerWidth > 768) {
                toggleSidebarMode();
            }
        });
    </script>
    <style type="text/tailwindcss">
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        /* Hide scrollbar for Chrome, Safari and Opera */
        *::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for IE, Edge and Firefox */
        * {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Allow custom scrollbars specifically */
        .custom-scrollbar::-webkit-scrollbar {
            display: block !important;
        }
        .custom-scrollbar {
            -ms-overflow-style: auto !important;
            scrollbar-width: thin !important;
        }
        .theme-toggle-dark {
            opacity: 0;
            transform: scale(0.5) rotate(-90deg);
            transition: all 0.3s ease;
            position: absolute;
        }
        .theme-toggle-light {
            opacity: 1;
            transform: scale(1) rotate(0deg);
            transition: all 0.3s ease;
        }
        .dark .theme-toggle-dark {
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }
        .dark .theme-toggle-light {
            opacity: 0;
            transform: scale(0.5) rotate(90deg);
        }
        .nav-link.active {
            color: #2b8cee;
            font-weight: 600;
        }
        .nav-link.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 20%;
            height: 60%;
            width: 3px;
            background: #2b8cee;
            border-radius: 0 4px 4px 0;
            box-shadow: 2px 0 8px rgba(43, 140, 238, 0.4);
            z-index: 10;
        }
        .nav-link:not(.active):hover::before {
            content: '';
            position: absolute;
            left: 0;
            top: 35%;
            height: 30%;
            width: 2px;
            background: rgba(43, 140, 238, 0.5);
            border-radius: 0 4px 4px 0;
            animation: bar-slide 0.3s ease-out forwards;
        }
        @keyframes bar-slide {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .nav-link:hover .material-symbols-outlined {
            font-variation-settings: 'FILL' 1;
            filter: drop-shadow(0 0 5px rgba(43, 140, 238, 0.3));
        }
        .nav-link:hover span:not(.material-symbols-outlined) {
            text-shadow: 0 0 10px rgba(43, 140, 238, 0.15);
        }
        .page-content {
            animation: page-fade-in 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        @keyframes page-fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .premium-glass:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px -8px rgba(0,0,0,0.08);
            border-color: rgba(43, 140, 238, 0.2);
        }
        .dark .premium-glass:hover {
            box-shadow: 0 12px 40px -8px rgba(0,0,0,0.4);
            border-color: rgba(43, 140, 238, 0.3);
        }
        .page-content.hidden { display: none !important; }
        .page-content:not(#page-settings) {
            min-height: 100%;
            display: flex;
            flex-direction: column;
        }
        #page-dashboard:not(.hidden) {
            height: 78vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            gap: 0.5rem;
        }
        .tab-btn.active {
            border-bottom: 2px solid #2b8cee;
            color: #2b8cee;
        }
        #btn-add-expert, #btn-add-aspirant {
            display: none;
        }
        #page-users[data-active-tab="experts"] #btn-add-expert {
            display: flex;
        }
        #page-users[data-active-tab="aspirants"] #btn-add-aspirant {
            display: flex;
        }
        .expert-label { display: inline; }
        .aspirant-label { display: none; }
        #page-users[data-active-tab="aspirants"] .expert-label { display: none; }
        #page-users[data-active-tab="aspirants"] .aspirant-label { display: inline; }
        /* Sidebar Pinned State */
        aside.sidebar-pinned {
            width: 256px !important;
            transition: width 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        aside.sidebar-pinned > div {
            width: 256px !important;
            box-shadow: 4px 0 20px -10px rgba(0,0,0,0.05) !important;
            backdrop-filter: none !important;
            background-color: rgb(255 255 255);
        }
        .dark aside.sidebar-pinned > div {
            background-color: rgb(17 26 34);
            box-shadow: 4px 0 20px -10px rgba(0,0,0,0.3) !important;
        }
        aside.sidebar-pinned .opacity-0 {
            opacity: 1 !important;
            transform: translateX(0) !important;
        }
        aside:not(.sidebar-pinned) {
            transition: width 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        main {
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        #sidebar-mode-toggle.pinned {
            transform: rotate(180deg);
            border-color: rgba(239, 68, 68, 0.3);
        }

        .filter-pill {
            padding: 0.375rem 1rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
        }
        .filter-pill.active {
            background-color: #2b8cee;
            border-color: #2b8cee;
            color: #ffffff;
        }
        .filter-pill:not(.active) {
            background-color: #ffffff;
            color: #64748b;
        }
        .dark .filter-pill:not(.active) {
            background-color: #1a252f;
            border-color: #324d67;
            color: #92adc9;
        }
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .pulse-dot {
            animation: pulse-dot 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.4s ease-out forwards;
        }
        @keyframes scale-in {
            from { opacity: 0; transform: scale(0.95) translateY(-10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-scale-in { animation: scale-in 0.2s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }

        /* Premium Glassmorphism Design System */
        .premium-glass {
            background: rgba(255, 255, 255, 0.7) !important;
            backdrop-filter: blur(16px) saturate(180%) !important;
            -webkit-backdrop-filter: blur(16px) saturate(180%) !important;
            border: 1px solid rgba(255, 255, 255, 0.45) !important;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.05) !important;
        }
        .dark .premium-glass {
            background: rgba(17, 26, 34, 0.6) !important;
            border: 1px solid rgba(255, 255, 255, 0.08) !important;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3) !important;
        }
        .premium-glass:hover {
            border-color: rgba(43, 140, 238, 0.4) !important;
            background: rgba(255, 255, 255, 0.8) !important;
            transform: translateY(-2px);
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .dark .premium-glass:hover {
            border-color: rgba(43, 140, 238, 0.3) !important;
            background: rgba(17, 26, 34, 0.7) !important;
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
            display: block !important;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.08);
            border-radius: 10px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.03);
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
            border: 2px solid transparent;
            background-clip: padding-box;
            transition: background 0.2s;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background-color: #94a3b8;
        }
        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: #94a3b8 transparent;
        }
        
        /* Modal Z-Index fix */
        [role="dialog"] { z-index: 10000 !important; }
        #global-action-menu { z-index: 9999 !important; }
        .swal2-container { z-index: 20000 !important; }

        /* Premium Toast System */
        @keyframes toast-in {
            from { transform: translateX(100%) scale(0.9); opacity: 0; }
            to { transform: translateX(0) scale(1); opacity: 1; }
        }
        @keyframes toast-out {
            from { transform: translateX(0) scale(1); opacity: 1; }
            to { transform: translateX(20px) scale(0.95); opacity: 0; }
        }
        .toast-animate-in {
            animation: toast-in 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        .toast-animate-out {
            animation: toast-out 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        /* Custom swal2 styling to match theme */
        .swal2-popup {
            background: #ffffff;
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            padding: 24px;
        }
        .dark .swal2-popup {
            background: #1a252f;
            color: #ffffff;
            border: 1px solid #324d67;
        }
        .dark .swal2-title { color: #ffffff; }
        .dark .swal2-html-container { color: #92adc9; }
        
        .premium-glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .dark .premium-glass {
            background: rgba(17, 26, 34, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.03);
        }
        .toast-shadow {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04), 0 0 0 1px rgba(0, 0, 0, 0.05);
        }
        .glass-toast {
            background-color: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.05) !important;
        }
        .dark .glass-toast {
            background-color: rgba(26, 37, 47, 0.98) !important;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05) !important;
        }
        
        /* Dynamic 'Rush & Return' Animated Hamburger */
        .hamburger-btn {
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            width: 44px !important;
            height: 44px !important;
            overflow: hidden !important;
        }
        .hamburger-btn span {
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            transform-origin: center center;
            height: 2px !important;
            width: 24px !important;
            background-color: currentColor;
        }

        /* Top Bar: Rush Right and Return with Rotation */
        .hamburger-btn.active span:nth-child(1) {
            animation: topBarRush 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            background-color: #2b8cee !important;
        }

        /* Middle Bar: Slide Out Right */
        .hamburger-btn.active span:nth-child(2) {
            opacity: 0;
            transform: translateX(50px);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.3s ease;
        }

        /* Bottom Bar: Rush Right and Return with Rotation */
        .hamburger-btn.active span:nth-child(3) {
            animation: bottomBarRush 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            background-color: #2b8cee !important;
        }

        @keyframes topBarRush {
            0% { transform: translateY(0) rotate(0) translateX(0); }
            35% { transform: translateY(0) rotate(0) translateX(35px); }
            100% { transform: translateY(8px) rotate(45deg) translateX(0); }
        }

        @keyframes bottomBarRush {
            0% { transform: translateY(0) rotate(0) translateX(0); }
            35% { transform: translateY(0) rotate(0) translateX(35px); }
            100% { transform: translateY(-8px) rotate(-45deg) translateX(0); }
        }

        /* Mobile Drawer (Overlay) Logic */
        @media (max-width: 768px) {
            #main-sidebar {
                position: fixed !important;
                left: 0;
                top: 0;
                height: 100vh;
                width: 256px !important;
                transform: translateX(-100%);
                z-index: 10000;
                transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1) !important;
            }
            #main-sidebar.mobile-active {
                transform: translateX(0);
            }
            #main-sidebar > div {
                width: 256px !important;
                box-shadow: 10px 0 40px -10px rgba(0,0,0,0.2) !important;
                overflow: visible !important;
            }
            /* Force show all text in mobile sidebar */
            #main-sidebar.mobile-active .opacity-0 {
                opacity: 1 !important;
                transform: translateX(0) !important;
            }
            /* Ensure system storage div is also visible */
            #main-sidebar.mobile-active div.opacity-0 {
                opacity: 1 !important;
                transform: translateY(0) !important;
            }
            /* Mobile Toggle Button Base (Circular) */
            #mobile-menu-toggle {
                position: absolute;
                right: -64px; /* Keeps three-bar aligned with header */
                top: 24px;   
                z-index: 10002;
                display: flex !important;
                background: white;
                box-shadow: 0 4px 20px rgba(0,0,0,0.08);
                border: 1px solid rgba(0,0,0,0.05);
                border-radius: 9999px !important; /* Circular background for both states */
                transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1) !important;
            }

            /* Cross Button Position (50% in / 50% out) */
            #mobile-menu-toggle.active {
                right: -22px !important; /* Half of 44px width */
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            }
            .dark #mobile-menu-toggle {
                background: #1a252f;
                box-shadow: 0 4px 20px rgba(0,0,0,0.4);
                border: 1px solid rgba(255,255,255,0.05);
            }
            main {
                transition: none !important; /* Fixed body */
            }
            #sidebar-overlay {
                z-index: 9999;
            }
            header {
                z-index: 30; /* Below sidebar and overlay */
                transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1) !important;
            }
            #sidebar-mode-toggle {
                display: none !important;
            }

            /* --- Premium Responsive User Management: High-End Compact Grid --- */
            #page-users .tab-view table, 
            #page-users .tab-view thead, 
            #page-users .tab-view tbody, 
            #page-users .tab-view th, 
            #page-users .tab-view td, 
            #page-users .tab-view tr {
                display: block;
            }

            #page-users .tab-view thead {
                display: none;
            }

            #page-users .tab-view tbody {
                display: grid !important;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)) !important;
                gap: 1.25rem !important;
                padding: 1.25rem !important;
                background: transparent !important;
                border: none !important;
            }

            #page-users .tab-view tr {
                background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.8)) !important;
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                border: 1px solid rgba(255, 255, 255, 0.7) !important;
                border-radius: 1.25rem !important;
                padding: 0.85rem 1rem !important;
                position: relative;
                transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
                box-shadow: 
                    0 8px 16px -8px rgba(0, 0, 0, 0.08),
                    0 4px 6px -2px rgba(0, 0, 0, 0.02),
                    inset 0 0 0 1px rgba(255, 255, 255, 0.5);
                display: flex !important;
                flex-direction: column !important;
                gap: 0 !important;
                overflow: visible !important;
                text-align: left !important;
                align-items: stretch !important;
            }

            .dark #page-users .tab-view tr {
                background: linear-gradient(145deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.2)) !important;
                backdrop-filter: blur(24px);
                -webkit-backdrop-filter: blur(24px);
                border: 1px solid rgba(255, 255, 255, 0.05) !important;
                box-shadow: 
                    0 15px 30px -10px rgba(0, 0, 0, 0.3),
                    0 0 0 1px rgba(255, 255, 255, 0.03),
                    inset 0 0 40px rgba(0, 0, 0, 0.1);
            }

            #page-users .tab-view tr:hover {
                transform: translateY(-4px);
                border-color: rgba(43, 140, 238, 0.4) !important;
                box-shadow: 0 20px 40px -12px rgba(43, 140, 238, 0.15);
            }

            #page-users .tab-view td {
                padding: 0 !important;
                border: none !important;
                width: 100% !important;
                height: auto !important;
                background: transparent !important;
            }

            /* Absolute Actions Menu - Top Right Refined */
            #page-users .tab-view td[data-label="Actions"] {
                position: absolute !important;
                top: 0.45rem !important;
                right: 0.5rem !important;
                z-index: 10;
                width: auto !important;
                order: 0;
            }
            #page-users .tab-view td[data-label="Actions"]::before {
                display: none !important;
            }
            #page-users .tab-view .action-btn-trigger {
                background: transparent !important;
                border: none !important;
                width: 28px;
                height: 28px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 0.65rem;
            }
            .dark #page-users .tab-view .action-btn-trigger {
                background: transparent !important;
                border: none !important;
            }

            /* Profile Section - Premium Header */
            #page-users .tab-view td[data-label*="Profile"],
            #page-users .tab-view td[data-label*="Name"] {
                order: 1;
                margin-bottom: 0.4rem;
                padding-bottom: 0.4rem !important;
                border-bottom: 1px solid rgba(0,0,0,0.04) !important;
            }
            .dark #page-users .tab-view td[data-label*="Profile"],
            .dark #page-users .tab-view td[data-label*="Name"] {
                border-bottom-color: rgba(255,255,255,0.06) !important;
            }

            #page-users .tab-view td[data-label*="Profile"] .flex,
            #page-users .tab-view td[data-label*="Name"] .flex {
                flex-direction: row !important;
                align-items: center !important;
                text-align: left !important;
                gap: 0.85rem !important;
                padding-left: 0;
            }

            /* Avatar Premium Glossy Border */
            #page-users .tab-view td[data-label*="Profile"] .relative,
            #page-users .tab-view td[data-label*="Name"] .relative {
                width: 3rem;
                height: 3rem;
                padding: 2px;
                background: linear-gradient(135deg, #2b8cee, #9333ea, #2b8cee);
                background-size: 200% 200%;
                animation: gradient-shift 4s ease infinite;
                border-radius: 0.85rem;
                flex-shrink: 0;
                margin: 0;
                box-shadow: 0 4px 10px rgba(43, 140, 238, 0.15);
            }

            @keyframes gradient-shift {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }

            #page-users .tab-view td[data-label*="Profile"] img, 
            #page-users .tab-view td[data-label*="Name"] img {
                width: 100% !important;
                height: 100% !important;
                border-radius: 0.75rem !important;
                border: 1.5px solid white;
                object-fit: cover;
            }
            .dark #page-users .tab-view td[data-label*="Profile"] img, 
            .dark #page-users .tab-view td[data-label*="Name"] img {
                border-color: #1e293b;
            }

            #page-users .tab-view td[data-label*="Profile"] .font-bold,
            #page-users .tab-view td[data-label*="Name"] .font-bold {
                font-size: 0.9375rem !important;
                font-weight: 800 !important;
                letter-spacing: -0.01em;
                color: #0f172a;
            }
            .dark #page-users .tab-view td[data-label*="Profile"] .font-bold,
            .dark #page-users .tab-view td[data-label*="Name"] .font-bold {
                color: #f8fafc;
            }

            #page-users .tab-view td[data-label*="Profile"] .text-xs {
                font-size: 0.7rem !important;
                color: #64748b;
                font-weight: 500;
            }
            .dark #page-users .tab-view td[data-label*="Profile"] .text-xs {
                color: #94a3b8;
            }

            /* Info Rows Refinement */
            #page-users .tab-view td:not([data-label*="Profile"]):not([data-label*="Name"]):not([data-label="Actions"]):not(.bulk-check-column):not([data-label="S.No"]) {
                display: flex !important;
                justify-content: space-between !important;
                align-items: center !important;
                padding: 0.4rem 0.25rem !important;
                order: 2;
                font-size: 0.75rem;
                font-weight: 700;
                color: #1e293b;
                border-bottom: 1px solid rgba(0, 0, 0, 0.02);
            }
            .dark #page-users .tab-view td:not([data-label*="Profile"]):not([data-label*="Name"]):not([data-label="Actions"]):not(.bulk-check-column):not([data-label="S.No"]) {
                color: #f1f5f9;
                border-bottom-color: rgba(255, 255, 255, 0.02);
            }
            #page-users .tab-view td:not([data-label*="Profile"]):not([data-label*="Name"]):not([data-label="Actions"]):not(.bulk-check-column):not([data-label="S.No"]):last-of-type {
                border-bottom: none;
            }

            /* Labels Styled for Premium Feel */
            #page-users .tab-view td:not([data-label*="Profile"]):not([data-label*="Name"]):not([data-label="Actions"]):not(.bulk-check-column):not([data-label="S.No"])::before {
                content: attr(data-label);
                font-weight: 800;
                color: #64748b;
                font-size: 0.6rem;
                text-transform: uppercase;
                letter-spacing: 0.1em;
            }
            .dark #page-users .tab-view td::before {
                color: #94a3b8;
            }

            /* Hide everything unwanted */
            #page-users .tab-view .bulk-check-column,
            #page-users .tab-view td[data-label="S.No"],
            #page-questions .tab-view td[data-label="Moderation"] {
                display: none !important;
            }

            /* --- Premium Responsive Question Management --- */
            #page-questions .tab-view table, 
            #page-questions .tab-view thead, 
            #page-questions .tab-view tbody, 
            #page-questions .tab-view th, 
            #page-questions .tab-view td, 
            #page-questions .tab-view tr {
                display: block;
            }

            #page-questions .tab-view thead {
                display: none;
            }

            #page-questions .tab-view tbody {
                display: grid !important;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)) !important;
                gap: 1.25rem !important;
                padding: 1.25rem !important;
                background: transparent !important;
                border: none !important;
            }

            #page-questions .tab-view tr {
                background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.8)) !important;
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                border: 1px solid rgba(255, 255, 255, 0.7) !important;
                border-radius: 1.25rem !important;
                padding: 1rem !important;
                position: relative;
                transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
                box-shadow: 
                    0 8px 16px -8px rgba(0, 0, 0, 0.08),
                    0 4px 6px -2px rgba(0, 0, 0, 0.02),
                    inset 0 0 0 1px rgba(255, 255, 255, 0.5);
                display: flex !important;
                flex-direction: column !important;
                gap: 0 !important;
                overflow: visible !important;
                text-align: left !important;
                align-items: stretch !important;
            }

            .dark #page-questions .tab-view tr {
                background: linear-gradient(145deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.2)) !important;
                backdrop-filter: blur(24px);
                -webkit-backdrop-filter: blur(24px);
                border: 1px solid rgba(255, 255, 255, 0.05) !important;
                box-shadow: 
                    0 15px 30px -10px rgba(0, 0, 0, 0.3),
                    0 0 0 1px rgba(255, 255, 255, 0.03),
                    inset 0 0 40px rgba(0, 0, 0, 0.1);
            }

            #page-questions .tab-view tr:hover {
                transform: translateY(-4px);
                border-color: rgba(43, 140, 238, 0.4) !important;
                box-shadow: 0 20px 40px -12px rgba(43, 140, 238, 0.15);
            }

            #page-questions .tab-view td {
                padding: 0 !important;
                border: none !important;
                width: 100% !important;
                height: auto !important;
                background: transparent !important;
            }

            /* Question Header & ID Refinement */
            #page-questions .tab-view td[data-label="ID"] {
                display: flex !important;
                justify-content: space-between !important;
                padding: 0.4rem 0.25rem !important;
                font-size: 0.65rem !important;
                color: #94a3b8 !important;
                border: none !important;
                width: 100% !important;
                padding-right: 2.5rem !important; /* Space for absolute actions button */
                font-family: inherit;
            }
            #page-questions .tab-view td[data-label="ID"]::before {
                content: "ID : " !important;
                display: inline-block !important;
                font-weight: 800;
                margin-right: 4px;
                color: #64748b;
            }

            /* Absolute Actions Menu - Top Right Refined */
            #page-questions .tab-view td[data-label="Actions"] {
                position: absolute !important;
                top: 0.5rem !important;
                right: 0.5rem !important;
                z-index: 10;
                width: auto !important;
            }
            #page-questions .tab-view td[data-label="Actions"]::before {
                display: none !important;
            }

            /* Question Details - Main Content */
            #page-questions .tab-view td[data-label="Question Details"] {
                margin-top: -0.25rem;
                margin-bottom: 1rem;
                padding-bottom: 0.75rem !important;
                border-bottom: 1px solid rgba(0,0,0,0.04) !important;
            }
            .dark #page-questions .tab-view td[data-label="Question Details"] {
                border-bottom-color: rgba(255,255,255,0.06) !important;
            }

            #page-questions .tab-view td[data-label="Question Details"] .font-medium {
                font-size: 0.875rem !important;
                font-weight: 700 !important;
                color: #0f172a;
                line-height: 1.5;
            }
            .dark #page-questions .tab-view td[data-label="Question Details"] .font-medium {
                color: #f8fafc;
            }

            /* Info Rows Refinement */
            #page-questions .tab-view td:not([data-label="Question Details"]):not([data-label="Actions"]):not([data-label="Moderation"]):not([data-label="ID"]) {
                display: flex !important;
                justify-content: space-between !important;
                align-items: center !important;
                padding: 0.4rem 0.25rem !important;
                font-size: 0.75rem;
                font-weight: 600;
                color: #1e293b;
                border-bottom: 1px solid rgba(0, 0, 0, 0.02);
                text-align: right !important;
            }
            .dark #page-questions .tab-view td:not([data-label="Question Details"]):not([data-label="Actions"]):not([data-label="Moderation"]):not([data-label="ID"]) {
                color: #f1f5f9;
                border-bottom-color: rgba(255, 255, 255, 0.02);
            }

            /* Internal alignment for flex labels */
            #page-questions .tab-view td:not([data-label="Question Details"]):not([data-label="Actions"]) > div.flex {
                justify-content: flex-end !important;
                width: auto !important;
            }
            #page-questions .tab-view td:not([data-label="Question Details"]):not([data-label="Actions"]) > div.flex-col {
                align-items: flex-end !important;
                text-align: right !important;
            }
            #page-questions .tab-view td:not([data-label="Question Details"]):not([data-label="Actions"]):not([data-label="Moderation"]):not([data-label="ID"]):last-of-type {
                border-bottom: none;
            }

            /* Labels Styled for Premium Feel */
            #page-questions .tab-view td:not([data-label="Question Details"]):not([data-label="Actions"]):not([data-label="Moderation"]):not([data-label="ID"])::before {
                content: attr(data-label);
                font-weight: 800;
                color: #64748b;
                font-size: 0.6rem;
                text-transform: uppercase;
                letter-spacing: 0.1em;
            }
            .dark #page-questions .tab-view td::before {
                color: #94a3b8;
            }
            /* Mobile Toast Refinement */
            #toast-container {
                top: 6rem !important; /* top-24: exactly 16px below the 72px+8px header */
                bottom: auto !important;
                right: 0 !important;
                left: auto !important;
                width: auto !important;
                max-width: 100% !important;
                align-items: flex-end !important;
            }

            .glass-toast {
                margin-left: auto !important;
                margin-right: 0 !important;
                min-width: 260px !important; 
                max-width: min(320px, 90vw) !important;
                padding: 0.75rem 1rem !important;
                gap: 0.85rem !important;
                border-radius: 1rem !important;
            }

            .glass-toast .w-12 {
                width: 2.25rem !important;
                height: 2.25rem !important;
            }

            .glass-toast .text-3xl {
                font-size: 1.35rem !important;
            }

            .glass-toast p.text-sm {
                font-size: 0.8rem !important;
            }

            .glass-toast p.text-\[12px\] {
                font-size: 0.7rem !important;
            }
        }

        /* --- Global Dropdown & Premium UI Enhancements --- */
        .dropdown-menu {
            position: absolute;
            right: 0;
            top: 100%;
            z-index: 50;
            min-width: 155px;
            background: #ffffff;
            border: 1px solid rgba(43, 140, 238, 0.15);
            border-radius: 0.85rem;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.12);
            padding: 0.3rem;
            animation: menu-slide-in 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            transform-origin: top right;
        }
        .dark .dropdown-menu {
            background: #1e293b;
            border-color: rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        @keyframes menu-slide-in {
            from { opacity: 0; transform: translateY(-8px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .dropdown-menu button {
            transition: all 0.2s ease;
            border-radius: 0.5rem;
            margin: 0;
            padding: 0.35rem 0.5rem !important;
            font-size: 0.725rem !important;
            font-weight: 700 !important;
            letter-spacing: -0.01em;
        }
        .dropdown-menu .material-symbols-outlined {
            font-size: 1.1rem !important;
        }
        
        /* Premium Card Badge Glows */
        .tab-view span.inline-flex {
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            transition: all 0.3s ease;
        }
        .tab-view tr:hover span.inline-flex {
            transform: scale(1.05);
        }
        /* --- Filter Slider Drawer --- */
        #filter-drawer {
            position: fixed;
            top: 0;
            right: 0;
            height: 100vh;
            width: 50%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            z-index: 10001;
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: -10px 0 40px rgba(0,0,0,0.1);
            border-left: 1px solid rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }
        .dark #filter-drawer {
            background: rgba(17, 26, 34, 0.95);
            border-left: 1px solid rgba(255,255,255,0.05);
            box-shadow: -10px 0 40px rgba(0,0,0,0.4);
        }
        #filter-drawer.active {
            transform: translateX(0);
        }
        @media (max-width: 1024px) {
            #filter-drawer {
                top: 0;
                bottom: 0;
                right: 0;
                height: 100vh;
                width: 60%;
                border-radius: 40px 0 0 40px; /* Only round left corners for side drawer */
                border: none;
                border-left: 1px solid rgba(0,0,0,0.05);
                transform: translateX(100%);
            }
            .dark #filter-drawer {
                border-left: 1px solid rgba(255,255,255,0.05);
            }
            #filter-drawer.active {
                transform: translateX(0);
            }
        }
        @media (max-width: 640px) {
            #filter-drawer {
                width: 85%;
                border-radius: 32px 0 0 32px;
            }
        }
        #filter-drawer-overlay, #question-filter-drawer-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        #filter-drawer-overlay.active, #question-filter-drawer-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        #filter-drawer.active, #question-filter-drawer.active {
            transform: translateX(0);
        }
        /* --- Filter Close Button Animation --- */
        .close-drawer-btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .close-drawer-btn span {
            display: inline-block;
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .close-drawer-btn:hover {
            background: rgba(239, 68, 68, 0.1) !important;
            color: #ef4444 !important;
            transform: scale(1.05);
        }
        .close-drawer-btn:active {
            transform: scale(0.95);
        }
        .close-drawer-btn:hover span {
            transform: rotate(90deg);
        }
        #filter-drawer.active .close-drawer-btn span, #question-filter-drawer.active .close-drawer-btn span {
            animation: btn-entry-spin 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.2s both;
        }
        @keyframes btn-entry-spin {
            from { transform: rotate(-180deg) scale(0); opacity: 0; }
            to { transform: rotate(0) scale(1); opacity: 1; }
        }

        /* --- Mobile Filter Pill drawer specific --- */
        .filter-pill-drawer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 1rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 600;
            background: rgba(43, 140, 238, 0.05);
            color: #64748b;
            border: 1px solid transparent;
            transition: all 0.2s;
        }
        .filter-pill-drawer.active {
            background: #2b8cee;
            color: white;
            box-shadow: 0 8px 16px rgba(43, 140, 238, 0.2);
        }
        .dark .filter-pill-drawer {
            background: rgba(255, 255, 255, 0.03);
            color: #92adc9;
        }
        .dark .filter-pill-drawer.active {
            background: #2b8cee;
            color: white;
        }

        /* Mobile Filter Slider */
        .mobile-filter-container {
            display: grid;
            grid-template-rows: 1fr;
            transition: grid-template-rows 0.5s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s ease;
            opacity: 1;
        }

        @media (max-width: 1023px) {
            .mobile-filter-container.collapsed {
                grid-template-rows: 0fr;
                opacity: 0;
                pointer-events: none;
            }
        }

        .mobile-filter-inner {
            overflow: hidden;
        }

        /* Question Modal Parameter Slider (Responsive) */
        .question-param-container {
            display: grid;
            grid-template-rows: 1fr;
            transition: grid-template-rows 0.5s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.4s ease, margin 0.5s ease, transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            opacity: 1;
        }

        @media (max-width: 1023px) {
            .question-param-container {
                margin-top: 1.25rem;
            }
            .question-param-container.collapsed {
                grid-template-rows: 0fr;
                opacity: 0;
                margin-top: 0 !important;
                margin-bottom: 0 !important;
                pointer-events: none;
                transform: translateY(-10px);
            }
        }
        .question-param-inner {
            overflow: hidden;
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-slate-100 antialiased">
    <div id="toast-container" class="fixed top-28 right-8 z-[99999] flex flex-col gap-4 pointer-events-none items-end">
    </div>
    <div class="flex h-screen overflow-hidden">
        <aside id="main-sidebar"
            class="relative z-[100] w-[72px] transition-all duration-500 cubic-bezier(0.16, 1, 0.3, 1)">
            <div
                class="group absolute top-0 left-0 h-screen w-[72px] hover:w-64 flex flex-col border-r border-slate-200/60 dark:border-slate-800/60 bg-white/95 dark:bg-[#111a22]/95 backdrop-blur-xl transition-all duration-500 cubic-bezier(0.16, 1, 0.3, 1) overflow-hidden hover:shadow-[10px_0_40px_-15px_rgba(0,0,0,0.1)] dark:hover:shadow-[10px_0_40px_-15px_rgba(0,0,0,0.4)] z-[100]">
                <div class="py-6 flex flex-col items-start transition-all duration-500">
                    <div class="flex items-center h-12 w-full">
                        <div class="w-[72px] flex-shrink-0 flex items-center justify-center">
                            <span class="material-symbols-outlined text-3xl font-bold text-primary">diamond</span>
                        </div>
                        <div
                            class="flex-1 flex items-center justify-between opacity-0 group-hover:opacity-100 translate-x-4 group-hover:translate-x-0 transition-all duration-500 whitespace-nowrap -ml-2 pr-6">
                            <div class="flex flex-col">
                                <h1 class="text-xl font-bold tracking-tight dark:text-white leading-tight">Prefix</h1>
                                <p
                                    class="text-slate-500 dark:text-[#92adc9] text-[10px] font-semibold uppercase tracking-wider">
                                    Enterprise Admin</p>
                            </div>
                            <button onclick="toggleSidebarMode()" id="sidebar-mode-toggle"
                                class="w-6 h-6 rounded-full border border-slate-200 dark:border-slate-800 flex items-center justify-center bg-white dark:bg-[#1a252f] shadow-sm hover:scale-110 active:scale-95 transition-all group/toggle"
                                title="Toggle Sidebar Mode">
                                <div id="sidebar-toggle-dot"
                                    class="w-1.5 h-1.5 rounded-full bg-[#0bda5b] shadow-[0_0_10px_rgba(11,218,91,0.8)] animate-pulse">
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
                <nav class="flex-1 px-3 mt-4 space-y-1.5">
                    <button
                        class="nav-link w-full flex items-center gap-4 px-3 py-3 rounded-xl text-slate-500 dark:text-[#92adc9] hover:text-primary transition-all duration-300 active relative group/link overflow-hidden"
                        id="nav-dashboard" onclick="switchPage('dashboard', this)">
                        <span class="material-symbols-outlined shrink-0 transition-all duration-300">dashboard</span>
                        <span
                            class="opacity-0 group-hover:opacity-100 translate-x-4 group-hover:translate-x-0 transition-all duration-500 whitespace-nowrap font-medium">Dashboard</span>
                    </button>
                    <button
                        class="nav-link w-full flex items-center gap-4 px-3 py-3 rounded-xl text-slate-500 dark:text-[#92adc9] hover:text-primary transition-all duration-300 relative group/link overflow-hidden"
                        id="nav-users" onclick="switchPage('users', this)">
                        <span class="material-symbols-outlined shrink-0 transition-all duration-300">group</span>
                        <span
                            class="opacity-0 group-hover:opacity-100 translate-x-4 group-hover:translate-x-0 transition-all duration-500 whitespace-nowrap font-medium">Users
                            Management</span>
                    </button>
                    <button
                        class="nav-link w-full flex items-center gap-4 px-3 py-3 rounded-xl text-slate-500 dark:text-[#92adc9] hover:text-primary transition-all duration-300 relative group/link overflow-hidden"
                        id="nav-questions" onclick="switchPage('questions', this); loadQuestions();">
                        <span class="material-symbols-outlined shrink-0 transition-all duration-300">quiz</span>
                        <span
                            class="opacity-0 group-hover:opacity-100 translate-x-4 group-hover:translate-x-0 transition-all duration-500 whitespace-nowrap font-medium">Question
                            Bank</span>
                    </button>
                    <button
                        class="nav-link w-full flex items-center gap-4 px-3 py-3 rounded-xl text-slate-500 dark:text-[#92adc9] hover:text-primary transition-all duration-300 relative group/link overflow-hidden"
                        id="nav-leaderboard" onclick="switchPage('leaderboard', this)">
                        <span class="material-symbols-outlined shrink-0 transition-all duration-300">leaderboard</span>
                        <span
                            class="opacity-0 group-hover:opacity-100 translate-x-4 group-hover:translate-x-0 transition-all duration-500 whitespace-nowrap font-medium">Leaderboard</span>
                    </button>
                    <button
                        class="nav-link w-full flex items-center gap-4 px-3 py-3 rounded-xl text-slate-500 dark:text-[#92adc9] hover:text-primary transition-all duration-300 relative group/link overflow-hidden"
                        id="nav-live-mock" onclick="switchPage('live-mock', this)">
                        <span class="material-symbols-outlined shrink-0 transition-all duration-300">bar_chart</span>
                        <span
                            class="opacity-0 group-hover:opacity-100 translate-x-4 group-hover:translate-x-0 transition-all duration-500 whitespace-nowrap font-medium">Live
                            Mock Analytics</span>
                    </button>
                    <div class="pt-6 mt-6 border-t border-slate-200/60 dark:border-slate-800/60">
                        <button id="nav-settings" onclick="switchPage('settings', this)"
                            class="nav-link w-full flex items-center gap-4 px-3 py-3 rounded-xl text-slate-500 dark:text-[#92adc9] transition-all duration-300 relative group/link overflow-hidden">
                            <span class="material-symbols-outlined shrink-0 transition-all duration-300">settings</span>
                            <span
                                class="opacity-0 group-hover:opacity-100 translate-x-4 group-hover:translate-x-0 transition-all duration-500 whitespace-nowrap font-medium">Platform
                                Settings</span>
                        </button>
                    </div>
                </nav>
                <div
                    class="p-4 bg-primary/5 dark:bg-primary/10 m-3 rounded-2xl border border-primary/10 opacity-0 group-hover:opacity-100 translate-y-4 group-hover:translate-y-0 transition-all duration-500 overflow-hidden">
                    <p class="text-[10px] font-bold text-primary mb-2 whitespace-nowrap uppercase tracking-tighter">
                        System Storage</p>
                    <div class="w-full bg-slate-200 dark:bg-slate-700 h-1.5 rounded-full overflow-hidden">
                        <div class="bg-primary h-full w-[65%] shadow-[0_0_8px_rgba(43,140,238,0.5)]"></div>
                    </div>
                    <div class="flex items-center justify-between mt-2">
                        <p class="text-[0.625rem] text-slate-400 dark:text-slate-500 font-bold">6.5GB / 10GB</p>
                        <p class="text-[0.625rem] text-primary font-black">65%</p>
                    </div>
                </div>
            </div>
            <!-- Mobile Toggle Button (Attached to sidebar edge) -->
            <button id="mobile-menu-toggle" onclick="toggleMobileSidebar()"
                class="md:hidden flex flex-col items-center justify-center w-10 h-10 rounded-xl text-slate-500 dark:text-[#92adc9] transition-all hover:bg-slate-100 dark:hover:bg-[#233648] hamburger-btn gap-1.5 p-2 overflow-hidden"
                title="Menu">
                <span class="block w-5 h-0.5 bg-current rounded-full"></span>
                <span class="block w-5 h-0.5 bg-current rounded-full"></span>
                <span class="block w-5 h-0.5 bg-current rounded-full"></span>
            </button>
        </aside>
        <main class="flex-1 flex flex-col min-w-0 overflow-hidden">
            <!-- Sidebar Overlay (Inside main for stacking) -->
            <div id="sidebar-overlay" onclick="toggleMobileSidebar()" 
                class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm hidden transition-opacity opacity-0"></div>
            <header
                class="h-[72px] flex items-center justify-between px-4 md:px-8 bg-white dark:bg-[#111a22] border border-slate-200 dark:border-slate-800 rounded-2xl mx-2 md:mx-4 mt-2 md:mt-6 mb-2 flex-shrink-0 shadow-sm transition-all duration-300">
                <div class="flex items-center gap-3 flex-1">
                    <div class="w-10 h-10 md:hidden flex-shrink-0"></div> <!-- Placeholder for floating button -->
                    <div class="w-full max-w-sm hidden sm:block">
                        <div class="relative">
                            <span
                                class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 dark:text-[#92adc9] text-xl">search</span>
                            <input
                                class="w-full bg-slate-50 dark:bg-[#1a252f] border-none rounded-lg py-2 pl-10 pr-4 text-sm focus:ring-2 focus:ring-primary/50 text-slate-900 dark:text-white placeholder:text-slate-500 dark:placeholder:text-[#92adc9]"
                                placeholder="Search database..." type="text" />
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-1">
                    <button
                        class="relative w-10 h-10 flex items-center justify-center text-slate-500 dark:text-[#92adc9] hover:bg-slate-100 dark:hover:bg-[#233648] rounded-lg transition-colors group"
                        onclick="toggleTheme()" title="Toggle Theme">
                        <span class="material-symbols-outlined theme-toggle-dark text-[22px]">light_mode</span>
                        <span class="material-symbols-outlined theme-toggle-light text-[22px]">dark_mode</span>
                    </button>
                    <div class="h-6 w-[1px] bg-slate-200 dark:bg-[#233648] mx-1"></div>
                    <button
                        class="p-2 text-slate-500 dark:text-[#92adc9] hover:bg-slate-100 dark:hover:bg-[#233648] rounded-lg relative">
                        <span class="material-symbols-outlined">notifications</span>
                        <span
                            class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-white dark:border-background-dark"></span>
                    </button>
                    <button
                        class="p-2 text-slate-500 dark:text-[#92adc9] hover:bg-slate-100 dark:hover:bg-[#233648] rounded-lg">
                        <span class="material-symbols-outlined">help</span>
                    </button>
                    <div class="h-8 w-[1px] bg-slate-200 dark:bg-[#233648] mx-2"></div>
                    <div class="relative">
                        <div class="flex items-center gap-3 pl-2 group cursor-pointer"
                            onclick="toggleProfileDropdown()">
                            <div class="text-right hidden sm:block">
                                <p id="header-admin-name" class="text-sm font-semibold dark:text-white leading-tight">
                                    Admin</p>
                                <p id="header-admin-role"
                                    class="text-[10px] text-slate-500 dark:text-[#92adc9] uppercase font-bold tracking-tight">
                                    System Administrator</p>
                            </div>
                            <div
                                class="w-9 h-9 rounded-full bg-primary/20 flex items-center justify-center border border-primary/30 overflow-hidden">
                                <img id="header-admin-avatar" alt="Avatar"
                                    src="https://ui-avatars.com/api/?name=Admin&background=2b8cee&color=fff" />
                            </div>
                        </div>

                        <!-- Profile Dropdown -->
                        <div id="profile-dropdown"
                            class="absolute right-0 mt-2 w-56 bg-white dark:bg-[#1a252f] rounded-xl shadow-xl border border-slate-200 dark:border-[#324d67] py-1 hidden z-50 animate-scale-in">
                            <div class="px-4 py-3 border-b border-slate-100 dark:border-[#324d67]">
                                <p id="dropdown-admin-name" class="text-sm font-bold dark:text-white truncate">Admin
                                    User</p>
                                <p id="dropdown-admin-email"
                                    class="text-[10px] text-slate-500 dark:text-[#92adc9] truncate">admin@prefix.edu</p>
                            </div>
                            <button
                                onclick="switchPage('settings', document.getElementById('nav-settings')); toggleProfileDropdown();"
                                class="w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-white hover:bg-slate-50 dark:hover:bg-[#233648] flex items-center gap-2">
                                <span class="material-symbols-outlined text-lg">person</span> Profile Settings
                            </button>
                            <button onclick="handleLogout()"
                                class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 flex items-center gap-2">
                                <span class="material-symbols-outlined text-lg">logout</span> Logout
                            </button>
                        </div>
                    </div>
                </div>
            </header>
            <div class="flex-1 overflow-y-auto p-4 md:p-6 custom-scrollbar">
                <div class="page-content active" id="page-dashboard">
                    <div class="mb-4 flex items-center justify-between">
                        <div>
                            <h2 class="text-xl font-bold dark:text-white leading-none">Dashboard Overview</h2>
                            <p class="text-[10px] text-slate-500 dark:text-[#92adc9] mt-1">Welcome back! Here's what's
                                happening today.</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-[#0bda5b] pulse-dot"></span>
                            <span class="text-[10px] font-bold text-slate-500 dark:text-[#92adc9] uppercase">Live Sync
                                Active</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-1">
                        <div
                            class="premium-glass p-3 rounded-2xl flex flex-col justify-between transition-all duration-300">
                            <div class="flex justify-between items-center mb-1">
                                <p
                                    class="text-slate-500 dark:text-[#92adc9] text-[10px] font-bold uppercase tracking-wider">
                                    Total Users</p>
                                <span class="text-xl font-black dark:text-white" id="dash-total-users">--</span>
                            </div>
                            <div
                                class="grid grid-cols-2 gap-3 border-t border-slate-200/50 dark:border-slate-800/50 pt-1.5">
                                <div class="flex flex-col gap-1 cursor-pointer hover:bg-primary/5 transition-all rounded-xl p-2 -m-2"
                                    onclick="navigateToUsers('experts', 'all')">
                                    <div class="flex items-center gap-2">
                                        <span class="material-symbols-outlined text-primary text-lg">school</span>
                                        <span
                                            class="text-[10px] font-bold text-slate-500 dark:text-[#92adc9]">Experts</span>
                                    </div>
                                    <div class="pl-7">
                                        <p class="text-lg font-bold dark:text-white" id="dash-total-experts">--</p>
                                        <div class="flex items-center text-[10px] text-[#0bda5b] font-black">
                                            <span class="material-symbols-outlined text-[10px]">trending_up</span> 4%
                                        </div>
                                    </div>
                                </div>
                                <div class="flex flex-col gap-1 cursor-pointer hover:bg-primary/5 transition-all rounded-xl p-2 -m-2"
                                    onclick="navigateToUsers('aspirants', 'all')">
                                    <div class="flex items-center gap-2">
                                        <span class="material-symbols-outlined text-purple-500 text-lg">person</span>
                                        <span
                                            class="text-[10px] font-bold text-slate-500 dark:text-[#92adc9]">Aspirants</span>
                                    </div>
                                    <div class="pl-7">
                                        <p class="text-lg font-bold dark:text-white" id="dash-total-aspirants">--</p>
                                        <div class="flex items-center text-[10px] text-[#0bda5b] font-black">
                                            <span class="material-symbols-outlined text-[10px]">trending_up</span> 14%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="premium-glass p-3 rounded-2xl cursor-pointer transition-all duration-300 group"
                            onclick="switchPage('questions', document.getElementById('nav-questions'))">
                            <div class="flex justify-between items-start mb-1">
                                <div
                                    class="p-1.5 bg-purple-500/10 rounded-xl group-hover:bg-purple-500/20 transition-colors">
                                    <span
                                        class="material-symbols-outlined text-purple-500 text-lg font-bold">quiz</span>
                                </div>
                                <span class="text-[#0bda5b] text-[10px] font-black flex items-center">
                                    <span class="material-symbols-outlined text-[10px]">trending_up</span> 5%
                                </span>
                            </div>
                            <p
                                class="text-slate-500 dark:text-[#92adc9] text-[10px] font-bold uppercase tracking-wider">
                                Total Questions</p>
                            <p class="text-xl font-black dark:text-white mt-0.5" id="dash-total-questions">--</p>
                        </div>
                        <div
                            class="premium-glass p-3 rounded-2xl flex flex-col justify-between transition-all duration-300">
                            <div class="flex justify-between items-center mb-1">
                                <p
                                    class="text-slate-500 dark:text-[#92adc9] text-[10px] font-bold uppercase tracking-wider">
                                    Pending Approvals</p>
                                <span class="text-xl font-black dark:text-white" id="dash-total-pending">--</span>
                            </div>
                            <div
                                class="grid grid-cols-2 gap-3 border-t border-slate-200/50 dark:border-slate-800/50 pt-1.5">
                                <div class="flex flex-col gap-1 cursor-pointer hover:bg-primary/5 transition-all rounded-xl p-2 -m-2"
                                    onclick="navigateToUsers('experts', 'pending')">
                                    <div class="flex items-center gap-2">
                                        <span class="material-symbols-outlined text-orange-500 text-lg">school</span>
                                        <span
                                            class="text-[10px] font-bold text-slate-500 dark:text-[#92adc9]">Experts</span>
                                    </div>
                                    <div class="pl-7">
                                        <p class="text-lg font-bold dark:text-white" id="dash-card-experts-count">--</p>
                                        <div class="flex items-center text-[10px] text-[#fa6238] font-black">
                                            <span class="material-symbols-outlined text-[10px]">trending_up</span> 12%
                                        </div>
                                    </div>
                                </div>
                                <div class="flex flex-col gap-1 cursor-pointer hover:bg-primary/5 transition-all rounded-xl p-2 -m-2"
                                    onclick="navigateToUsers('aspirants', 'pending')">
                                    <div class="flex items-center gap-2">
                                        <span class="material-symbols-outlined text-orange-500 text-lg">person</span>
                                        <span
                                            class="text-[10px] font-bold text-slate-500 dark:text-[#92adc9]">Aspirants</span>
                                    </div>
                                    <div class="pl-7">
                                        <p class="text-lg font-bold dark:text-white" id="dash-card-aspirants-count">--
                                        </p>
                                        <div class="flex items-center text-[10px] text-[#fa6238] font-black">
                                            <span class="material-symbols-outlined text-[10px]">trending_down</span> 2%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="premium-glass p-2.5 rounded-2xl cursor-pointer transition-all duration-300 group"
                            onclick="switchPage('questions', document.getElementById('nav-questions')); loadQuestions();">
                            <div class="flex justify-between items-start mb-1">
                                <div
                                    class="p-1 bg-[#06b6d4]/10 rounded-xl group-hover:bg-[#06b6d4]/20 transition-colors">
                                    <span
                                        class="material-symbols-outlined text-[#06b6d4] text-base font-bold">assignment_turned_in</span>
                                </div>
                                <span class="text-[#0bda5b] text-[10px] font-black flex items-center">
                                    <span class="material-symbols-outlined text-[10px]">trending_up</span> 8%
                                </span>
                            </div>
                            <p
                                class="text-slate-500 dark:text-[#92adc9] text-[10px] font-bold uppercase tracking-wider">
                                Active Exams</p>
                            <p class="text-xl font-black dark:text-white mt-0.5">15</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-3 flex-1 min-h-0">
                        <div
                            class="lg:col-span-2 premium-glass p-3 rounded-2xl transition-all duration-300 flex flex-col">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center gap-4">
                                    <div>
                                        <h3 class="font-black text-lg dark:text-white">Platform Growth</h3>
                                        <p
                                            class="text-[10px] uppercase font-bold text-slate-500 dark:text-[#92adc9] tracking-tighter">
                                            User engagement velocity</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-6">
                                    <div class="flex items-center gap-2">
                                        <span
                                            class="w-2.5 h-2.5 rounded-full bg-[#06b6d4] shadow-[0_0_10px_rgba(6,182,212,0.5)]"></span>
                                        <span
                                            class="text-[10px] font-black text-slate-500 dark:text-[#92adc9] uppercase">Experts</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span
                                            class="w-2.5 h-2.5 rounded-full bg-[#ec4899] shadow-[0_0_10px_rgba(236,72,153,0.5)]"></span>
                                        <span
                                            class="text-[10px] font-black text-slate-500 dark:text-[#92adc9] uppercase">Aspirants</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-1 min-h-0" id="platform-growth-chart"></div>
                        </div>
                        <div class="flex flex-col gap-1 min-h-0">
                            <div class="premium-glass p-2.5 rounded-2xl transition-all duration-300 flex-1">
                                <h3 class="font-black text-base dark:text-white mb-1">Content Status</h3>
                                <div class="space-y-1">
                                    <div>
                                        <div
                                            class="flex justify-between text-[10px] font-bold uppercase tracking-wider mb-1">
                                            <span class="text-slate-500 dark:text-[#92adc9]">Total Users</span>
                                            <span class="text-primary" id="status-total-users">--</span>
                                        </div>
                                        <div
                                            class="w-full bg-slate-100 dark:bg-slate-800 h-2 rounded-full overflow-hidden">
                                            <div id="bar-total-users"
                                                class="bg-primary h-full w-0 shadow-[0_0_10px_rgba(43,140,238,0.4)] transition-all duration-1000">
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <div
                                            class="flex justify-between text-[10px] font-bold uppercase tracking-wider mb-1">
                                            <span class="text-slate-500 dark:text-[#92adc9]">Question Bank</span>
                                            <span class="text-purple-500" id="status-total-questions">--</span>
                                        </div>
                                        <div
                                            class="w-full bg-slate-100 dark:bg-slate-800 h-2 rounded-full overflow-hidden">
                                            <div id="bar-total-questions"
                                                class="bg-purple-500 h-full w-0 shadow-[0_0_10px_rgba(168,85,247,0.4)] transition-all duration-1000">
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <div
                                            class="flex justify-between text-[10px] font-bold uppercase tracking-wider mb-1">
                                            <span class="text-slate-500 dark:text-[#92adc9]">Pending Approvals</span>
                                            <span class="text-orange-500" id="status-pending-approvals">--</span>
                                        </div>
                                        <div
                                            class="w-full bg-slate-100 dark:bg-slate-800 h-2 rounded-full overflow-hidden">
                                            <div id="bar-pending-approvals"
                                                class="bg-orange-500 h-full w-0 shadow-[0_0_10px_rgba(249,115,22,0.4)] transition-all duration-1000">
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <div
                                            class="flex justify-between text-[10px] font-bold uppercase tracking-wider mb-1">
                                            <span class="text-slate-500 dark:text-[#92adc9]">Active Exams</span>
                                            <span class="text-[#0bda5b]" id="status-active-exams">15</span>
                                        </div>
                                        <div
                                            class="w-full bg-slate-100 dark:bg-slate-800 h-2 rounded-full overflow-hidden">
                                            <div id="bar-active-exams"
                                                class="bg-[#0bda5b] h-full w-[75%] shadow-[0_0_10px_rgba(11,218,91,0.4)] transition-all duration-1000">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Separate Weekly Insights Card -->
                            <div class="premium-glass p-3 rounded-2xl transition-all duration-300 mb-4 lg:mb-0">
                                <div class="p-2.5 rounded-xl bg-primary/5 border border-primary/10">
                                    <div class="flex items-center justify-between mb-1">
                                        <p class="text-[10px] font-black text-primary uppercase tracking-widest">Weekly
                                            Insights</p>
                                        <span class="material-symbols-outlined text-primary text-xs">trending_up</span>
                                    </div>
                                    <p class="text-[10px] text-slate-400 dark:text-slate-500 leading-tight mb-2">Sprint
                                        performance report ready.</p>
                                    <button
                                        class="w-full text-[10px] font-black text-white bg-primary py-1.5 rounded-lg hover:bg-primary/90 transition-all shadow-sm flex items-center justify-center gap-2">
                                        <span class="material-symbols-outlined text-[10px]">download</span> Download
                                        Report
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="page-content hidden" data-active-tab="experts" id="page-users">

                    <div class="mb-8 flex flex-col lg:flex-row lg:items-end justify-between gap-6">
                        <div class="flex-1">
                            <h2 class="text-2xl font-bold dark:text-white">User Management</h2>
                            <p class="text-slate-500 dark:text-[#92adc9]">Manage roles, verify accounts and monitor user
                                statuses.</p>
                            <!-- Search Bar for Mobile/Tablet (Visible below title) -->
                            <div class="flex items-center gap-2 mt-4 lg:hidden">
                                <div class="relative flex-1">
                                    <span
                                        class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 dark:text-[#92adc9] text-lg">search</span>
                                    <input
                                        class="w-full bg-white dark:bg-[#1a252f] border border-slate-200 dark:border-[#324d67] rounded-xl py-3 pl-10 pr-4 text-sm focus:ring-1 focus:ring-primary text-slate-900 dark:text-white placeholder:text-slate-400 shadow-sm"
                                        placeholder="Search by name or email..." type="text" onkeyup="if(event.key === 'Enter') fetchUsers(currentUserRole, currentFilterStatus, 1, this.value)" />
                                </div>
                                <button onclick="toggleFilterDrawer()" class="w-12 h-12 flex items-center justify-center bg-white dark:bg-[#1a252f] border border-slate-200 dark:border-[#324d67] rounded-xl text-slate-500 transition-all active:scale-90 shadow-sm">
                                    <span class="material-symbols-outlined">filter_list</span>
                                </button>
                            </div>
                        </div>
                        <div class="flex flex-col sm:flex-row items-center gap-3 w-full lg:w-auto">
                            <!-- Search Bar for Desktop (Visible on large screens) -->
                            <div class="relative w-64 hidden lg:block">
                                <span
                                    class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 dark:text-[#92adc9] text-lg">search</span>
                                <input
                                    class="w-full bg-white dark:bg-[#1a252f] border border-slate-200 dark:border-[#324d67] rounded-lg py-2 pl-9 pr-4 text-xs focus:ring-1 focus:ring-primary text-slate-900 dark:text-white placeholder:text-slate-400"
                                    placeholder="Search users..." type="text" onkeyup="if(event.key === 'Enter') fetchUsers(currentUserRole, currentFilterStatus, 1, this.value)" />
                            </div>
                            <button
                                class="w-full sm:w-auto bg-primary text-white px-5 py-2.5 rounded-xl font-bold text-sm flex items-center justify-center gap-2 hover:bg-primary/90 transition-all shadow-lg shadow-primary/20 active:scale-95"
                                id="btn-add-expert" onclick="openModal('modal-add-expert')">
                                <span class="material-symbols-outlined text-lg">school</span>
                                <span>Add Expert</span>
                            </button>
                            <button
                                class="w-full sm:w-auto bg-primary text-white px-5 py-2.5 rounded-xl font-bold text-sm flex items-center justify-center gap-2 hover:bg-primary/90 transition-all shadow-lg shadow-primary/20 active:scale-95"
                                id="btn-add-aspirant" onclick="openModal('modal-add-aspirant')">
                                <span class="material-symbols-outlined text-lg">person</span>
                                <span>Add Aspirant</span>
                            </button>
                        </div>
                    </div>
                    <div
                        class="flex flex-col md:flex-row md:items-center justify-between border-b border-slate-200 dark:border-[#324d67] mb-6 gap-4">
                        <div class="flex items-center">
                            <button
                                class="tab-btn px-6 py-3 text-sm font-black border-b-2 border-transparent transition-all active"
                                id="tab-experts" onclick="switchTab('experts')">
                                Experts (1,240)
                            </button>
                            <button
                                class="tab-btn px-6 py-3 text-sm font-black border-b-2 border-transparent transition-all"
                                id="tab-aspirants" onclick="switchTab('aspirants')">
                                Aspirants (11,600)
                            </button>
                        </div>
                        <div
                            class="hidden lg:flex items-center gap-2 pb-2 md:pb-0 overflow-x-auto custom-scrollbar whitespace-nowrap mask-fade-right">
                            <button id="filter-all" class="filter-pill active" onclick="applyFilter('all', this)">
                                <span class="expert-label">All Experts</span>
                                <span class="aspirant-label">All Aspirants</span>
                            </button>
                            <button id="filter-approved" class="filter-pill" onclick="applyFilter('approved', this)">
                                <span class="expert-label">Approved</span>
                                <span class="aspirant-label">Approved</span>
                            </button>
                            <button id="filter-suspended" class="filter-pill" onclick="applyFilter('suspended', this)">
                                <span class="expert-label">Suspended</span>
                                <span class="aspirant-label">Suspended</span>
                            </button>
                            <button id="filter-pending" class="filter-pill" onclick="applyFilter('pending', this)">
                                <span class="expert-label">Pending</span>
                                <span class="aspirant-label">Pending</span>
                            </button>
                        </div>
                    </div>
                    <div class="tab-view block" id="tab-content-experts">
                        <div
                            class="bg-white dark:bg-background-dark rounded-xl border border-slate-200 dark:border-[#324d67] shadow-sm overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left">
                                    <thead
                                        class="bg-slate-50 dark:bg-[#1a252f] text-slate-500 dark:text-[#92adc9] text-xs uppercase tracking-wider font-bold">
                                        <tr>
                                            <th class="px-6 py-4 w-10 md:table-cell hidden">
                                                <input type="checkbox" class="rounded border-slate-300 text-primary focus:ring-primary h-4 w-4" onchange="toggleSelectAll('expert', this)">
                                            </th>
                                            <th class="px-6 py-4 w-16 md:table-cell hidden">S.No</th>
                                            <th class="px-6 py-4">Expert Profile</th>
                                            <th class="px-6 py-4">Specialization</th>
                                            <th class="px-6 py-4">Joined Date</th>
                                            <th class="px-6 py-4">Verification</th>
                                            <th class="px-6 py-4">Status</th>
                                            <th class="px-6 py-4 text-right">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbody-experts"
                                        class="text-sm dark:text-white divide-y divide-slate-100 dark:divide-[#324d67]">
                                        <!-- Existing Rows -->
                                        <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                            <td class="px-6 py-4 w-10 md:table-cell hidden">
                                                <input type="checkbox" class="user-checkbox rounded border-slate-300 text-primary focus:ring-primary h-4 w-4">
                                            </td>
                                            <td class="px-6 py-4 w-16 md:table-cell hidden" data-label="S.No">1</td>
                                            <td class="px-6 py-4" data-label="Expert Profile">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 rounded-full bg-slate-200 overflow-hidden">
                                                        <img alt="User"
                                                            src="https://lh3.googleusercontent.com/aida-public/AB6AXuAajaArR2whI0qaa_VKIU3fjO8fOomcp_4iF7PtU2oIoa7wW3YvwRHcVn9EQNo4BRlHY5Z7rbOs3cWRJzvIsZQuPh8MTXZV7WFl_zj-kL7EhGtKYR-Zc5Stpr5ybrDEcz_v3lM4QzZ1YkZHQJA3Mt86uq2Cn23QxLqp8dqF2So6QzlIyK30q0MlRD9R6wmTscx_WwfJcb4rIdaZxZ7GR_R1TNUp5GL91OmT5_OoVMXSisGF_E6raDEUp9FqwhkcC9RfxahS7_J3rk4i" />
                                                    </div>
                                                    <div>
                                                        <p class="font-bold">Dr. Robert Vance</p>
                                                        <p class="text-xs text-slate-500 dark:text-[#92adc9]">
                                                            robert.v@prefix.edu</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4" data-label="Specialization">Organic Chemistry</td>
                                            <td class="px-6 py-4 text-slate-500 dark:text-[#92adc9]" data-label="Joined Date">Oct 12, 2023</td>
                                            <td class="px-6 py-4" data-label="Verification">
                                                <span
                                                    class="bg-orange-100 dark:bg-orange-500/10 text-orange-600 dark:text-orange-400 px-2 py-1 rounded text-[0.625rem] font-bold uppercase">Pending
                                                    Review</span>
                                            </td>
                                            <td class="px-6 py-4" data-label="Status">
                                                <span class="inline-flex items-center gap-1.5 text-xs font-bold text-slate-500"><span class="h-2 w-2 rounded-full bg-slate-300"></span> Inactive</span>
                                            </td>
                                            <td class="px-6 py-4 text-right" data-label="Actions">
                                                <div class="flex justify-end gap-2">
                                                    <button
                                                        class="text-green-500 hover:text-green-600 hover:bg-green-50 dark:hover:bg-green-500/10 p-1.5 rounded-lg transition-colors"
                                                        title="Approve">
                                                        <span
                                                            class="material-symbols-outlined text-xl">check_circle</span>
                                                    </button>
                                                    <button
                                                        class="text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 p-1.5 rounded-lg transition-colors"
                                                        title="Reject">
                                                        <span class="material-symbols-outlined text-xl">cancel</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                            <td class="px-6 py-4">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 rounded-full bg-slate-200 overflow-hidden">
                                                        <img alt="User"
                                                            src="https://lh3.googleusercontent.com/aida-public/AB6AXuCWMR0E1AbvdMehGB-TxbhWtwLWB7jlrgLPU-sWPKZtGx__a1zpmphisxMm4Hr1Fosax9Ux_33YYVkGxLnzgYAZDLFcpIJ-uHKA_y1CzJlEn__dg-tqUixV6_xl5ON8xXNb3ysoa0ryjmdqOkIYMMvd9S9h4M98XE_BnpZ3UUrpAz2qsGOUMnph2w0QbkIZkWdZcqpCGvX0nEACSje-GWoBI64g_rW00PKOxNt80mW_bcgh2w4PObcyEPk_G3u3Pp2ZV4u0PDZWspV5" />
                                                    </div>
                                                    <div>
                                                        <p class="font-bold">Prof. Jane Cooper</p>
                                                        <p class="text-xs text-slate-500 dark:text-[#92adc9]">
                                                            jane.c@prefix.edu</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">Applied Physics</td>
                                            <td class="px-6 py-4 text-slate-500 dark:text-[#92adc9]">Sep 28, 2023</td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="bg-green-100 dark:bg-green-500/10 text-green-600 dark:text-green-400 px-2 py-1 rounded text-[0.625rem] font-bold uppercase">Verified</span>
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <div class="flex justify-end gap-1">
                                                    <button
                                                        class="text-slate-500 hover:text-primary hover:bg-blue-50 dark:hover:bg-blue-500/10 p-2 rounded-lg transition-all"
                                                        title="Edit">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">edit_square</span>
                                                    </button>
                                                    <button
                                                        class="text-slate-500 hover:text-orange-500 hover:bg-orange-50 dark:hover:bg-orange-500/10 p-2 rounded-lg transition-all"
                                                        title="Suspend">
                                                        <span class="material-symbols-outlined text-[20px]">block</span>
                                                    </button>
                                                    <button
                                                        class="text-slate-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 p-2 rounded-lg transition-all"
                                                        title="Remove">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">delete</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                            <td class="px-6 py-4">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 rounded-full bg-slate-200 overflow-hidden">
                                                        <img alt="User"
                                                            src="https://ui-avatars.com/api/?name=Alan+Grant&background=random" />
                                                    </div>
                                                    <div>
                                                        <p class="font-bold">Dr. Alan Grant</p>
                                                        <p class="text-xs text-slate-500 dark:text-[#92adc9]">
                                                            alan.g@prefix.edu</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">Paleontology</td>
                                            <td class="px-6 py-4 text-slate-500 dark:text-[#92adc9]">Nov 05, 2023</td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="bg-orange-100 dark:bg-orange-500/10 text-orange-600 dark:text-orange-400 px-2 py-1 rounded text-[0.625rem] font-bold uppercase">Pending</span>
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <div class="flex justify-end gap-2">
                                                    <button
                                                        class="text-green-500 hover:text-green-600 hover:bg-green-50 dark:hover:bg-green-500/10 p-1.5 rounded-lg transition-colors"
                                                        title="Approve">
                                                        <span
                                                            class="material-symbols-outlined text-xl">check_circle</span>
                                                    </button>
                                                    <button
                                                        class="text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 p-1.5 rounded-lg transition-colors"
                                                        title="Reject">
                                                        <span class="material-symbols-outlined text-xl">cancel</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                            <td class="px-6 py-4">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 rounded-full bg-slate-200 overflow-hidden">
                                                        <img alt="User"
                                                            src="https://ui-avatars.com/api/?name=Ellie+Sattler&background=random" />
                                                    </div>
                                                    <div>
                                                        <p class="font-bold">Dr. Ellie Sattler</p>
                                                        <p class="text-xs text-slate-500 dark:text-[#92adc9]">
                                                            ellie.s@prefix.edu</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">Paleobotany</td>
                                            <td class="px-6 py-4 text-slate-500 dark:text-[#92adc9]">Nov 10, 2023</td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="bg-green-100 dark:bg-green-500/10 text-green-600 dark:text-green-400 px-2 py-1 rounded text-[0.625rem] font-bold uppercase">Active</span>
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <div class="flex justify-end gap-1">
                                                    <button
                                                        class="text-slate-500 hover:text-primary hover:bg-blue-50 dark:hover:bg-blue-500/10 p-2 rounded-lg transition-all"
                                                        title="Edit">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">edit_square</span>
                                                    </button>
                                                    <button
                                                        class="text-slate-500 hover:text-orange-500 hover:bg-orange-50 dark:hover:bg-orange-500/10 p-2 rounded-lg transition-all"
                                                        title="Suspend">
                                                        <span class="material-symbols-outlined text-[20px]">block</span>
                                                    </button>
                                                    <button
                                                        class="text-slate-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 p-2 rounded-lg transition-all"
                                                        title="Remove">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">delete</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                            <td class="px-6 py-4">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 rounded-full bg-slate-200 overflow-hidden">
                                                        <img alt="User"
                                                            src="https://ui-avatars.com/api/?name=Ian+Malcolm&background=random" />
                                                    </div>
                                                    <div>
                                                        <p class="font-bold">Dr. Ian Malcolm</p>
                                                        <p class="text-xs text-slate-500 dark:text-[#92adc9]">
                                                            ian.m@prefix.edu</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">Chaos Theory</td>
                                            <td class="px-6 py-4 text-slate-500 dark:text-[#92adc9]">Nov 15, 2023</td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="bg-green-100 dark:bg-green-500/10 text-green-600 dark:text-green-400 px-2 py-1 rounded text-[0.625rem] font-bold uppercase">Verified</span>
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <div class="flex justify-end gap-1">
                                                    <button
                                                        class="text-slate-500 hover:text-primary hover:bg-blue-50 dark:hover:bg-blue-500/10 p-2 rounded-lg transition-all"
                                                        title="Edit">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">edit_square</span>
                                                    </button>
                                                    <button
                                                        class="text-slate-500 hover:text-orange-500 hover:bg-orange-50 dark:hover:bg-orange-500/10 p-2 rounded-lg transition-all"
                                                        title="Suspend">
                                                        <span class="material-symbols-outlined text-[20px]">block</span>
                                                    </button>
                                                    <button
                                                        class="text-slate-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 p-2 rounded-lg transition-all"
                                                        title="Remove">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">delete</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <!-- Extra Hidden Rows -->
                                        <tr
                                            class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors hidden extra-row-expert">
                                            <td class="px-6 py-4">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 rounded-full bg-slate-200 overflow-hidden">
                                                        <img alt="User"
                                                            src="https://ui-avatars.com/api/?name=Sarah+Harding&background=random" />
                                                    </div>
                                                    <div>
                                                        <p class="font-bold">Dr. Sarah Harding</p>
                                                        <p class="text-xs text-slate-500 dark:text-[#92adc9]">
                                                            sarah.h@prefix.edu</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">Behavioral Ecology</td>
                                            <td class="px-6 py-4 text-slate-500 dark:text-[#92adc9]">Dec 01, 2023</td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="bg-green-100 dark:bg-green-500/10 text-green-600 dark:text-green-400 px-2 py-1 rounded text-[0.625rem] font-bold uppercase">Verified</span>
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <div class="flex justify-end gap-1">
                                                    <button
                                                        class="text-slate-500 hover:text-primary hover:bg-blue-50 dark:hover:bg-blue-500/10 p-2 rounded-lg transition-all"
                                                        title="Edit">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">edit_square</span>
                                                    </button>
                                                    <button
                                                        class="text-slate-500 hover:text-orange-500 hover:bg-orange-50 dark:hover:bg-orange-500/10 p-2 rounded-lg transition-all"
                                                        title="Suspend">
                                                        <span class="material-symbols-outlined text-[20px]">block</span>
                                                    </button>
                                                    <button
                                                        class="text-slate-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 p-2 rounded-lg transition-all"
                                                        title="Remove">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">delete</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr
                                            class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors hidden extra-row-expert">
                                            <td class="px-6 py-4">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 rounded-full bg-slate-200 overflow-hidden">
                                                        <img alt="User"
                                                            src="https://ui-avatars.com/api/?name=John+Hammond&background=random" />
                                                    </div>
                                                    <div>
                                                        <p class="font-bold">John Hammond</p>
                                                        <p class="text-xs text-slate-500 dark:text-[#92adc9]">
                                                            john.h@prefix.edu</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">Genetics</td>
                                            <td class="px-6 py-4 text-slate-500 dark:text-[#92adc9]">Dec 05, 2023</td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="bg-green-100 dark:bg-green-500/10 text-green-600 dark:text-green-400 px-2 py-1 rounded text-[0.625rem] font-bold uppercase">Verified</span>
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <div class="flex justify-end gap-1">
                                                    <button
                                                        class="text-slate-500 hover:text-primary hover:bg-blue-50 dark:hover:bg-blue-500/10 p-2 rounded-lg transition-all"
                                                        title="Edit">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">edit_square</span>
                                                    </button>
                                                    <button
                                                        class="text-slate-500 hover:text-orange-500 hover:bg-orange-50 dark:hover:bg-orange-500/10 p-2 rounded-lg transition-all"
                                                        title="Suspend">
                                                        <span class="material-symbols-outlined text-[20px]">block</span>
                                                    </button>
                                                    <button
                                                        class="text-slate-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 p-2 rounded-lg transition-all"
                                                        title="Remove">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">delete</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Pagination Footer -->
                            <div id="expert-pagination-footer"
                                class="bg-slate-50 dark:bg-[#1a252f] px-6 py-4 border-t border-slate-200 dark:border-[#324d67] flex flex-col sm:flex-row items-center justify-between gap-4">
                                <div class="flex items-center gap-4">
                                    <p class="text-sm text-slate-500 dark:text-[#92adc9]">Showing <span
                                            class="font-bold text-slate-900 dark:text-white"
                                            id="expert-count-display">5</span> of <span
                                            class="font-bold text-slate-900 dark:text-white">124</span> experts</p>
                                </div>

                                <div id="experts-pagination-controls" class="flex items-center gap-1">
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-500 dark:text-[#92adc9] hover:bg-white dark:hover:bg-[#233648] transition-colors disabled:opacity-50">
                                        <span class="material-symbols-outlined text-sm">chevron_left</span>
                                    </button>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg bg-primary text-white font-bold text-xs shadow-sm">1</button>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-500 dark:text-[#92adc9] hover:bg-white dark:hover:bg-[#233648] transition-colors text-xs font-medium">2</button>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-500 dark:text-[#92adc9] hover:bg-white dark:hover:bg-[#233648] transition-colors text-xs font-medium">3</button>
                                    <span class="text-slate-400 px-1">...</span>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-500 dark:text-[#92adc9] hover:bg-white dark:hover:bg-[#233648] transition-colors text-xs font-medium">124</button>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-500 dark:text-[#92adc9] hover:bg-white dark:hover:bg-[#233648] transition-colors">
                                        <span class="material-symbols-outlined text-sm">chevron_right</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-view hidden" id="tab-content-aspirants">
                        <div
                            class="bg-white dark:bg-background-dark rounded-xl border border-slate-200 dark:border-[#324d67] shadow-sm overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left">
                                    <thead
                                        class="bg-slate-50 dark:bg-[#1a252f] text-slate-500 dark:text-[#92adc9] text-xs uppercase tracking-wider font-bold">
                                        <tr>
                                            <th class="px-6 py-4 w-10 md:table-cell hidden">
                                                <input type="checkbox" class="rounded border-slate-300 text-primary focus:ring-primary h-4 w-4" onchange="toggleSelectAll('aspirant', this)">
                                            </th>
                                            <th class="px-6 py-4 w-16 md:table-cell hidden">S.No</th>
                                            <th class="px-6 py-4">Aspirant Name</th>
                                            <th class="px-6 py-4">Applicant Type</th>
                                            <th class="px-6 py-4">Avg Score</th>
                                            <th class="px-6 py-4">Verification</th>
                                            <th class="px-6 py-4">Status</th>
                                            <th class="px-6 py-4 text-right">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbody-aspirants"
                                        class="text-sm dark:text-white divide-y divide-slate-100 dark:divide-[#324d67]">
                                        <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                            <td class="px-6 py-4 w-10 md:table-cell hidden">
                                                <input type="checkbox" class="user-checkbox rounded border-slate-300 text-primary focus:ring-primary h-4 w-4">
                                            </td>
                                            <td class="px-6 py-4 w-16 md:table-cell hidden" data-label="S.No">1</td>
                                            <td class="px-6 py-4" data-label="Aspirant Name">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 rounded-full bg-slate-200 overflow-hidden">
                                                        <img alt="User"
                                                            src="https://lh3.googleusercontent.com/aida-public/AB6AXuAKxfVkmDonLH0I5a5QmtJzE3hqOphdoLC6BFDl9oeQvPUgIlTKbIImxI2uvSCT45U39du9S319qokuNHF6AU0tHE9o5c62VxZPzHmcByNmQtQkfYRdkSbpehbvOmZdAOnFvwiY5peJ4G2bYrgxOkEY66fUPW2Xe_CBSeedz2i4FtxleAVPHBPV20jupL6WbHRc-gSPwqehEV0cjecACfmZ8UwpbtOh4_4Gg4GWi7nchIMinWnGWATjGtgERwzUxDyekN-Hh_nrjWi3" />
                                                    </div>
                                                    <div>
                                                        <p class="font-bold">Marcus Thorne</p>
                                                        <p class="text-xs text-slate-500 dark:text-[#92adc9]">
                                                            m.thorne@gmail.com</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4" data-label="Applicant Type">
                                                <span
                                                    class="px-2 py-1 bg-blue-50 dark:bg-blue-500/10 text-blue-600 dark:text-blue-400 rounded text-[0.625rem] font-bold">Student</span>
                                            </td>
                                            <td class="px-6 py-4" data-label="Status">
                                                <span
                                                    class="bg-green-100 dark:bg-green-500/10 text-green-600 dark:text-green-400 px-2 py-1 rounded text-[0.625rem] font-bold uppercase">Active</span>
                                            </td>
                                            <td class="px-6 py-4 text-green-500 font-bold" data-label="Avg Score">88.5%</td>
                                            <td class="px-6 py-4 text-right" data-label="Actions">
                                                <div class="flex justify-end gap-1">
                                                    <button
                                                        class="text-slate-500 hover:text-primary hover:bg-blue-50 dark:hover:bg-blue-500/10 p-2 rounded-lg transition-all"
                                                        title="Edit">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">edit_square</span>
                                                    </button>
                                                    <button
                                                        class="text-slate-500 hover:text-orange-500 hover:bg-orange-50 dark:hover:bg-orange-500/10 p-2 rounded-lg transition-all"
                                                        title="Suspend">
                                                        <span class="material-symbols-outlined text-[20px]">block</span>
                                                    </button>
                                                    <button
                                                        class="text-slate-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 p-2 rounded-lg transition-all"
                                                        title="Remove">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">delete</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                            <td class="px-6 py-4">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 rounded-full bg-slate-200 overflow-hidden">
                                                        <img alt="User"
                                                            src="https://lh3.googleusercontent.com/aida-public/AB6AXuAq81Cjs-pxoSzyXeUYpI4hbPocx0xtEEvD-HMj-bPJtVshqgLqoBBw_NAPqd30e0y3yOCyY2MEz3jpgLbd9Ov7bVmT3_KJYZzfp3Oj78VxtNIyk91X0nomHMGuT6K3jWdw3550BjkyGzrLSc3cfyps94ikviU5XYEzhKgwZAE-sZHRggqIuvNCJ0hR19JgezgF9j62SKGDVqcC74RGlFqhfVfgfai7z3_wcdQ9xnCuNYMuiZVX6ig3mXQy0uJw_zrFW_OCe7veuJPt" />
                                                    </div>
                                                    <div>
                                                        <p class="font-bold">Elena Gilbert</p>
                                                        <p class="text-xs text-slate-500 dark:text-[#92adc9]">
                                                            elena.g@yahoo.com</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="px-2 py-1 bg-slate-100 dark:bg-slate-500/10 text-slate-500 dark:text-slate-400 rounded text-[0.625rem] font-bold">Aspirant</span>
                                            </td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="bg-orange-100 dark:bg-orange-500/10 text-orange-600 dark:text-orange-400 px-2 py-1 rounded text-[0.625rem] font-bold uppercase">Pending</span>
                                            </td>
                                            <td class="px-6 py-4 text-slate-500 dark:text-[#92adc9] font-bold">62.0%
                                            </td>
                                            <td class="px-6 py-4 text-right">
                                                <div class="flex justify-end gap-2">
                                                    <button
                                                        class="text-green-500 hover:text-green-600 hover:bg-green-50 dark:hover:bg-green-500/10 p-1.5 rounded-lg transition-colors"
                                                        title="Approve">
                                                        <span
                                                            class="material-symbols-outlined text-xl">check_circle</span>
                                                    </button>
                                                    <button
                                                        class="text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 p-1.5 rounded-lg transition-colors"
                                                        title="Reject">
                                                        <span class="material-symbols-outlined text-xl">cancel</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                            <td class="px-6 py-4">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 rounded-full bg-slate-200 overflow-hidden">
                                                        <img alt="User"
                                                            src="https://ui-avatars.com/api/?name=James+Potter&background=random" />
                                                    </div>
                                                    <div>
                                                        <p class="font-bold">James Potter</p>
                                                        <p class="text-xs text-slate-500 dark:text-[#92adc9]">
                                                            james.p@hogwarts.edu</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="px-2 py-1 bg-blue-50 dark:bg-blue-500/10 text-blue-600 dark:text-blue-400 rounded text-[0.625rem] font-bold">Student</span>
                                            </td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="bg-green-100 dark:bg-green-500/10 text-green-600 dark:text-green-400 px-2 py-1 rounded text-[0.625rem] font-bold uppercase">Active</span>
                                            </td>
                                            <td class="px-6 py-4 text-green-500 font-bold">92.0%</td>
                                            <td class="px-6 py-4 text-right">
                                                <div class="flex justify-end gap-1">
                                                    <button
                                                        class="text-slate-500 hover:text-primary hover:bg-blue-50 dark:hover:bg-blue-500/10 p-2 rounded-lg transition-all"
                                                        title="Edit">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">edit_square</span>
                                                    </button>
                                                    <button
                                                        class="text-slate-500 hover:text-orange-500 hover:bg-orange-50 dark:hover:bg-orange-500/10 p-2 rounded-lg transition-all"
                                                        title="Suspend">
                                                        <span class="material-symbols-outlined text-[20px]">block</span>
                                                    </button>
                                                    <button
                                                        class="text-slate-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 p-2 rounded-lg transition-all"
                                                        title="Remove">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">delete</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                            <td class="px-6 py-4">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 rounded-full bg-slate-200 overflow-hidden">
                                                        <img alt="User"
                                                            src="https://ui-avatars.com/api/?name=Lily+Evans&background=random" />
                                                    </div>
                                                    <div>
                                                        <p class="font-bold">Lily Evans</p>
                                                        <p class="text-xs text-slate-500 dark:text-[#92adc9]">
                                                            lily.e@hogwarts.edu</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="px-2 py-1 bg-slate-100 dark:bg-slate-500/10 text-slate-500 dark:text-slate-400 rounded text-[0.625rem] font-bold">Aspirant</span>
                                            </td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="bg-orange-100 dark:bg-orange-500/10 text-orange-600 dark:text-orange-400 px-2 py-1 rounded text-[0.625rem] font-bold uppercase">Pending</span>
                                            </td>
                                            <td class="px-6 py-4 text-slate-500 dark:text-[#92adc9] font-bold">--</td>
                                            <td class="px-6 py-4 text-right">
                                                <div class="flex justify-end gap-2">
                                                    <button
                                                        class="text-green-500 hover:text-green-600 hover:bg-green-50 dark:hover:bg-green-500/10 p-1.5 rounded-lg transition-colors"
                                                        title="Approve">
                                                        <span
                                                            class="material-symbols-outlined text-xl">check_circle</span>
                                                    </button>
                                                    <button
                                                        class="text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 p-1.5 rounded-lg transition-colors"
                                                        title="Reject">
                                                        <span class="material-symbols-outlined text-xl">cancel</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <!-- Hidden Extra Rows -->
                                        <tr
                                            class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors hidden extra-row-aspirant">
                                            <td class="px-6 py-4">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 rounded-full bg-slate-200 overflow-hidden">
                                                        <img alt="User"
                                                            src="https://ui-avatars.com/api/?name=Peter+Pettigrew&background=random" />
                                                    </div>
                                                    <div>
                                                        <p class="font-bold">Peter Pettigrew</p>
                                                        <p class="text-xs text-slate-500 dark:text-[#92adc9]">
                                                            peter.p@hogwarts.edu</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="px-2 py-1 bg-blue-50 dark:bg-blue-500/10 text-blue-600 dark:text-blue-400 rounded text-[0.625rem] font-bold">Student</span>
                                            </td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="bg-red-100 dark:bg-red-500/10 text-red-600 dark:text-red-400 px-2 py-1 rounded text-[0.625rem] font-bold uppercase">Suspended</span>
                                            </td>
                                            <td class="px-6 py-4 text-red-500 font-bold">32.0%</td>
                                            <td class="px-6 py-4 text-right">
                                                <div class="flex justify-end gap-1">
                                                    <button
                                                        class="text-slate-500 hover:text-primary hover:bg-blue-50 dark:hover:bg-blue-500/10 p-2 rounded-lg transition-all"
                                                        title="Edit">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">edit_square</span>
                                                    </button>
                                                    <button
                                                        class="text-slate-500 hover:text-green-500 hover:bg-green-50 dark:hover:bg-green-500/10 p-2 rounded-lg transition-all"
                                                        title="Unsuspend">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">check_circle</span>
                                                    </button>
                                                    <button
                                                        class="text-slate-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 p-2 rounded-lg transition-all"
                                                        title="Remove">
                                                        <span
                                                            class="material-symbols-outlined text-[20px]">delete</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr
                                            class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors hidden extra-row-aspirant">
                                            <td class="px-6 py-4">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 rounded-full bg-slate-200 overflow-hidden">
                                                        <img alt="User"
                                                            src="https://ui-avatars.com/api/?name=Sirius+Black&background=random" />
                                                    </div>
                                                    <div>
                                                        <p class="font-bold">Sirius Black</p>
                                                        <p class="text-xs text-slate-500 dark:text-[#92adc9]">
                                                            sirius.b@hogwarts.edu</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="px-2 py-1 bg-slate-100 dark:bg-slate-500/10 text-slate-500 dark:text-slate-400 rounded text-[0.625rem] font-bold">Aspirant</span>
                                            </td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="bg-orange-100 dark:bg-orange-500/10 text-orange-600 dark:text-orange-400 px-2 py-1 rounded text-[0.625rem] font-bold uppercase">Pending</span>
                                            </td>
                                            <td class="px-6 py-4 text-slate-500 dark:text-[#92adc9] font-bold">--</td>
                                            <td class="px-6 py-4 text-right">
                                                <div class="flex justify-end gap-2">
                                                    <button
                                                        class="text-green-500 hover:text-green-600 hover:bg-green-50 dark:hover:bg-green-500/10 p-1.5 rounded-lg transition-colors"
                                                        title="Approve">
                                                        <span
                                                            class="material-symbols-outlined text-xl">check_circle</span>
                                                    </button>
                                                    <button
                                                        class="text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 p-1.5 rounded-lg transition-colors"
                                                        title="Reject">
                                                        <span class="material-symbols-outlined text-xl">cancel</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Pagination Footer -->
                            <div id="aspirant-pagination-footer"
                                class="bg-slate-50 dark:bg-[#1a252f] px-6 py-4 border-t border-slate-200 dark:border-[#324d67] flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <p class="text-sm text-slate-500 dark:text-[#92adc9]">Showing <span
                                            class="font-bold text-slate-900 dark:text-white"
                                            id="aspirant-count-display">4</span> of <span
                                            class="font-bold text-slate-900 dark:text-white">1160</span> aspirants</p>
                                </div>

                                <div id="aspirants-pagination-controls" class="flex items-center gap-1">
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-500 dark:text-[#92adc9] hover:bg-white dark:hover:bg-[#233648] transition-colors disabled:opacity-50">
                                        <span class="material-symbols-outlined text-sm">chevron_left</span>
                                    </button>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg bg-primary text-white font-bold text-xs shadow-sm">1</button>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-500 dark:text-[#92adc9] hover:bg-white dark:hover:bg-[#233648] transition-colors text-xs font-medium">2</button>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-500 dark:text-[#92adc9] hover:bg-white dark:hover:bg-[#233648] transition-colors text-xs font-medium">3</button>
                                    <span class="text-slate-400 px-1">...</span>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-500 dark:text-[#92adc9] hover:bg-white dark:hover:bg-[#233648] transition-colors text-xs font-medium">1160</button>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-500 dark:text-[#92adc9] hover:bg-white dark:hover:bg-[#233648] transition-colors">
                                        <span class="material-symbols-outlined text-sm">chevron_right</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page-content hidden" id="page-questions">
                    <div class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-6">
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-xs font-bold text-primary uppercase tracking-wider">Content
                                    Management</span>
                            </div>
                            <h2 class="text-2xl font-bold dark:text-white">Approved Questions</h2>
                            <p class="text-slate-500 dark:text-[#92adc9]">Review and manage the active bank of verified
                                questions.</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <button
                                class="bg-white dark:bg-[#1a252f] text-slate-600 dark:text-[#92adc9] border border-slate-200 dark:border-[#324d67] px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 hover:bg-slate-50 dark:hover:bg-[#233648] hover:text-primary transition-colors shadow-sm h-[38px]"
                                onclick="openModal('modal-add-sub-cat'); loadCustomItems()">
                                <span class="material-symbols-outlined text-lg">category</span>
                                Add Sub & Cat
                            </button>
                            <button
                                class="bg-primary text-white px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 hover:bg-primary/90 transition-colors shadow-sm h-[38px]"
                                onclick="openModal('modal-add-question'); loadQuestionMetadata()">
                                <span class="material-symbols-outlined text-lg">add</span>
                                New Question
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-4 gap-2 sm:gap-4 mb-8">
                        <div
                            class="bg-white dark:bg-[#1a252f] p-2 sm:p-4 rounded-xl border border-slate-200 dark:border-[#324d67] shadow-sm flex flex-col justify-center sm:block">
                            <div class="flex items-center justify-between sm:block">
                                <p class="text-[9px] sm:text-xs text-slate-500 dark:text-[#92adc9] font-medium sm:mb-1 truncate">Questions</p>
                                <p class="text-sm sm:text-xl font-bold dark:text-white text-right sm:text-left" id="stat-total-questions">--</p>
                            </div>
                        </div>
                        <div
                            class="bg-white dark:bg-[#1a252f] p-2 sm:p-4 rounded-xl border border-slate-200 dark:border-[#324d67] shadow-sm flex flex-col justify-center sm:block">
                            <div class="flex items-center justify-between sm:block">
                                <p class="text-[9px] sm:text-xs text-slate-500 dark:text-[#92adc9] font-medium sm:mb-1 truncate">Approved</p>
                                <p class="text-sm sm:text-xl font-bold dark:text-white text-right sm:text-left" id="stat-approved">--</p>
                            </div>
                        </div>
                        <div
                            class="bg-white dark:bg-[#1a252f] p-2 sm:p-4 rounded-xl border border-slate-200 dark:border-[#324d67] shadow-sm flex flex-col justify-center sm:block">
                            <div class="flex items-center justify-between sm:block">
                                <p class="text-[9px] sm:text-xs text-slate-500 dark:text-[#92adc9] font-medium sm:mb-1 truncate">Pending</p>
                                <p class="text-sm sm:text-xl font-bold dark:text-white text-right sm:text-left" id="stat-pending">--</p>
                            </div>
                        </div>
                        <div
                            class="bg-white dark:bg-[#1a252f] p-2 sm:p-4 rounded-xl border border-slate-200 dark:border-[#324d67] shadow-sm flex flex-col justify-center sm:block">
                            <div class="flex items-center justify-between sm:block">
                                <p class="text-[9px] sm:text-xs text-slate-500 dark:text-[#92adc9] font-medium sm:mb-1 truncate">Suspend</p>
                                <p class="text-sm sm:text-xl font-bold dark:text-white text-right sm:text-left" id="stat-suspended">--</p>
                            </div>
                        </div>
                    </div>
                    <!-- Filter Bar -->
                    <div class="mb-6 bg-white dark:bg-[#1a252f] p-4 rounded-xl border border-slate-200 dark:border-[#324d67] shadow-sm">
                        <div class="flex items-center gap-3">
                            <!-- Search (Always Left) -->
                            <div class="flex-grow min-w-0">
                                <div class="relative group">
                                    <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-primary transition-colors text-lg">search</span>
                                    <input type="text" id="filter-search" oninput="loadQuestions()"
                                        placeholder="Search by ID or Question Content..."
                                        class="w-full bg-slate-50 dark:bg-[#111a22]/50 border border-slate-200 dark:border-[#324d67] rounded-xl py-2.5 pl-10 pr-4 text-xs font-medium dark:text-white focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all placeholder:text-slate-400">
                                </div>
                            </div>

                            <!-- Filter Toggle (Right Aligned) -->
                            <div class="flex items-center gap-2">
                                <button onclick="toggleQuestionFilterDrawer()" 
                                    class="flex lg:hidden items-center gap-2 px-4 py-2.5 bg-white dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] rounded-xl text-slate-600 dark:text-[#92adc9] font-bold text-xs hover:bg-slate-50 dark:hover:bg-[#233648] transition-all active:scale-95 shadow-sm">
                                    <span class="material-symbols-outlined text-lg">filter_list</span>
                                    <span>Filters</span>
                                </button>
                                
                                <!-- Desktop-Only Filters (Inline) -->
                                <div class="hidden lg:flex items-center gap-3">
                                    <!-- Role -->
                                    <div class="w-40">
                                        <select id="filter-role" onchange="loadQuestions()"
                                            class="w-full bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] rounded-lg py-2 px-3 text-xs font-medium dark:text-white focus:ring-1 focus:ring-primary outline-none shadow-sm">
                                            <option value="all">All Roles</option>
                                            <option value="student">Student</option>
                                            <option value="aspirant">Aspirant</option>
                                        </select>
                                    </div>

                                    <!-- Expert -->
                                    <div class="w-44">
                                        <select id="filter-expert" onchange="loadQuestions()"
                                            class="w-full bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] rounded-lg py-2 px-3 text-xs font-medium dark:text-white focus:ring-1 focus:ring-primary outline-none shadow-sm">
                                            <option value="all">All Experts</option>
                                            <option value="Admin">Admin</option>
                                        </select>
                                    </div>

                                    <!-- Status -->
                                    <div class="w-36">
                                        <select id="filter-status" onchange="loadQuestions()"
                                            class="w-full bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] rounded-lg py-2 px-3 text-xs font-medium dark:text-white focus:ring-1 focus:ring-primary outline-none shadow-sm">
                                            <option value="all">All Status</option>
                                            <option value="pending">Pending</option>
                                            <option value="approved">Approved</option>
                                            <option value="rejected">Rejected</option>
                                            <option value="suspended">Suspended</option>
                                        </select>
                                    </div>

                                    <!-- Difficulty -->
                                    <div class="w-32">
                                        <select id="filter-diff" onchange="loadQuestions()"
                                            class="w-full bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] rounded-lg py-2 px-3 text-xs font-medium dark:text-white focus:ring-1 focus:ring-primary outline-none shadow-sm">
                                            <option value="all">All Difficulty</option>
                                            <option value="Easy">Easy</option>
                                            <option value="Medium">Medium</option>
                                            <option value="Hard">Hard</option>
                                        </select>
                                    </div>

                                    <!-- Language -->
                                    <div class="w-32">
                                        <select id="filter-lang" onchange="loadQuestions()"
                                            class="w-full bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] rounded-lg py-2 px-3 text-xs font-medium dark:text-white focus:ring-1 focus:ring-primary outline-none shadow-sm">
                                            <option value="all">All Languages</option>
                                            <option value="English">English</option>
                                            <option value="Bengali">Bengali</option>
                                        </select>
                                    </div>

                                    <!-- Reset -->
                                    <button onclick="resetFilters()"
                                        class="bg-white dark:bg-[#111a22] text-slate-500 dark:text-[#92adc9] border border-slate-200 dark:border-[#324d67] px-4 py-2 rounded-lg font-bold text-xs hover:bg-slate-50 dark:hover:bg-[#233648] hover:text-red-500 dark:hover:text-red-400 transition-all h-[34px] flex items-center justify-center gap-2 shadow-sm whitespace-nowrap"
                                        title="Reset Filters">
                                        <span class="material-symbols-outlined text-sm">restart_alt</span> Reset
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <script>
                        function resetFilters() {
                            if (document.getElementById('filter-search')) document.getElementById('filter-search').value = '';
                            if (document.getElementById('filter-role')) document.getElementById('filter-role').value = 'all';
                            if (document.getElementById('filter-status')) document.getElementById('filter-status').value = 'all';
                            if (document.getElementById('filter-diff')) document.getElementById('filter-diff').value = 'all';
                            if (document.getElementById('filter-lang')) document.getElementById('filter-lang').value = 'all';
                            if (document.getElementById('filter-expert')) document.getElementById('filter-expert').value = 'all';

                            loadQuestions();
                        }

                        async function loadExpertsFilter() {
                            const select = document.getElementById('filter-expert');
                            if (!select) return;

                            try {
                                const response = await fetch('../api/admin/get_users.php?role=expert&limit=100');
                                const result = await response.json();

                                if (result.status === 'success') {
                                    const experts = result.data;
                                    // Keep "All Experts" and "Admin"
                                    let options = '<option value="all">All Experts</option><option value="Admin">Admin</option>';
                                    experts.forEach(exp => {
                                        options += `<option value="${exp.full_name}">${exp.full_name}</option>`;
                                    });
                                    select.innerHTML = options;
                                }
                            } catch (error) {
                                console.error('Error loading experts:', error);
                            }
                        }

                        // Load expert names into filter dropdown on start
                        loadExpertsFilter();
                    </script>

                    <div
                        class="bg-white dark:bg-background-dark rounded-xl border border-slate-200 dark:border-[#324d67] shadow-sm overflow-hidden tab-view">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead
                                    class="bg-slate-50 dark:bg-[#1a252f] text-slate-500 dark:text-[#92adc9] text-xs uppercase tracking-wider font-semibold">
                                    <tr>
                                        <th class="px-6 py-4 w-16">ID</th>
                                        <th class="px-6 py-4">Question Details</th>
                                        <th class="px-6 py-4">Subject/Class</th>
                                        <th class="px-6 py-4">Added By</th>
                                        <th class="px-6 py-4">Status</th>
                                        <th class="px-6 py-4 text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="questions-table-body"
                                    class="text-sm dark:text-white divide-y divide-slate-100 dark:divide-[#324d67]">
                                    <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                        <td class="px-6 py-4 font-mono text-xs text-slate-400">#PQ-9281</td>
                                        <td class="px-6 py-4 max-w-md">
                                            <div class="flex flex-col gap-1">
                                                <p class="font-medium line-clamp-1">Calculate the angular momentum of a
                                                    particle moving in a circular path...</p>
                                                <div class="flex gap-2">
                                                    <span
                                                        class="px-1.5 py-0.5 bg-blue-100 dark:bg-blue-500/10 text-blue-600 dark:text-blue-400 text-[0.625rem] font-bold rounded">MULTIPLE
                                                        CHOICE</span>
                                                    <span
                                                        class="px-1.5 py-0.5 bg-orange-100 dark:bg-orange-500/10 text-orange-600 dark:text-orange-400 text-[0.625rem] font-bold rounded">HARD</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex flex-col">
                                                <span class="font-semibold text-xs">Physics</span>
                                                <span class="text-xs text-slate-500 dark:text-[#92adc9]">Class 12 
                                                    Mechanics</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-2">
                                                <div class="w-6 h-6 rounded-full bg-slate-200 overflow-hidden">
                                                    <img alt="Expert"
                                                        src="https://lh3.googleusercontent.com/aida-public/AB6AXuAajaArR2whI0qaa_VKIU3fjO8fOomcp_4iF7PtU2oIoa7wW3YvwRHcVn9EQNo4BRlHY5Z7rbOs3cWRJzvIsZQuPh8MTXZV7WFl_zj-kL7EhGtKYR-Zc5Stpr5ybrDEcz_v3lM4QzZ1YkZHQJA3Mt86uq2Cn23QxLqp8dqF2So6QzlIyK30q0MlRD9R6wmTscx_WwfJcb4rIdaZxZ7GR_R1TNUp5GL91OmT5_OoVMXSisGF_E6raDEUp9FqwhkcC9RfxahS7_J3rk4i" />
                                                </div>
                                                <span class="text-xs">Dr. Robert Vance</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span
                                                class="px-2 py-1 rounded-full text-[10px] font-bold uppercase bg-green-100 dark:bg-green-500/20 text-green-700 dark:text-green-400">
                                                Approved
                                            </span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-2 justify-center">
                                                <button
                                                    class="text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-500/10 p-1.5 rounded-lg transition-all"
                                                    title="Suspend">
                                                    <span class="material-symbols-outlined text-[20px]">pause</span>
                                                </button>
                                                <button
                                                    class="text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 p-1.5 rounded-lg transition-all"
                                                    title="Reject">
                                                    <span class="material-symbols-outlined text-[20px]">close</span>
                                                </button>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-right">
                                            <div class="flex justify-end gap-2">
                                                <button
                                                    class="text-primary hover:bg-primary/10 p-1.5 rounded-lg transition-all"
                                                    title="Edit">
                                                    <span class="material-symbols-outlined text-[20px]">edit</span>
                                                </button>
                                                <button
                                                    class="text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 p-1.5 rounded-lg transition-all"
                                                    title="Remove">
                                                    <span class="material-symbols-outlined text-[20px]">delete</span>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                        <td class="px-6 py-4 font-mono text-xs text-slate-400">#PQ-9282</td>
                                        <td class="px-6 py-4 max-w-md">
                                            <div class="flex flex-col gap-1">
                                                <p class="font-medium line-clamp-1">Identify the organic compound formed
                                                    when ethanol reacts with PCl5...</p>
                                                <div class="flex gap-2">
                                                    <span
                                                        class="px-1.5 py-0.5 bg-blue-100 dark:bg-blue-500/10 text-blue-600 dark:text-blue-400 text-[0.625rem] font-bold rounded">SINGLE
                                                        CORRECT</span>
                                                    <span
                                                        class="px-1.5 py-0.5 bg-green-100 dark:bg-green-500/10 text-green-600 dark:text-green-400 text-[0.625rem] font-bold rounded">EASY</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex flex-col">
                                                <span class="font-semibold text-xs">Chemistry</span>
                                                <span class="text-xs text-slate-500 dark:text-[#92adc9]">Class 11 
                                                    Organic</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-2">
                                                <div class="w-6 h-6 rounded-full bg-slate-200 overflow-hidden">
                                                    <img alt="Expert"
                                                        src="https://lh3.googleusercontent.com/aida-public/AB6AXuCWMR0E1AbvdMehGB-TxbhWtwLWB7jlrgLPU-sWPKZtGx__a1zpmphisxMm4Hr1Fosax9Ux_33YYVkGxLnzgYAZDLFcpIJ-uHKA_y1CzJlEn__dg-tqUixV6_xl5ON8xXNb3ysoa0ryjmdqOkIYMMvd9S9h4M98XE_BnpZ3UUrpAz2qsGOUMnph2w0QbkIZkWdZcqpCGvX0nEACSje-GWoBI64g_rW00PKOxNt80mW_bcgh2w4PObcyEPk_G3u3Pp2ZV4u0PDZWspV5" />
                                                </div>
                                                <span class="text-xs font-bold text-slate-600 dark:text-[#92adc9]">Prof.
                                                    Jane Cooper</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span
                                                class="px-2 py-1 rounded-full text-[10px] font-bold uppercase bg-green-100 dark:bg-green-500/20 text-green-700 dark:text-green-400">
                                                Approved
                                            </span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-2 justify-center">
                                                <button
                                                    class="text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-500/10 p-1.5 rounded-lg transition-all"
                                                    title="Suspend">
                                                    <span class="material-symbols-outlined text-[20px]">pause</span>
                                                </button>
                                                <button
                                                    class="text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 p-1.5 rounded-lg transition-all"
                                                    title="Reject">
                                                    <span class="material-symbols-outlined text-[20px]">close</span>
                                                </button>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-right">
                                            <div class="flex justify-end gap-2">
                                                <button
                                                    class="text-primary hover:bg-primary/10 p-1.5 rounded-lg transition-all"
                                                    title="Edit">
                                                    <span class="material-symbols-outlined text-[20px]">edit</span>
                                                </button>
                                                <button
                                                    class="text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 p-1.5 rounded-lg transition-all"
                                                    title="Remove">
                                                    <span class="material-symbols-outlined text-[20px]">delete</span>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                        <td class="px-6 py-4 font-mono text-xs text-slate-400">#PQ-9283</td>
                                        <td class="px-6 py-4 max-w-md">
                                            <div class="flex flex-col gap-1">
                                                <p class="font-medium line-clamp-1">Find the derivative of f(x) =
                                                    sin(x)e^x with respect to x using product rule...</p>
                                                <div class="flex gap-2">
                                                    <span
                                                        class="px-1.5 py-0.5 bg-blue-100 dark:bg-blue-500/10 text-blue-600 dark:text-blue-400 text-[0.625rem] font-bold rounded">MCQ</span>
                                                    <span
                                                        class="px-1.5 py-0.5 bg-yellow-100 dark:bg-yellow-500/10 text-yellow-600 dark:text-yellow-400 text-[0.625rem] font-bold rounded">MEDIUM</span>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex flex-col">
                                                <span class="font-semibold text-xs">Mathematics</span>
                                                <span class="text-xs text-slate-500 dark:text-[#92adc9]">Class 12 
                                                    Calculus</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-2">
                                                <div
                                                    class="w-6 h-6 rounded-full bg-slate-200 overflow-hidden text-[0.625rem] flex items-center justify-center font-bold text-primary bg-primary/20">
                                                    AR
                                                </div>
                                                <span class="text-xs font-bold text-slate-600 dark:text-[#92adc9]">Alex
                                                    Rivera</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4">
                                            <span
                                                class="px-2 py-1 rounded-full text-[10px] font-bold uppercase bg-green-100 dark:bg-green-500/20 text-green-700 dark:text-green-400">
                                                Approved
                                            </span>
                                        </td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-2 justify-center">
                                                <button
                                                    class="text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-500/10 p-1.5 rounded-lg transition-all"
                                                    title="Suspend">
                                                    <span class="material-symbols-outlined text-[20px]">pause</span>
                                                </button>
                                                <button
                                                    class="text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 p-1.5 rounded-lg transition-all"
                                                    title="Reject">
                                                    <span class="material-symbols-outlined text-[20px]">close</span>
                                                </button>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-right">
                                            <div class="flex justify-end gap-2">
                                                <button
                                                    class="text-primary hover:bg-primary/10 p-1.5 rounded-lg transition-all"
                                                    title="Edit">
                                                    <span class="material-symbols-outlined text-[20px]">edit</span>
                                                </button>
                                                <button
                                                    class="text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 p-1.5 rounded-lg transition-all"
                                                    title="Remove">
                                                    <span class="material-symbols-outlined text-[20px]">delete</span>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div
                            class="px-6 py-4 bg-white dark:bg-[#1a252f] border-t border-slate-100 dark:border-[#324d67] flex flex-col sm:flex-row items-center justify-between gap-4">
                            <div class="flex flex-col gap-1">
                                <p class="text-xs font-medium text-slate-500 dark:text-[#92adc9]">
                                    Showing <span class="text-slate-900 dark:text-white font-bold">1-10</span> of <span
                                        class="text-slate-900 dark:text-white font-bold">42,840</span> questions
                                </p>
                            </div>

                            <div class="flex items-center gap-3">
                                <!-- Previous -->
                                <button
                                    class="group flex items-center justify-center w-9 h-9 rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-400 dark:text-[#92adc9] hover:bg-slate-50 dark:hover:bg-[#233648] hover:text-primary hover:border-primary/30 transition-all duration-200 disabled:opacity-40 disabled:hover:bg-transparent disabled:hover:border-slate-200 disabled:cursor-not-allowed"
                                    disabled="">
                                    <span
                                        class="material-symbols-outlined text-[20px] group-hover:-translate-x-0.5 transition-transform">chevron_left</span>
                                </button>

                                <!-- Page Numbers Container (Segmented Control Style) -->
                                <div
                                    class="flex items-center p-1 bg-slate-50 dark:bg-[#111a22] border border-slate-100 dark:border-[#324d67] rounded-xl shadow-inner">
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg bg-white dark:bg-[#233648] text-primary font-bold text-xs shadow-sm border border-slate-200/50 dark:border-slate-700 transition-all transform scale-100">1</button>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg text-slate-500 dark:text-[#92adc9] hover:text-slate-900 dark:hover:text-white hover:bg-white/50 dark:hover:bg-[#233648]/50 transition-all text-xs font-medium">2</button>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg text-slate-500 dark:text-[#92adc9] hover:text-slate-900 dark:hover:text-white hover:bg-white/50 dark:hover:bg-[#233648]/50 transition-all text-xs font-medium">3</button>
                                    <div
                                        class="w-8 h-8 flex items-center justify-center text-slate-400 dark:text-slate-600 pb-2 font-bold tracking-widest">
                                        ...</div>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg text-slate-500 dark:text-[#92adc9] hover:text-slate-900 dark:hover:text-white hover:bg-white/50 dark:hover:bg-[#233648]/50 transition-all text-xs font-medium">4284</button>
                                </div>

                                <!-- Next -->
                                <button
                                    class="group flex items-center justify-center w-9 h-9 rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-500 dark:text-[#92adc9] hover:bg-slate-50 dark:hover:bg-[#233648] hover:text-primary hover:border-primary/30 transition-all duration-200 shadow-sm hover:shadow">
                                    <span
                                        class="material-symbols-outlined text-[20px] group-hover:translate-x-0.5 transition-transform">chevron_right</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="page-content hidden" id="page-leaderboard">
                    <div class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-6">
                        <div>
                            <h2 class="text-2xl font-bold dark:text-white">Platform Rankings</h2>
                            <p class="text-slate-500 dark:text-[#92adc9]">Monitor and manage student and expert
                                performance.</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button
                                class="bg-white dark:bg-[#1a252f] border border-slate-200 dark:border-[#324d67] text-slate-700 dark:text-white px-4 py-2 rounded-lg font-bold text-sm flex items-center gap-2 hover:bg-slate-50 dark:hover:bg-[#233648] transition-colors shadow-sm h-[38px]">
                                <span class="material-symbols-outlined text-lg">file_download</span>
                                Export Data
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                        <div
                            class="bg-white dark:bg-[#1a252f] p-4 rounded-xl border border-slate-200 dark:border-[#324d67] shadow-sm">
                            <div class="flex items-center justify-between mb-1">
                                <p
                                    class="text-xs text-slate-500 dark:text-[#92adc9] font-bold uppercase tracking-wider">
                                    Top Aspirant</p>
                                <span class="material-symbols-outlined text-primary">emoji_events</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full overflow-hidden">
                                    <img alt="User"
                                        src="https://lh3.googleusercontent.com/aida-public/AB6AXuDk6jwrR0uL1-KG1hR0AZmKmKn4rBn4JQXwUbuiK_twsNdNELAL4j6geNhy1u4Qm0LZYvaBhDqfpj1sYopRbthxmVIgPix500-rIY9fg6-soHFcyYRVfgBONBg9nZfXQXnPMRTJaw5Btnw4leA2Fs_4DlHoL8_j1hsdlFnsJBFlxK0Jo07MzsNOoJb0S-pqyRvVm0b4XwmJjI9txqUxhEUcAut0DESd_uzcUBNqE3lQ6TyDmHJ_GVN8bfq-ySTGGVI2Kr7QurEUSK8X" />
                                </div>
                                <div>
                                    <p class="text-sm font-bold dark:text-white">Arjun Sharma</p>
                                    <p class="text-[0.625rem] text-green-500 font-bold">99.8th Percentile</p>
                                </div>
                            </div>
                        </div>
                        <div
                            class="bg-white dark:bg-[#1a252f] p-4 rounded-xl border border-slate-200 dark:border-[#324d67] shadow-sm">
                            <div class="flex items-center justify-between mb-1">
                                <p
                                    class="text-xs text-slate-500 dark:text-[#92adc9] font-bold uppercase tracking-wider">
                                    Global Avg. Score</p>
                                <span class="material-symbols-outlined text-blue-500">analytics</span>
                            </div>
                            <p class="text-2xl font-bold dark:text-white">742<span
                                    class="text-sm text-slate-400 font-normal ml-1">/1000</span></p>
                            <p class="text-[0.625rem] text-slate-400 mt-1 flex items-center gap-1">
                                <span class="material-symbols-outlined text-xs text-green-500">trending_up</span>
                                +12 pts from last month
                            </p>
                        </div>
                        <div
                            class="bg-white dark:bg-[#1a252f] p-4 rounded-xl border border-slate-200 dark:border-[#324d67] shadow-sm">
                            <div class="flex items-center justify-between mb-1">
                                <p
                                    class="text-xs text-slate-500 dark:text-[#92adc9] font-bold uppercase tracking-wider">
                                    Top Expert</p>
                                <span class="material-symbols-outlined text-purple-500">school</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full overflow-hidden">
                                    <img alt="Expert"
                                        src="https://lh3.googleusercontent.com/aida-public/AB6AXuAajaArR2whI0qaa_VKIU3fjO8fOomcp_4iF7PtU2oIoa7wW3YvwRHcVn9EQNo4BRlHY5Z7rbOs3cWRJzvIsZQuPh8MTXZV7WFl_zj-kL7EhGtKYR-Zc5Stpr5ybrDEcz_v3lM4QzZ1YkZHQJA3Mt86uq2Cn23QxLqp8dqF2So6QzlIyK30q0MlRD9R6wmTscx_WwfJcb4rIdaZxZ7GR_R1TNUp5GL91OmT5_OoVMXSisGF_E6raDEUp9FqwhkcC9RfxahS7_J3rk4i" />
                                </div>
                                <div>
                                    <p class="text-sm font-bold dark:text-white">Dr. Robert Vance</p>
                                    <p class="text-[0.625rem] text-slate-400 font-bold">4.9/5 Rating</p>
                                </div>
                            </div>
                        </div>
                        <div
                            class="bg-white dark:bg-[#1a252f] p-4 rounded-xl border border-slate-200 dark:border-[#324d67] shadow-sm">
                            <div class="flex items-center justify-between mb-1">
                                <p
                                    class="text-xs text-slate-500 dark:text-[#92adc9] font-bold uppercase tracking-wider">
                                    Questions Solved</p>
                                <span class="material-symbols-outlined text-orange-500">task_alt</span>
                            </div>
                            <p class="text-2xl font-bold dark:text-white">1.2M+</p>
                            <p class="text-[0.625rem] text-slate-400 mt-1">Across all categories</p>
                        </div>
                    </div>
                    <div
                        class="bg-white dark:bg-background-dark rounded-xl border border-slate-200 dark:border-[#324d67] shadow-sm overflow-hidden">
                        <div class="border-b border-slate-200 dark:border-[#324d67] px-6">

                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left">
                                <thead
                                    class="bg-slate-50 dark:bg-[#1a252f] text-slate-500 dark:text-[#92adc9] text-xs uppercase tracking-wider font-semibold">
                                    <tr>
                                        <th class="px-6 py-4 w-16">Rank</th>
                                        <th class="px-6 py-4">Aspirant Name</th>
                                        <th class="px-6 py-4 text-center">Exams Taken</th>
                                        <th class="px-6 py-4 text-center">Accuracy %</th>
                                        <th class="px-6 py-4 text-center">Total Points</th>
                                        <th class="px-6 py-4 text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="text-sm dark:text-white divide-y divide-slate-100 dark:divide-[#324d67]">
                                    <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                        <td class="px-6 py-4 font-bold text-slate-400">01</td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-3">
                                                <div
                                                    class="w-9 h-9 rounded-full overflow-hidden border border-slate-200 dark:border-slate-700">
                                                    <img alt="User"
                                                        src="https://lh3.googleusercontent.com/aida-public/AB6AXuDk6jwrR0uL1-KG1hR0AZmKmKn4rBn4JQXwUbuiK_twsNdNELAL4j6geNhy1u4Qm0LZYvaBhDqfpj1sYopRbthxmVIgPix500-rIY9fg6-soHFcyYRVfgBONBg9nZfXQXnPMRTJaw5Btnw4leA2Fs_4DlHoL8_j1hsdlFnsJBFlxK0Jo07MzsNOoJb0S-pqyRvVm0b4XwmJjI9txqUxhEUcAut0DESd_uzcUBNqE3lQ6TyDmHJ_GVN8bfq-ySTGGVI2Kr7QurEUSK8X" />
                                                </div>
                                                <div>
                                                    <p class="font-bold">Arjun Sharma</p>
                                                    <p class="text-[0.625rem] text-slate-500 uppercase">Class 12  JEE
                                                        Mains</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-center font-medium">142</td>
                                        <td class="px-6 py-4 text-center">
                                            <div class="flex items-center justify-center gap-2">
                                                <div
                                                    class="w-16 bg-slate-200 dark:bg-slate-700 h-1.5 rounded-full overflow-hidden">
                                                    <div class="bg-green-500 h-full w-[94%]"></div>
                                                </div>
                                                <span class="text-xs font-bold text-green-500">94.2%</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-center font-bold text-primary">12,840</td>
                                        <td class="px-6 py-4 text-right">
                                            <button
                                                class="text-xs font-bold bg-slate-100 dark:bg-[#233648] px-3 py-1.5 rounded-lg text-slate-600 dark:text-[#92adc9] hover:bg-primary hover:text-white transition-all">View
                                                Stats</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                        <td class="px-6 py-4 font-bold text-slate-400">02</td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-3">
                                                <div
                                                    class="w-9 h-9 rounded-full overflow-hidden border border-slate-200 dark:border-slate-700">
                                                    <img alt="User"
                                                        src="https://lh3.googleusercontent.com/aida-public/AB6AXuCWMR0E1AbvdMehGB-TxbhWtwLWB7jlrgLPU-sWPKZtGx__a1zpmphisxMm4Hr1Fosax9Ux_33YYVkGxLnzgYAZDLFcpIJ-uHKA_y1CzJlEn__dg-tqUixV6_xl5ON8xXNb3ysoa0ryjmdqOkIYMMvd9S9h4M98XE_BnpZ3UUrpAz2qsGOUMnph2w0QbkIZkWdZcqpCGvX0nEACSje-GWoBI64g_rW00PKOxNt80mW_bcgh2w4PObcyEPk_G3u3Pp2ZV4u0PDZWspV5" />
                                                </div>
                                                <div>
                                                    <p class="font-bold">Priya Patel</p>
                                                    <p class="text-[0.625rem] text-slate-500 uppercase">Class 12  NEET
                                                    </p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-center font-medium">128</td>
                                        <td class="px-6 py-4 text-center">
                                            <div class="flex items-center justify-center gap-2">
                                                <div
                                                    class="w-16 bg-slate-200 dark:bg-slate-700 h-1.5 rounded-full overflow-hidden">
                                                    <div class="bg-green-500 h-full w-[89%]"></div>
                                                </div>
                                                <span class="text-xs font-bold text-green-500">89.5%</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-center font-bold text-primary">11,420</td>
                                        <td class="px-6 py-4 text-right">
                                            <button
                                                class="text-xs font-bold bg-slate-100 dark:bg-[#233648] px-3 py-1.5 rounded-lg text-slate-600 dark:text-[#92adc9] hover:bg-primary hover:text-white transition-all">View
                                                Stats</button>
                                        </td>
                                    </tr>
                                    <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                        <td class="px-6 py-4 font-bold text-slate-400">03</td>
                                        <td class="px-6 py-4">
                                            <div class="flex items-center gap-3">
                                                <div
                                                    class="w-9 h-9 rounded-full bg-orange-500/10 flex items-center justify-center font-bold text-orange-500 text-xs border border-orange-500/20">
                                                    RN
                                                </div>
                                                <div>
                                                    <p class="font-bold">Rahul Nair</p>
                                                    <p class="text-[0.625rem] text-slate-500 uppercase">Class 11  JEE
                                                        Adv</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-center font-medium">115</td>
                                        <td class="px-6 py-4 text-center">
                                            <div class="flex items-center justify-center gap-2">
                                                <div
                                                    class="w-16 bg-slate-200 dark:bg-slate-700 h-1.5 rounded-full overflow-hidden">
                                                    <div class="bg-green-500 h-full w-[86%]"></div>
                                                </div>
                                                <span class="text-xs font-bold text-green-500">86.8%</span>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 text-center font-bold text-primary">10,950</td>
                                        <td class="px-6 py-4 text-right">
                                            <button
                                                class="text-xs font-bold bg-slate-100 dark:bg-[#233648] px-3 py-1.5 rounded-lg text-slate-600 dark:text-[#92adc9] hover:bg-primary hover:text-white transition-all">View
                                                Stats</button>
                                        </td>
                                    </tr>


                                </tbody>
                            </table>
                        </div>
                        <div
                            class="px-6 py-4 bg-slate-50 dark:bg-[#1a252f] border-t border-slate-100 dark:border-[#324d67] flex flex-col sm:flex-row items-center justify-between gap-4">
                            <p class="text-xs text-slate-500 dark:text-[#92adc9] font-medium">
                                Showing top <span class="dark:text-white font-bold">100</span> aspirants globally
                            </p>
                            <div class="flex items-center gap-2">
                                <button
                                    class="p-1.5 rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-400 dark:text-slate-500 hover:bg-slate-100 dark:hover:bg-[#233648]">
                                    <span class="material-symbols-outlined text-lg">chevron_left</span>
                                </button>
                                <div class="flex gap-1">
                                    <button
                                        class="w-8 h-8 rounded-lg bg-primary text-white text-xs font-bold">1</button>
                                    <button
                                        class="w-8 h-8 rounded-lg text-slate-600 dark:text-[#92adc9] hover:bg-slate-100 dark:hover:bg-[#233648] text-xs font-bold">2</button>
                                    <button
                                        class="w-8 h-8 rounded-lg text-slate-600 dark:text-[#92adc9] hover:bg-slate-100 dark:hover:bg-[#233648] text-xs font-bold">3</button>
                                    <span class="w-8 h-8 flex items-center justify-center text-slate-400">...</span>
                                    <button
                                        class="w-8 h-8 rounded-lg text-slate-600 dark:text-[#92adc9] hover:bg-slate-100 dark:hover:bg-[#233648] text-xs font-bold">10</button>
                                </div>
                                <button
                                    class="p-1.5 rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-400 dark:text-slate-500 hover:bg-slate-100 dark:hover:bg-[#233648]">
                                    <span class="material-symbols-outlined text-lg">chevron_right</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="page-content hidden" id="page-live-mock">
                    <div class="space-y-4">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <h2 class="text-2xl font-black tracking-tight dark:text-white">Live Mock Exams</h2>
                                <p class="text-slate-500 dark:text-[#92adc9] text-xs mt-1">Manage and monitor ongoing
                                    and scheduled national level mock tests.</p>
                            </div>
                            <button
                                class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg font-bold text-xs flex items-center gap-2 transition-all shadow-lg shadow-primary/20">
                                <span class="material-symbols-outlined text-sm">add</span>
                                Schedule New Mock
                            </button>
                        </div>
                        <!-- Stats Cards -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
                            <div
                                class="bg-white dark:bg-background-dark border border-slate-200 dark:border-slate-800 p-4 rounded-xl space-y-1">
                                <p
                                    class="text-slate-500 dark:text-[#92adc9] text-[0.625rem] font-bold uppercase tracking-wider">
                                    Total Scheduled</p>
                                <div class="flex items-baseline justify-between">
                                    <p class="text-xl font-black dark:text-white">128</p>
                                    <span class="text-emerald-500 text-[0.625rem] font-bold">+12%</span>
                                </div>
                            </div>
                            <div
                                class="bg-white dark:bg-background-dark border border-slate-200 dark:border-slate-800 p-4 rounded-xl space-y-1">
                                <p
                                    class="text-slate-500 dark:text-[#92adc9] text-[0.625rem] font-bold uppercase tracking-wider">
                                    Currently Live</p>
                                <div class="flex items-baseline justify-between">
                                    <div class="flex items-center gap-2">
                                        <span class="relative flex h-2 w-2">
                                            <span
                                                class="pulse-dot absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                                            <span
                                                class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                                        </span>
                                        <p class="text-xl font-black dark:text-white">12</p>
                                    </div>
                                    <span class="text-emerald-500 text-[0.625rem] font-bold">+5%</span>
                                </div>
                            </div>
                            <div
                                class="bg-white dark:bg-background-dark border border-slate-200 dark:border-slate-800 p-4 rounded-xl space-y-1">
                                <p
                                    class="text-slate-500 dark:text-[#92adc9] text-[0.625rem] font-bold uppercase tracking-wider">
                                    Total Participants</p>
                                <div class="flex items-baseline justify-between">
                                    <p class="text-xl font-black dark:text-white">45.2k</p>
                                    <span class="text-rose-500 text-[0.625rem] font-bold">-2%</span>
                                </div>
                            </div>
                            <div
                                class="bg-white dark:bg-background-dark border border-slate-200 dark:border-slate-800 p-4 rounded-xl space-y-1">
                                <p
                                    class="text-slate-500 dark:text-[#92adc9] text-[0.625rem] font-bold uppercase tracking-wider">
                                    Avg. Completion Rate</p>
                                <div class="flex items-baseline justify-between">
                                    <p class="text-xl font-black dark:text-white">88%</p>
                                    <span class="text-emerald-500 text-[0.625rem] font-bold">+4%</span>
                                </div>
                            </div>
                        </div>
                        <!-- Filter Bar -->
                        <div class="flex flex-wrap items-center gap-4">
                            <div class="flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl">
                                <button
                                    class="px-4 py-1.5 rounded-lg text-sm font-bold bg-white dark:bg-background-dark shadow-sm dark:text-white">All
                                    Exams</button>
                                <button
                                    class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-900 dark:hover:text-white">JEE</button>
                                <button
                                    class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-900 dark:hover:text-white">NEET</button>
                                <button
                                    class="px-4 py-1.5 rounded-lg text-sm font-medium text-slate-500 hover:text-slate-900 dark:hover:text-white">GATE</button>
                            </div>
                            <div class="flex-1"></div>
                            <div class="flex gap-2">
                                <button
                                    class="p-2 border border-slate-200 dark:border-slate-800 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-[#92adc9]">
                                    <span class="material-symbols-outlined text-xl">filter_list</span>
                                </button>
                                <button
                                    class="p-2 border border-slate-200 dark:border-slate-800 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-600 dark:text-[#92adc9]">
                                    <span class="material-symbols-outlined text-xl">calendar_month</span>
                                </button>
                            </div>
                        </div>
                        <!-- Live Mock Exams Table -->
                        <div
                            class="bg-white dark:bg-background-dark rounded-xl border border-slate-200 dark:border-[#324d67] shadow-sm overflow-hidden">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left">
                                    <thead
                                        class="bg-slate-50 dark:bg-[#1a252f] text-slate-500 dark:text-[#92adc9] text-xs uppercase tracking-wider font-semibold">
                                        <tr>
                                            <th class="px-6 py-4">Mock Exam Details</th>
                                            <th class="px-6 py-4 text-center">Status</th>
                                            <th class="px-6 py-4">Aspirants Registered</th>
                                            <th class="px-6 py-4">Schedule & Duration</th>
                                            <th class="px-6 py-4 text-right">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody
                                        class="text-sm dark:text-white divide-y divide-slate-100 dark:divide-[#324d67]">
                                        <!-- Exam 1 -->
                                        <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                            <td class="px-6 py-5">
                                                <div class="flex items-center gap-3">
                                                    <div
                                                        class="w-10 h-10 rounded-lg bg-emerald-500/10 flex items-center justify-center text-emerald-500 border border-emerald-500/20">
                                                        <span class="material-symbols-outlined text-2xl">draw</span>
                                                    </div>
                                                    <div>
                                                        <p class="font-bold">National Mock Test - JEE Advanced 2024</p>
                                                        <p
                                                            class="text-[0.625rem] text-slate-500 dark:text-[#92adc9] uppercase font-bold tracking-wider">
                                                            Engineering  JEE Advanced</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-5">
                                                <div class="flex justify-center">
                                                    <span
                                                        class="bg-emerald-100 text-emerald-700 dark:bg-emerald-500/10 dark:text-emerald-400 px-2 py-1 rounded text-[0.625rem] font-bold flex items-center gap-1.5 uppercase">
                                                        <span
                                                            class="size-1 bg-emerald-500 rounded-full animate-pulse"></span>
                                                        LIVE
                                                    </span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-5">
                                                <div class="flex items-center gap-3">
                                                    <div
                                                        class="flex-1 min-w-[100px] bg-slate-100 dark:bg-slate-800 h-1.5 rounded-full overflow-hidden">
                                                        <div class="bg-primary h-full rounded-full shadow-[0_0_8px_rgba(43,140,238,0.3)]"
                                                            style="width: 83%"></div>
                                                    </div>
                                                    <span class="text-xs font-bold text-primary">12.5k / 15k</span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-5 whitespace-nowrap">
                                                <p class="font-semibold text-xs">Oct 24, 2023</p>
                                                <p
                                                    class="text-[0.625rem] text-slate-500 dark:text-[#92adc9] font-bold uppercase mt-0.5">
                                                    09:00 AM  180 min</p>
                                            </td>
                                            <td class="px-6 py-5 text-right">
                                                <div class="flex justify-end gap-2">
                                                    <button
                                                        class="text-xs font-bold bg-primary text-white px-3 py-1.5 rounded-lg hover:bg-primary/90 transition-all shadow-sm flex items-center gap-1.5">
                                                        <span
                                                            class="material-symbols-outlined text-sm">monitoring</span>
                                                        Control Room
                                                    </button>
                                                    <button
                                                        class="bg-slate-100 dark:bg-[#233648] hover:bg-slate-200 dark:hover:bg-[#324d67] text-slate-600 dark:text-[#92adc9] p-1.5 rounded-lg transition-all border border-slate-200 dark:border-[#324d67]">
                                                        <span class="material-symbols-outlined text-lg">settings</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <!-- Exam 2 -->
                                        <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                            <td class="px-6 py-5">
                                                <div class="flex items-center gap-3">
                                                    <div
                                                        class="w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center text-blue-500 border border-blue-500/20">
                                                        <span
                                                            class="material-symbols-outlined text-2xl">psychology</span>
                                                    </div>
                                                    <div>
                                                        <p class="font-bold">NEET 2024: Physics Full Length Mock</p>
                                                        <p
                                                            class="text-[0.625rem] text-slate-500 dark:text-[#92adc9] uppercase font-bold tracking-wider">
                                                            Medical  NEET</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-5">
                                                <div class="flex justify-center">
                                                    <span
                                                        class="bg-emerald-100 text-emerald-700 dark:bg-emerald-500/10 dark:text-emerald-400 px-2 py-1 rounded text-[0.625rem] font-bold flex items-center gap-1.5 uppercase">
                                                        <span
                                                            class="size-1 bg-emerald-500 rounded-full animate-pulse"></span>
                                                        LIVE
                                                    </span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-5">
                                                <div class="flex items-center gap-3">
                                                    <div
                                                        class="flex-1 min-w-[100px] bg-slate-100 dark:bg-slate-800 h-1.5 rounded-full overflow-hidden">
                                                        <div class="bg-primary h-full rounded-full shadow-[0_0_8px_rgba(43,140,238,0.3)]"
                                                            style="width: 78%"></div>
                                                    </div>
                                                    <span class="text-xs font-bold text-primary">15.7k / 20k</span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-5 whitespace-nowrap">
                                                <p class="font-semibold text-xs">Oct 24, 2023</p>
                                                <p
                                                    class="text-[0.625rem] text-slate-500 dark:text-[#92adc9] font-bold uppercase mt-0.5">
                                                    10:00 AM  200 min</p>
                                            </td>
                                            <td class="px-6 py-5 text-right">
                                                <div class="flex justify-end gap-2">
                                                    <button
                                                        class="text-xs font-bold bg-primary text-white px-3 py-1.5 rounded-lg hover:bg-primary/90 transition-all shadow-sm flex items-center gap-1.5">
                                                        <span
                                                            class="material-symbols-outlined text-sm">monitoring</span>
                                                        Control Room
                                                    </button>
                                                    <button
                                                        class="bg-slate-100 dark:bg-[#233648] hover:bg-slate-200 dark:hover:bg-[#324d67] text-slate-600 dark:text-[#92adc9] p-1.5 rounded-lg transition-all border border-slate-200 dark:border-[#324d67]">
                                                        <span class="material-symbols-outlined text-lg">settings</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <!-- Exam 3 -->
                                        <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                            <td class="px-6 py-5">
                                                <div class="flex items-center gap-3">
                                                    <div
                                                        class="w-10 h-10 rounded-lg bg-orange-500/10 flex items-center justify-center text-orange-500 border border-orange-500/20">
                                                        <span
                                                            class="material-symbols-outlined text-2xl">description</span>
                                                    </div>
                                                    <div>
                                                        <p class="font-bold">GATE 2024: Computer Science Mock</p>
                                                        <p
                                                            class="text-[0.625rem] text-slate-500 dark:text-[#92adc9] uppercase font-bold tracking-wider">
                                                            Engineering  GATE</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-5">
                                                <div class="flex justify-center">
                                                    <span
                                                        class="bg-emerald-100 text-emerald-700 dark:bg-emerald-500/10 dark:text-emerald-400 px-2 py-1 rounded text-[0.625rem] font-bold flex items-center gap-1.5 uppercase">
                                                        <span
                                                            class="size-1 bg-emerald-500 rounded-full animate-pulse"></span>
                                                        LIVE
                                                    </span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-5">
                                                <div class="flex items-center gap-3">
                                                    <div
                                                        class="flex-1 min-w-[100px] bg-slate-100 dark:bg-slate-800 h-1.5 rounded-full overflow-hidden">
                                                        <div class="bg-primary h-full rounded-full shadow-[0_0_8px_rgba(43,140,238,0.3)]"
                                                            style="width: 82%"></div>
                                                    </div>
                                                    <span class="text-xs font-bold text-primary">8.2k / 10k</span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-5 whitespace-nowrap">
                                                <p class="font-semibold text-xs">Oct 24, 2023</p>
                                                <p
                                                    class="text-[0.625rem] text-slate-500 dark:text-[#92adc9] font-bold uppercase mt-0.5">
                                                    02:00 PM  180 min</p>
                                            </td>
                                            <td class="px-6 py-5 text-right">
                                                <div class="flex justify-end gap-2">
                                                    <button
                                                        class="text-xs font-bold bg-primary text-white px-3 py-1.5 rounded-lg hover:bg-primary/90 transition-all shadow-sm flex items-center gap-1.5">
                                                        <span
                                                            class="material-symbols-outlined text-sm">monitoring</span>
                                                        Control Room
                                                    </button>
                                                    <button
                                                        class="bg-slate-100 dark:bg-[#233648] hover:bg-slate-200 dark:hover:bg-[#324d67] text-slate-600 dark:text-[#92adc9] p-1.5 rounded-lg transition-all border border-slate-200 dark:border-[#324d67]">
                                                        <span class="material-symbols-outlined text-lg">settings</span>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- Pagination Footer -->
                            <div
                                class="bg-slate-50 dark:bg-[#1a252f] px-6 py-4 border-t border-slate-200 dark:border-[#324d67] flex items-center justify-between">
                                <p class="text-sm text-slate-500 dark:text-[#92adc9]">Showing <span
                                        class="font-bold text-slate-900 dark:text-white">3</span> active mock exams</p>
                                <div class="flex items-center gap-1">
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-500 dark:text-[#92adc9] hover:bg-white dark:hover:bg-[#233648] transition-colors">
                                        <span class="material-symbols-outlined text-sm">chevron_left</span>
                                    </button>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg bg-primary text-white font-bold text-xs shadow-sm">1</button>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-500 dark:text-[#92adc9] hover:bg-white dark:hover:bg-[#233648] transition-colors text-xs font-medium">2</button>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-500 dark:text-[#92adc9] hover:bg-white dark:hover:bg-[#233648] transition-colors text-xs font-medium">3</button>
                                    <span class="text-slate-400 px-1">...</span>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-500 dark:text-[#92adc9] hover:bg-white dark:hover:bg-[#233648] transition-colors text-xs font-medium">10</button>
                                    <button
                                        class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-[#324d67] text-slate-500 dark:text-[#92adc9] hover:bg-white dark:hover:bg-[#233648] transition-colors">
                                        <span class="material-symbols-outlined text-sm">chevron_right</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Profile Settings Section -->
                <div class="page-content hidden" id="page-settings">
                    <div class="mb-8">
                        <h2 class="text-2xl font-black tracking-tight dark:text-white">Admin Profile Settings</h2>
                        <p class="text-slate-500 dark:text-[#92adc9] text-sm">Update your personal information and
                            dashboard appearance.</p>
                    </div>

                    <div class="max-w-3xl mx-auto">
                        <div
                            class="bg-white dark:bg-background-dark rounded-2xl border border-slate-200 dark:border-[#324d67] shadow-sm overflow-hidden">
                            <div
                                class="px-8 py-6 border-b border-slate-100 dark:border-[#324d67] bg-slate-50/50 dark:bg-[#1a252f]/50">
                                <h3
                                    class="text-xs font-black dark:text-white uppercase tracking-[0.2em] text-slate-500">
                                    My Profile Details</h3>
                            </div>

                            <div class="p-8 space-y-8">
                                <!-- Photo Upload Section -->
                                <div class="flex flex-col sm:flex-row items-center gap-8">
                                    <div class="relative group">
                                        <div
                                            class="w-24 h-24 rounded-full bg-primary/10 border-4 border-white dark:border-[#1a252f] shadow-lg overflow-hidden flex items-center justify-center">
                                            <img id="settings-preview-avatar" src=""
                                                class="w-full h-full object-cover bg-slate-100 dark:bg-slate-800">
                                        </div>
                                        <label for="admin-photo-input"
                                            class="absolute bottom-0 right-0 w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center cursor-pointer shadow-md hover:scale-110 transition-transform border-2 border-white dark:border-[#1a252f]">
                                            <span
                                                class="material-symbols-outlined text-sm font-bold">photo_camera</span>
                                        </label>
                                        <input type="file" id="admin-photo-input" class="hidden" accept="image/*"
                                            onchange="previewAdminPhoto(this)">
                                    </div>

                                    <div class="flex-1 text-center sm:text-left">
                                        <h4 class="text-sm font-bold dark:text-white mb-1">Profile Picture</h4>
                                        <p class="text-[11px] text-slate-500 dark:text-[#92adc9] mb-4">Upload a
                                            high-resolution square image for your dashboard avatar. Supported formats:
                                            JPG, PNG, WebP.</p>
                                        <div class="flex flex-wrap justify-center sm:justify-start gap-3">
                                            <button onclick="document.getElementById('admin-photo-input').click()"
                                                class="bg-primary text-white px-4 py-2 rounded-lg text-[10px] font-black shadow-lg shadow-primary/20 hover:bg-primary/90 transition-all">Change
                                                Photo</button>
                                            <button onclick="removeAdminPhoto()"
                                                class="bg-white dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] px-4 py-2 rounded-lg text-[10px] font-bold text-slate-600 dark:text-[#92adc9] hover:bg-slate-50 transition-all">Remove</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="space-y-2">
                                        <label
                                            class="text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-wider">Login
                                            / Display Name</label>
                                        <div class="relative">
                                            <span
                                                class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-lg">person</span>
                                            <input type="text" id="input-admin-name" placeholder="Full Name"
                                                class="w-full bg-slate-50/50 dark:bg-[#233648] border border-slate-200 dark:border-[#324d67] rounded-xl pl-10 pr-4 py-3 text-sm font-semibold dark:text-white focus:ring-2 focus:ring-primary/50 transition-all outline-none">
                                        </div>
                                    </div>

                                    <div class="space-y-2">
                                        <label
                                            class="text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-wider">Email
                                            Address</label>
                                        <div class="relative">
                                            <span
                                                class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-lg">mail</span>
                                            <input type="email" id="input-admin-email" placeholder="email@example.com"
                                                class="w-full bg-slate-50/50 dark:bg-[#233648] border border-slate-200 dark:border-[#324d67] rounded-xl pl-10 pr-4 py-3 text-sm font-semibold dark:text-white focus:ring-2 focus:ring-primary/50 transition-all outline-none">
                                        </div>
                                    </div>

                                    <div class="space-y-2">
                                        <label
                                            class="text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-wider">Phone
                                            Number</label>
                                        <div class="relative">
                                            <span
                                                class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-lg">call</span>
                                            <input type="tel" id="input-admin-phone" placeholder="+1 (555) 000-0000"
                                                class="w-full bg-slate-50/50 dark:bg-[#233648] border border-slate-200 dark:border-[#324d67] rounded-xl pl-10 pr-4 py-3 text-sm font-semibold dark:text-white focus:ring-2 focus:ring-primary/50 transition-all outline-none">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div
                                class="px-8 py-5 bg-slate-50/50 dark:bg-[#1a252f]/50 border-t border-slate-100 dark:border-[#324d67] flex items-center justify-between">
                                <p class="text-[10px] text-slate-500 flex items-center gap-1.5">
                                    <span class="material-symbols-outlined text-sm">info</span>
                                    Changes are reflected instantly across the dashboard.
                                </p>
                                <div class="flex gap-3">
                                    <button onclick="handleDiscard()"
                                        class="px-5 py-2.5 text-xs font-bold text-slate-500 hover:text-slate-900 dark:hover:text-white transition-all">Discard</button>
                                    <button onclick="updateAdminProfile(event)"
                                        class="bg-primary text-white px-8 py-2.5 rounded-lg text-xs font-black shadow-xl shadow-primary/20 hover:scale-[1.02] active:scale-95 transition-all">Update
                                        Profile</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- Filter Drawer Logic ---
        window.toggleFilterDrawer = function() {
            const drawer = document.getElementById('filter-drawer');
            const overlay = document.getElementById('filter-drawer-overlay');
            if (!drawer || !overlay) return;

            drawer.classList.toggle('active');
            overlay.classList.toggle('active');
        };
    </script>

    <script>
        // ===== CORE FUNCTIONS (Must be defined early for inline onclick handlers) =====

        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            // Dispatch event for components that need to sync with theme
            window.dispatchEvent(new CustomEvent('themeChanged', {
                detail: { isDark: document.documentElement.classList.contains('dark') }
            }));
        }

        function openModal(id) {
            // Force close global action menu if open
            const globalMenu = document.getElementById('global-action-menu');
            if (globalMenu && !globalMenu.classList.contains('hidden')) {
                globalMenu.classList.add('hidden');
                document.querySelectorAll('.action-btn-trigger').forEach(b => b.classList.remove('action-btn-trigger'));
            }

            const modal = document.getElementById(id);
            if (!modal) {
                console.error(' Modal not found:', id);
                return;
            }

            modal.classList.remove('hidden');
            modal.classList.add('flex');

            // Trigger animations
            setTimeout(() => {
                modal.querySelector('.modal-backdrop')?.classList.replace('opacity-0', 'opacity-100');
                modal.querySelector('.modal-panel')?.classList.replace('opacity-0', 'opacity-100');
                modal.querySelector('.modal-panel')?.classList.replace('translate-y-4', 'translate-y-0');
                modal.querySelector('.modal-panel')?.classList.replace('sm:scale-95', 'sm:scale-100');
            }, 10);

            // Special: Reset Question Params Slider for New Question Modal
            if (id === 'modal-add-question') {
                const section = document.getElementById('question-param-section');
                const icon = document.getElementById('param-toggle-icon');
                if (section) section.classList.remove('collapsed');
                if (icon) icon.style.transform = 'rotate(0deg)';
            }
        }

        function closeModal(id) {
            const modal = document.getElementById(id);
            if (!modal) {
                console.error(' Modal not found:', id);
                return;
            }

            modal.querySelector('.modal-backdrop')?.classList.replace('opacity-100', 'opacity-0');
            modal.querySelector('.modal-panel')?.classList.replace('opacity-100', 'opacity-0');
            modal.querySelector('.modal-panel')?.classList.replace('translate-y-0', 'translate-y-4');
            modal.querySelector('.modal-panel')?.classList.replace('sm:scale-100', 'sm:scale-95');

            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }, 300);
        }

        // Make these immediately available globally
        window.openModal = openModal;
        window.closeModal = closeModal;

        // Forward declarations for functions defined later (called from dynamic HTML)
        window.openEditModal = async function (userId, role) {
            console.log(' openEditModal called:', { userId, role });
            try {
                const response = await fetch(`../api/admin/manage_user.php?action=get&user_id=${userId}&role=${role}`);
                const data = await response.json();
                if (data.status === 'success') {
                    const user = data.data;
                    user.role = role;
                    document.getElementById('edit-user-id').value = user.id;
                    document.getElementById('edit-user-role').value = user.role;
                    document.getElementById('edit-user-name').value = user.full_name;
                    document.getElementById('edit-user-email').value = user.email;
                    document.getElementById('edit-user-phone').value = user.phone || '';
                    document.getElementById('edit-user-gender').value = user.gender || 'male';
                    document.getElementById('edit-user-status').value = user.status;

                    const expertFields = document.getElementById('edit-expert-fields');
                    const aspirantFields = document.getElementById('edit-aspirant-fields');

                    if (user.role === 'expert') {
                        expertFields.classList.remove('hidden');
                        aspirantFields.classList.add('hidden');
                        document.getElementById('edit-user-profession').value = user.profession || '';
                        document.getElementById('edit-user-department').value = user.department || '';
                        document.getElementById('edit-user-degree').value = user.degree || '';
                        document.getElementById('edit-user-spec').value = user.specialization || 'Organic Chemistry';
                    } else {
                        expertFields.classList.add('hidden');
                        aspirantFields.classList.remove('hidden');
                        document.getElementById('edit-user-class').value = user.class || '';
                    }
                    openModal('modal-edit-user');
                } else {
                    alert(data.message || 'Failed to load user data');
                }
            } catch (error) {
                console.error(' Error loading user:', error);
                alert('Failed to load user data');
            }
        };

        window.confirmDelete = async function (userId, role) {
            openModal('modal-confirm-delete');
            document.getElementById('confirm-delete-btn').onclick = async () => {
                try {
                    const formData = new URLSearchParams();
                    formData.append('action', 'delete');
                    formData.append('user_id', userId);
                    formData.append('role', role);

                    const response = await fetch('../api/admin/manage_user.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: formData.toString()
                    });
                    const data = await response.json();
                    if (data.status === 'success') {
                        alert(data.message || 'User deleted successfully');
                        closeModal('modal-confirm-delete');
                        // Reload the page to refresh the user list
                        window.location.reload();
                    } else {
                        alert(data.message || 'Delete failed');
                    }
                } catch (error) {
                    console.error(' Delete error:', error);
                    alert('Delete failed');
                }
            };
        };

        window.updateUserStatus = async function (userId, status, role) {
            try {
                const formData = new URLSearchParams();
                formData.append('action', 'update_status');
                formData.append('user_id', userId);
                formData.append('status', status);
                formData.append('role', role);

                const response = await fetch('../api/admin/manage_user.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: formData.toString()
                });
                const data = await response.json();
                if (data.status === 'success') {
                    alert(data.message || 'Status updated successfully');
                    window.location.reload();
                } else {
                    alert(data.message || 'Update failed');
                }
            } catch (error) {
                console.error(' Update error:', error);
                alert('Operation failed');
            }
        };


    </script>
    <!-- Add Expert Modal -->
    <div id="modal-add-expert" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <!-- Backdrop -->
        <div class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity opacity-0 modal-backdrop"
            onclick="closeModal('modal-add-expert')"></div>

        <!-- Modal Panel -->
        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div
                    class="relative transform overflow-hidden rounded-xl bg-white dark:bg-[#1a252f] text-left shadow-xl transition-all sm:my-8 w-full sm:max-w-lg opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95 modal-panel border border-slate-200 dark:border-[#324d67]">

                    <!-- Header -->
                    <div
                        class="bg-gradient-to-r from-slate-50 to-white dark:from-[#111a22] dark:to-[#1a252f] px-6 py-4 border-b border-slate-200 dark:border-[#324d67] flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-emerald-500/10 rounded-lg">
                                <span class="material-symbols-outlined text-emerald-500">school</span>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-slate-900 dark:text-white leading-none">Add New Expert
                                </h3>
                                <p
                                    class="text-[10px] text-slate-500 dark:text-[#92adc9] mt-1 uppercase tracking-widest font-bold">
                                    Faculty Enrollment Portal</p>
                            </div>
                        </div>
                        <button type="button"
                            class="p-2 rounded-full text-slate-400 hover:text-slate-600 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-slate-800 transition-all"
                            onclick="closeModal('modal-add-expert')">
                            <span class="material-symbols-outlined text-base">close</span>
                        </button>
                    </div>

                    <!-- Body -->
                    <div class="px-6 py-6 overflow-y-auto max-h-[80vh]">
                        <form id="form-add-expert" class="space-y-6">
                            <input type="hidden" name="user_id" id="expert-user-id">
                            <input type="hidden" name="action_type" id="expert-action-type" value="add">

                            <!-- Section: Personal Info -->
                            <div class="space-y-4">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-[10px] font-black text-emerald-500 uppercase tracking-widest">01.
                                        Identity & Contact</span>
                                    <div class="h-px flex-1 bg-slate-100 dark:bg-slate-800"></div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="space-y-1.5">
                                        <label for="expert-name"
                                            class="block text-[11px] font-bold text-slate-500 dark:text-[#92adc9] uppercase ml-1">Full
                                            Name</label>
                                        <div class="relative group">
                                            <span
                                                class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm group-focus-within:text-emerald-500 transition-colors">person</span>
                                            <input type="text" name="name" id="expert-name"
                                                class="block w-full rounded-xl border-0 py-2.5 pl-10 text-slate-900 dark:text-white dark:bg-[#111a22] shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] placeholder:text-slate-400 focus:ring-2 focus:ring-inset focus:ring-emerald-500 sm:text-sm transition-all"
                                                placeholder="Dr. John Doe" required>
                                        </div>
                                    </div>
                                    <div class="space-y-1.5">
                                        <label for="expert-email"
                                            class="block text-[11px] font-bold text-slate-500 dark:text-[#92adc9] uppercase ml-1">Email
                                            Address</label>
                                        <div class="relative group">
                                            <span
                                                class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm group-focus-within:text-emerald-500 transition-colors">mail</span>
                                            <input type="email" name="email" id="expert-email"
                                                class="block w-full rounded-xl border-0 py-2.5 pl-10 text-slate-900 dark:text-white dark:bg-[#111a22] shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] placeholder:text-slate-400 focus:ring-2 focus:ring-inset focus:ring-emerald-500 sm:text-sm transition-all"
                                                placeholder="expert@university.edu" required>
                                        </div>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="space-y-1.5">
                                        <label for="expert-phone"
                                            class="block text-[11px] font-bold text-slate-500 dark:text-[#92adc9] uppercase ml-1">Phone
                                            Number</label>
                                        <div class="relative group">
                                            <span
                                                class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm group-focus-within:text-emerald-500 transition-colors">call</span>
                                            <input type="tel" name="phone" id="expert-phone"
                                                class="block w-full rounded-xl border-0 py-2.5 pl-10 text-slate-900 dark:text-white dark:bg-[#111a22] shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] placeholder:text-slate-400 focus:ring-2 focus:ring-inset focus:ring-emerald-500 sm:text-sm transition-all"
                                                placeholder="+1 (555) 000-0000">
                                        </div>
                                    </div>
                                    <div class="space-y-1.5">
                                        <label
                                            class="block text-[11px] font-bold text-slate-500 dark:text-[#92adc9] uppercase ml-1">Gender</label>
                                        <div class="grid grid-cols-2 gap-2 h-[42px]">
                                            <label class="relative flex items-center justify-center cursor-pointer">
                                                <input type="radio" name="gender" value="male" checked
                                                    class="peer sr-only">
                                                <div
                                                    class="w-full h-full flex items-center justify-center rounded-xl bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] text-[11px] font-bold text-slate-500 peer-checked:bg-emerald-500/10 peer-checked:border-emerald-500 peer-checked:text-emerald-600 transition-all">
                                                    Male</div>
                                            </label>
                                            <label class="relative flex items-center justify-center cursor-pointer">
                                                <input type="radio" name="gender" value="female" class="peer sr-only">
                                                <div
                                                    class="w-full h-full flex items-center justify-center rounded-xl bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] text-[11px] font-bold text-slate-500 peer-checked:bg-emerald-500/10 peer-checked:border-emerald-500 peer-checked:text-emerald-600 transition-all">
                                                    Female</div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Section: Professional Info -->
                            <div class="space-y-4">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-[10px] font-black text-emerald-500 uppercase tracking-widest">02.
                                        Expertise & Credentials</span>
                                    <div class="h-px flex-1 bg-slate-100 dark:bg-slate-800"></div>
                                </div>

                                <div
                                    class="bg-slate-50/50 dark:bg-[#111a22]/50 p-5 rounded-2xl border border-slate-100 dark:border-[#324d67] space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="space-y-1.5">
                                            <label for="expert-designation"
                                                class="block text-[11px] font-bold text-slate-500 dark:text-[#92adc9] uppercase ml-1">Designation</label>
                                            <div class="relative group">
                                                <span
                                                    class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm group-focus-within:text-emerald-500 transition-colors">badge</span>
                                                <input type="text" name="profession" id="expert-designation"
                                                    class="block w-full rounded-xl border-0 py-2.5 pl-10 text-slate-900 dark:text-white dark:bg-[#111a22] shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] placeholder:text-slate-400 focus:ring-2 focus:ring-inset focus:ring-emerald-500 sm:text-sm transition-all"
                                                    placeholder="Senior Professor/Teacher">
                                            </div>
                                        </div>
                                        <div class="space-y-1.5">
                                            <label for="expert-department"
                                                class="block text-[11px] font-bold text-slate-500 dark:text-[#92adc9] uppercase ml-1">Department</label>
                                            <div class="relative group">
                                                <span
                                                    class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm group-focus-within:text-emerald-500 transition-colors">account_balance</span>
                                                <input type="text" name="department" id="expert-department"
                                                    class="block w-full rounded-xl border-0 py-2.5 pl-10 text-slate-900 dark:text-white dark:bg-[#111a22] shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] placeholder:text-slate-400 focus:ring-2 focus:ring-inset focus:ring-emerald-500 sm:text-sm transition-all"
                                                    placeholder="School/College name">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="space-y-1.5">
                                        <label for="expert-spec"
                                            class="block text-[11px] font-bold text-slate-500 dark:text-[#92adc9] uppercase ml-1">Core
                                            Specialization</label>
                                        <div class="relative group">
                                            <span
                                                class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm group-focus-within:text-emerald-500 transition-colors">psychology</span>
                                            <select id="expert-spec" name="specialization"
                                                class="block w-full rounded-xl border-0 py-2.5 pl-10 text-slate-900 dark:text-white dark:bg-[#111a22] shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] focus:ring-2 focus:ring-inset focus:ring-emerald-500 sm:text-sm transition-all appearance-none cursor-pointer">
                                                <option value="" selected disabled>Choose specialization subject
                                                </option>
                                                <option value="Organic Chemistry">Organic Chemistry</option>
                                                <option value="Applied Physics">Applied Physics</option>
                                                <option value="Mathematics">Mathematics</option>
                                                <option value="Biology">Biology</option>
                                                <option value="Computer Science">Computer Science</option>
                                                <option value="English Literature">English Literature</option>
                                            </select>
                                            <span
                                                class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-base">expand_more</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <input type="hidden" name="degree" value="">

                            <!-- Action Buttons -->
                            <div class="flex items-center gap-3 pt-4">
                                <button type="button" onclick="closeModal('modal-add-expert')"
                                    class="flex-1 py-3 px-4 rounded-xl text-sm font-bold text-white bg-gradient-to-br from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 shadow-lg shadow-red-500/25 active:scale-95 transition-all flex items-center justify-center gap-2">
                                    <span class="material-symbols-outlined text-base">cancel</span>
                                    Discard
                                </button>
                                <button type="button" id="btn-submit-expert"
                                    onclick="handleAddUser('form-add-expert', 'expert')"
                                    class="flex-[2] py-3 px-4 rounded-xl text-sm font-bold text-white bg-gradient-to-br from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700 shadow-lg shadow-emerald-500/25 active:scale-95 transition-all flex items-center justify-center gap-2">
                                    <span class="material-symbols-outlined text-base">verified_user</span>
                                    Register Faculty
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>
    </div>
    </div>

    <!-- Add Aspirant Modal -->
    <div id="modal-add-aspirant" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <!-- Backdrop -->
        <div class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity opacity-0 modal-backdrop"
            onclick="closeModal('modal-add-aspirant')"></div>

        <!-- Modal Panel -->
        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div
                    class="relative transform overflow-hidden rounded-xl bg-white dark:bg-[#1a252f] text-left shadow-xl transition-all sm:my-8 w-full sm:max-w-lg opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95 modal-panel border border-slate-200 dark:border-[#324d67]">

                    <!-- Header -->
                    <div
                        class="bg-gradient-to-r from-slate-50 to-white dark:from-[#111a22] dark:to-[#1a252f] px-6 py-4 border-b border-slate-200 dark:border-[#324d67] flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-emerald-500/10 rounded-lg">
                                <span class="material-symbols-outlined text-emerald-500">person_add</span>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-slate-900 dark:text-white leading-none">Add New
                                    Aspirant</h3>
                                <p
                                    class="text-[10px] text-slate-500 dark:text-[#92adc9] mt-1 uppercase tracking-widest font-bold">
                                    User Enrollment Portal</p>
                            </div>
                        </div>
                        <button type="button"
                            class="p-2 rounded-full text-slate-400 hover:text-slate-600 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-slate-800 transition-all"
                            onclick="closeModal('modal-add-aspirant')">
                            <span class="material-symbols-outlined text-base">close</span>
                        </button>
                    </div>

                    <!-- Body -->
                    <div class="px-6 py-6 overflow-y-auto max-h-[80vh]">
                        <form id="form-add-aspirant" class="space-y-6">
                            <input type="hidden" name="user_id" id="aspirant-user-id">
                            <input type="hidden" name="action_type" id="aspirant-action-type" value="add">

                            <!-- Personal Information Group -->
                            <div class="space-y-4">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-[10px] font-black text-emerald-500 uppercase tracking-widest">01.
                                        Personal Information</span>
                                    <div class="h-px flex-1 bg-slate-100 dark:bg-slate-800"></div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="space-y-1.5">
                                        <label for="aspirant-name"
                                            class="block text-[11px] font-bold text-slate-500 dark:text-[#92adc9] uppercase ml-1">Full
                                            Name</label>
                                        <div class="relative group">
                                            <span
                                                class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm group-focus-within:text-emerald-500 transition-colors">person</span>
                                            <input type="text" name="name" id="aspirant-name"
                                                class="block w-full rounded-xl border-0 py-2.5 pl-10 text-slate-900 dark:text-white dark:bg-[#111a22] shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] placeholder:text-slate-400 focus:ring-2 focus:ring-inset focus:ring-emerald-500 sm:text-sm transition-all"
                                                placeholder="Enter full name" required>
                                        </div>
                                    </div>
                                    <div class="space-y-1.5">
                                        <label for="aspirant-email"
                                            class="block text-[11px] font-bold text-slate-500 dark:text-[#92adc9] uppercase ml-1">Email
                                            Address</label>
                                        <div class="relative group">
                                            <span
                                                class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm group-focus-within:text-emerald-500 transition-colors">mail</span>
                                            <input type="email" name="email" id="aspirant-email"
                                                class="block w-full rounded-xl border-0 py-2.5 pl-10 text-slate-900 dark:text-white dark:bg-[#111a22] shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] placeholder:text-slate-400 focus:ring-2 focus:ring-inset focus:ring-emerald-500 sm:text-sm transition-all"
                                                placeholder="example@mail.com" required>
                                        </div>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="space-y-1.5">
                                        <label for="aspirant-phone"
                                            class="block text-[11px] font-bold text-slate-500 dark:text-[#92adc9] uppercase ml-1">Phone
                                            Number</label>
                                        <div class="relative group">
                                            <span
                                                class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm group-focus-within:text-emerald-500 transition-colors">call</span>
                                            <input type="tel" name="phone" id="aspirant-phone"
                                                class="block w-full rounded-xl border-0 py-2.5 pl-10 text-slate-900 dark:text-white dark:bg-[#111a22] shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] placeholder:text-slate-400 focus:ring-2 focus:ring-inset focus:ring-emerald-500 sm:text-sm transition-all"
                                                placeholder="+91 0000 000 000">
                                        </div>
                                    </div>
                                    <div class="space-y-1.5">
                                        <label
                                            class="block text-[11px] font-bold text-slate-500 dark:text-[#92adc9] uppercase ml-1">Gender</label>
                                        <div class="grid grid-cols-3 gap-2 h-[42px]">
                                            <label class="relative flex items-center justify-center cursor-pointer">
                                                <input type="radio" name="gender" value="male" checked
                                                    class="peer sr-only">
                                                <div
                                                    class="w-full h-full flex items-center justify-center rounded-xl bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] text-[11px] font-bold text-slate-500 peer-checked:bg-emerald-500/10 peer-checked:border-emerald-500 peer-checked:text-emerald-600 transition-all">
                                                    Male</div>
                                            </label>
                                            <label class="relative flex items-center justify-center cursor-pointer">
                                                <input type="radio" name="gender" value="female" class="peer sr-only">
                                                <div
                                                    class="w-full h-full flex items-center justify-center rounded-xl bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] text-[11px] font-bold text-slate-500 peer-checked:bg-emerald-500/10 peer-checked:border-emerald-500 peer-checked:text-emerald-600 transition-all">
                                                    Female</div>
                                            </label>
                                            <label class="relative flex items-center justify-center cursor-pointer">
                                                <input type="radio" name="gender" value="other" class="peer sr-only">
                                                <div
                                                    class="w-full h-full flex items-center justify-center rounded-xl bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] text-[11px] font-bold text-slate-500 peer-checked:bg-emerald-500/10 peer-checked:border-emerald-500 peer-checked:text-emerald-600 transition-all">
                                                    Other</div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Enrollment Details Group -->
                            <div class="space-y-4">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-[10px] font-black text-emerald-500 uppercase tracking-widest">02.
                                        Enrollment Details</span>
                                    <div class="h-px flex-1 bg-slate-100 dark:bg-slate-800"></div>
                                </div>

                                <div
                                    class="bg-slate-50/50 dark:bg-[#111a22]/50 p-4 rounded-2xl border border-slate-100 dark:border-[#324d67] space-y-4">
                                    <div class="space-y-2">
                                        <label
                                            class="block text-[11px] font-bold text-slate-500 dark:text-[#92adc9] uppercase ml-1">Applicant
                                            Classification</label>
                                        <div
                                            class="relative flex justify-center p-1 bg-slate-200/50 dark:bg-[#233648] rounded-xl cursor-pointer">
                                            <!-- Animated Background Slider -->
                                            <div id="toggle-slider"
                                                class="absolute left-1 top-1 bottom-1 w-[calc(50%-4px)] bg-white dark:bg-[#1a252f] rounded-lg shadow-md transition-all duration-300 ease-in-out">
                                            </div>

                                            <button type="button" id="btn-student"
                                                onclick="toggleAspirantType('student')"
                                                class="relative z-10 flex-1 py-2 text-xs font-bold rounded-lg transition-colors duration-300 text-emerald-600">
                                                Academic Student
                                            </button>
                                            <button type="button" id="btn-aspirant"
                                                onclick="toggleAspirantType('aspirant')"
                                                class="relative z-10 flex-1 py-2 text-xs font-bold rounded-lg transition-colors duration-300 text-slate-500 dark:text-slate-400">
                                                Job Aspirant
                                            </button>
                                        </div>
                                    </div>

                                    <div id="div-aspirant-class"
                                        class="student-only-fields grid transition-[grid-template-rows] duration-500 ease-in-out grid-rows-[1fr]">
                                        <div class="overflow-hidden">
                                            <div class="space-y-1.5 pt-2">
                                                <label for="aspirant-class"
                                                    class="block text-[11px] font-bold text-slate-500 dark:text-[#92adc9] uppercase ml-1">Current
                                                    Academic Class</label>
                                                <div class="relative group">
                                                    <span
                                                        class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm group-focus-within:text-emerald-500 transition-colors">school</span>
                                                    <select id="aspirant-class" name="aspirant-class"
                                                        class="mt-1 block w-full rounded-xl border-0 py-2.5 dark:bg-[#16202a] dark:text-white shadow-sm ring-1 ring-inset ring-slate-200 dark:ring-[#324d67] focus:ring-2 focus:ring-emerald-500 sm:text-xs pl-10 outline-none transition-all">
                                                        <option value="" selected disabled>Choose Class</option>
                                                    </select>
                                                    <span
                                                        class="material-symbols-outlined absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-base">expand_more</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex items-center gap-3 pt-4">
                                <button type="button" onclick="closeModal('modal-add-aspirant')"
                                    class="flex-1 py-3 px-4 rounded-xl text-sm font-bold text-white bg-gradient-to-br from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 shadow-lg shadow-red-500/25 active:scale-95 transition-all flex items-center justify-center gap-2">
                                    <span class="material-symbols-outlined text-base">cancel</span>
                                    Discard
                                </button>
                                <button type="button" id="btn-submit-aspirant"
                                    onclick="handleAddUser('form-add-aspirant', 'aspirant')"
                                    class="flex-[2] py-3 px-4 rounded-xl text-sm font-bold text-white bg-gradient-to-br from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700 shadow-lg shadow-emerald-500/25 active:scale-95 transition-all flex items-center justify-center gap-2">
                                    <span class="material-symbols-outlined text-base">check_circle</span>
                                    Enroll Aspirant
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- View User Modal (Pro Max Design) -->
    <div id="modal-view-profile" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <!-- Backdrop -->
        <div class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity opacity-0 modal-backdrop"
            onclick="closeModal('modal-view-profile')"></div>

        <!-- Modal Panel -->
        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div
                    class="relative transform overflow-hidden rounded-xl bg-white dark:bg-[#1a252f] text-left shadow-xl transition-all sm:my-8 w-full sm:max-w-lg opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95 modal-panel border border-slate-200 dark:border-[#324d67]">

                    <!-- Header -->
                    <div
                        class="bg-gradient-to-r from-slate-50 to-white dark:from-[#111a22] dark:to-[#1a252f] px-6 py-4 border-b border-slate-200 dark:border-[#324d67] flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="p-2 bg-blue-500/10 rounded-lg">
                                <span class="material-symbols-outlined text-blue-500">account_circle</span>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-slate-900 dark:text-white leading-none">User Profile</h3>
                                <p class="text-[10px] text-slate-500 dark:text-[#92adc9] mt-1 uppercase tracking-widest font-bold">Comprehensive Identity Details</p>
                            </div>
                        </div>
                        <button type="button"
                            class="p-2 rounded-full text-slate-400 hover:text-slate-600 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-slate-800 transition-all"
                            onclick="closeModal('modal-view-profile')">
                            <span class="material-symbols-outlined text-base">close</span>
                        </button>
                    </div>

                    <!-- Body -->
                    <div class="px-6 py-3 overflow-y-auto max-h-[80vh]">
                        
                        <!-- Top Header: Avatar & Main Info -->
                        <div class="flex flex-col items-center text-center mb-5">
                            <div class="relative group mb-3">
                                <div class="w-20 h-20 rounded-2xl p-1 bg-gradient-to-tr from-blue-500 to-indigo-500 shadow-lg">
                                    <img id="profile-avatar" src="" alt="User Avatar"
                                        class="w-full h-full rounded-xl object-cover border-2 border-white dark:border-[#1a252f] bg-slate-50">
                                </div>
                                <div id="profile-status-indicator"
                                    class="absolute -bottom-0.5 -right-0.5 w-5 h-5 rounded-full border-[3px] border-white dark:border-[#1a252f] bg-green-500 shadow-sm">
                                </div>
                            </div>
                            
                            <h4 id="profile-name" class="text-lg font-bold text-slate-900 dark:text-white mb-0.5">User Name</h4>
                            <div class="flex items-center gap-2">
                                <span id="profile-role-badge" class="px-1.5 py-0.5 rounded text-[9px] font-black uppercase tracking-wider bg-blue-500/10 text-blue-500 border border-blue-500/20">ROLE</span>
                                <span id="profile-status-text" class="text-[9px] font-bold text-slate-400 uppercase tracking-widest"> ACTIVE</span>
                            </div>
                        </div>

                        <!-- Info Grid -->
                        <div class="space-y-4">
                            
                            <!-- Section: Primary Identity -->
                            <div class="space-y-3">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-[10px] font-black text-blue-500 uppercase tracking-widest">01. Identity & Contact</span>
                                    <div class="h-px flex-1 bg-slate-100 dark:bg-slate-800"></div>
                                </div>

                                <div class="grid grid-cols-2 gap-3">
                                    <div class="p-2.5 bg-slate-50 dark:bg-[#111a22] rounded-xl border border-slate-100 dark:border-[#324d67]">
                                        <p class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase mb-0.5">Email Address</p>
                                        <p id="profile-email" class="text-[11px] font-semibold text-slate-900 dark:text-slate-200 truncate">user@example.com</p>
                                    </div>
                                    <div class="p-2.5 bg-slate-50 dark:bg-[#111a22] rounded-xl border border-slate-100 dark:border-[#324d67]">
                                        <p class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase mb-0.5">Phone Number</p>
                                        <p id="profile-phone" class="text-[11px] font-semibold text-slate-900 dark:text-slate-200">N/A</p>
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-3">
                                    <div class="p-2.5 bg-slate-50 dark:bg-[#111a22] rounded-xl border border-slate-100 dark:border-[#324d67]">
                                        <p class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase mb-0.5">Unique ID</p>
                                        <p id="profile-unique-id" class="text-[11px] font-mono font-bold text-slate-900 dark:text-slate-200 uppercase">#USER-000</p>
                                    </div>
                                    <div class="p-2.5 bg-slate-50 dark:bg-[#111a22] rounded-xl border border-slate-100 dark:border-[#324d67]">
                                        <p class="text-[10px] font-bold text-slate-400 dark:text-slate-500 uppercase mb-0.5">Gender</p>
                                        <p id="profile-gender" class="text-[11px] font-semibold text-slate-900 dark:text-slate-200">Not Specified</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Section: Role Specific Details -->
                            <div id="profile-professional-section" class="space-y-3">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-[10px] font-black text-purple-500 uppercase tracking-widest">02. Profile Details</span>
                                    <div class="h-px flex-1 bg-slate-100 dark:bg-slate-800"></div>
                                </div>

                                <!-- Expert Fields -->
                                <div id="profile-expert-details" class="grid grid-cols-1 gap-2.5 hidden">
                                    <div class="flex justify-between items-center p-2.5 bg-purple-500/5 rounded-xl border border-purple-500/10">
                                        <span class="text-[10px] font-bold text-purple-500 uppercase">Designation</span>
                                        <span id="profile-designation" class="text-xs font-bold dark:text-white">Senior Faculty</span>
                                    </div>
                                    <div class="flex justify-between items-center p-2.5 bg-purple-500/5 rounded-xl border border-purple-500/10">
                                        <span class="text-[10px] font-bold text-purple-500 uppercase">Department</span>
                                        <span id="profile-department" class="text-xs font-bold dark:text-white">Mathematics</span>
                                    </div>
                                    <div class="flex justify-between items-center p-2.5 bg-purple-500/5 rounded-xl border border-purple-500/10">
                                        <span class="text-[10px] font-bold text-purple-500 uppercase">Specialization</span>
                                        <span id="profile-specialization" class="text-xs font-bold dark:text-white">Calculus</span>
                                    </div>
                                </div>

                                <!-- Aspirant Fields -->
                                <div id="profile-aspirant-details" class="grid grid-cols-1 gap-2.5 hidden">
                                    <div class="flex justify-between items-center p-2.5 bg-purple-500/5 rounded-xl border border-purple-500/10">
                                        <span class="text-[10px] font-bold text-purple-500 uppercase">Category</span>
                                        <span id="profile-category" class="text-xs font-bold dark:text-white">JEE Main</span>
                                    </div>
                                    <div class="flex justify-between items-center p-2.5 bg-purple-500/5 rounded-xl border border-purple-500/10">
                                        <span class="text-[10px] font-bold text-purple-500 uppercase">Class / Grade</span>
                                        <span id="profile-class" class="text-xs font-bold dark:text-white">12th Standard</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="bg-slate-50 dark:bg-[#111a22] px-6 py-3 border-t border-slate-200 dark:border-[#324d67] flex justify-between items-center">
                        <div class="flex flex-col">
                            <span class="text-[9px] text-slate-400 dark:text-slate-500 font-bold uppercase tracking-tighter">Registration Date</span>
                            <span id="profile-joined-date" class="text-[11px] font-bold text-slate-600 dark:text-slate-400 italic">Feb 2026</span>
                        </div>
                        <div class="flex items-center gap-2">
                             <button id="profile-edit-btn" class="flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-[#1a252f] text-slate-700 dark:text-slate-200 rounded-lg border border-slate-200 dark:border-[#324d67] hover:bg-slate-50 dark:hover:bg-[#233648] transition-all text-xs font-bold shadow-sm">
                                <span class="material-symbols-outlined text-sm">edit</span>
                                Edit Profile
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Add New Question Modal -->
    <div id="modal-add-question" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <div class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity opacity-0 modal-backdrop"
            onclick="closeModal('modal-add-question')"></div>
        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div
                    class="relative transform overflow-hidden rounded-xl bg-white dark:bg-[#1a252f] text-left shadow-xl transition-all sm:my-8 w-[95%] sm:max-w-6xl min-h-[85vh] max-h-[92vh] opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95 modal-panel border border-slate-200 dark:border-[#324d67] flex flex-col">

                    <!-- Header -->
                    <div
                        class="bg-slate-50 dark:bg-[#111a22] px-6 py-4 border-b border-slate-200 dark:border-[#324d67] flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-bold text-slate-900 dark:text-white">Create New Question</h3>
                            <p class="text-xs text-slate-500 dark:text-[#92adc9]">Configure parameters for the question
                                bank.</p>
                        </div>
                        <button type="button"
                            class="text-slate-400 hover:text-slate-500 dark:hover:text-slate-300 transition-colors"
                            onclick="closeModal('modal-add-question')">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>

                    <!-- Body -->
                    <div class="px-6 py-6 pb-2 flex-1 overflow-y-auto">
                        <form id="form-add-question" class="space-y-6 h-full">
                            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 h-full">

                                <!-- LEFT COLUMN: Parameters (4 cols) -->
                                <div class="lg:col-span-4 border-r border-slate-100 dark:border-[#324d67] pr-2 lg:pr-6">
                                    
                                    <!-- Slide Toggle Button for Mobile -->
                                    <button type="button" onclick="toggleQuestionParams()"
                                        class="w-full flex lg:hidden items-center justify-between p-3.5 mb-2 rounded-xl bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] text-slate-700 dark:text-white transition-all active:scale-95 group shadow-sm">
                                        <div class="flex items-center gap-2.5">
                                            <div class="p-2 bg-primary/10 rounded-lg group-hover:bg-primary/20 transition-colors">
                                                <span class="material-symbols-outlined text-primary text-xl">settings_account_box</span>
                                            </div>
                                            <span class="text-xs font-black uppercase tracking-widest">Question Parameters</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <span class="text-[10px] font-bold text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity">Toggle View</span>
                                            <span id="param-toggle-icon" class="material-symbols-outlined transition-transform duration-500 text-slate-400">expand_less</span>
                                        </div>
                                    </button>

                                    <div id="question-param-section" class="question-param-container">
                                        <div class="question-param-inner space-y-5">
                                            <!-- Language Toggle -->
                                            <div class="space-y-2">
                                                <label
                                                    class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Language</label>
                                                <div
                                                    class="grid grid-cols-2 gap-2 bg-slate-100 dark:bg-[#111a22] p-1 rounded-lg border border-slate-200 dark:border-[#324d67]">
                                                    <label class="relative cursor-pointer text-center">
                                                        <input type="radio" name="question_lang" value="Bengali"
                                                            class="peer sr-only" checked>
                                                        <div
                                                            class="py-2 rounded-md text-xs font-bold transition-all peer-checked:bg-white dark:peer-checked:bg-primary peer-checked:text-primary dark:peer-checked:text-white text-slate-500 dark:text-[#92adc9] shadow-sm peer-checked:shadow">
                                                            Bengali</div>
                                                    </label>
                                                    <label class="relative cursor-pointer text-center">
                                                        <input type="radio" name="question_lang" value="English"
                                                            class="peer sr-only">
                                                        <div
                                                            class="py-2 rounded-md text-xs font-bold transition-all peer-checked:bg-white dark:peer-checked:bg-primary peer-checked:text-primary dark:peer-checked:text-white text-slate-500 dark:text-[#92adc9] shadow-sm peer-checked:shadow">
                                                            English</div>
                                                    </label>
                                                </div>
                                            </div>

                                            <!-- Role Selection -->
                                            <div class="space-y-2">
                                                <label
                                                    class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Target
                                                    Role</label>
                                                <div class="grid grid-cols-2 gap-2">
                                                    <label class="cursor-pointer">
                                                        <input type="radio" name="target_role" value="student"
                                                            class="peer sr-only" checked onchange="toggleQRole('student')">
                                                        <div
                                                            class="text-center p-2 rounded-lg border border-slate-200 dark:border-[#324d67] peer-checked:border-primary peer-checked:bg-primary/5 dark:peer-checked:bg-primary/10 transition-all">
                                                            <span
                                                                class="block text-xs font-bold text-slate-700 dark:text-white peer-checked:text-primary">Student</span>
                                                        </div>
                                                    </label>
                                                    <label class="cursor-pointer">
                                                        <input type="radio" name="target_role" value="aspirant"
                                                            class="peer sr-only" onchange="toggleQRole('aspirant')">
                                                        <div
                                                            class="text-center p-2 rounded-lg border border-slate-200 dark:border-[#324d67] peer-checked:border-primary peer-checked:bg-primary/5 dark:peer-checked:bg-primary/10 transition-all">
                                                            <span
                                                                class="block text-xs font-bold text-slate-700 dark:text-white peer-checked:text-primary">Aspirant</span>
                                                        </div>
                                                    </label>
                                                </div>
                                            </div>

                                            <!-- Student Specifics -->
                                            <div id="param-student" class="space-y-4 animate-fadeIn">
                                                <div class="space-y-2">
                                                    <label
                                                        class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Class
                                                        Level</label>
                                                    <select name="student_class" id="q-student-class"
                                                        class="w-full bg-slate-50 dark:bg-[#111a22] border-slate-200 dark:border-[#324d67] rounded-lg text-xs p-2.5 dark:text-white focus:ring-primary"
                                                        onchange="handleStudentClassChange(this.options[this.selectedIndex].getAttribute('data-id'))">
                                                        <option value="" selected disabled>Loading Classes...</option>
                                                    </select>
                                                </div>
                                                <div class="space-y-2">
                                                    <label
                                                        class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Subject</label>
                                                    <select name="student_subject" id="q-student-subject"
                                                        class="w-full bg-slate-50 dark:bg-[#111a22] border-slate-200 dark:border-[#324d67] rounded-lg text-xs p-2.5 dark:text-white focus:ring-primary">
                                                        <option value="" selected disabled>Select Class First</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <!-- Aspirant Specifics -->
                                            <div id="param-aspirant" class="hidden space-y-4 animate-fadeIn">
                                                <div class="space-y-2">
                                                    <label
                                                        class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Exam
                                                        Category</label>
                                                    <select name="aspirant_exam_category" id="q-aspirant-exam-category"
                                                        class="w-full bg-slate-50 dark:bg-[#111a22] border-slate-200 dark:border-[#324d67] rounded-lg text-xs p-2.5 dark:text-white focus:ring-primary"
                                                        onchange="handleAspirantCategoryChange(this.options[this.selectedIndex].getAttribute('data-id'))">
                                                        <option value="">Loading...</option>
                                                    </select>
                                                </div>
                                                <div class="space-y-2">
                                                    <label
                                                        class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Subject</label>
                                                    <select name="aspirant_subject" id="q-aspirant-subject"
                                                        class="w-full bg-slate-50 dark:bg-[#111a22] border-slate-200 dark:border-[#324d67] rounded-lg text-xs p-2.5 dark:text-white focus:ring-primary">
                                                        <option value="">Loading...</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <!-- Difficulty -->
                                            <div class="space-y-2">
                                                <label
                                                    class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Difficulty</label>
                                                <div class="flex gap-2">
                                                    <label class="cursor-pointer flex-1">
                                                        <input type="radio" name="difficulty" value="Easy" class="peer sr-only">
                                                        <span
                                                            class="block text-center text-[10px] font-bold py-1.5 rounded bg-slate-100 dark:bg-[#1a252f] text-slate-500 peer-checked:bg-green-100 peer-checked:text-green-600 dark:peer-checked:bg-green-900/30 dark:peer-checked:text-green-400">Easy</span>
                                                    </label>
                                                    <label class="cursor-pointer flex-1">
                                                        <input type="radio" name="difficulty" value="Medium"
                                                            class="peer sr-only" checked>
                                                        <span
                                                            class="block text-center text-[10px] font-bold py-1.5 rounded bg-slate-100 dark:bg-[#1a252f] text-slate-500 peer-checked:bg-yellow-100 peer-checked:text-yellow-600 dark:peer-checked:bg-yellow-900/30 dark:peer-checked:text-yellow-400">Medium</span>
                                                    </label>
                                                    <label class="cursor-pointer flex-1">
                                                        <input type="radio" name="difficulty" value="Hard" class="peer sr-only">
                                                        <span
                                                            class="block text-center text-[10px] font-bold py-1.5 rounded bg-slate-100 dark:bg-[#1a252f] text-slate-500 peer-checked:bg-red-100 peer-checked:text-red-600 dark:peer-checked:bg-red-900/30 dark:peer-checked:text-red-400">Hard</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- RIGHT COLUMN: Content (8 cols) -->
                                <div class="lg:col-span-8 space-y-5 h-full flex flex-col">

                                    <div class="space-y-2">
                                        <label
                                            class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Question
                                            Content</label>
                                        <textarea name="question_text" rows="3"
                                            class="w-full bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] rounded-xl text-sm p-4 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-primary/50 outline-none resize-none"
                                            placeholder="Type your question here..."></textarea>
                                    </div>

                                    <div class="space-y-3 flex-1">
                                        <label
                                            class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500 flex justify-between">
                                            <span>Options</span>
                                            <span class="text-[10px] normal-case font-normal text-slate-400">Check the
                                                correct answer</span>
                                        </label>

                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                            <!-- Option A -->
                                            <div class="relative group">
                                                <div
                                                    class="absolute left-3 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-400 group-focus-within:text-primary">
                                                    A</div>
                                                <input type="text" name="option_a"
                                                    class="block w-full rounded-lg border border-slate-200 dark:border-[#324d67] bg-white dark:bg-[#16202a] py-2.5 pl-8 pr-10 text-sm text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary"
                                                    placeholder="Option A">
                                                <div class="absolute right-3 top-1/2 -translate-y-1/2">
                                                    <input type="radio" name="correct_answer" value="a"
                                                        class="h-4 w-4 border-slate-300 text-primary focus:ring-primary cursor-pointer">
                                                </div>
                                            </div>
                                            <!-- Option B -->
                                            <div class="relative group">
                                                <div
                                                    class="absolute left-3 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-400 group-focus-within:text-primary">
                                                    B</div>
                                                <input type="text" name="option_b"
                                                    class="block w-full rounded-lg border border-slate-200 dark:border-[#324d67] bg-white dark:bg-[#16202a] py-2.5 pl-8 pr-10 text-sm text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary"
                                                    placeholder="Option B">
                                                <div class="absolute right-3 top-1/2 -translate-y-1/2">
                                                    <input type="radio" name="correct_answer" value="b"
                                                        class="h-4 w-4 border-slate-300 text-primary focus:ring-primary cursor-pointer">
                                                </div>
                                            </div>
                                            <!-- Option C -->
                                            <div class="relative group">
                                                <div
                                                    class="absolute left-3 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-400 group-focus-within:text-primary">
                                                    C</div>
                                                <input type="text" name="option_c"
                                                    class="block w-full rounded-lg border border-slate-200 dark:border-[#324d67] bg-white dark:bg-[#16202a] py-2.5 pl-8 pr-10 text-sm text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary"
                                                    placeholder="Option C">
                                                <div class="absolute right-3 top-1/2 -translate-y-1/2">
                                                    <input type="radio" name="correct_answer" value="c"
                                                        class="h-4 w-4 border-slate-300 text-primary focus:ring-primary cursor-pointer">
                                                </div>
                                            </div>
                                            <!-- Option D -->
                                            <div class="relative group">
                                                <div
                                                    class="absolute left-3 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-400 group-focus-within:text-primary">
                                                    D</div>
                                                <input type="text" name="option_d"
                                                    class="block w-full rounded-lg border border-slate-200 dark:border-[#324d67] bg-white dark:bg-[#16202a] py-2.5 pl-8 pr-10 text-sm text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary"
                                                    placeholder="Option D">
                                                <div class="absolute right-3 top-1/2 -translate-y-1/2">
                                                    <input type="radio" name="correct_answer" value="d"
                                                        class="h-4 w-4 border-slate-300 text-primary focus:ring-primary cursor-pointer">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="space-y-2">
                                        <label
                                            class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Explanation
                                            (Optional)</label>
                                        <textarea name="explanation" rows="2"
                                            class="w-full bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] rounded-xl text-xs p-3 dark:text-white placeholder:text-slate-400 focus:ring-primary outline-none"
                                            placeholder="Reasoning for the correct answer..."></textarea>
                                    </div>

                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Footer -->
                    <div
                        class="bg-slate-50 dark:bg-[#111a22] px-6 py-4 sm:flex items-center justify-between border-t border-slate-200 dark:border-[#324d67] mt-auto">
                        <div class="flex gap-2">
                            <a href="../bulk-entry.html" target="_blank"
                                class="hidden sm:flex items-center gap-2 text-[10px] font-black uppercase text-slate-500 hover:text-primary transition-colors">
                                <span class="material-symbols-outlined text-sm">construction</span>
                                Builder Tool
                            </a>
                            <input type="file" id="bulk-upload-modal-input" class="hidden" accept=".json"
                                onchange="handleBulkUploadContextual(this)">
                            <button type="button"
                                class="text-xs font-bold text-slate-600 dark:text-[#92adc9] hover:text-primary dark:hover:text-white flex items-center gap-1.5 transition-all"
                                onclick="document.getElementById('bulk-upload-modal-input').click()">
                                <span class="material-symbols-outlined text-lg">upload_file</span>
                                Bulk Upload
                            </button>
                        </div>
                        <div class="flex gap-2 mt-4 sm:mt-0 w-full sm:w-auto">
                            <button type="button" onclick="handleAddQuestion()"
                                class="flex-1 inline-flex justify-center items-center rounded-lg bg-primary px-4 h-10 md:h-12 text-xs md:text-sm font-bold text-white shadow-lg shadow-primary/20 hover:bg-primary/90 sm:w-auto transition-all">Create</button>
                            <button type="button"
                                class="flex-1 inline-flex justify-center items-center rounded-lg bg-white dark:bg-[#1a252f] px-4 h-10 md:h-12 text-xs md:text-sm font-bold text-slate-700 dark:text-[#92adc9] shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] hover:bg-slate-50 dark:hover:bg-[#233648] sm:w-auto transition-all"
                                onclick="closeModal('modal-add-question')">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Add Subject or Category -->
    <!-- Modal: Add Subject or Category -->
    <div id="modal-add-sub-cat" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <div class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity opacity-0 modal-backdrop"
            onclick="closeModal('modal-add-sub-cat')"></div>

        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div
                    class="modal-panel relative transform overflow-hidden rounded-2xl bg-white dark:bg-[#111a22] text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-4xl opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95 border border-slate-200 dark:border-[#324d67]">

                    <!-- Animated Close Button (Mobile Only) -->
                    <button type="button" onclick="closeModal('modal-add-sub-cat')"
                        class="absolute top-4 right-4 z-[70] md:hidden flex items-center justify-center w-10 h-10 rounded-full bg-white/90 dark:bg-[#1a252f]/90 backdrop-blur-sm border border-slate-200 dark:border-[#324d67] text-slate-500 hover:text-red-500 hover:rotate-90 hover:scale-110 active:scale-95 transition-all duration-300 shadow-xl group"
                        aria-label="Close Modal">
                        <span class="material-symbols-outlined transition-transform duration-300 group-hover:scale-125">close</span>
                    </button>

                    <!-- Split Layout -->
                    <div class="grid grid-cols-1 md:grid-cols-2">

                        <!-- LEFT SECTION: FORM -->
                        <div class="p-4 md:p-8 border-r border-slate-100 dark:border-[#324d67]">
                            <div class="flex items-center gap-3 mb-3 md:mb-6">
                                <div class="p-2 bg-primary/10 rounded-xl md:p-2.5">
                                    <span class="material-symbols-outlined text-primary text-base md:text-xl">category</span>
                                </div>
                                <div>
                                    <h3 class="text-sm font-bold dark:text-white leading-tight md:text-lg">Add Taxonomy</h3>
                                    <p class="text-[9px] text-slate-500 dark:text-[#92adc9] md:text-xs">Create new subjects or
                                        categories.</p>
                                </div>
                            </div>

                            <div class="space-y-3 md:space-y-6">
                                <div class="space-y-1 md:space-y-2">
                                    <label
                                        class="block text-[10px] font-black dark:text-white uppercase tracking-wider text-slate-500 md:text-xs">Item
                                        Type</label>
                                    <div class="relative grid grid-cols-2 p-1 bg-slate-100 dark:bg-[#16202a] rounded-xl md:rounded-2xl z-0">
                                        <!-- Sliding Indicator -->
                                        <div id="taxo-type-indicator" 
                                            class="absolute top-1 left-1 bottom-1 w-[calc(50%-4px)] bg-white dark:bg-primary/20 rounded-lg md:rounded-xl shadow-sm transition-all duration-300 ease-[cubic-bezier(0.34,1.56,0.64,1)] z-0"></div>
                                        
                                        <label class="relative z-10 cursor-pointer group">
                                            <input type="radio" name="sub_cat_type" value="subject" checked
                                                onchange="switchTaxonomyType('subject')" class="peer sr-only">
                                            <div class="flex flex-col items-center justify-center h-10 rounded-lg transition-all md:h-14 md:p-3 md:rounded-xl">
                                                <span class="block text-[11px] font-black text-slate-400 peer-checked:text-primary transition-all duration-300 md:text-sm">Class</span>
                                                <span class="block text-[8px] text-slate-400 font-bold md:text-[10px]">For Students</span>
                                            </div>
                                        </label>
                                        <label class="relative z-10 cursor-pointer group">
                                            <input type="radio" name="sub_cat_type" value="category"
                                                onchange="switchTaxonomyType('category')" class="peer sr-only">
                                            <div class="flex flex-col items-center justify-center h-10 rounded-lg transition-all md:h-14 md:p-3 md:rounded-xl">
                                                <span class="block text-[11px] font-black text-slate-400 peer-checked:text-primary transition-all duration-300 md:text-sm">Category</span>
                                                <span class="block text-[8px] text-slate-400 font-bold md:text-[10px]">For Aspirants</span>
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <div class="space-y-1 md:space-y-2">
                                    <label
                                        class="block text-[10px] font-black dark:text-white uppercase tracking-wider text-slate-500 md:text-xs">Name</label>
                                    <input type="text" id="sub-cat-name" oninput="this.value = this.value.toUpperCase()"
                                        onkeydown="if(event.key === 'Enter') { handleAddSubCat(); document.getElementById('sub-cat-name').focus(); }"
                                        placeholder="Enter name (e.g. Physics, WBPSC)"
                                        class="w-full bg-slate-50 dark:bg-[#16202a] border border-slate-200 dark:border-[#324d67] rounded-xl text-xs p-2 dark:text-white focus:ring-2 focus:ring-primary/50 outline-none transition-all md:text-sm md:p-3.5">
                                </div>

                                <div class="pt-1 flex gap-2 md:pt-4 md:gap-3">
                                    <button type="button" onclick="handleAddSubCat()"
                                        class="flex-1 bg-primary text-white py-2 rounded-xl font-bold text-xs hover:bg-primary/90 transition-all shadow-lg shadow-primary/20 flex items-center justify-center gap-2 md:py-3 md:text-sm">
                                        <span class="material-symbols-outlined text-base md:text-lg">add_circle</span>
                                        Add Item
                                    </button>
                                    <button type="button"
                                        class="px-3 py-2 text-xs font-bold text-slate-600 dark:text-[#92adc9] bg-slate-100 dark:bg-[#16202a] hover:bg-slate-200 dark:hover:bg-[#233648] rounded-xl transition-all md:px-6 md:py-3 md:text-sm"
                                        onclick="closeModal('modal-add-sub-cat')">Cancel</button>
                                </div>
                            </div>
                        </div>

                        <!-- RIGHT SECTION: PREVIEW -->
                        <div class="bg-slate-50 dark:bg-[#16202a]/50 p-4 flex flex-col h-full overflow-hidden relative md:p-8">

                            <!-- Slider Panel for Adding Subjects (Scoped to this section) -->
                            <div id="slider-add-subject"
                                class="absolute inset-y-0 right-0 z-[60] w-full bg-white dark:bg-[#0f172a] shadow-xl transform translate-x-full transition-transform duration-300 ease-in-out border-l border-slate-200 dark:border-[#1e293b] flex flex-col">
                                <!-- Header -->
                                <div
                                    class="px-4 py-3 border-b border-slate-100 dark:border-[#1e293b] flex items-center justify-between bg-slate-50 dark:bg-[#1e293b]">
                                    <div class="flex items-center gap-2 overflow-hidden">
                                        <span class="material-symbols-outlined text-purple-600 text-lg">category</span>
                                        <div class="text-xs font-black dark:text-white truncate"
                                            id="slider-category-name">CAT CATEGORY</div>
                                    </div>
                                    <button onclick="closeSubjectSlider()"
                                        class="p-1 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors text-slate-400 hover:text-slate-600 dark:hover:text-white"
                                        title="Close">
                                        <span class="material-symbols-outlined text-lg">arrow_forward</span>
                                    </button>
                                </div>

                                <!-- Add Subject Input -->
                                <div class="p-3 border-b border-slate-100 dark:border-[#1e293b] space-y-2">
                                    <label
                                        class="block text-[10px] font-black dark:text-white uppercase tracking-wider text-slate-500">New
                                        Subject</label>
                                    <div class="flex gap-2">
                                        <input type="text" id="slider-new-subject-input"
                                            placeholder="Enter subject name..."
                                            class="flex-1 bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] rounded-lg px-3 py-1.5 text-xs dark:text-white focus:ring-1 focus:ring-purple-500 outline-none transition-all"
                                            onkeydown="if(event.key === 'Enter') addSubjectToSliderList()">
                                        <button onclick="addSubjectToSliderList()"
                                            class="px-3 py-1.5 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-lg hover:bg-purple-200 dark:hover:bg-purple-900/50 transition-colors">
                                            <span class="material-symbols-outlined text-base">add</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Added Subjects List -->
                                <div class="flex-1 overflow-y-auto p-3 custom-scrollbar">
                                    <label
                                        class="block text-[10px] font-black dark:text-white uppercase tracking-wider text-slate-500">Added
                                        Subjects</label>
                                    <div class="flex flex-wrap gap-2 content-start" id="slider-subject-list">
                                        <!-- Items injected by JS -->
                                        <div class="w-full text-center py-8 text-slate-400 text-xs italic"
                                            id="slider-empty-state">No subjects added yet.</div>
                                    </div>
                                </div>

                                <!-- Footer Actions -->
                                <div
                                    class="p-3 border-t border-slate-100 dark:border-[#1e293b] bg-slate-50 dark:bg-[#1e293b]">
                                    <button onclick="saveCategorySubjects()"
                                        class="w-full py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-bold text-xs shadow-md shadow-purple-500/20 transition-all flex items-center justify-center gap-1.5">
                                        <span class="material-symbols-outlined text-sm">save</span>
                                        Save Changes
                                    </button>
                                </div>
                            </div>

                            <!-- Recent Items -->
                            <div class="mb-3 flex-shrink-0 md:mb-6">
                                <div class="flex items-center justify-between mb-2 md:mb-3">
                                    <label
                                        class="block text-[10px] font-black dark:text-white uppercase tracking-wider text-slate-500 md:text-xs">
                                        <span
                                            class="material-symbols-outlined text-xs align-text-bottom mr-1 text-orange-500 md:text-sm">history</span>
                                        Recently Added
                                    </label>
                                </div>
                                <div id="preview-recent-list" class="flex flex-wrap gap-2 min-h-[48px] max-h-[100px] overflow-y-auto custom-scrollbar pr-1">
                                    <span class="text-[10px] text-slate-400 italic py-2 md:text-xs">No recent items added this
                                        session.</span>
                                </div>
                            </div>

                            <!-- Existing Items -->
                            <div class="flex-1 flex flex-col min-h-0">
                                <div class="flex items-center justify-between mb-3 flex-shrink-0">
                                    <label
                                        class="block text-[10px] font-black dark:text-white uppercase tracking-wider text-slate-500 md:text-xs">
                                        Existing Items
                                        <span
                                            class="ml-1 px-1.5 py-0.5 rounded-md bg-slate-200 dark:bg-[#233648] text-slate-600 dark:text-white text-[10px]"
                                            id="preview-count">0</span>
                                    </label>
                                    <div class="relative">
                                        <span
                                            class="material-symbols-outlined absolute left-2 top-1/2 -translate-y-1/2 text-slate-400 text-sm">search</span>
                                        <input type="text" id="preview-search" onkeyup="loadCustomItems()"
                                            placeholder="Search..."
                                            class="w-32 bg-white dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] rounded-lg pl-7 pr-2 py-1 text-xs dark:text-white focus:outline-none focus:border-primary">
                                    </div>
                                </div>

                                <div id="preview-existing-list"
                                    class="flex-1 overflow-y-auto custom-scrollbar pr-1.5 flex flex-wrap content-start gap-2 min-h-[160px] max-h-[220px] transition-all duration-300">
                                    <!-- Dynamic Items -->
                                    <div class="w-full h-full flex items-center justify-center text-slate-400 text-xs">
                                        <span class="material-symbols-outlined animate-spin mr-2">sync</span> Loading...
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-- Edit User Modal -->
    <div id="modal-edit-user" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <div class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity opacity-0 modal-backdrop"
            onclick="closeModal('modal-edit-user')"></div>
        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div
                    class="relative transform overflow-hidden rounded-xl bg-white dark:bg-[#1a252f] text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95 modal-panel border border-slate-200 dark:border-[#324d67]">
                    <div
                        class="bg-slate-50 dark:bg-[#111a22] px-4 py-3 sm:px-6 border-b border-slate-200 dark:border-[#324d67] flex justify-between items-center">
                        <h3 class="text-base font-semibold leading-6 text-slate-900 dark:text-white">Edit Profile</h3>
                        <button type="button" class="text-slate-400 hover:text-slate-500 transition-colors"
                            onclick="closeModal('modal-edit-user')">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>
                    <div class="px-4 py-6 sm:px-6">
                        <form id="form-edit-user" class="space-y-4">
                            <input type="hidden" name="user_id" id="edit-user-id">
                            <input type="hidden" name="role" id="edit-user-role">
                            <input type="hidden" name="degree" id="edit-user-degree">
                            <div>
                                <label class="block text-sm font-medium text-slate-900 dark:text-[#92adc9]">Full
                                    Name</label>
                                <input type="text" name="name" id="edit-user-name"
                                    class="mt-1 block w-full rounded-md border-0 py-2 dark:bg-[#233648] dark:text-white shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] focus:ring-2 focus:ring-primary sm:text-sm pl-3"
                                    required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-900 dark:text-[#92adc9]">Email
                                    Address</label>
                                <input type="email" name="email" id="edit-user-email"
                                    class="mt-1 block w-full rounded-md border-0 py-2 dark:bg-[#233648] dark:text-white shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] focus:ring-2 focus:ring-primary sm:text-sm pl-3"
                                    required>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-900 dark:text-[#92adc9]">Phone
                                        Number</label>
                                    <input type="text" name="phone" id="edit-user-phone"
                                        class="mt-1 block w-full rounded-md border-0 py-2 dark:bg-[#233648] dark:text-white shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] focus:ring-2 focus:ring-primary sm:text-sm pl-3">
                                </div>
                                <div>
                                    <label
                                        class="block text-sm font-medium text-slate-900 dark:text-[#92adc9]">Gender</label>
                                    <select name="gender" id="edit-user-gender"
                                        class="mt-1 block w-full rounded-md border-0 py-2 dark:bg-[#233648] dark:text-white shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] focus:ring-2 focus:ring-primary sm:text-sm pl-3">
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div id="edit-expert-fields" class="space-y-4 hidden">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label
                                            class="block text-sm font-medium text-slate-900 dark:text-[#92adc9]">Designation</label>
                                        <input type="text" name="profession" id="edit-user-profession"
                                            class="mt-1 block w-full rounded-md border-0 py-2 dark:bg-[#233648] dark:text-white shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] focus:ring-2 focus:ring-primary sm:text-sm pl-3">
                                    </div>
                                    <div>
                                        <label
                                            class="block text-sm font-medium text-slate-900 dark:text-[#92adc9]">Organization</label>
                                        <input type="text" name="department" id="edit-user-department"
                                            class="mt-1 block w-full rounded-md border-0 py-2 dark:bg-[#233648] dark:text-white shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] focus:ring-2 focus:ring-primary sm:text-sm pl-3">
                                    </div>
                                </div>
                                <div>
                                    <label
                                        class="block text-sm font-medium text-slate-900 dark:text-[#92adc9]">Specialization</label>
                                    <select name="specialization" id="edit-user-spec"
                                        class="mt-1 block w-full rounded-md border-0 py-2 dark:bg-[#233648] dark:text-white shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] focus:ring-2 focus:ring-primary sm:text-sm pl-3">
                                        <option value="Organic Chemistry">Organic Chemistry</option>
                                        <option value="Applied Physics">Applied Physics</option>
                                        <option value="Mathematics">Mathematics</option>
                                        <option value="Biology">Biology</option>
                                        <option value="Computer Science">Computer Science</option>
                                    </select>
                                </div>
                            </div>

                            <div id="edit-aspirant-fields" class="space-y-4 hidden">
                                <div>
                                    <label
                                        class="block text-sm font-medium text-slate-900 dark:text-[#92adc9]">Class</label>
                                    <select name="aspirant-class" id="edit-user-class"
                                        class="mt-1 block w-full rounded-md border-0 py-2 dark:bg-[#233648] dark:text-white shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] focus:ring-2 focus:ring-primary sm:text-sm pl-3">
                                        <option value="">Select Class</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-slate-900 dark:text-[#92adc9]">Account
                                    Status</label>
                                <select name="status" id="edit-user-status"
                                    class="mt-1 block w-full rounded-md border-0 py-2 dark:bg-[#233648] dark:text-white shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] focus:ring-2 focus:ring-primary sm:text-sm pl-3">
                                    <option value="active">Active</option>
                                    <option value="pending">Pending</option>
                                    <option value="suspended">Suspended</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    <div
                        class="bg-slate-50 dark:bg-[#111a22] px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 border-t border-slate-200 dark:border-[#324d67]">
                        <button type="button" onclick="handleEditUser()"
                            class="inline-flex w-full justify-center rounded-lg bg-primary px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-primary/90 sm:ml-3 sm:w-auto transition-colors">Save
                            Changes</button>
                        <button type="button"
                            class="mt-3 inline-flex w-full justify-center rounded-lg bg-white dark:bg-[#1a252f] px-3 py-2 text-sm font-semibold text-slate-900 dark:text-[#92adc9] shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] hover:bg-slate-50 transition-colors sm:mt-0 sm:w-auto"
                            onclick="closeModal('modal-edit-user')">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Activity Log Modal -->
    <div id="modal-activity-log" class="fixed inset-0 z-50 hidden items-center justify-center p-4 sm:p-6" role="dialog"
        aria-modal="true">
        <div class="modal-backdrop fixed inset-0 bg-slate-900/60 backdrop-blur-sm opacity-0 transition-opacity duration-300"
            onclick="closeModal('modal-activity-log')"></div>
        <div
            class="modal-panel relative w-full max-w-lg transform overflow-hidden rounded-2xl bg-white dark:bg-[#0f172a] shadow-2xl transition-all duration-300 opacity-0 translate-y-4 sm:scale-95 border border-slate-200 dark:border-[#1e293b]">
            <div
                class="bg-slate-50 dark:bg-[#1e293b]/50 px-6 py-4 border-b border-slate-100 dark:border-[#1e293b] flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="p-2 bg-blue-500/10 rounded-lg">
                        <span class="material-symbols-outlined text-blue-500">history</span>
                    </div>
                    <div>
                        <h3 class="text-sm font-bold text-slate-900 dark:text-white" id="activity-log-title">User
                            Activity Log</h3>
                        <p class="text-[10px] text-slate-500 dark:text-slate-400">Tracking user interactions and
                            security events</p>
                    </div>
                </div>
                <button onclick="closeModal('modal-activity-log')"
                    class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-800 text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>

            <!-- Quick Stats Bar -->
            <div
                class="grid grid-cols-3 gap-px bg-slate-200 dark:bg-[#1e293b] border-b border-slate-200 dark:border-[#1e293b]">
                <div class="bg-white dark:bg-[#0f172a] p-4 text-center">
                    <p class="text-[10px] uppercase tracking-wider font-bold text-slate-400 mb-1">Logins</p>
                    <p class="text-lg font-black text-slate-900 dark:text-white" id="log-stat-logins">--</p>
                </div>
                <div class="bg-white dark:bg-[#0f172a] p-4 text-center">
                    <p class="text-[10px] uppercase tracking-wider font-bold text-slate-400 mb-1">Devices</p>
                    <p class="text-lg font-black text-slate-900 dark:text-white" id="log-stat-devices">--</p>
                </div>
                <div class="bg-white dark:bg-[#0f172a] p-4 text-center">
                    <p class="text-[10px] uppercase tracking-wider font-bold text-slate-400 mb-1">Status</p>
                    <p class="text-lg font-black text-green-500" id="log-stat-status">Secure</p>
                </div>
            </div>

            <div class="p-6 max-h-[50vh] overflow-y-auto custom-scrollbar">
                <!-- Timeline Container -->
                <div class="relative pl-4 border-l-2 border-slate-100 dark:border-slate-800/50 space-y-8"
                    id="activity-log-timeline">
                    <!-- Items injected by JS -->
                </div>
            </div>

            <div
                class="bg-slate-50 dark:bg-[#1e293b]/50 px-6 py-4 border-t border-slate-100 dark:border-[#1e293b] flex items-center justify-between">
                <button class="text-xs font-bold text-blue-600 dark:text-blue-400 hover:underline">Download Report
                    (PDF)</button>
                <button onclick="closeModal('modal-activity-log')"
                    class="px-5 py-2 text-sm font-bold text-slate-600 dark:text-slate-300 bg-slate-200 dark:bg-slate-800 rounded-lg hover:text-slate-900 dark:hover:text-white transition-all">Done</button>
            </div>
        </div>
    </div>

    <!-- Slider Panel for Adding Subjects -->

    <div id="modal-reset-password" class="fixed inset-0 z-50 hidden items-center justify-center p-4 sm:p-6"
        role="dialog" aria-modal="true">
        <div class="modal-backdrop fixed inset-0 bg-slate-900/60 backdrop-blur-sm opacity-0 transition-opacity duration-300"
            onclick="closeModal('modal-reset-password')"></div>
        <div
            class="modal-panel relative w-full max-w-md transform overflow-hidden rounded-2xl bg-white dark:bg-[#0f172a] shadow-2xl transition-all duration-300 opacity-0 translate-y-4 sm:scale-95 border border-slate-200 dark:border-[#1e293b]">

            <!-- Step 1: Selection -->
            <div id="reset-password-step-1" class="block">
                <div class="p-6 text-center border-b border-slate-100 dark:border-[#1e293b]">
                    <div class="w-16 h-16 bg-blue-500/10 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="material-symbols-outlined text-3xl text-blue-500 animate-pulse">lock_reset</span>
                    </div>
                    <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-2">Security Override</h3>
                    <p class="text-sm text-slate-500 dark:text-slate-400">Initialize password recovery for <br><span
                            id="reset-user-email"
                            class="font-bold text-slate-700 dark:text-blue-400">user@example.com</span></p>
                </div>

                <div class="p-6 space-y-3">
                    <button onclick="triggerPasswordReset('email')"
                        class="w-full flex items-center gap-4 p-4 rounded-xl border-2 border-slate-100 dark:border-[#1e293b] hover:border-blue-500 hover:bg-blue-50/50 dark:hover:bg-blue-500/5 transition-all group group">
                        <span
                            class="material-symbols-outlined p-3 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-400 group-hover:bg-blue-100 dark:group-hover:bg-blue-500/20 group-hover:text-blue-600">mail</span>
                        <div class="text-left">
                            <p class="text-sm font-bold text-slate-700 dark:text-slate-200">Magic Link</p>
                            <p class="text-[10px] text-slate-400">Email a secure, one-time reset link</p>
                        </div>
                    </button>

                    <button onclick="showResetManualForm()"
                        class="w-full flex items-center gap-4 p-4 rounded-xl border-2 border-slate-100 dark:border-[#1e293b] hover:border-amber-500 hover:bg-amber-50/50 dark:hover:bg-amber-500/5 transition-all group">
                        <span
                            class="material-symbols-outlined p-3 rounded-lg bg-slate-100 dark:bg-slate-800 text-slate-400 group-hover:bg-amber-100 dark:group-hover:bg-amber-500/20 group-hover:text-amber-600">key</span>
                        <div class="text-left">
                            <p class="text-sm font-bold text-slate-700 dark:text-slate-200">Force Reset</p>
                            <p class="text-[10px] text-slate-400">Set a custom or temporary password now</p>
                        </div>
                    </button>
                </div>

                <div class="bg-slate-50 dark:bg-[#1e293b]/50 p-4 flex justify-center">
                    <button onclick="closeModal('modal-reset-password')"
                        class="text-xs font-bold text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors">EXIT
                        SECURE PROTOCOL</button>
                </div>
            </div>

            <!-- Step 2: Manual Form -->
            <div id="reset-password-step-2" class="hidden animate-fade-in">
                <div class="p-6 border-b border-slate-100 dark:border-[#1e293b]">
                    <button onclick="showResetSelection()"
                        class="mb-4 flex items-center gap-1 text-xs font-bold text-slate-400 hover:text-primary transition-colors">
                        <span class="material-symbols-outlined text-sm">arrow_back</span> Back to Selection
                    </button>
                    <h3 class="text-lg font-bold text-slate-900 dark:text-white">Manual Password Override</h3>
                    <p class="text-xs text-slate-500 italic">User will be prompted to change this on next login.</p>
                </div>
                <div class="p-6 space-y-4">
                    <div class="space-y-2">
                        <label class="text-[10px] font-black uppercase tracking-widest text-slate-400">New
                            Password</label>
                        <div class="relative group">
                            <input type="text" id="manual-new-password" placeholder=""
                                class="w-full bg-slate-50 dark:bg-[#1a252f] border-2 border-slate-100 dark:border-[#1e293b] rounded-xl px-4 py-3 text-sm font-mono dark:text-white focus:border-amber-500 ring-0 outline-none transition-all">
                            <button onclick="generateRandomPassword()"
                                class="absolute right-3 top-1/2 -translate-y-1/2 p-2 text-slate-400 hover:text-amber-500">
                                <span class="material-symbols-outlined text-lg">casino</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="p-6 bg-slate-50 dark:bg-[#1e293b]/50 flex gap-3">
                    <button onclick="closeModal('modal-reset-password')"
                        class="flex-1 py-3 text-sm font-bold text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-800 rounded-xl transition-all">Cancel</button>
                    <button onclick="submitManualResetStatus()"
                        class="flex-1 py-3 text-sm font-bold text-white bg-amber-500 hover:bg-amber-600 rounded-xl shadow-lg shadow-amber-500/20 transition-all">Apply
                        Override</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="modal-confirm-delete" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <div class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity opacity-0 modal-backdrop"
            onclick="closeModal('modal-confirm-delete')"></div>
        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div
                    class="relative transform overflow-hidden rounded-xl bg-white dark:bg-[#1a252f] text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-md opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95 modal-panel border border-slate-200 dark:border-[#324d67]">
                    <div class="p-6">
                        <div class="flex items-center gap-4 mb-4">
                            <div
                                class="flex-shrink-0 w-12 h-12 rounded-full bg-red-100 dark:bg-red-500/10 flex items-center justify-center">
                                <span class="material-symbols-outlined text-red-600">warning</span>
                            </div>
                            <div>
                                <h3 class="text-lg font-bold text-slate-900 dark:text-white">Delete User Profile?</h3>
                                <p class="text-sm text-slate-500">This action cannot be undone. All data will be lost.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div
                        class="bg-slate-50 dark:bg-[#111a22] px-6 py-4 flex gap-3 justify-end border-t border-slate-200 dark:border-[#324d67]">
                        <button type="button"
                            class="px-4 py-2 text-sm font-bold text-slate-600 dark:text-[#92adc9] hover:text-slate-900 transition-all"
                            onclick="closeModal('modal-confirm-delete')">Cancel</button>
                        <button type="button" id="confirm-delete-btn"
                            class="bg-red-500 text-white px-6 py-2 rounded-lg font-bold text-sm hover:bg-red-600 transition-all shadow-lg shadow-red-500/20">Delete
                            Account</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Taxonomy Confirmation Modal -->
    <div id="modal-confirm-delete-taxonomy" class="fixed inset-0 z-[60] hidden" aria-labelledby="modal-title"
        role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity opacity-0 modal-backdrop"
            onclick="closeModal('modal-confirm-delete-taxonomy')"></div>
        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center">
                <div
                    class="relative transform overflow-hidden rounded-xl bg-white dark:bg-[#1a252f] text-left shadow-xl transition-all sm:w-full sm:max-w-xs opacity-0 scale-95 modal-panel border border-slate-200 dark:border-[#324d67]">
                    <div class="p-6 text-center space-y-4">
                        <div
                            class="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-red-100 dark:bg-red-500/10">
                            <span class="material-symbols-outlined text-red-600">delete</span>
                        </div>
                        <div>
                            <h3 class="text-base font-bold text-slate-900 dark:text-white">Delete Item?</h3>
                            <p class="text-xs text-slate-500 mt-1">Are you sure you want to delete this? This action
                                cannot be undone.</p>
                        </div>
                    </div>
                    <div
                        class="bg-slate-50 dark:bg-[#111a22] px-6 py-3 flex gap-2 justify-center border-t border-slate-200 dark:border-[#324d67]">
                        <button type="button"
                            class="flex-1 py-2 text-xs font-bold text-slate-600 dark:text-[#92adc9] hover:bg-slate-200 dark:hover:bg-slate-800 rounded-lg transition-all"
                            onclick="closeModal('modal-confirm-delete-taxonomy')">Cancel</button>
                        <button type="button" id="confirm-delete-tax-btn"
                            class="flex-1 py-2 text-xs font-bold text-white bg-red-500 hover:bg-red-600 rounded-lg transition-all shadow-sm">Yes,
                            Sure</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container Moved to Top -->

    <script>
        // ===== MAIN APPLICATION LOGIC =====
        // Note: openModal and closeModal are defined in the first script tag above

        function toggleAspirantType(type) {
            const slider = document.getElementById('toggle-slider');
            const btnStudent = document.getElementById('btn-student');
            const btnAspirant = document.getElementById('btn-aspirant');
            const classDiv = document.querySelector('.student-only-fields');

            if (!slider || !btnStudent || !btnAspirant || !classDiv) return;

            if (type === 'student') {
                slider.style.transform = 'translateX(0%)';
                btnStudent.classList.add('text-emerald-600');
                btnStudent.classList.remove('text-slate-500', 'dark:text-slate-400');
                btnAspirant.classList.remove('text-emerald-600');
                btnAspirant.classList.add('text-slate-500', 'dark:text-slate-400');

                classDiv.classList.remove('grid-rows-[0fr]');
                classDiv.classList.add('grid-rows-[1fr]');
            } else {
                slider.style.transform = 'translateX(100%)';
                btnAspirant.classList.add('text-emerald-600');
                btnAspirant.classList.remove('text-slate-500', 'dark:text-slate-400');
                btnStudent.classList.remove('text-emerald-600');
                btnStudent.classList.add('text-slate-500', 'dark:text-slate-400');

                classDiv.classList.remove('grid-rows-[1fr]');
                classDiv.classList.add('grid-rows-[0fr]');
            }
        }


        function toggleQuestionParams() {
            const section = document.getElementById('question-param-section');
            const icon = document.getElementById('param-toggle-icon');
            if (!section || !icon) return;

            const isCollapsed = section.classList.toggle('collapsed');
            icon.style.transform = isCollapsed ? 'rotate(180deg)' : 'rotate(0deg)';
        }

        function toggleQuestionFilterDrawer() {
            const drawer = document.getElementById('question-filter-drawer');
            const overlay = document.getElementById('question-filter-drawer-overlay');
            if (!drawer || !overlay) return;

            const becomingActive = !drawer.classList.contains('active');
            if (becomingActive) {
                // Sync mobile values from desktop filters
                const filters = ['role', 'expert', 'status', 'diff', 'lang'];
                filters.forEach(f => {
                    const desktop = document.getElementById(`filter-${f}`);
                    const mobile = document.getElementById(`mobile-filter-${f}`);
                    if (desktop && mobile) mobile.value = desktop.value;
                });
            }

            drawer.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function syncFilter(desktopId, value) {
            const desktopSelect = document.getElementById(desktopId);
            if (desktopSelect) desktopSelect.value = value;
        }

        function resetFilters() {
            const filters = [
                { id: 'filter-role', mobileId: 'mobile-filter-role' },
                { id: 'filter-expert', mobileId: 'mobile-filter-expert' },
                { id: 'filter-status', mobileId: 'mobile-filter-status' },
                { id: 'filter-diff', mobileId: 'mobile-filter-diff' },
                { id: 'filter-lang', mobileId: 'mobile-filter-lang' }
            ];

            filters.forEach(f => {
                const desktop = document.getElementById(f.id);
                const mobile = document.getElementById(f.mobileId);
                if (desktop) desktop.value = 'all';
                if (mobile) mobile.value = 'all';
            });

            const searchInput = document.getElementById('filter-search');
            if (searchInput) searchInput.value = '';

            loadQuestions();
        }

        // === Question Modal Logic ===

        function toggleQRole(role) {
            const studentSection = document.getElementById('param-student');
            const aspirantSection = document.getElementById('param-aspirant');

            if (role === 'student') {
                studentSection.classList.remove('hidden');
                aspirantSection.classList.add('hidden');
            } else {
                studentSection.classList.add('hidden');
                aspirantSection.classList.remove('hidden');
            }
        }


        // === Question Loading Logic ===
        async function loadQuestions() {
            const tableBody = document.getElementById('questions-table-body');
            if (!tableBody) return;

            // Show loading state
            tableBody.innerHTML = `<tr><td colspan="7" class="text-center py-8 text-slate-500"><span class="material-symbols-outlined animate-spin align-middle mr-2">sync</span>Loading questions...</td></tr>`;

            // Get Filters
            const search = document.getElementById('filter-search')?.value || '';
            const role = document.getElementById('filter-role')?.value || 'all';
            const status = document.getElementById('filter-status')?.value || 'all';
            const diff = document.getElementById('filter-diff')?.value || 'all';
            const lang = document.getElementById('filter-lang')?.value || 'all';
            const expert = document.getElementById('filter-expert')?.value || 'all';

            const params = new URLSearchParams({
                search, role, status, difficulty: diff, language: lang, added_by: expert
            });

            try {
                const response = await fetch(`../api/admin/get_questions.php?${params.toString()}`);
                const result = await response.json();

                if (result.status === 'success') {
                    const questions = result.data;
                    const meta = result.meta;

                    // Update Stats
                    if (meta) {
                        const elTotal = document.getElementById('stat-total-questions');
                        if (elTotal) elTotal.innerText = meta.total || 0;

                        const elApp = document.getElementById('stat-approved');
                        if (elApp) elApp.innerText = meta.approved || 0;

                        const elPend = document.getElementById('stat-pending');
                        if (elPend) elPend.innerText = meta.pending || 0;

                        const elSusp = document.getElementById('stat-suspended');
                        if (elSusp) elSusp.innerText = meta.suspended || 0;
                    }

                    if (questions.length === 0) {
                        tableBody.innerHTML = `<tr><td colspan="6" class="text-center py-8 text-slate-500 italic">No questions found.</td></tr>`;
                        return;
                    }

                    tableBody.innerHTML = questions.map(q => {
                        // Truncate text
                        const shortText = q.question_text.length > 60 ? q.question_text.substring(0, 60) + '...' : q.question_text;
                        const meta = q.role === 'student'
                            ? `<span class="px-2 py-0.5 bg-blue-50 dark:bg-blue-900/40 text-blue-600 dark:text-blue-400 rounded text-[10px] font-bold uppercase mr-1">Student</span> ${q.academic_level || ''}  ${q.subject || ''}`
                            : `<span class="px-2 py-0.5 bg-purple-50 dark:bg-purple-900/40 text-purple-600 dark:text-purple-400 rounded text-[10px] font-bold uppercase mr-1">Aspirant</span> ${q.category || ''}  ${q.subject || ''}`;

                        const difficultyColor = q.difficulty === 'Easy' ? 'text-green-600 bg-green-50 dark:bg-green-900/40' :
                            (q.difficulty === 'Medium' ? 'text-yellow-600 bg-yellow-50 dark:bg-yellow-900/40' : 'text-red-600 bg-red-50 dark:bg-red-900/40');

                        // Status Badge
                        let statusBadge = '';
                        let statusClass = '';
                        let modButtons = '';
                        let actionButtons = '';

                        // Edit & Delete are standard across most states
                        const editAction = `
                        <button onclick="handleEditQuestion('${q.unique_id}')" class="w-full text-left text-primary hover:bg-primary/10 flex items-center gap-2" title="Edit">
                            <span class="material-symbols-outlined text-base">edit</span> Edit Question
                        </button>`;
                        const deleteAction = `
                         <button onclick="handleQuestionAction('${q.unique_id}', 'delete')" class="w-full text-left text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 flex items-center gap-2" title="Remove">
                            <span class="material-symbols-outlined text-base">delete</span> Delete Question
                        </button>`;

                        if (q.status === 'approved') {
                            statusBadge = 'Approved';
                            statusClass = 'bg-green-100 dark:bg-green-500/20 text-green-700 dark:text-green-400';
                            modButtons = `
                            <button onclick="handleQuestionAction('${q.unique_id}', 'suspended')" class="w-full text-left text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-500/10 flex items-center gap-2">
                                <span class="material-symbols-outlined text-base">pause</span> Suspend Now
                            </button>
                            <button onclick="handleQuestionAction('${q.unique_id}', 'rejected')" class="w-full text-left text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 flex items-center gap-2">
                                <span class="material-symbols-outlined text-base">close</span> Reject Now
                            </button>
                         `;
                            actionButtons = editAction + modButtons + `<div class="border-t border-slate-100 dark:border-[#324d67] my-1"></div>` + deleteAction;
                        } else if (q.status === 'suspended') {
                            statusBadge = 'Suspended';
                            statusClass = 'bg-red-100 dark:bg-red-500/20 text-red-700 dark:text-red-400';
                            modButtons = `
                            <button onclick="handleQuestionAction('${q.unique_id}', 'approved')" class="w-full text-left text-green-600 hover:bg-green-50 dark:hover:bg-green-500/10 flex items-center gap-2">
                                <span class="material-symbols-outlined text-base">play_arrow</span> Activate Now
                            </button>
                            <button onclick="handleQuestionAction('${q.unique_id}', 'rejected')" class="w-full text-left text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 flex items-center gap-2">
                                <span class="material-symbols-outlined text-base">close</span> Reject Now
                            </button>
                         `;
                            actionButtons = editAction + modButtons + `<div class="border-t border-slate-100 dark:border-[#324d67] my-1"></div>` + deleteAction;
                        } else if (q.status === 'rejected') {
                            statusBadge = 'Rejected';
                            statusClass = 'bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-400';
                            modButtons = `
                            <button onclick="handleQuestionAction('${q.unique_id}', 'approved')" class="w-full text-left text-green-600 hover:bg-green-50 dark:hover:bg-green-500/10 flex items-center gap-2">
                                <span class="material-symbols-outlined text-base">check</span> Re-Approve
                            </button>
                            <button onclick="handleQuestionAction('${q.unique_id}', 'suspended')" class="w-full text-left text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-500/10 flex items-center gap-2">
                                <span class="material-symbols-outlined text-base">pause</span> Suspend Now
                            </button>
                         `;
                            actionButtons = editAction + modButtons + `<div class="border-t border-slate-100 dark:border-[#324d67] my-1"></div>` + deleteAction;
                        } else {
                            statusBadge = 'Pending';
                            statusClass = 'bg-orange-100 dark:bg-orange-500/10 text-orange-600 dark:text-orange-400';
                            modButtons = `
                            <button onclick="handleQuestionAction('${q.unique_id}', 'approved')" class="w-full text-left text-green-600 hover:bg-green-50 dark:hover:bg-green-500/10 flex items-center gap-2">
                                <span class="material-symbols-outlined text-base">check</span> Approve Now
                            </button>
                            <button onclick="handleQuestionAction('${q.unique_id}', 'rejected')" class="w-full text-left text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 flex items-center gap-2">
                                <span class="material-symbols-outlined text-base">close</span> Reject Now
                            </button>
                            <button onclick="handleQuestionAction('${q.unique_id}', 'suspended')" class="w-full text-left text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-500/10 flex items-center gap-2">
                                <span class="material-symbols-outlined text-base">pause</span> Suspend Now
                            </button>
                         `;
                            actionButtons = editAction + modButtons;
                        }

                        return `
                        <tr class="hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors group">
                            <td class="px-6 py-4 font-mono text-xs text-slate-400" data-label="ID">${q.unique_id}</td>
                            <td class="px-6 py-4 max-w-md" data-label="Question Details">
                                <div class="flex flex-col gap-1">
                                    <p class="font-medium text-slate-800 dark:text-slate-200 line-clamp-2">${shortText}</p>
                                    <div class="flex gap-2">
                                        <span class="px-1.5 py-0.5 rounded text-[10px] font-bold ${difficultyColor.replace('text-', 'bg-').replace('600', '100').replace('50', '500/10')} text-${difficultyColor.split(' ')[0].split('-')[1]}-600 dark:text-${difficultyColor.split(' ')[0].split('-')[1]}-400 font-bold rounded uppercase">${q.type || 'MCQ'}</span>
                                        <span class="px-1.5 py-0.5 rounded text-[10px] font-bold uppercase ${difficultyColor}">${q.difficulty}</span>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4" data-label="Subject/Class">
                                <div class="flex flex-col">
                                    <span class="font-semibold text-xs">${q.subject || q.category || 'General'}</span>
                                    <span class="text-xs text-slate-500 dark:text-[#92adc9]">${meta.replace(/<[^>]*>/g, '').trim().split(' ').slice(1).join(' ')}</span>
                                </div>
                            </td>
                            <td class="px-6 py-4" data-label="Added By">
                                <div class="flex items-center gap-2">
                                    <div class="w-6 h-6 rounded-full bg-slate-200 overflow-hidden flex items-center justify-center text-[10px] font-bold text-slate-600">
                                        ${(q.added_by || 'Admin').substring(0, 2).toUpperCase()}
                                    </div>
                                    <span class="text-xs text-slate-600 dark:text-[#92adc9]">${q.added_by || 'Admin'}</span>
                                </div>
                            </td>
                            <td class="px-6 py-4" data-label="Status">
                                <span class="px-2 py-1 rounded-full text-[10px] font-bold uppercase ${statusClass}">
                                    ${statusBadge}
                                </span>
                            </td>
                            <td class="px-6 py-4 text-right relative" data-label="Actions">
                                <button onclick="toggleActionMenu(this)" class="action-btn-trigger p-2 rounded-lg hover:bg-slate-100 hover:text-slate-700 dark:text-slate-400 dark:hover:bg-[#324d67] dark:hover:text-white transition-colors">
                                    <span class="material-symbols-outlined">more_vert</span>
                                </button>
                                <div class="dropdown-menu hidden">
                                    <div class="py-1">
                                        ${actionButtons}
                                    </div>
                                </div>
                            </td>
                        </tr>
                    `;
                    }).join('');
                } else {
                    tableBody.innerHTML = `<tr><td colspan="6" class="text-center py-8 text-red-500">Failed to load: ${result.message}</td></tr>`;
                }
            } catch (error) {
                console.error(error);
                tableBody.innerHTML = `<tr><td colspan="6" class="text-center py-8 text-red-500">Connection error</td></tr>`;
            }
        }

        // Question Action Logic
        // Global click to close menus
        document.addEventListener('click', () => {
             const globalMenu = document.getElementById('global-action-menu');
             if (globalMenu && !globalMenu.classList.contains('hidden')) {
                 globalMenu.classList.add('hidden');
                 document.querySelectorAll('.action-btn-trigger').forEach(b => b.classList.remove('action-btn-trigger'));
             }
        });

        async function handleQuestionAction(id, action) {
            let actionText = action;
            let confirmText = action;
            let confirmColor = '#3b82f6'; // blue-500 default

            if (action === 'delete') {
                actionText = 'delete';
                confirmText = 'Delete';
                confirmColor = '#ef4444'; // red-500
            } else if (action === 'approved') {
                actionText = 'approve';
                confirmText = 'Approve';
                confirmColor = '#10b981'; // emerald-500
            } else if (action === 'rejected') {
                actionText = 'reject';
                confirmText = 'Reject';
                confirmColor = '#64748b'; // slate-500
            } else if (action === 'suspended') {
                actionText = 'suspend';
                confirmText = 'Suspend';
                confirmColor = '#f97316'; // orange-500
            }

            const swalResult = await Swal.fire({
                title: 'Are you sure?',
                text: `You are about to ${actionText} this question.`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: confirmColor,
                cancelButtonColor: '#94a3b8',
                confirmButtonText: `Yes, ${confirmText} it!`,
                background: document.documentElement.classList.contains('dark') ? '#1e293b' : '#fff',
                color: document.documentElement.classList.contains('dark') ? '#fff' : '#0f172a'
            });

            if (!swalResult.isConfirmed) return;

            const apiAction = action === 'delete' ? 'delete' : 'update_status';

            try {
                const formData = new FormData();
                formData.append('action', apiAction);
                formData.append('id', id);
                if (apiAction === 'update_status') formData.append('status', action);

                const response = await fetch('../api/admin/manage_questions.php', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.status === 'success') {
                    Swal.fire({
                        title: 'Success!',
                        text: result.message,
                        icon: 'success',
                        timer: 1500,
                        showConfirmButton: false,
                        background: document.documentElement.classList.contains('dark') ? '#1e293b' : '#fff',
                        color: document.documentElement.classList.contains('dark') ? '#fff' : '#0f172a'
                    });
                    loadQuestions(); // Reload list
                } else {
                    Swal.fire({
                        title: 'Error!',
                        text: result.message,
                        icon: 'error',
                        background: document.documentElement.classList.contains('dark') ? '#1e293b' : '#fff',
                        color: document.documentElement.classList.contains('dark') ? '#fff' : '#0f172a'
                    });
                }
            } catch (error) {
                console.error(error);
                showToast('Action failed: ' + error.message, 'error');
            }
        }

        async function handleEditQuestion(id) {
            showToast('Fetching question details...');
            try {
                const response = await fetch(`../api/admin/get_questions.php?id=${id}`);
                const result = await response.json();

                if (result.status === 'success') {
                    const q = result.data;
                    // Populate Add Question Form with data
                    // This is a simplified "Edit" - in real app we'd toggle modal state to "Edit Mode"

                    openModal('modal-add-question');
                    const form = document.getElementById('form-add-question');
                    if (!form) return;

                    // Basic fill
                    form.querySelector('[name="question_text"]').value = q.question_text || '';
                    form.querySelector('[name="option_a"]').value = q.option_a || '';
                    form.querySelector('[name="option_b"]').value = q.option_b || '';
                    form.querySelector('[name="option_c"]').value = q.option_c || '';
                    form.querySelector('[name="option_d"]').value = q.option_d || '';
                    form.querySelector('[name="explanation"]').value = q.explanation || '';

                    // Selects
                    // Radio/Select handling
                    if (q.language) {
                        const langRadio = form.querySelector(`input[name="question_lang"][value="${q.language}"]`);
                        if (langRadio) langRadio.checked = true;
                    }

                    // Difficulty
                    const diffSelect = form.querySelector('[name="difficulty"]');
                    if (diffSelect) diffSelect.value = q.difficulty;

                    if (q.correct_answer) {
                        const correctRadio = form.querySelector(`input[name="correct_answer"][value="${q.correct_answer.toLowerCase()}"]`);
                        if (correctRadio) correctRadio.checked = true;
                    }

                    // Role & Parameters
                    if (q.role) {
                        const roleRadio = form.querySelector(`input[name="target_role"][value="${q.role}"]`);
                        if (roleRadio) {
                            roleRadio.checked = true;
                            if (typeof toggleQRole === 'function') toggleQRole(q.role);
                        }

                        // Wait for toggle (it's sync via classList so safe)
                        if (q.role === 'student') {
                            // Class
                            const classSelect = form.querySelector('[name="student_class"]');
                            if (classSelect && q.academic_level) {
                                classSelect.value = q.academic_level;
                                // Trigger dynamic loading of subjects for this class
                                const selectedOption = classSelect.options[classSelect.selectedIndex];
                                const classId = selectedOption ? selectedOption.getAttribute('data-id') : null;
                                if (classId) {
                                    await handleStudentClassChange(classId);
                                    // Now set the subject value
                                    const stuSubSelect = form.querySelector('[name="student_subject"]');
                                    if (stuSubSelect && q.subject) stuSubSelect.value = q.subject;
                                }
                            }
                        } else if (q.role === 'aspirant') {
                            // Category
                            const catSelect = form.querySelector('[name="aspirant_exam_category"]');
                            if (catSelect && q.category) {
                                catSelect.value = q.category;
                                // Trigger dynamic loading of subjects for this category
                                const selectedOption = catSelect.options[catSelect.selectedIndex];
                                const catId = selectedOption ? selectedOption.getAttribute('data-id') : null;
                                if (catId) {
                                    await handleAspirantCategoryChange(catId);
                                    // Now set the subject value
                                    const aspSubSelect = form.querySelector('[name="aspirant_subject"]');
                                    if (aspSubSelect && q.subject) aspSubSelect.value = q.subject;
                                }
                            }
                        }
                    }

                    showToast('Loaded question data for editing.');

                    // Add ID to form for update (need to modify handleAddQuestion to support update)
                    // Temporarily adding a hidden input
                    let idInput = document.getElementById('edit-question-id');
                    if (!idInput) {
                        idInput = document.createElement('input');
                        idInput.type = 'hidden';
                        idInput.id = 'edit-question-id';
                        idInput.name = 'id'; // For PHP
                        form.appendChild(idInput);
                    }
                    idInput.value = id;

                    // Change button text
                    const footerParams = form.parentElement.parentElement.querySelector('.bg-slate-50.dark\\:bg-\\[\\#111a22\\]'); // locating footer container
                    // Actually safer to search document based on onclick
                    const btns = document.querySelectorAll('button[onclick="handleAddQuestion()"]');
                    btns.forEach(b => b.innerText = 'Update Question');

                } else {
                    showToast('Question data not found', 'error');
                }
            } catch (error) {
                console.error(error);
                showToast('Failed to load for edit', 'error');
            }
        }

        // Helper for selects
        function setSelectValue(select, value) {
            if (!select) return;
            for (let i = 0; i < select.options.length; i++) {
                if (select.options[i].value == value) {
                    select.selectedIndex = i;
                    break;
                }
            }
        }


        async function loadQuestionMetadata() {
            // Modal Dropdowns
            const studentClassSelect = document.getElementById('q-student-class');
            const studentSubSelect = document.getElementById('q-student-subject');
            const aspirantCatSelect = document.getElementById('q-aspirant-exam-category');
            const aspirantSubSelect = document.getElementById('q-aspirant-subject');

            // Filter Dropdowns
            const filterStuSub = document.getElementById('filter-stu-subject');
            const filterAspCat = document.getElementById('filter-exam-category');
            const filterAspSub = document.getElementById('filter-asp-subject');
            const filterClassSelect = document.getElementById('filter-class');

            // User Management Modals
            const aspirantClassSelect = document.getElementById('aspirant-class');
            const editUserClassSelect = document.getElementById('edit-user-class');

            if (studentClassSelect) studentClassSelect.innerHTML = '<option value="">Loading...</option>';
            if (aspirantCatSelect) aspirantCatSelect.innerHTML = '<option value="">Loading...</option>';

            try {
                const response = await fetch('../api/admin/manage_taxonomy.php');
                const result = await response.json();

                if (result.status === 'success') {
                    const subjects = result.data.subject || []; // These are effectively 'Classes' for Students
                    const categories = result.data.category || [];

                    // 1. Populate Student Classes (Modal)
                    const classOptionsHTML = subjects.map(s => `<option value="${s.name}" data-id="${s.id}">${s.name}</option>`).join('');
                    if (studentClassSelect) {
                        studentClassSelect.innerHTML = '<option value="" selected disabled>Select Class</option>' + classOptionsHTML;
                    }

                    // User Management Class Dropdowns
                    if (aspirantClassSelect) {
                        aspirantClassSelect.innerHTML = '<option value="" selected disabled>Choose Class</option>' + classOptionsHTML;
                    }
                    if (editUserClassSelect) {
                        editUserClassSelect.innerHTML = '<option value="">Select Class</option>' + classOptionsHTML;
                    }

                    // Populate Filters
                    if (filterClassSelect) {
                        filterClassSelect.innerHTML = '<option value="">All Classes</option>' + classOptionsHTML;
                    }

                    // 2. Populate Filters (Global Subject tracking)
                    // Note: filterStuSub and filterAspSub will still show all subjects for general filtering
                    // We'll calculate a unique set of subject names across all classes/categories if needed, 
                    // but for now, we'll fetch them from the taxonomies.
                    const allMappedSubjects = []; // To be implemented if global subject filtering is needed

                    if (filterStuSub) {
                        filterStuSub.innerHTML = '<option value="">All Subjects</option>'; // To be filled dynamically or from a global subject list
                    }

                    // 3. Populate Aspirant Categories (Modal & Filter)
                    const categoryOptionsHTML = categories.map(c => `<option value="${c.name}" data-id="${c.id}">${c.name}</option>`).join('');
                    if (aspirantCatSelect) {
                        aspirantCatSelect.innerHTML = '<option value="" selected disabled>Select Exam Category</option>' + categoryOptionsHTML;
                    }
                    if (filterAspCat) {
                        filterAspCat.innerHTML = '<option value="">All Categories</option>' + categoryOptionsHTML;
                    }

                    // 4. Reset Subjects to "Select First"
                    if (studentSubSelect) {
                        studentSubSelect.innerHTML = '<option value="" selected disabled>Select Class First</option>';
                    }
                    if (aspirantSubSelect) {
                        aspirantSubSelect.innerHTML = '<option value="" selected disabled>Select Category First</option>';
                    }

                } else {
                    showToast('Failed to load metadata: ' + result.message, 'error');
                }
            } catch (error) {
                console.error(error);
                showToast('Connection error while loading question metadata', 'error');
            }
        }

        async function handleStudentClassChange(classId) {
            const subSelect = document.getElementById('q-student-subject');
            if (!subSelect) return;

            if (!classId) {
                subSelect.innerHTML = '<option value="" selected disabled>Select Class First</option>';
                return;
            }

            try {
                subSelect.innerHTML = '<option value="">Loading...</option>';
                const response = await fetch(`../api/admin/manage_taxonomy.php?action=get_category_subjects&category_id=${classId}`);
                const result = await response.json();

                if (result.status === 'success') {
                    const subjects = result.data || [];
                    if (subjects.length === 0) {
                        subSelect.innerHTML = '<option value="" selected disabled>No subjects linked</option>';
                    } else {
                        subSelect.innerHTML = '<option value="" selected disabled>Select Subject</option>' +
                            subjects.map(s => `<option value="${s.name}">${s.name}</option>`).join('');
                    }
                } else {
                    showToast('Failed to load subjects: ' + result.message, 'error');
                    subSelect.innerHTML = '<option value="" selected disabled>Error loading</option>';
                }
            } catch (error) {
                console.error(error);
                showToast('Error loading subjects', 'error');
                subSelect.innerHTML = '<option value="" selected disabled>Error loading</option>';
            }
        }

        async function handleAspirantCategoryChange(categoryId) {
            const subSelect = document.getElementById('q-aspirant-subject');
            if (!subSelect) return;

            if (!categoryId) {
                subSelect.innerHTML = '<option value="" selected disabled>Select Category First</option>';
                return;
            }

            try {
                subSelect.innerHTML = '<option value="">Loading...</option>';
                const response = await fetch(`../api/admin/manage_taxonomy.php?action=get_category_subjects&category_id=${categoryId}`);
                const result = await response.json();

                if (result.status === 'success') {
                    const subjects = result.data || [];
                    if (subjects.length === 0) {
                        subSelect.innerHTML = '<option value="" selected disabled>No subjects linked</option>';
                    } else {
                        subSelect.innerHTML = '<option value="" selected disabled>Select Subject</option>' +
                            subjects.map(s => `<option value="${s.name}">${s.name}</option>`).join('');
                    }
                } else {
                    showToast('Failed to load subjects: ' + result.message, 'error');
                    subSelect.innerHTML = '<option value="" selected disabled>Error loading</option>';
                }
            } catch (error) {
                console.error(error);
                showToast('Error loading subjects', 'error');
                subSelect.innerHTML = '<option value="" selected disabled>Error loading</option>';
            }
        }

        async function handleAddQuestion() {
            const form = document.getElementById('form-add-question');
            const formData = new FormData(form);
            const btn = document.querySelector('button[onclick="handleAddQuestion()"]');

            // Check for Update Mode
            const editIdInput = document.getElementById('edit-question-id');
            const isEdit = editIdInput && editIdInput.value;
            if (isEdit) {
                formData.append('action', 'edit');
                formData.append('id', editIdInput.value);
            } else {
                formData.append('action', 'create');
            }

            // --- VALIDATION AND PREPARATION ---
            const role = formData.get('target_role');
            const text = formData.get('question_text').trim();
            const correct = formData.get('correct_answer');

            // 1. Common Validation
            if (!text || !correct) {
                showToast('Question text and correct answer selection are required.', 'error');
                return;
            }

            const optA = formData.get('option_a')?.trim();
            const optB = formData.get('option_b')?.trim();
            const optC = formData.get('option_c')?.trim();
            const optD = formData.get('option_d')?.trim();

            if (!optA || !optB || !optC || !optD) {
                showToast('All 4 options (A, B, C, D) are required.', 'error');
                return;
            }

            // 2. Role-Specific Validation
            // 2. Role-Specific Validation (Skip on Edit as role fields might not be re-populated/changed)
            if (!isEdit && role === 'student') {
                const level = formData.get('student_class');
                const subject = formData.get('student_subject');
                if (!level || !subject) {
                    showToast('For Student: Class Level and Subject are MANDATORY.', 'error');
                    return;
                }
            } else if (!isEdit && role === 'aspirant') {
                const category = formData.get('aspirant_exam_category');
                const subject = formData.get('aspirant_subject');
                if (!category || !subject) {
                    showToast('For Aspirant: Exam Category and Subject are MANDATORY.', 'error');
                    return;
                }
            }

            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<span class="material-symbols-outlined animate-spin text-lg">sync</span> Creating...`;

            try {
                const response = await fetch('../api/admin/manage_questions.php', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.status === 'success') {
                    if (isEdit) {
                        showToast(result.message);
                        closeModal('modal-add-question');
                        const editIdInput = document.getElementById('edit-question-id');
                        if (editIdInput) editIdInput.remove();
                        btn.innerHTML = 'Add Question';
                        form.reset(); // Full reset for edit case
                    } else {
                        showToast(`${result.message} (ID: ${result.id})`);

                        // --- RESET FORM BUT KEEP MODAL OPEN ---
                        form.querySelector('textarea[name="question_text"]').value = '';
                        form.querySelector('textarea[name="explanation"]').value = '';
                        form.querySelectorAll('input[name^="option_"]').forEach(i => i.value = '');
                        form.querySelectorAll('input[name="correct_answer"]').forEach(i => i.checked = false);
                    }

                    loadQuestions(); // Update list in background

                    // Optional: Scroll to top of content column or focus on question text?
                    form.querySelector('textarea[name="question_text"]').focus();

                } else {
                    showToast(result.message, 'error');
                }
            } catch (error) {
                console.error(error);
                showToast('Connection error', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        // Taxonomy State
        // Taxonomy State
        let taxonomyRecentItems = new Set(); // Stores IDs as strings/numbers based on API return 

         window.switchTaxonomyType = function(type) {
            const indicator = document.getElementById('taxo-type-indicator');
            const existingList = document.getElementById('preview-existing-list');
            
            if (indicator) {
                indicator.style.left = type === 'subject' ? '4px' : 'calc(50%)';
            }
            
            // Add fade-out effect to content
            if (existingList) {
                existingList.classList.add('opacity-0', 'translate-y-2');
                existingList.classList.remove('opacity-100', 'translate-y-0');
            }
            
            setTimeout(async () => {
                await loadCustomItems();
                if (existingList) {
                    existingList.classList.remove('opacity-0', 'translate-y-2');
                    existingList.classList.add('opacity-100', 'translate-y-0');
                }
            }, 200);
        };

        async function loadCustomItems() {
            // Determine selected type from Radio Buttons or fallback
            const typeInput = document.querySelector('input[name="sub_cat_type"]:checked');
            const type = typeInput ? typeInput.value : 'subject';

            const searchTerm = document.getElementById('preview-search')?.value.toLowerCase() || '';

            // UI Elements
            const existingList = document.getElementById('preview-existing-list');
            const recentList = document.getElementById('preview-recent-list');
            const countSpan = document.getElementById('preview-count');

            if (!existingList) return;

            try {
                // Show loading state
                // Show loading state with enough height to prevent collapse
                existingList.innerHTML = `<div class="w-full text-center py-6 md:py-12 text-slate-400 text-xs flex flex-col items-center justify-center gap-2">
                    <span class="material-symbols-outlined animate-spin text-lg md:text-xl">sync</span>
                    <span class="font-medium tracking-wide">Syncing Taxonomy...</span>
                </div>`;

                const response = await fetch('../api/admin/manage_taxonomy.php');
                const result = await response.json();

                if (result.status === 'success') {
                    const items = result.data[type] || [];

                    // Filter items
                    const filteredItems = items.filter(item => item.name.toLowerCase().includes(searchTerm));

                    // Render Existing Items
                    if (filteredItems.length === 0) {
                        existingList.innerHTML = `<div class="w-full text-center py-8 text-slate-400 text-xs italic">No items found.</div>`;
                    } else {
                        existingList.innerHTML = filteredItems.map(item => `
                        <div class="relative px-4 py-3 rounded-xl bg-white dark:bg-[#1a252f] border border-slate-200 dark:border-[#324d67] shadow-sm group hover:border-primary transition-all cursor-default overflow-hidden flex flex-col gap-2">
                            <!-- Header: Name & Indicator -->
                            <div class="flex items-center justify-between transition-opacity duration-200 group-hover:opacity-10">
                                <div class="flex items-center gap-2">
                                    <span class="text-xs font-black text-slate-700 dark:text-white truncate">${item.name}</span>
                                    ${taxonomyRecentItems.has(String(item.id)) || taxonomyRecentItems.has(Number(item.id)) ? '<span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>' : ''}
                                </div>
                                <span class="text-[10px] text-slate-400 font-bold">${item.subjects ? item.subjects.length : 0} Subjects</span>
                            </div>

                            <!-- Subjects list -->
                            <div class="flex flex-wrap gap-1 mt-1 transition-opacity duration-200 group-hover:opacity-5">
                                ${item.subjects && item.subjects.length > 0
                                ? item.subjects.map(s => `<span class="px-1.5 py-0.5 rounded bg-slate-100 dark:bg-white/5 border border-slate-200/50 dark:border-white/5 text-[9px] font-bold text-slate-500 dark:text-slate-400 capitalize">${s}</span>`).slice(0, 5).join('') + (item.subjects.length > 5 ? `<span class="text-[9px] text-slate-400 px-1 font-bold">+${item.subjects.length - 5} more</span>` : '')
                                : '<span class="text-[9px] text-slate-400 italic">No subjects linked</span>'
                            }
                            </div>
                            
                            <!-- Action Overlay -->
                            <div class="absolute inset-0 flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 bg-white/20 dark:bg-black/30 backdrop-blur-[2px]">
                                <button onclick="openAddSubjectToCategory(${item.id}, '${item.name.replace(/'/g, "\\'")}')" class="p-1 rounded bg-purple-50 text-purple-600 hover:bg-purple-100 dark:bg-purple-900/40 dark:text-purple-400 transition-colors shadow-sm" title="Add Subject">
                                    <span class="material-symbols-outlined text-[16px]">playlist_add</span>
                                </button>
                                <button onclick="handleEditTaxonomy(${item.id}, '${item.name.replace(/'/g, "\\'")}')" class="p-1 rounded bg-blue-50 text-blue-600 hover:bg-blue-100 dark:bg-blue-900/40 dark:text-blue-400 transition-colors shadow-sm" title="Edit">
                                    <span class="material-symbols-outlined text-[16px]">edit</span>
                                </button>
                                <button onclick="handleDeleteTaxonomy(${item.id})" class="p-1 rounded bg-red-50 text-red-600 hover:bg-red-100 dark:bg-red-900/40 dark:text-red-400 transition-colors shadow-sm" title="Delete">
                                    <span class="material-symbols-outlined text-[16px]">delete</span>
                                </button>
                            </div>
                        </div>
                    `).join('');
                    }

                    // Update Count
                    if (countSpan) countSpan.textContent = filteredItems.length;

                    // Render Recent Items (Client-side tracking for this session)
                    if (recentList) {
                        // Check loosely or convert both to string for robust comparison
                        const recentItemsData = items.filter(item =>
                            taxonomyRecentItems.has(String(item.id)) || taxonomyRecentItems.has(Number(item.id))
                        );

                        if (recentItemsData.length === 0) {
                            recentList.innerHTML = `<span class="text-xs text-slate-400 italic py-2 w-full text-center">No recent items added this session.</span>`;
                        } else {
                            recentList.innerHTML = recentItemsData.map(item => `
                            <span class="px-3 py-1.5 rounded-lg bg-green-50 dark:bg-green-500/10 border border-green-200 dark:border-green-500/30 text-xs font-bold text-green-700 dark:text-green-400 shadow-sm flex items-center gap-2 animate-in fade-in zoom-in duration-300">
                                ${item.name}
                                <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span>
                            </span>
                        `).join('');
                        }
                    }

                } else {
                    existingList.innerHTML = `<div class="text-red-500 text-xs text-center p-4">Error loading data</div>`;
                }
            } catch (error) {
                console.error(error);
                existingList.innerHTML = `<div class="text-red-500 text-xs text-center p-4">Connection error</div>`;
            }
        }


        // Reset form helper
        function resetTaxonomyForm() {
            const nameInput = document.getElementById('sub-cat-name');
            const btn = document.querySelector('button[onclick="handleAddSubCat()"]');

            if (nameInput) {
                nameInput.value = '';
                nameInput.removeAttribute('data-edit-id');
            }

            if (btn) {
                btn.innerHTML = `<span class="material-symbols-outlined text-lg">add_circle</span> Add Item`;
                btn.onclick = null; // Let the attribute handle it or re-assign if needed
            }

            const cancelEditBtn = document.getElementById('btn-cancel-edit-taxonomy');
            if (cancelEditBtn) cancelEditBtn.remove();
        }

        async function handleEditTaxonomy(id, name) {
            const nameInput = document.getElementById('sub-cat-name');
            const btn = document.querySelector('button[onclick="handleAddSubCat()"]');

            if (!nameInput || !btn) return;

            nameInput.value = name;
            nameInput.setAttribute('data-edit-id', id);
            nameInput.focus();

            btn.innerHTML = `<span class="material-symbols-outlined text-lg">save</span> Update`;

            // Add Cancel Button if not exists
            let cancelBtn = document.getElementById('btn-cancel-edit-taxonomy');
            if (!cancelBtn) {
                cancelBtn = document.createElement('button');
                cancelBtn.id = 'btn-cancel-edit-taxonomy';
                cancelBtn.type = 'button';
                cancelBtn.className = 'flex-1 py-3 px-4 bg-slate-100 dark:bg-[#1e293b] hover:bg-slate-200 dark:hover:bg-slate-800 text-slate-600 dark:text-[#92adc9] rounded-xl font-bold text-sm transition-all flex items-center justify-center gap-2';
                cancelBtn.innerHTML = 'Cancel Edit';
                cancelBtn.onclick = resetTaxonomyForm;
                
                // Insert after the Current "Update" button
                btn.parentNode.insertBefore(cancelBtn, btn.nextSibling);
            }
        }

        // --- SUBJECT SLIDER LOGIC ---
        let currentCategoryId = null;
        let addedSliderSubjects = [];

        async function openAddSubjectToCategory(id, name) {
            currentCategoryId = id;
            document.getElementById('slider-category-name').textContent = name;

            // Reset Input & List
            const input = document.getElementById('slider-new-subject-input');
            if (input) input.value = '';

            // Open Slider
            const slider = document.getElementById('slider-add-subject');
            slider.classList.remove('translate-x-full');

            // Fetch existing subjects from DB
            await fetchExistingSubjects(id);

            // Focus input
            setTimeout(() => input?.focus(), 300);
        }

        async function fetchExistingSubjects(catId) {
            const listContainer = document.getElementById('slider-subject-list');
            listContainer.innerHTML = `<div class="w-full text-center py-4 text-slate-400 text-xs"><span class="material-symbols-outlined animate-spin text-sm align-middle">sync</span> Loading...</div>`;

            try {
                const response = await fetch(`../api/admin/manage_taxonomy.php?action=get_category_subjects&category_id=${catId}`);
                const result = await response.json();

                if (result.status === 'success') {
                    addedSliderSubjects = (result.data || []).map(item => item.name);
                    renderSliderAddedSubjects();
                } else {
                    showToast(result.message, 'error');
                    addedSliderSubjects = [];
                    renderSliderAddedSubjects();
                }
            } catch (error) {
                console.error(error);
                showToast('Failed to load existing subjects', 'error');
                addedSliderSubjects = [];
                renderSliderAddedSubjects();
            }
        }

        function closeSubjectSlider() {
            const slider = document.getElementById('slider-add-subject');
            slider.classList.add('translate-x-full');
            currentCategoryId = null;
        }

        window.addSubjectToSliderList = function () {
            const input = document.getElementById('slider-new-subject-input');
            const subject = input.value.trim();

            if (!subject) return;

            // Check for duplicates
            if (addedSliderSubjects.some(s => s.toLowerCase() === subject.toLowerCase())) {
                showToast('Subject already added!', 'error');
                return;
            }

            addedSliderSubjects.push(subject);
            input.value = '';
            renderSliderAddedSubjects();
        };

        window.removeSliderSubject = function (index) {
            addedSliderSubjects.splice(index, 1);
            renderSliderAddedSubjects();
        };

        function renderSliderAddedSubjects() {
            const listContainer = document.getElementById('slider-subject-list');
            const emptyState = document.getElementById('slider-empty-state');

            if (addedSliderSubjects.length === 0) {
                listContainer.innerHTML = '';
                if (emptyState) listContainer.appendChild(emptyState);
                else listContainer.innerHTML = `<div class="text-center py-8 text-slate-400 text-xs italic" id="slider-empty-state">No subjects added yet.</div>`;
                return;
            }

            listContainer.innerHTML = addedSliderSubjects.map((subject, index) => `
            <div class="relative px-3 py-1.5 rounded-lg bg-white dark:bg-[#1a252f] border border-slate-200 dark:border-[#324d67] text-[11px] font-bold text-slate-600 dark:text-[#92adc9] shadow-sm group hover:border-red-400 transition-all cursor-default">
                <span class="truncate pr-4">${subject}</span>
                <button onclick="removeSliderSubject(${index})" class="absolute right-1 top-1/2 -translate-y-1/2 p-0.5 rounded text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-all opacity-0 group-hover:opacity-100">
                    <span class="material-symbols-outlined text-[14px]">close</span>
                </button>
            </div>
        `).join('');
        }

        window.saveCategorySubjects = async function () {
            if (!currentCategoryId) return;

            // We only allow saving if there are subjects added (preventing empty saves if not intended, 
            // but if user wants to clear all, they'd remove all then save)

            const btn = document.querySelector('#slider-add-subject button[onclick="saveCategorySubjects()"]');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<span class="material-symbols-outlined animate-spin text-sm">sync</span> Saving...`;

            try {
                const formData = new FormData();
                formData.append('action', 'add_category_subjects');
                formData.append('category_id', currentCategoryId);

                // Append subjects array
                addedSliderSubjects.forEach(subject => {
                    formData.append('subjects[]', subject);
                });

                const response = await fetch('../api/admin/manage_taxonomy.php', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.status === 'success') {
                    showToast(result.message);
                    loadCustomItems(); // Refresh the main list to show updated subjects
                    // Slider stays open until manually closed
                } else {
                    showToast(result.message, 'error');
                }
            } catch (e) {
                console.error(e);
                showToast('Failed to save subjects', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        };



        let taxItemToDelete = null;

        function handleDeleteTaxonomy(id) {
            taxItemToDelete = id;
            const btn = document.getElementById('confirm-delete-tax-btn');
            btn.onclick = performDeleteTaxonomy;
            openModal('modal-confirm-delete-taxonomy');
        }

        async function performDeleteTaxonomy() {
            if (!taxItemToDelete) return;

            const btn = document.getElementById('confirm-delete-tax-btn');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<span class="material-symbols-outlined animate-spin text-sm">sync</span>`;

            try {
                const formData = new FormData();
                formData.append('action', 'delete');
                formData.append('id', taxItemToDelete);

                const response = await fetch('../api/admin/manage_taxonomy.php', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.status === 'success') {
                    showToast(result.message);
                    loadCustomItems(); // Reload list
                    // Also remove from recent items if it was there
                    taxonomyRecentItems.delete(String(taxItemToDelete));
                    taxonomyRecentItems.delete(Number(taxItemToDelete));
                    closeModal('modal-confirm-delete-taxonomy');
                } else {
                    showToast(result.message, 'error');
                }
            } catch (error) {
                console.error(error);
                showToast('Connection error', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
                taxItemToDelete = null;
            }
        }

        async function handleAddSubCat() {
            const typeInput = document.querySelector('input[name="sub_cat_type"]:checked');
            const type = typeInput ? typeInput.value : 'subject';
            const nameInput = document.getElementById('sub-cat-name');
            const name = nameInput.value.trim();
            const btn = document.querySelector('button[onclick="handleAddSubCat()"]');

            // Check for Edit Mode
            const editId = nameInput.getAttribute('data-edit-id');
            const isEdit = !!editId;

            if (!name) {
                showToast('Please enter a name', 'error');
                return;
            }

            // Disable button loading state
            const originalBtnText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<span class="material-symbols-outlined animate-spin text-lg">sync</span> ${isEdit ? 'Updating...' : 'Adding...'}`;

            try {
                const formData = new FormData();
                formData.append('action', isEdit ? 'edit' : 'add');
                if (isEdit) formData.append('id', editId);

                formData.append('type', type);
                formData.append('name', name);

                const response = await fetch('../api/admin/manage_taxonomy.php', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.status === 'success') {
                    showToast(`${result.message}`);

                    if (isEdit) {
                        resetTaxonomyForm(); // Exit edit mode
                    } else {
                        nameInput.value = ''; // Clear input
                        nameInput.focus();    // Refocus for next entry
                        // Add to recent items tracking
                        taxonomyRecentItems.add(result.data.id);
                    }

                    loadCustomItems(); // Reload list
                } else {
                    showToast(result.message, 'error');
                }
            } catch (error) {
                console.error(error);
                showToast('Something went wrong', 'error');
            } finally {
                btn.disabled = false;
                // If we're still in "Updating/Adding" state (meaning error or no redirect), restore original text
                if (btn.innerHTML.includes('...') || btn.innerHTML.includes('sync')) {
                    btn.innerHTML = originalBtnText;
                }
            }
        }


        async function handleEditUser() {
            const id = document.getElementById('edit-user-id').value;
            const role = document.getElementById('edit-user-role').value;
            const btn = document.querySelector('button[onclick="handleEditUser()"]');

            // Basic fields
            const formData = new URLSearchParams();
            formData.append('action', 'update');
            formData.append('user_id', id);
            formData.append('role', role);
            formData.append('full_name', document.getElementById('edit-user-name').value);
            formData.append('email', document.getElementById('edit-user-email').value);
            formData.append('phone', document.getElementById('edit-user-phone').value);
            formData.append('gender', document.getElementById('edit-user-gender').value);
            formData.append('status', document.getElementById('edit-user-status').value);

            // Role specific fields
            if (role === 'expert') {
                formData.append('specialization', document.getElementById('edit-user-spec').value);
                formData.append('profession', document.getElementById('edit-user-profession').value);
                formData.append('department', document.getElementById('edit-user-department').value);
            } else if (role === 'aspirant') {
                formData.append('aspirant-class', document.getElementById('edit-user-class').value);
            }

            try {
                const originalText = btn.innerHTML;
                btn.disabled = true;
                btn.innerHTML = 'Saving...';

                const response = await fetch('../api/admin/manage_user.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: formData.toString()
                });

                const data = await response.json();

                if (data.status === 'success') {
                    closeModal('modal-edit-user');
                    showToast('User updated successfully');
                    // Refresh list if needed - navigateToUsers(role) would be ideal but might reset view
                    fetchUsers(role); // Added refresh
                } else {
                    showToast(data.message || 'Update failed', 'error');
                }
            } catch (error) {
                console.error(error);
                showToast('Connection error', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'Save Changes';
            }
        }



        function handleBulkUploadContextual(input) {
            if (!input.files || !input.files[0]) return;
            const file = input.files[0];
            showToast(`Bulk upload triggered for: ${file.name}`);
            // Placeholder for future implementation
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            if (!container) {
                console.error('[Toast] Container #toast-container not found in DOM!');
                return;
            }

            // Clear any existing toasts so they appear in the same place and don't stack
            container.innerHTML = '';

            const toast = document.createElement('div');
            const icon = type === 'success' ? 'check_circle' : 'error';
            const iconColor = type === 'success' ? 'text-[#0bda5b]' : 'text-red-500';
            const borderSide = type === 'success' ? 'border-l-4 border-l-[#0bda5b]' : 'border-l-4 border-l-red-500';

            // z-[99999] ensuring it's on top of EVERYTHING
            toast.className = `glass-toast ${borderSide} toast-shadow rounded-2xl p-4 flex items-center gap-4 min-w-[340px] max-w-md toast-animate-in pointer-events-auto relative z-[99999] mb-2`;

            toast.innerHTML = `
            <div class="flex-shrink-0 flex items-center justify-center w-12 h-12 rounded-full ${type === 'success' ? 'bg-[#0bda5b]/15' : 'bg-red-500/15'}">
                <span class="material-symbols-outlined ${iconColor} text-3xl">${icon}</span>
            </div>
            <div class="flex-1">
                <p class="text-sm font-black dark:text-white mb-0.5">${type.charAt(0).toUpperCase() + type.slice(1)}</p>
                <p class="text-[12px] font-semibold text-slate-500 dark:text-[#92adc9] leading-tight">${message}</p>
            </div>
            <button class="text-slate-400 hover:text-slate-600 dark:hover:text-white transition-colors p-2" onclick="const t = this.closest('.glass-toast'); t.classList.replace('toast-animate-in', 'toast-animate-out'); setTimeout(() => t.remove(), 400)">
                <span class="material-symbols-outlined text-xl">close</span>
            </button>
        `;

            container.appendChild(toast);

            // Auto-remove logic
            setTimeout(() => {
                if (toast && document.body.contains(toast)) {
                    toast.classList.replace('toast-animate-in', 'toast-animate-out');
                    setTimeout(() => toast.remove(), 400);
                }
            }, 5000);
        }


        let currentUserRole = 'expert';
        let currentFilterStatus = 'all';
        let currentPage = 1;
        let currentLimit = 5;
        let currentSearch = '';

        async function fetchUsers(role = currentUserRole, status = currentFilterStatus, page = currentPage, search = currentSearch, limit = currentLimit, silent = false) {
            currentUserRole = role;
            currentFilterStatus = status;
            currentPage = page;
            currentSearch = search;
            currentLimit = limit;

            const tableBody = role === 'expert' ?
                document.querySelector('#tab-content-experts tbody') :
                document.querySelector('#tab-content-aspirants tbody');

            if (!tableBody) return;

            if (!silent) {
                tableBody.innerHTML = `<tr><td colspan="5" class="px-6 py-10 text-center"><span class="material-symbols-outlined animate-spin align-middle mr-2">sync</span> Loading users...</td></tr>`;
            }

            try {
                const response = await fetch(`../api/admin/get_users.php?role=${role}&status=${status}&page=${page}&search=${encodeURIComponent(search)}&limit=${limit}`);
                const data = await response.json();

                if (data.status === 'success') {
                    const actualLimit = data.pagination.limit;
                    renderUserTable(tableBody, data.data, role, page, actualLimit);
                    renderPagination(role, data.pagination);

                    // Update Active Tab Count with filtered total
                    const activeTabBtn = document.getElementById(`tab-${role}s`);
                    if (activeTabBtn) {
                        const label = role.charAt(0).toUpperCase() + role.slice(1) + 's';
                        activeTabBtn.textContent = `${label} (${data.pagination.total.toLocaleString()})`;
                    }
                } else {
                    tableBody.innerHTML = `<tr><td colspan="5" class="px-6 py-10 text-center text-red-500">${data.message}</td></tr>`;
                }
            } catch (error) {
                console.error(' Error fetching users:', error);
                tableBody.innerHTML = `<tr><td colspan="5" class="px-6 py-10 text-center text-red-500">Failed to load data</td></tr>`;
            }
        }

        function renderUserTable(container, users, role, page = 1, limit = currentLimit) {
            // Bulk check states are handled by static HTML and updateBulkUI

            if (users.length === 0) {
                container.innerHTML = `<tr><td colspan="7" class="px-6 py-10 text-center text-slate-400">No users found matching your criteria.</td></tr>`;
                return;
            }

            const now = new Date();

            container.innerHTML = users.map((user, index) => {
                const date = new Date(user.created_at || user.joined_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                const serialNo = (page - 1) * limit + index + 1;

                // Validation & Status Logic...
                // New Badge
                const createdTime = new Date(user.created_at).getTime();
                const isNew = (now.getTime() - createdTime) < (24 * 60 * 60 * 1000);
                const newBadge = isNew ? `<span class="ml-2 inline-flex items-center text-[10px] font-black text-green-500 animate-pulse tracking-wide uppercase">New</span>` : '';

                // Verification
                let verificationBadge;
                if (user.verification_status === 'approved') {
                    verificationBadge = `<span class="inline-flex items-center gap-1 text-[10px] font-black text-green-500 uppercase tracking-tight"><span class="w-1.5 h-1.5 rounded-full bg-green-500"></span> Verified</span>`;
                } else {
                    verificationBadge = `<span class="inline-flex items-center gap-1 text-[10px] font-black text-slate-400 uppercase tracking-tight"><span class="w-1.5 h-1.5 rounded-full bg-slate-400"></span> Un-verified</span>`;
                }

                // Status Badge
                let statusBadge;
                if (user.status === 'suspended') {
                    statusBadge = `<span class="inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium bg-orange-50 text-orange-700 border border-orange-200 dark:bg-orange-500/10 dark:text-orange-400 dark:border-orange-500/20"><span class="w-1.5 h-1.5 rounded-full bg-orange-500 animate-pulse"></span> Suspended</span>`;
                } else if (user.status === 'rejected') {
                    statusBadge = `<span class="inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-50 text-red-700 border border-red-200 dark:bg-red-500/10 dark:text-red-400 dark:border-red-500/20"><span class="w-1.5 h-1.5 rounded-full bg-red-500"></span> Rejected</span>`;
                } else {
                    const isOnline = user.account_status === 'active';
                    statusBadge = isOnline
                        ? `<span class="inline-flex items-center gap-1.5 text-xs font-bold text-green-600 dark:text-green-400"><span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span></span> Active</span>`
                        : `<span class="inline-flex items-center gap-1.5 text-xs font-bold text-slate-500 dark:text-slate-500"><span class="h-2 w-2 rounded-full bg-slate-300 dark:bg-slate-600"></span> Inactive</span>`;
                }

                const avatar = user.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.full_name)}&background=random`;

                // Actions
                let actions = '';
                if (user.status === 'pending') {
                    actions = `
                    <button onclick="viewUserDetails(${user.id}, '${role}')" class="w-full text-left text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-[#233648] flex items-center gap-2"><span class="material-symbols-outlined text-base">visibility</span> View Profile</button>
                    <button onclick="updateUserStatus(${user.id}, 'active', '${role}')" class="w-full text-left text-green-600 hover:bg-green-50 dark:hover:bg-green-500/10 flex items-center gap-2"><span class="material-symbols-outlined text-base">check</span> Approve User</button>

                    <div class="border-t border-slate-100 dark:border-[#324d67] my-0.5"></div>
                    <button onclick="handleSendEmail(${user.id}, '${user.email}')" class="w-full text-left text-indigo-600 hover:bg-indigo-50 dark:hover:bg-indigo-500/10 flex items-center gap-2"><span class="material-symbols-outlined text-base">mail</span> Chat Now</button>
                `;
                } else if (user.status === 'active') {
                    actions = `
                    <button onclick="viewUserDetails(${user.id}, '${role}', event)" class="w-full text-left text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-[#233648] flex items-center gap-2"><span class="material-symbols-outlined text-base">visibility</span> View Profile</button>
                    <button onclick="openEditModal(${user.id}, '${role}')" class="w-full text-left text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-[#233648] flex items-center gap-2"><span class="material-symbols-outlined text-base">edit</span> Edit User</button>
                    <button onclick="updateUserStatus(${user.id}, 'suspended', '${role}')" class="w-full text-left text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-500/10 flex items-center gap-2"><span class="material-symbols-outlined text-base">pause</span> Suspend User</button>
                    <div class="border-t border-slate-100 dark:border-[#324d67] my-0.5"></div>
                    <button onclick="confirmDelete(${user.id}, '${role}', event)" class="w-full text-left text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 flex items-center gap-2"><span class="material-symbols-outlined text-base">delete</span> Delete User</button>
                `;
                } else if (user.status === 'suspended') {
                    actions = `
                    <button onclick="viewUserDetails(${user.id}, '${role}', event)" class="w-full text-left text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-[#233648] flex items-center gap-2"><span class="material-symbols-outlined text-base">visibility</span> View Profile</button>
                     <button onclick="updateUserStatus(${user.id}, 'active', '${role}', event)" class="w-full text-left text-green-600 hover:bg-green-50 dark:hover:bg-green-500/10 flex items-center gap-2"><span class="material-symbols-outlined text-base">play_arrow</span> Activate Now</button>
                     <div class="border-t border-slate-100 dark:border-[#324d67] my-0.5"></div>
                     <button onclick="confirmDelete(${user.id}, '${role}', event)" class="w-full text-left text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 flex items-center gap-2"><span class="material-symbols-outlined text-base">delete</span> Delete User</button>
                `;
                } else {
                    actions = `
                    <button onclick="viewUserDetails(${user.id}, '${role}', event)" class="w-full text-left text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-[#233648] flex items-center gap-2"><span class="material-symbols-outlined text-base">visibility</span> View Profile</button>
                    <button onclick="confirmDelete(${user.id}, '${role}', event)" class="w-full text-left text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 flex items-center gap-2"><span class="material-symbols-outlined text-base">delete</span> Delete User</button>
                `;
                }

                // Render

                const checkboxCell = `
                    <td class="px-6 py-4 w-10 bulk-check-column">
                        <input type="checkbox" class="user-checkbox rounded-lg border-slate-300 text-primary focus:ring-primary h-5 w-5 transition-all cursor-pointer" value="${user.id}" data-role="${role}" onchange="updateBulkUI()">
                    </td>`;

                if (role === 'expert') {
                    return `
                <tr class="hover:bg-slate-50 dark:hover:bg-[#233648] group transition-colors">
                    ${checkboxCell}
                    <td class="px-6 py-4 w-16 whitespace-nowrap text-slate-500 font-bold" data-label="S.No">${serialNo}</td>
                    <td class="px-6 py-4 whitespace-nowrap" data-label="Expert Profile">
                        <div class="flex items-center gap-3">
                            <div class="relative">
                                <img class="h-10 w-10 rounded-full object-cover bg-slate-100" src="${avatar}" alt="">
                            </div>
                            <div>
                                <div class="font-bold text-slate-900 dark:text-white flex items-center">
                                    ${user.full_name} ${newBadge}
                                </div>
                                <div class="text-xs text-slate-500 dark:text-[#92adc9]">${user.email}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap" data-label="Specialization">
                        <span class="text-slate-600 dark:text-slate-300 font-medium">${user.specialization || 'N/A'}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap" data-label="Joined Date">
                        <span class="text-slate-500 font-medium">${date}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap" data-label="Verification">
                        ${verificationBadge}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap" data-label="Status">
                        ${statusBadge}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right relative" data-label="Actions">
                        <button onclick="toggleActionMenu(this)" class="action-btn-trigger p-2 rounded-lg hover:bg-slate-100 hover:text-slate-700 dark:text-slate-400 dark:hover:bg-[#324d67] dark:hover:text-white transition-colors">
                            <span class="material-symbols-outlined">more_vert</span>
                        </button>
                        <div class="dropdown-menu hidden">
                            <div class="py-1">
                                ${actions}
                            </div>
                        </div>
                    </td>
                </tr>`;
                } else {
                    return `
                <tr class="hover:bg-slate-50 dark:hover:bg-[#233648] group transition-colors">
                    ${checkboxCell}
                    <td class="px-6 py-4 w-16 whitespace-nowrap text-slate-500 font-bold" data-label="S.No">${serialNo}</td>
                    <td class="px-6 py-4 whitespace-nowrap" data-label="Aspirant Name">
                        <div class="flex items-center gap-3">
                            <div class="relative">
                                <img class="h-10 w-10 rounded-full object-cover bg-slate-100" src="${avatar}" alt="">
                            </div>
                            <div>
                                <div class="font-bold text-slate-900 dark:text-white flex items-center">
                                    ${user.full_name} ${newBadge}
                                </div>
                                <div class="text-xs text-slate-500 dark:text-[#92adc9]">${user.email}</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap" data-label="Type">
                         <span class="px-2 py-1 bg-blue-50 dark:bg-blue-500/10 text-blue-600 dark:text-blue-400 rounded text-[0.625rem] font-bold capitalize">${user.category || 'aspirant'}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap" data-label="Avg Score">
                        <span class="text-green-500 font-bold">${user.average_score || '0'}%</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap" data-label="Verification">
                        ${verificationBadge}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap" data-label="Status">
                        ${statusBadge}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right relative" data-label="Actions">
                        <button onclick="toggleActionMenu(this)" class="action-btn-trigger p-2 rounded-lg hover:bg-slate-100 hover:text-slate-700 dark:text-slate-400 dark:hover:bg-[#324d67] dark:hover:text-white transition-colors">
                            <span class="material-symbols-outlined">more_vert</span>
                        </button>
                        <div class="dropdown-menu hidden">
                            <div class="py-1">
                                ${actions}
                            </div>
                        </div>
                    </td>
                </tr>`;
                }
            }).join('');
        }

        // --- Bulk Action Logic ---
        let selectedUserIds = new Set();

        function toggleSelectAll(role, checkbox) {
            const tableBody = checkbox.closest('table').querySelector('tbody');
            const checkboxes = tableBody.querySelectorAll('.user-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = checkbox.checked;
                handleSelection(cb);
            });
            updateBulkUI();
        }

        function updateBulkUI() {
            const checkboxes = document.querySelectorAll('.user-checkbox:checked');
            selectedUserIds.clear();
            checkboxes.forEach(cb => selectedUserIds.add(cb.value));

            let bulkBar = document.getElementById('bulk-action-bar');

            if (selectedUserIds.size > 0) {
                if (!bulkBar) {
                    bulkBar = document.createElement('div');
                    bulkBar.id = 'bulk-action-bar';
                    bulkBar.className = 'fixed bottom-6 left-1/2 -translate-x-1/2 bg-slate-900 text-white rounded-xl shadow-2xl py-3 px-6 flex items-center gap-6 z-[999] animate-slide-up';
                    bulkBar.innerHTML = `
                    <div class="flex items-center gap-2">
                        <span class="bg-white/20 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold" id="bulk-count">0</span>
                        <span class="text-sm font-semibold">Selected</span>
                    </div>
                    <div class="w-px h-6 bg-white/20"></div>
                    <div class="flex items-center gap-2">
                         <button onclick="handleBulkAction('approve')" class="p-2 hover:bg-white/20 rounded-lg transition-colors flex flex-col items-center gap-0.5 group" title="Approve">
                            <span class="material-symbols-outlined text-xl text-green-400 group-hover:scale-110 transition-transform">check_circle</span>
                            <span class="text-[10px] font-medium opacity-70">Approve</span>
                         </button>
                         <button onclick="handleBulkAction('suspend')" class="p-2 hover:bg-white/20 rounded-lg transition-colors flex flex-col items-center gap-0.5 group" title="Suspend">
                            <span class="material-symbols-outlined text-xl text-orange-400 group-hover:scale-110 transition-transform">block</span>
                            <span class="text-[10px] font-medium opacity-70">Suspend</span>
                         </button>
                         <button onclick="handleBulkAction('delete')" class="p-2 hover:bg-white/20 rounded-lg transition-colors flex flex-col items-center gap-0.5 group" title="Delete">
                            <span class="material-symbols-outlined text-xl text-red-400 group-hover:scale-110 transition-transform">delete</span>
                            <span class="text-[10px] font-medium opacity-70">Delete</span>
                         </button>
                    </div>
                `;
                    document.body.appendChild(bulkBar);
                }

                document.getElementById('bulk-count').textContent = selectedUserIds.size;
                bulkBar.classList.remove('hidden');
            } else {
                if (bulkBar) bulkBar.remove();
            }
        }

        function handleSelection(cb) {
            // Just logic storage if needed, but we recalculate on updateBulkUI
        }

        async function handleBulkAction(action) {
            if (selectedUserIds.size === 0) return;

            const actionLabels = {
                'approve': 'Approve',
                'suspend': 'Suspend',
                'delete': 'Delete'
            };

            const result = await Swal.fire({
                title: `Bulk ${actionLabels[action]}?`,
                text: `You are about to ${actionLabels[action].toLowerCase()} ${selectedUserIds.size} users.`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: action === 'delete' ? '#ef4444' : '#2b8cee',
                confirmButtonText: `Yes, ${actionLabels[action]} them!`,
                background: document.documentElement.classList.contains('dark') ? '#1a252f' : '#ffffff',
                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#0f172a'
            });

            if (result.isConfirmed) {
                try {
                    const formData = new URLSearchParams();
                    formData.append('action', 'bulk_action');
                    formData.append('user_ids', Array.from(selectedUserIds).join(','));
                    formData.append('status', action);

                    const response = await fetch('../api/admin/manage_user.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: formData.toString()
                    });

                    const data = await response.json();

                    if (data.status === 'success') {
                        showToast(data.message);

                        fetchUsers(currentUserRole); // Refresh
                        document.getElementById('bulk-action-bar')?.remove();
                        selectedUserIds.clear();
                    } else {
                        showToast(data.message, 'error');
                    }
                } catch (error) {
                    console.error(error);
                    showToast('Bulk action failed', 'error');
                }
            }
        }

        // Explicitly expose to window for dynamic HTML access
        window.toggleSelectAll = toggleSelectAll;
        window.updateBulkUI = updateBulkUI;
        window.handleBulkAction = handleBulkAction;


        // --- GLOBAL ACTION MENU PORTAL LOGIC ---
        // Create the global menu container once
        let globalMenu = document.getElementById('global-action-menu');
        if (!globalMenu) {
            globalMenu = document.createElement('div');
            globalMenu.id = 'global-action-menu';
            // Use the same dropdown-menu class for consistent styling
            globalMenu.className = 'hidden fixed z-[9999] dropdown-menu overflow-hidden';
            document.body.appendChild(globalMenu);
        }

        // Unified Click Handler for closing dropdowns
        document.addEventListener('click', (e) => {
            // Toggle Global Action Menu
            const globalMenu = document.getElementById('global-action-menu');
            if (globalMenu && !globalMenu.classList.contains('hidden')) {
                // Close if clicked OUTSIDE or if an ACTION BUTTON INSIDE is clicked
                if ((!e.target.closest('#global-action-menu') && !e.target.closest('.action-btn-trigger')) || e.target.closest('#global-action-menu button')) {
                    globalMenu.classList.add('hidden');
                    document.querySelectorAll('.action-btn-trigger').forEach(b => b.classList.remove('action-btn-trigger'));
                }
            }

            // Toggle Profile Dropdown
            const profileDropdown = document.getElementById('profile-dropdown');
            if (profileDropdown && !profileDropdown.classList.contains('hidden')) {
                if (!e.target.closest('#profile-dropdown') && !e.target.closest('[onclick="toggleProfileDropdown()"]')) {
                    profileDropdown.classList.add('hidden');
                }
            }
        });

        // Close on any scroll to prevent floating menu
        document.addEventListener('scroll', () => {
            const globalMenu = document.getElementById('global-action-menu');
            if (globalMenu && !globalMenu.classList.contains('hidden')) {
                globalMenu.classList.add('hidden');
                document.querySelectorAll('.action-btn-trigger').forEach(b => b.classList.remove('action-btn-trigger'));
            }
        }, true);

        window.toggleActionMenu = function (btn) {
            event.stopPropagation();
            const globalMenu = document.getElementById('global-action-menu');
            if (!globalMenu) return;

            const hiddenMenu = btn.nextElementSibling;
            if (!hiddenMenu) return;

            // If this button was already the trigger and menu is open, close it
            if (btn.classList.contains('action-btn-trigger') && !globalMenu.classList.contains('hidden')) {
                globalMenu.classList.add('hidden');
                btn.classList.remove('action-btn-trigger');
                return;
            }

            // Close any existing open instances
            document.querySelectorAll('.action-btn-trigger').forEach(b => b.classList.remove('action-btn-trigger'));

            // Mark this as active trigger
            btn.classList.add('action-btn-trigger');

            // Copy content
            globalMenu.innerHTML = hiddenMenu.innerHTML;

            // Show it first to get height for positioning
            globalMenu.classList.remove('hidden');

            // Position it
            const rect = btn.getBoundingClientRect();
            const menuWidth = 160; 
            globalMenu.style.width = menuWidth + 'px';

            let left = rect.right - menuWidth; 
            if (left < 10) left = 10; 

            let top = rect.bottom + 8;
            
            // Check overflow bottom
            if (top + globalMenu.offsetHeight > window.innerHeight) {
                top = rect.top - globalMenu.offsetHeight - 8;
            }

            globalMenu.style.left = left + 'px';
            globalMenu.style.top = top + 'px';
        }
        function renderPagination(role, meta) {
            const footerId = role === 'expert' ? 'expert-pagination-footer' : 'aspirant-pagination-footer';
            const footer = document.getElementById(footerId);

            if (!footer) return;

            const start = (meta.limit === -1) ? 1 : (meta.page - 1) * meta.limit + 1;
            const end = (meta.limit === -1) ? meta.total : Math.min(meta.page * meta.limit, meta.total);

            // Pagination Controls
            let controls = `
            <div class="flex items-center gap-1">
                <button onclick="fetchUsers('${role}', '${currentFilterStatus}', ${meta.page - 1})" ${meta.page === 1 ? 'disabled' : ''} class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 text-slate-500 hover:bg-white disabled:opacity-50">
                    <span class="material-symbols-outlined text-sm">chevron_left</span>
                </button>
                ${Array.from({ length: Math.min(5, meta.total_pages) }, (_, i) => {
                const p = i + 1;
                return `<button onclick="fetchUsers('${role}', '${currentFilterStatus}', ${p})" class="w-8 h-8 flex items-center justify-center rounded-lg ${p === meta.page ? 'bg-primary text-white font-bold' : 'border border-slate-200 text-slate-500'} text-xs">${p}</button>`;
            }).join('')}
                <button onclick="fetchUsers('${role}', '${currentFilterStatus}', ${meta.page + 1})" ${meta.page >= meta.total_pages ? 'disabled' : ''} class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 text-slate-500 hover:bg-white disabled:opacity-50">
                    <span class="material-symbols-outlined text-sm">chevron_right</span>
                </button>
            </div>
        `;

            footer.innerHTML = `
            <div class="flex items-center gap-4">
                <p class="text-sm text-slate-500">Showing <span class="font-bold text-slate-900 dark:text-white">${end > 0 ? start + '-' + end : 0}</span> of <span class="font-bold text-slate-900 dark:text-white">${meta.total}</span> ${role}s</p>
            </div>
            ${controls}
        `;
        }

        async function updateUserStatus(userId, status, role) {
            try {
                const formData = new URLSearchParams();
                formData.append('action', 'update_status');
                formData.append('user_id', userId);
                formData.append('status', status);
                formData.append('role', role);

                const response = await fetch('../api/admin/manage_user.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: formData.toString()
                });
                const data = await response.json();
                if (data.status === 'success') {
                    showToast(data.message);
                    fetchUsers(currentUserRole);
                    fetchStats();
                } else showToast(data.message, 'error');
            } catch (error) { showToast('Operation failed', 'error'); }
        }

        async function confirmDelete(userId, role) {
            const result = await Swal.fire({
                title: 'Delete User?',
                text: "You won't be able to revert this! The user and all associated data will be permanently deleted.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#64748b',
                confirmButtonText: 'Yes, delete it!',
                background: document.documentElement.classList.contains('dark') ? '#1a252f' : '#ffffff',
                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#0f172a'
            });

            if (result.isConfirmed) {
                try {
                    const formData = new URLSearchParams();
                    formData.append('action', 'delete');
                    formData.append('user_id', userId);
                    formData.append('role', role);

                    const response = await fetch('../api/admin/manage_user.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: formData.toString()
                    });
                    const data = await response.json();

                    if (data.status === 'success') {
                        Swal.fire(
                            'Deleted!',
                            data.message,
                            'success'
                        );
                        fetchUsers(currentUserRole);
                        fetchStats();
                        // Close Details Modal if open (in case view mode was active)
                        closeModal(`modal-add-${role}`);
                    } else {
                        Swal.fire(
                            'Error!',
                            data.message,
                            'error'
                        );
                    }
                } catch (error) {
                    console.error(' Delete error:', error);
                    Swal.fire(
                        'Error!',
                        'Something went wrong while deleting.',
                        'error'
                    );
                }
            }
        }

        async function viewUserDetails(userId, role) {
            try {
                const response = await fetch(`../api/admin/manage_user.php?action=get&user_id=${userId}&role=${role}`);
                const data = await response.json();

                if (data.status === 'success') {
                    const user = data.data;
                    const modal = document.getElementById('modal-view-profile');

                    // Populate Header
                    document.getElementById('profile-name').textContent = user.full_name || 'No Name';
                    document.getElementById('profile-email').textContent = user.email;
                    document.getElementById('profile-avatar').src = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.full_name)}&background=random&size=200`;

                    // Status Indicator
                    const statusColor = {
                        'active': 'bg-green-500',
                        'pending': 'bg-orange-500',
                        'suspended': 'bg-red-500',
                        'rejected': 'bg-slate-500'
                    }[user.status] || 'bg-slate-400';

                    const statusIndicator = document.getElementById('profile-status-indicator');
                    statusIndicator.className = `absolute -bottom-1 -right-1 w-6 h-6 rounded-full border-4 border-white dark:border-[#1a252f] ${statusColor} shadow-sm`;

                    // Status Text
                    const statusText = document.getElementById('profile-status-text');
                    if (statusText) statusText.textContent = ` ${user.status.toUpperCase()}`;
                    
                    // Joined Date
                    const joinedDateEl = document.getElementById('profile-joined-date');
                    if (joinedDateEl) joinedDateEl.textContent = user.created_at || 'Feb 2026';

                    // Role Badge - Using Specialization for Experts to be more specific
                    const roleBadge = document.getElementById('profile-role-badge');
                    if (roleBadge) {
                        if (role === 'expert') {
                            roleBadge.textContent = user.specialization || 'Expert Faculty';
                        } else {
                            roleBadge.textContent = user.category === 'student' ? 'Student' : 'Aspirant';
                        }
                    }


                    // Contact Info
                    document.getElementById('profile-phone').textContent = user.phone || 'N/A';
                    document.getElementById('profile-gender').textContent = user.gender || 'Not Specified';
                    document.getElementById('profile-unique-id').textContent = user.unique_id || 'N/A';

                    // Specific Details
                    const expertDetails = document.getElementById('profile-expert-details');
                    const aspirantDetails = document.getElementById('profile-aspirant-details');

                    if (role === 'expert') {
                        expertDetails.classList.remove('hidden');
                        aspirantDetails.classList.add('hidden');
                        document.getElementById('profile-designation').textContent = user.profession || 'N/A';
                        document.getElementById('profile-department').textContent = user.department || 'N/A';
                        document.getElementById('profile-specialization').textContent = user.specialization || 'N/A';
                    } else {
                        expertDetails.classList.add('hidden');
                        aspirantDetails.classList.remove('hidden');
                        document.getElementById('profile-category').textContent = user.category || 'Aspirant';
                        document.getElementById('profile-class').textContent = user.class || 'N/A';
                    }

                    // Setup Edit Button
                    const editBtn = document.getElementById('profile-edit-btn');
                    editBtn.onclick = () => {
                        closeModal('modal-view-profile');
                        setTimeout(() => openEditModal(userId, role), 300); // Small delay for transition
                    };

                    openModal('modal-view-profile');
                } else {
                    showToast(data.message, 'error');
                }
            } catch (error) {
                console.error(error);
                showToast('Failed to load profile', 'error');
            }
        }

        function openAddUserModal(role) {
            const modalId = `modal-add-${role}`;
            const formId = `form-add-${role}`;
            const form = document.getElementById(formId);

            // Reset Form & State
            form.reset();
            document.getElementById(`${role}-user-id`).value = '';
            document.getElementById(`${role}-action-type`).value = 'add';
 
            // Reset Toggle if Aspirant
            if (role === 'aspirant') {
                toggleAspirantType('student');
            }

            // Fix: Enable all inputs (in case View mode disabled them)
            const inputs = document.querySelectorAll(`#${formId} input, #${formId} select, #${formId} button`);
            inputs.forEach(el => el.disabled = false);

            // Fix: Show Submit button (in case View mode hid it)
            const btn = document.getElementById(`btn-submit-${role}`);
            btn.classList.remove('hidden');

            // Reset UI
            document.querySelector(`#${modalId} h3`).textContent = `Add New ${role.charAt(0).toUpperCase() + role.slice(1)}`;
            btn.innerHTML = `Add ${role.charAt(0).toUpperCase() + role.slice(1)}`;

            openModal(modalId);
        }

        async function openEditModal(userId, role) {
            try {
                const response = await fetch(`../api/admin/manage_user.php?action=get&user_id=${userId}&role=${role}`);
                const data = await response.json();

                if (data.status === 'success') {
                    const user = data.data;
                    const modalId = `modal-add-${role}`;
                    const formId = `form-add-${role}`;

                    // Set Hidden Values
                    document.getElementById(`${role}-user-id`).value = user.id;
                    document.getElementById(`${role}-action-type`).value = 'update';

                    // Populate Fields
                    document.getElementById(`${role}-name`).value = user.full_name;
                    document.getElementById(`${role}-email`).value = user.email;
                    document.getElementById(`${role}-phone`).value = user.phone || '';

                    // Handle Gender
                    if (user.gender) {
                        const genderInput = document.querySelector(`#${formId} input[name="gender"][value="${user.gender}"]`);
                        if (genderInput) genderInput.checked = true;
                    }



                    // Role Specific Fields
                    if (role === 'expert') {
                        if (user.profession) document.getElementById('expert-designation').value = user.profession;
                        if (user.department) document.getElementById('expert-department').value = user.department;
                        if (user.specialization) document.getElementById('expert-spec').value = user.specialization;
                    } else {
                        // Aspirant Logic
                        const category = user.category || 'aspirant';
                        toggleAspirantType(category); // Update UI slider
                        if (user.class) document.getElementById('aspirant-class').value = user.class;
                    }

                    // Update Modal UI for Edit
                    document.querySelector(`#${modalId} h3`).textContent = `Edit ${role.charAt(0).toUpperCase() + role.slice(1)}`;
                    const btn = document.getElementById(`btn-submit-${role}`);
                    btn.innerHTML = `Update ${role.charAt(0).toUpperCase() + role.slice(1)}`;

                    openModal(modalId);
                } else {
                    showToast(data.message, 'error');
                }
            } catch (error) {
                console.error(error);
                showToast('Failed to load user data', 'error');
            }
        }

        async function handleAddUser(formId, role) {
            const form = document.getElementById(formId);
            const btnId = role === 'expert' ? 'btn-submit-expert' : 'btn-submit-aspirant';
            const btn = document.getElementById(btnId);
            if (!btn) return;

            const actionType = document.getElementById(`${role}-action-type`).value;
            const isUpdate = actionType === 'update';

            // SweetAlert Confirmation for Update
            if (isUpdate) {
                const result = await Swal.fire({
                    title: 'Are you sure?',
                    text: "Do you want to update this user's details?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#2b8cee',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, update it!',
                    background: document.documentElement.classList.contains('dark') ? '#1a252f' : '#ffffff',
                    color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#0f172a'
                });

                if (!result.isConfirmed) return;
            }

            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = 'Processing...';

            const formData = new FormData(form);
            // Explicitly set action based on mode
            formData.append('action', actionType);

            // Handle Role/Category nuances
            if (role === 'aspirant') {
                const type = document.getElementById('toggle-slider').style.transform.includes('100%') ? 'aspirant' : 'student';
                // If updating, we might want to keep the role or update it. 
                // The form logic sets toggle slider matches UI.
                formData.append('role', type);
            } else {
                formData.append('role', 'expert');
            }

            try {
                const response = await fetch('../api/admin/manage_user.php', {
                    method: 'POST',
                    body: new URLSearchParams(formData)
                });
                const data = await response.json();

                if (data.status === 'success') {
                    closeModal(`modal-add-${role}`);

                    if (isUpdate) {
                        Swal.fire({
                            title: 'Updated!',
                            text: 'User details have been updated.',
                            icon: 'success',
                            background: document.documentElement.classList.contains('dark') ? '#1a252f' : '#ffffff',
                            color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#0f172a',
                            confirmButtonColor: '#2b8cee'
                        });
                    } else {
                        showToast(data.message);
                    }

                    form.reset();
                    fetchUsers(currentUserRole); // Refresh table
                    fetchStats();
                } else {
                    showToast(data.message, 'error');
                }
            } catch (error) {
                console.error(error);
                showToast('System error', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        let _lastPageId = 'dashboard';

        function switchPage(pageId, btn) {
            // Close mobile sidebar if active
            const aside = document.getElementById('main-sidebar');
            if (window.innerWidth <= 768 && aside && aside.classList.contains('mobile-active')) {
                toggleMobileSidebar();
            }

            // Track history for Discard/Back
            const currentPage = document.querySelector('.page-content.active');
            if (currentPage) {
                const currentId = currentPage.id.replace('page-', '');
                if (currentId !== pageId) {
                    _lastPageId = currentId;
                }
            }

            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
                page.classList.remove('active');
            });
            const targetPage = document.getElementById('page-' + pageId);
            if (targetPage) {
                targetPage.classList.remove('hidden');
                targetPage.classList.add('active');

                // Auto-refresh profile data when entering settings
                if (pageId === 'settings') {
                    loadAdminProfile();
                }
            }
            document.querySelectorAll('.nav-link').forEach(nav => {
                nav.classList.remove('active');
            });
            if (btn) btn.classList.add('active');
        }

        function handleDiscard() {
            const target = (_lastPageId && _lastPageId !== 'settings') ? _lastPageId : 'dashboard';
            const navBtn = document.getElementById('nav-' + target);
            switchPage(target, navBtn);
        }
        window.handleDiscard = handleDiscard;

        function navigateToUsers(tabId, filterType = 'all') {
            const navBtn = document.getElementById('nav-users');
            switchPage('users', navBtn);
            switchTab(tabId, filterType);
        }

        function switchTab(tabId, filter = 'all') {
            document.querySelectorAll('.tab-view').forEach(view => {
                view.classList.add('hidden');
                view.classList.remove('block');
            });
            document.getElementById('tab-content-' + tabId).classList.remove('hidden');
            document.getElementById('tab-content-' + tabId).classList.add('block');
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('tab-' + tabId).classList.add('active');
            document.getElementById('page-users').setAttribute('data-active-tab', tabId);

            // Update Filter Pills UI
            document.querySelectorAll('.filter-pill').forEach(pill => pill.classList.remove('active'));
            const activeFilterBtn = document.getElementById('filter-' + filter);
            if (activeFilterBtn) activeFilterBtn.classList.add('active');

            // Normalize role for API (API expects singular 'expert' or 'aspirant')
            const role = tabId === 'experts' ? 'expert' : (tabId === 'aspirants' ? 'aspirant' : tabId);
            fetchUsers(role, filter, 1);
        }

        function applyFilter(filterType, btn) {
            // Remove active class from ALL filter buttons (drawer + desktop)
            document.querySelectorAll('.filter-pill, .filter-pill-drawer').forEach(b => {
                b.classList.remove('active');
            });
            
            // Add active class to the clicked button
            btn.classList.add('active');
            
            // Sync UI: find the "partner" button and activate it
            // If it's a drawer button, it might have data-filter. If desktop, it has an ID
            const status = btn.getAttribute('data-filter') || filterType;
            document.querySelectorAll(`[data-filter="${status}"], #filter-${status}`).forEach(b => {
                b.classList.add('active');
            });

            window.currentFilterStatus = status;
            fetchUsers(currentUserRole, status, 1);
        }

        async function fetchStats() {
            try {
                const response = await fetch('../api/admin/get_stats.php');
                const result = await response.json();

                if (result.status === 'success') {
                    const data = result.data;

                    // Animate numbers for premium feel
                    animateValue('dash-total-users', 0, data.total_users, 1000);
                    animateValue('dash-total-experts', 0, data.experts, 1000);
                    animateValue('dash-total-aspirants', 0, data.aspirants, 1000);
                    animateValue('dash-total-questions', 0, data.total_questions, 1000);
                    animateValue('dash-total-pending', 0, data.pending_total, 1000);

                    // Update detail cards
                    if (document.getElementById('dash-card-experts-count'))
                        document.getElementById('dash-card-experts-count').innerText = data.pending_experts;
                    if (document.getElementById('dash-card-aspirants-count'))
                        document.getElementById('dash-card-aspirants-count').innerText = data.pending_aspirants;

                    // Update tab labels
                    const tabExpBtn = document.getElementById('tab-experts');
                    const tabAspBtn = document.getElementById('tab-aspirants');
                    // Only update inactive tabs to allow fetchUsers to control active tab (filtered) count
                    if (tabExpBtn && !tabExpBtn.classList.contains('active')) tabExpBtn.textContent = `Experts (${data.experts.toLocaleString()})`;
                    if (tabAspBtn && !tabAspBtn.classList.contains('active')) tabAspBtn.textContent = `Aspirants (${data.aspirants.toLocaleString()})`;

                    // Update Content Status Section
                    const statusUsers = document.getElementById('status-total-users');
                    if (statusUsers) {
                        statusUsers.innerText = `${data.experts} Experts / ${data.aspirants} Asp`;
                        const userProgress = Math.min(((data.experts + data.aspirants) / 1000) * 100, 100); // Scale relative to 1000 users
                        document.getElementById('bar-total-users').style.width = userProgress + '%';
                    }

                    const statusQuestions = document.getElementById('status-total-questions');
                    if (statusQuestions) {
                        statusQuestions.innerText = `${data.total_questions} Questions`;
                        const questionProgress = Math.min((data.total_questions / 500) * 100, 100); // Scale relative to 500 questions
                        document.getElementById('bar-total-questions').style.width = questionProgress + '%';
                    }

                    const statusPending = document.getElementById('status-pending-approvals');
                    if (statusPending) {
                        statusPending.innerText = `${data.pending_experts} Exp / ${data.pending_aspirants} Asp`;
                        const pendingProgress = Math.min((data.pending_total / 50) * 100, 100); // Scale relative to 50 total pending
                        document.getElementById('bar-pending-approvals').style.width = pendingProgress + '%';
                    }

                    const statusExams = document.getElementById('status-active-exams');
                    if (statusExams) {
                        statusExams.innerText = `${data.active_exams} Active`;
                        document.getElementById('bar-active-exams').style.width = '75%'; // Static feel for active exams
                    }
                }
            } catch (e) {
                console.error("Failed to fetch stats", e);
            }
        }

        // Helper for animated counters
        function animateValue(id, start, end, duration) {
            const obj = document.getElementById(id);
            if (!obj) return;

            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const value = Math.floor(progress * (end - start) + start);
                obj.innerText = value.toLocaleString();
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        function handleSearch(val) {
            currentSearch = val;
            fetchUsers(currentUserRole, currentFilterStatus, 1, val);
        }

        let platformGrowthChart = null;

        async function initPlatformGrowthChart(months = 6) {
            // Safety check for Library availability
            if (typeof ApexCharts === 'undefined') {
                setTimeout(() => initPlatformGrowthChart(months), 200);
                return;
            }

            const chartElement = document.getElementById('platform-growth-chart');
            if (!chartElement) return;

            // Sync selector UI if called programmatically
            const selector = document.getElementById('growth-range-selector');
            if (selector && selector.value != months) selector.value = months;

            // Show loading state
            chartElement.innerHTML = `
            <div class="h-full w-full flex flex-col items-center justify-center gap-2 text-slate-400">
                <div class="w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"></div>
                <p class="text-[10px] font-bold uppercase tracking-widest font-display">Analyzing Data...</p>
            </div>
        `;

            try {
                const response = await fetch(`../api/admin/get_platform_growth.php?months=${months}`);
                if (!response.ok) throw new Error('API unreachable');
                const result = await response.json();

                if (result.status === 'success') {
                    const data = result.data;

                    // Clear loading state
                    chartElement.innerHTML = '';

                    if (!data || data.length === 0) {
                        chartElement.innerHTML = `
                        <div class="h-full flex flex-col items-center justify-center text-slate-400/60 p-6 text-center">
                            <span class="material-symbols-outlined text-4xl mb-2 opacity-50">analytics</span>
                            <p class="text-xs font-medium italic leading-relaxed">No registration data found for the selected period.</p>
                        </div>
                    `;
                        return;
                    }

                    const labels = data.map(item => item.month_label);
                    const expertData = data.map(item => item.experts);
                    const aspirantData = data.map(item => item.aspirants);

                    const isDark = document.documentElement.classList.contains('dark');

                    const options = {
                        series: [
                            { name: 'Experts', data: expertData },
                            { name: 'Aspirants', data: aspirantData }
                        ],
                        chart: {
                            type: 'area',
                            height: 218,
                            toolbar: { show: false },
                            fontFamily: 'Inter, sans-serif',
                            dropShadow: {
                                enabled: true,
                                top: 8,
                                left: 0,
                                blur: 8,
                                opacity: 0.1,
                                color: isDark ? '#000' : '#2b8cee'
                            },
                            animations: {
                                enabled: true,
                                easing: 'easeinout',
                                speed: 800,
                                animateGradually: { enabled: true, delay: 150 },
                                dynamicAnimation: { enabled: true, speed: 350 }
                            },
                            background: 'transparent',
                            foreColor: isDark ? '#92adc9' : '#64748b'
                        },
                        colors: ['#06b6d4', '#ec4899'], // Deeper, more vibrant Cyan and Pink
                        stroke: {
                            curve: 'smooth',
                            width: 4,
                            lineCap: 'round'
                        },
                        fill: {
                            type: 'gradient',
                            gradient: {
                                shadeIntensity: 1,
                                opacityFrom: 0.55,
                                opacityTo: 0.05,
                                stops: [0, 95, 100],
                                colorStops: isDark ? [] : [
                                    { offset: 0, color: '#06b6d4', opacity: 0.4 },
                                    { offset: 100, color: '#ec4899', opacity: 0.05 }
                                ]
                            }
                        },
                        markers: {
                            size: 5,
                            colors: ['#fff'],
                            strokeColors: ['#06b6d4', '#ec4899'],
                            strokeWidth: 3,
                            hover: {
                                size: 8,
                                strokeWidth: 4
                            }
                        },
                        grid: {
                            show: true,
                            borderColor: isDark ? '#233648' : '#f1f5f9',
                            strokeDashArray: 5,
                            xaxis: { lines: { show: false } },
                            yaxis: { lines: { show: true } },
                            padding: {
                                top: 10,
                                right: 20,
                                bottom: 0,
                                left: 10
                            }
                        },
                        xaxis: {
                            categories: labels,
                            axisBorder: { show: true, color: isDark ? '#233648' : '#cbd5e1', height: 2 },
                            axisTicks: { show: false },
                            labels: {
                                offsetY: 5,
                                style: { fontSize: '10px', fontWeight: 500 }
                            }
                        },
                        yaxis: {
                            min: 0,
                            forceNiceScale: true,
                            labels: {
                                offsetX: -5,
                                style: { fontWeight: 600, fontSize: '10px' },
                                formatter: (val) => Math.floor(val)
                            }
                        },
                        tooltip: {
                            theme: isDark ? 'dark' : 'light',
                            x: { show: true },
                            y: {
                                formatter: (val) => `${val} Registered`
                            },
                            style: { fontSize: '12px' },
                            marker: { show: true }
                        },
                        legend: { show: false }
                    };

                    if (platformGrowthChart) {
                        platformGrowthChart.destroy();
                    }

                    platformGrowthChart = new ApexCharts(chartElement, options);
                    platformGrowthChart.render();
                } else {
                    throw new Error(result.message || 'Failed to fetch data');
                }
            } catch (error) {
                console.error('Failed to initialize growth chart:', error);
                chartElement.innerHTML = `
                <div class="h-full flex flex-col items-center justify-center text-red-500/80 gap-2 p-4 text-center">
                    <span class="material-symbols-outlined text-4xl opacity-50">cloud_off</span>
                    <p class="text-[10px] font-bold uppercase tracking-tight">Analytics Service Offline</p>
                    <p class="text-[9px] text-slate-400 max-w-[150px]">Unable to connect to the growth analytics endpoint.</p>
                </div>
            `;
            }
        }

        // Sync chart with theme changes
        window.addEventListener('themeChanged', () => {
            if (platformGrowthChart) {
                const isDark = document.documentElement.classList.contains('dark');
                platformGrowthChart.updateOptions({
                    chart: {
                        foreColor: isDark ? '#92adc9' : '#64748b'
                    },
                    grid: {
                        borderColor: isDark ? '#233648' : '#f1f5f9'
                    },
                    tooltip: {
                        theme: isDark ? 'dark' : 'light'
                    },
                    markers: {
                        hover: {
                            strokeColors: isDark ? '#101922' : '#fff'
                        }
                    }
                });
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            // Load Admin Profile First
            loadAdminProfile();

            fetchStats();
            fetchUsers('expert'); // Initial load
            loadCustomItems();
            loadQuestionMetadata();
            initPlatformGrowthChart();

            // Add event listeners for global search
            document.querySelector('header input[type="search"]')?.addEventListener('input', (e) => handleSearch(e.target.value));
            document.querySelector('#page-users input[type="text"]')?.addEventListener('input', (e) => handleSearch(e.target.value));

            // Attach form handlers
            const addExpBtn = document.getElementById('btn-submit-expert');
            if (addExpBtn) addExpBtn.onclick = () => handleAddUser('form-add-expert', 'expert');

            const addAspBtn = document.getElementById('btn-submit-aspirant');
            if (addAspBtn) addAspBtn.onclick = () => handleAddUser('form-add-aspirant', 'aspirant');

            // Attach OPEN modal handlers
            const openExpBtn = document.getElementById('btn-add-expert');
            if (openExpBtn) openExpBtn.onclick = () => openAddUserModal('expert');

            const openAspBtn = document.getElementById('btn-add-aspirant');
            if (openAspBtn) openAspBtn.onclick = () => openAddUserModal('aspirant');

            // Initialize Real-time Sync
            initRealTimeSync();
        });

        // --- REAL-TIME SYNC LOGIC ---
        function initRealTimeSync() {
            // 1. Cross-tab Instant Sync (For local development/multiple tabs)
            window.addEventListener('storage', (e) => {
                if (e.key === 'prefix_new_user') {
                    console.log(' Real-time Sync triggered via Storage Event');
                    refreshDashboardData('Storage Sync');
                }
            });

            // 2. Periodic Polling (For remote updates/fallback)
            // Refresh every 10 seconds while the dashboard is visible
            setInterval(() => {
                if (document.visibilityState === 'visible') {
                    const hasOpenModal = document.querySelector('.modal.active') || document.querySelector('.swal2-container');
                    // Only refresh if no modal is open and user isn't searching/filtering actively?
                    // Actually, fetchUsers is safe as legacy Search/Filter are stored in global vars.
                    if (!hasOpenModal) {
                        refreshDashboardData('Periodic Poll');
                    }
                }
            }, 10000);
        }

        async function refreshDashboardData(source = 'System') {
            try {
                // Stats refresh handles counts on cards and tab labels
                await fetchStats();

                // Users refresh handles the current view
                // Preserve current view state (role, status, page, search, limit)
                // Use 'true' for silent refresh to prevent UI flickering
                await fetchUsers(currentUserRole, currentFilterStatus, currentPage, currentSearch, currentLimit, true);

                // If on taxonomy page, refresh that too
                if (document.getElementById('page-taxonomy')?.classList.contains('active')) {
                    await loadCustomItems();
                }

                console.log(` Dashboard auto-refreshed via ${source}`);
            } catch (error) {
                console.warn('Dashboard sync skipped:', error);
            }
        }

        // --- PROFILE & SETTINGS LOGIC ---

        // Tiny MD5 implementation for Gravatar
        function md5(string) {
            function k(n) { return (n << 7) | (n >>> 25); }
            function l(n) { return (n << 12) | (n >>> 20); }
            function m(n) { return (n << 17) | (n >>> 15); }
            function o(n) { return (n << 22) | (n >>> 10); }

            var hex_chr = "0123456789abcdef";
            function rhex(num) {
                var str = "";
                for (var j = 0; j <= 3; j++) str += hex_chr.charAt((num >> (j * 8 + 4)) & 0x0F) + hex_chr.charAt((num >> (j * 8)) & 0x0F);
                return str;
            }

            function str2blks_MD5(str) {
                var nblk = ((str.length + 8) >> 6) + 1;
                var blks = new Array(nblk * 16);
                for (var i = 0; i < nblk * 16; i++) blks[i] = 0;
                for (i = 0; i < str.length; i++) blks[i >> 2] |= str.charCodeAt(i) << ((i % 4) * 8);
                blks[i >> 2] |= 0x80 << ((i % 4) * 8);
                blks[nblk * 16 - 2] = str.length * 8;
                return blks;
            }

            function add(x, y) {
                var lsw = (x & 0xFFFF) + (y & 0xFFFF);
                var msw = (x >> 16) + (y >> 16) + (lsw >> 16);
                return (msw << 16) | (lsw & 0xFFFF);
            }

            function rol(num, cnt) { return (num << cnt) | (num >>> (32 - cnt)); }

            function cmn(q, a, b, x, s, t) { return add(rol(add(add(a, q), add(x, t)), s), b); }
            function ff(a, b, c, d, x, s, t) { return cmn((b & c) | ((~b) & d), a, b, x, s, t); }
            function gg(a, b, c, d, x, s, t) { return cmn((b & d) | (c & (~d)), a, b, x, s, t); }
            function hh(a, b, c, d, x, s, t) { return cmn(b ^ c ^ d, a, b, x, s, t); }
            function ii(a, b, c, d, x, s, t) { return cmn(c ^ (b | (~d)), a, b, x, s, t); }

            var x = str2blks_MD5(string);
            var a = 1732584193;
            var b = -271733879;
            var c = -1732584194;
            var d = 271733878;

            for (var i = 0; i < x.length; i += 16) {
                var olda = a; var oldb = b; var oldc = c; var oldd = d;

                a = ff(a, b, c, d, x[i + 0], 7, -680876936); d = ff(d, a, b, c, x[i + 1], 12, -389564586); c = ff(c, d, a, b, x[i + 2], 17, 606105819); b = ff(b, c, d, a, x[i + 3], 22, -1044525330);
                a = ff(a, b, c, d, x[i + 4], 7, -176418897); d = ff(d, a, b, c, x[i + 5], 12, 1200080426); c = ff(c, d, a, b, x[i + 6], 17, -1473231341); b = ff(b, c, d, a, x[i + 7], 22, -45705983);
                a = ff(a, b, c, d, x[i + 8], 7, 1770035416); d = ff(d, a, b, c, x[i + 9], 12, -1958414417); c = ff(c, d, a, b, x[i + 10], 17, -42063); b = ff(b, c, d, a, x[i + 11], 22, -1990404162);
                a = ff(a, b, c, d, x[i + 12], 7, 1804603682); d = ff(d, a, b, c, x[i + 13], 12, -40341101); c = ff(c, d, a, b, x[i + 14], 17, -1502002290); b = ff(b, c, d, a, x[i + 15], 22, 1236535329);

                a = gg(a, b, c, d, x[i + 1], 5, -165796510); d = gg(d, a, b, c, x[i + 6], 9, -1069501632); c = gg(c, d, a, b, x[i + 11], 14, 643717713); b = gg(b, c, d, a, x[i + 0], 20, -373897302);
                a = gg(a, b, c, d, x[i + 5], 5, -701558691); d = gg(d, a, b, c, x[i + 10], 9, 38016083); c = gg(c, d, a, b, x[i + 15], 14, -660478335); b = gg(b, c, d, a, x[i + 4], 20, -405537848);
                a = gg(a, b, c, d, x[i + 9], 5, 568446438); d = gg(d, a, b, c, x[i + 14], 9, -1019803690); c = gg(c, d, a, b, x[i + 3], 14, -187363961); b = gg(b, c, d, a, x[i + 8], 20, 1163531501);
                a = gg(a, b, c, d, x[i + 13], 5, -1444681467); d = gg(d, a, b, c, x[i + 2], 9, -51403784); c = gg(c, d, a, b, x[i + 7], 14, 1735328473); b = gg(b, c, d, a, x[i + 12], 20, -1926607734);

                a = hh(a, b, c, d, x[i + 5], 4, -378558); d = hh(d, a, b, c, x[i + 8], 11, -2022574463); c = hh(c, d, a, b, x[i + 11], 16, 1839030562); b = hh(b, c, d, a, x[i + 14], 23, -35309556);
                a = hh(a, b, c, d, x[i + 1], 4, -1530992060); d = hh(d, a, b, c, x[i + 4], 11, 1272893353); c = hh(c, d, a, b, x[i + 7], 16, -155497632); b = hh(b, c, d, a, x[i + 10], 23, -1094730640);
                a = hh(a, b, c, d, x[i + 13], 4, 681279174); d = hh(d, a, b, c, x[i + 0], 11, -358537222); c = hh(c, d, a, b, x[i + 3], 16, -722521979); b = hh(b, c, d, a, x[i + 6], 23, 76029189);
                a = hh(a, b, c, d, x[i + 9], 4, -640364487); d = hh(d, a, b, c, x[i + 12], 11, -421815835); c = hh(c, d, a, b, x[i + 15], 16, 530742520); b = hh(b, c, d, a, x[i + 2], 23, -995338651);

                a = ii(a, b, c, d, x[i + 0], 6, -198630844); d = ii(d, a, b, c, x[i + 7], 10, 1126891415); c = ii(c, d, a, b, x[i + 14], 15, -1416354905); b = ii(b, c, d, a, x[i + 5], 21, -57434055);
                a = ii(a, b, c, d, x[i + 12], 6, 1700485571); d = ii(d, a, b, c, x[i + 3], 10, -1894946606); c = ii(c, d, a, b, x[i + 10], 15, -1051523); b = ii(b, c, d, a, x[i + 1], 21, -2054922799);
                a = ii(a, b, c, d, x[i + 8], 6, 1873313359); d = ii(d, a, b, c, x[i + 15], 10, -30611744); c = ii(c, d, a, b, x[i + 6], 15, -1560198380); b = ii(b, c, d, a, x[i + 13], 21, 1309151649);
                a = ii(a, b, c, d, x[i + 4], 6, -145523070); d = ii(d, a, b, c, x[i + 11], 10, -1120210379); c = ii(c, d, a, b, x[i + 2], 15, 718787280); b = ii(b, c, d, a, x[i + 9], 21, -343485551);

                a = add(a, olda); b = add(b, oldb); c = add(c, oldc); d = add(d, oldd);
            }
            return rhex(a) + rhex(b) + rhex(c) + rhex(d);
        }

        function getAvatarUrl(email, name, customAvatar) {
            // Only return customAvatar if it's NOT a generated UI/Gravatar URL
            if (customAvatar &&
                customAvatar.trim().length > 0 &&
                customAvatar !== 'undefined' &&
                customAvatar !== 'null' &&
                !customAvatar.includes('ui-avatars.com') &&
                !customAvatar.includes('gravatar.com')) {
                // If it's a relative path (starts with ../), ensure it works
                // Our API returns it exactly as stored, e.g. "../uploads/avatars/..."
                // Since this page is in admin_dashboard/, "../" goes to root, then "uploads/..."
                // This is correct.
                return customAvatar;
            }

            // Direct fallback to UI Avatars with first letter (length=1)
            return `https://ui-avatars.com/api/?name=${encodeURIComponent(name || 'Admin')}&background=random&color=fff&bold=true&size=128&length=1`;
        }

        async function loadAdminProfile() {
            try {
                console.log(' Loading Admin Profile...');
                const response = await fetch('../api/admin/get_profile.php');
                if (!response.ok) {
                    let errMsg = response.statusText;
                    try {
                        const errData = await response.json();
                        if (errData.message) errMsg = errData.message;
                    } catch (e) { }
                    const errorObj = new Error(`API Error ${response.status}: ${errMsg}`);
                    errorObj.status = response.status;
                    throw errorObj;
                }

                const result = await response.json();

                if (result.status === 'success') {
                    const admin = result.data;
                    console.log(' Admin Profile Loaded:', admin);

                    // Populate Settings Form
                    const nameInput = document.getElementById('input-admin-name');
                    const emailInput = document.getElementById('input-admin-email');
                    const phoneInput = document.getElementById('input-admin-phone');

                    if (nameInput) nameInput.value = admin.name || '';
                    if (emailInput) emailInput.value = admin.email || '';
                    if (phoneInput) phoneInput.value = admin.phone || '';

                    // Generate and Set Avatar
                    const avatarSrc = getAvatarUrl(admin.email, admin.name, admin.avatar);
                    const previewAvatar = document.getElementById('settings-preview-avatar');
                    if (previewAvatar) previewAvatar.src = avatarSrc;

                    // Sync Header & Dropdown
                    const headerName = document.getElementById('header-admin-name');
                    const headerAvatar = document.getElementById('header-admin-avatar');
                    const headerRole = document.getElementById('header-admin-role');
                    const dropdownName = document.getElementById('dropdown-admin-name');
                    const dropdownEmail = document.getElementById('dropdown-admin-email');

                    if (headerName) headerName.textContent = admin.name || 'Admin';
                    if (headerAvatar) headerAvatar.src = avatarSrc;
                    if (headerRole) {
                        const roleMap = { 'admin': 'System Administrator' };
                        headerRole.textContent = roleMap[admin.role] || admin.role || 'System Administrator';
                    }

                    if (dropdownName) dropdownName.textContent = admin.name || 'Admin User';
                    if (dropdownEmail) dropdownEmail.textContent = admin.email || '';

                    // Attach live preview listeners
                    if (!window._profileListenersAttached) {
                        const updatePreview = () => {
                            const currentName = nameInput?.value || 'Admin';
                            const currentEmail = emailInput?.value || '';

                            // Only update preview if it is currently using a generated avatar
                            // This prevents overwriting a custom photo when user edits name
                            if (previewAvatar && (previewAvatar.src.includes('ui-avatars.com') || previewAvatar.src.includes('gravatar.com'))) {
                                const liveAvatar = getAvatarUrl(currentEmail, currentName);
                                previewAvatar.src = liveAvatar;
                            }
                        };

                        if (nameInput) nameInput.addEventListener('input', updatePreview);
                        if (emailInput) emailInput.addEventListener('input', updatePreview);
                        window._profileListenersAttached = true;
                    }
                } else {
                    console.warn(' Profile Fetch Warning:', result.message);
                    showToast('Failed to load profile: ' + (result.message || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error(' Failed to load admin profile:', error);
                let msg = error.message;
                if (error.status === 401) msg = "Session expired. Please login again.";
                if (error.status === 404) msg = "User profile not found.";
                showToast(msg || 'Connection failed: Could not load profile details', 'error');
            }
        }

        function previewAdminPhoto(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();

                reader.onload = function (e) {
                    const img = new Image();
                    img.onload = function () {
                        // Create a canvas to resize the image
                        const canvas = document.createElement('canvas');
                        const size = 256; // Standard avatar size
                        canvas.width = size;
                        canvas.height = size;
                        const ctx = canvas.getContext('2d');

                        // Calculate square crop
                        let sourceX = 0;
                        let sourceY = 0;
                        let sourceWidth = img.width;
                        let sourceHeight = img.height;

                        if (img.width > img.height) {
                            sourceWidth = img.height;
                            sourceX = (img.width - img.height) / 2;
                        } else {
                            sourceHeight = img.width;
                            sourceY = (img.height - img.width) / 2;
                        }

                        // Draw image to canvas with high quality
                        ctx.imageSmoothingEnabled = true;
                        ctx.imageSmoothingQuality = 'high';
                        ctx.drawImage(img, sourceX, sourceY, sourceWidth, sourceHeight, 0, 0, size, size);

                        // Convert to compressed JPEG (Quality 0.8 is great balance)
                        const optimizedBase64 = canvas.toDataURL('image/jpeg', 0.8);
                        document.getElementById('settings-preview-avatar').src = optimizedBase64;

                        showToast('Photo optimized for upload', 'success');
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function removeAdminPhoto() {
            const name = document.getElementById('input-admin-name').value;
            const defaultAvatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(name || 'Admin')}&background=random&color=fff&bold=true&size=256&length=1`;
            document.getElementById('settings-preview-avatar').src = defaultAvatar;
            document.getElementById('admin-photo-input').value = '';
        }

        async function updateAdminProfile(event) {
            const name = document.getElementById('input-admin-name').value;
            const email = document.getElementById('input-admin-email').value;
            const phone = document.getElementById('input-admin-phone').value;
            let avatar = document.getElementById('settings-preview-avatar').src;

            if (!name || !email) {
                showToast('Name and Email are required', 'error');
                return;
            }

            // If avatar is the default generated one, send empty string to DB
            // This ensures DB stores NULL/empty and we generate dynamic avatar on load
            if (avatar && (avatar.includes('ui-avatars.com') || avatar.includes('gravatar.com'))) {
                avatar = '';
            }

            const btn = event.currentTarget;
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<span class="animate-spin inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full mr-2"></span> Saving...';

            try {
                const formData = new URLSearchParams();
                formData.append('action', 'update_profile');
                formData.append('name', name);
                formData.append('email', email);
                formData.append('phone', phone);
                formData.append('avatar', avatar);

                const response = await fetch('../api/admin/update_profile.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: formData.toString()
                });

                const result = await response.json();

                if (result.status === 'success') {
                    // Update dashboard header instantly
                    document.getElementById('header-admin-name').textContent = name;
                    document.getElementById('header-admin-avatar').src = avatar;

                    showToast('Profile updated successfully!', 'success');
                } else {
                    showToast(result.message || 'Update failed', 'error');
                }
            } catch (error) {
                console.error('Update Profile Error:', error);
                showToast('System error occurred', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profile-dropdown');
            dropdown.classList.toggle('hidden');
        }

        // --- Logout Modal Logic (Replaces native confirm) ---
        window.handleLogout = function () {
            console.log('Open Logout Modal');
            const dropdown = document.getElementById('profile-dropdown');
            if (dropdown) dropdown.classList.add('hidden');

            const modal = document.getElementById('modal-logout-confirm');
            const backdrop = document.getElementById('modal-logout-backdrop');
            const panel = document.getElementById('modal-logout-panel');

            if (modal) modal.classList.remove('hidden');
            // Animate in
            setTimeout(() => {
                if (backdrop) backdrop.classList.remove('opacity-0');
                if (panel) {
                    panel.classList.remove('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
                    panel.classList.add('translate-y-0', 'sm:scale-100');
                }
            }, 10);
        };

        window.closeLogoutModal = function () {
            const modal = document.getElementById('modal-logout-confirm');
            const backdrop = document.getElementById('modal-logout-backdrop');
            const panel = document.getElementById('modal-logout-panel');

            // Animate out
            if (backdrop) backdrop.classList.add('opacity-0');
            if (panel) {
                panel.classList.add('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
                panel.classList.remove('translate-y-0', 'sm:scale-100');
            }

            setTimeout(() => {
                if (modal) modal.classList.add('hidden');
            }, 300);
        };

        window.confirmLogout = async function () {
            const btn = document.querySelector('#modal-logout-panel button[onclick="confirmLogout()"]');
            if (btn) {
                btn.disabled = true;
                btn.innerHTML = '<span class="material-symbols-outlined animate-spin text-sm">sync</span> Signing out...';
            }
            try {
                await fetch('../api/logout.php', { method: 'POST' });
            } catch (e) { console.error(e); }
            window.location.href = '../index.html';
        };

        // Close dropdown on click outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.relative')) {
                document.getElementById('profile-dropdown')?.classList.add('hidden');
            }
        });

        // Make functions global for inline onclick
        window.openModal = openModal;
        window.closeModal = closeModal;
        window.openEditModal = openEditModal;
        window.confirmDelete = confirmDelete;
        window.handleAddUser = handleAddUser;
        window.handleEditUser = handleEditUser;
        window.updateUserStatus = updateUserStatus;
        window.fetchUsers = fetchUsers;
        window.toggleQuestionRole = toggleQuestionRole;
        window.toggleAspirantType = toggleAspirantType;
        window.handleAddSubCat = handleAddSubCat;
        window.switchPage = switchPage;
        window.switchTab = switchTab;
        window.applyFilter = applyFilter;
        window.navigateToUsers = navigateToUsers;
        window.handleSearch = handleSearch;
        window.showToast = showToast;
        // --- Logout Modal Logic (Moved Up) ---
        window.handleLogout = function () {
            console.log('Open Logout Modal');
            const dropdown = document.getElementById('profile-dropdown');
            if (dropdown) dropdown.classList.add('hidden');

            const modal = document.getElementById('modal-logout-confirm');
            const backdrop = document.getElementById('modal-logout-backdrop');
            const panel = document.getElementById('modal-logout-panel');

            if (modal) modal.classList.remove('hidden');
            // Animate in
            setTimeout(() => {
                if (backdrop) backdrop.classList.remove('opacity-0');
                if (panel) {
                    panel.classList.remove('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
                    panel.classList.add('translate-y-0', 'sm:scale-100');
                }
            }, 10);
        };

        window.closeLogoutModal = function () {
            const modal = document.getElementById('modal-logout-confirm');
            const backdrop = document.getElementById('modal-logout-backdrop');
            const panel = document.getElementById('modal-logout-panel');

            // Animate out
            if (backdrop) backdrop.classList.add('opacity-0');
            if (panel) {
                panel.classList.add('opacity-0', 'translate-y-4', 'sm:translate-y-0', 'sm:scale-95');
                panel.classList.remove('translate-y-0', 'sm:scale-100');
            }

            setTimeout(() => {
                if (modal) modal.classList.add('hidden');
            }, 300);
        };

        window.confirmLogout = async function () {
            // Show loading state
            const btn = document.querySelector('#modal-logout-panel button[onclick="confirmLogout()"]');
            if (btn) {
                btn.disabled = true;
                btn.innerHTML = '<span class="material-symbols-outlined animate-spin text-sm">sync</span> Signing out...';
            }

            try {
                // Call API to destroy session
                await fetch('../api/logout.php', { method: 'POST' });
            } catch (e) {
                console.error(e);
            }

            // Redirect to Login
            window.location.href = '../index.html';
        };

        window.removeAdminPhoto = removeAdminPhoto;
        window.handleBulkUploadContextual = handleBulkUploadContextual;
        window.toggleQRole = toggleQRole;
        window.handleAddQuestion = handleAddQuestion;
        window.loadQuestionMetadata = loadQuestionMetadata;
        window.loadCustomItems = loadCustomItems;
        window.handleEditTaxonomy = handleEditTaxonomy;
        window.handleDeleteTaxonomy = handleDeleteTaxonomy;
        window.resetTaxonomyForm = resetTaxonomyForm;
        window.handleAddSubCat = handleAddSubCat;
        window.toggleQuestionActionMenu = toggleQuestionActionMenu;
        window.handleQuestionAction = handleQuestionAction;
        window.handleEditQuestion = handleEditQuestion;
        // window.loadQuestions = loadQuestions;
        /* 
        Logout logic moved up to prevent potential script blocking issues
        */

        window.handleAspirantCategoryChange = handleAspirantCategoryChange;
        window.initPlatformGrowthChart = initPlatformGrowthChart;

        // --- Advanced User Actions ---

        window.handleResetPassword = function (userId, email, e) {
            if (e) e.stopPropagation();

            // Force close global menu first
            const globalMenu = document.getElementById('global-action-menu');
            if (globalMenu) globalMenu.classList.add('hidden');
            document.querySelectorAll('.action-btn-trigger').forEach(b => b.classList.remove('action-btn-trigger'));

            // Reset steps
            document.getElementById('reset-password-step-1').classList.remove('hidden');
            document.getElementById('reset-password-step-1').classList.add('block');
            document.getElementById('reset-password-step-2').classList.add('hidden');
            document.getElementById('reset-password-step-2').classList.remove('block');

            const emailSpan = document.getElementById('reset-user-email');
            if (emailSpan) emailSpan.textContent = email;
            openModal('modal-reset-password');

            window._currentResetUserId = userId;
            window._currentResetEmail = email;
        };

        window.showResetManualForm = function () {
            document.getElementById('reset-password-step-1').classList.add('hidden');
            document.getElementById('reset-password-step-1').classList.remove('block');
            document.getElementById('reset-password-step-2').classList.remove('hidden');
            document.getElementById('reset-password-step-2').classList.add('block');
            document.getElementById('manual-new-password').value = '';
        };

        window.showResetSelection = function () {
            document.getElementById('reset-password-step-1').classList.remove('hidden');
            document.getElementById('reset-password-step-1').classList.add('block');
            document.getElementById('reset-password-step-2').classList.add('hidden');
            document.getElementById('reset-password-step-2').classList.remove('block');
        };

        window.generateRandomPassword = function () {
            const pass = Math.random().toString(36).slice(-8).toUpperCase() + Math.floor(Math.random() * 10);
            document.getElementById('manual-new-password').value = pass;
        };

        window.submitManualResetStatus = async function () {
            const pass = document.getElementById('manual-new-password').value;
            if (!pass) return showToast('Please enter or generate a password', 'error');

            try {
                const formData = new URLSearchParams();
                formData.append('action', 'reset_password');
                formData.append('user_id', window._currentResetUserId);
                formData.append('password', pass);

                const response = await fetch('../api/admin/manage_user.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: formData.toString()
                });
                const data = await response.json();

                if (data.status === 'success') {
                    closeModal('modal-reset-password');
                    showToast(`Security Override Successful: Password changed.`);
                } else {
                    showToast(data.message, 'error');
                }
            } catch (error) {
                console.error(error);
                showToast('Failed to reset password', 'error');
            }
        };

        window.triggerPasswordReset = async function (type) {
            if (type === 'email') {
                showToast(`Magic link dispatched to ${window._currentResetEmail}`);
                closeModal('modal-reset-password');
            }
        };

        window.handleViewLogs = async function (userId, userName, e) {
            if (e) e.stopPropagation();

            // Force close global menu first
            const globalMenu = document.getElementById('global-action-menu');
            if (globalMenu) globalMenu.classList.add('hidden');
            document.querySelectorAll('.action-btn-trigger').forEach(b => b.classList.remove('action-btn-trigger'));

            // Populate Title and Stats
            document.getElementById('activity-log-title').textContent = `Activity: ${userName}`;
            // Keep mock stats for visuals or set to '-'
            document.getElementById('log-stat-logins').textContent = '-';
            document.getElementById('log-stat-devices').textContent = '-';

            const timeline = document.getElementById('activity-log-timeline');
            timeline.innerHTML = '<div class="py-12 flex justify-center"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div></div>';

            openModal('modal-activity-log');

            try {
                const response = await fetch(`../api/admin/manage_user.php?action=get_activity_logs&user_id=${userId}`);
                const data = await response.json();

                if (data.status === 'success') {
                    const logs = data.data;

                    if (logs.length === 0) {
                        timeline.innerHTML = `
                        <div class="flex flex-col items-center justify-center py-12 text-slate-400">
                             <span class="material-symbols-outlined text-4xl mb-2 opacity-20">history_toggle_off</span>
                             <p class="text-sm">No recorded activity found for this user.</p>
                        </div>
                    `;
                        return;
                    }

                    timeline.innerHTML = logs.map(act => {
                        let icon = 'info';
                        let color = 'slate';
                        const a = act.action.toLowerCase();

                        if (a.includes('login')) { icon = 'login'; color = 'blue'; }
                        else if (a.includes('reset') || a.includes('password')) { icon = 'lock_reset'; color = 'indigo'; }
                        else if (a.includes('create')) { icon = 'person_add'; color = 'green'; }
                        else if (a.includes('update')) { icon = 'edit_note'; color = 'amber'; }
                        else if (a.includes('delete')) { icon = 'delete'; color = 'red'; }
                        else if (a.includes('security') || a.includes('audit')) { icon = 'shield'; color = 'purple'; }

                        // Format date nicely
                        const d = new Date(act.created_at);
                        const timeStr = d.toLocaleDateString() + ' ' + d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                        return `
                    <div class="relative pl-8 pb-8 last:pb-0 group">
                        <!-- Bullet -->
                        <div class="absolute left-[-22px] top-0 w-8 h-8 rounded-full bg-white dark:bg-[#0f172a] border-2 border-slate-100 dark:border-slate-800 flex items-center justify-center z-10 transition-all group-hover:border-${color}-500 group-hover:scale-110">
                            <span class="material-symbols-outlined text-[18px] text-slate-400 group-hover:text-${color}-500">${icon}</span>
                        </div>
                        <!-- Card -->
                        <div class="bg-slate-50 dark:bg-[#1e293b]/20 rounded-2xl p-4 border border-slate-100 dark:border-[#1e293b]/50 group-hover:bg-white dark:group-hover:bg-[#1e293b]/40 group-hover:border-${color}-500/20 transition-all">
                            <div class="flex justify-between items-start mb-1">
                                <h4 class="font-bold text-slate-900 dark:text-white text-sm">${act.action}</h4>
                                <span class="text-[10px] font-bold uppercase tracking-wider text-slate-400">${timeStr}</span>
                            </div>
                            <p class="text-[11px] text-slate-500 dark:text-slate-400 leading-relaxed">${act.details || ''}</p>
                            ${act.ip_address ? `<div class="mt-2 flex items-center gap-1 text-[10px] text-slate-400 font-mono bg-slate-100 dark:bg-[#1a252f] w-fit px-2 py-0.5 rounded"><span class="material-symbols-outlined text-[10px]">dns</span> ${act.ip_address}</div>` : ''}
                        </div>
                    </div>
                    `;
                    }).join('');
                } else {
                    timeline.innerHTML = `<div class="text-center py-8 text-red-500">Error: ${data.message}</div>`;
                }
            } catch (error) {
                console.error(error);
                timeline.innerHTML = `<div class="text-center py-8 text-red-500">Failed to load logs</div>`;
            }
        };

        window.handleSendEmail = async function (userId, email, e) {
            if (e) e.stopPropagation();

            // Force close global menu first
            const globalMenu = document.getElementById('global-action-menu');
            if (globalMenu) globalMenu.classList.add('hidden');
            document.querySelectorAll('.action-btn-trigger').forEach(b => b.classList.remove('action-btn-trigger'));

            const { value: text } = await Swal.fire({
                input: 'textarea',
                inputLabel: `Official Correspondence: ${email}`,
                inputPlaceholder: 'Format your notification here...',
                confirmButtonText: 'Encrypt & Send',
                confirmButtonColor: '#3b82f6',
                showCancelButton: true,
                background: document.documentElement.classList.contains('dark') ? '#1a252f' : '#ffffff',
                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#0f172a'
            });

            if (text) {
                showToast('Message archived and dispatched successfully.');
            }
        };

        // Hook navigation for Questions page
        const navQuestions = document.getElementById('nav-questions');
        if (navQuestions) {
            navQuestions.addEventListener('click', () => {
                // Small delay to ensure view switch happened if handled by switchPage
                setTimeout(() => {
                    loadQuestions();
                    loadQuestionMetadata(); // Ensure dropdowns are populated
                }, 50);
            });
        }

        // Initialize Metadata on Load
        document.addEventListener('DOMContentLoaded', () => {
            loadQuestionMetadata();
        });
    </script>

    <!-- Question Filter Drawer -->
    <div id="question-filter-drawer-overlay" onclick="toggleQuestionFilterDrawer()"></div>
    <div id="question-filter-drawer" class="fixed top-0 right-0 h-full w-[80%] sm:w-[50%] bg-white dark:bg-[#111a22] z-[10001] translate-x-full transition-transform duration-400 cubic-bezier(0.16, 1, 0.3, 1) shadow-2xl border-l border-slate-200 dark:border-slate-800 flex flex-col">
        <div class="p-6 border-b border-slate-100 dark:border-slate-800/60 flex items-center justify-between">
            <div>
                <h3 class="text-lg font-bold dark:text-white">Question Filters</h3>
                <p class="text-[10px] text-slate-500 dark:text-[#92adc9] uppercase font-bold tracking-widest mt-1">Refine Question Bank</p>
            </div>
            <button onclick="toggleQuestionFilterDrawer()" class="close-drawer-btn w-10 h-10 flex items-center justify-center rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800/60 text-slate-400 transition-all">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        
        <div class="flex-1 overflow-y-auto p-6 space-y-6 custom-scrollbar">
            <!-- Target Role -->
            <div class="space-y-2">
                <div class="flex items-center gap-2 ml-1">
                    <span class="material-symbols-outlined text-[18px] text-blue-500">groups</span>
                    <label class="text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-wider">Target Role</label>
                </div>
                <select id="mobile-filter-role" onchange="syncFilter('filter-role', this.value); loadQuestions()"
                    class="w-full bg-slate-50 dark:bg-[#1a252f] border border-slate-200 dark:border-[#324d67] rounded-xl py-3 px-4 text-sm font-medium dark:text-white focus:ring-1 focus:ring-primary outline-none">
                    <option value="all">All Roles</option>
                    <option value="student">Student</option>
                    <option value="aspirant">Aspirant</option>
                </select>
            </div>

            <!-- Added By Expert -->
            <div class="space-y-2">
                <div class="flex items-center gap-2 ml-1">
                    <span class="material-symbols-outlined text-[18px] text-indigo-500">person_edit</span>
                    <label class="text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-wider">Added By</label>
                </div>
                <select id="mobile-filter-expert" onchange="syncFilter('filter-expert', this.value); loadQuestions()"
                    class="w-full bg-slate-50 dark:bg-[#1a252f] border border-slate-200 dark:border-[#324d67] rounded-xl py-3 px-4 text-sm font-medium dark:text-white focus:ring-1 focus:ring-primary outline-none">
                    <option value="all">All Experts</option>
                    <option value="Admin">Admin</option>
                </select>
            </div>

            <!-- Moderation Status -->
            <div class="space-y-2">
                <div class="flex items-center gap-2 ml-1">
                    <span class="material-symbols-outlined text-[18px] text-emerald-500">verified</span>
                    <label class="text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-wider">Status</label>
                </div>
                <select id="mobile-filter-status" onchange="syncFilter('filter-status', this.value); loadQuestions()"
                    class="w-full bg-slate-50 dark:bg-[#1a252f] border border-slate-200 dark:border-[#324d67] rounded-xl py-3 px-4 text-sm font-medium dark:text-white focus:ring-1 focus:ring-primary outline-none">
                    <option value="all">All Status</option>
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                    <option value="suspended">Suspended</option>
                </select>
            </div>

            <!-- Difficulty Level -->
            <div class="space-y-2">
                <div class="flex items-center gap-2 ml-1">
                    <span class="material-symbols-outlined text-[18px] text-amber-500">equalizer</span>
                    <label class="text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-wider">Difficulty Level</label>
                </div>
                <select id="mobile-filter-diff" onchange="syncFilter('filter-diff', this.value); loadQuestions()"
                    class="w-full bg-slate-50 dark:bg-[#1a252f] border border-slate-200 dark:border-[#324d67] rounded-xl py-3 px-4 text-sm font-medium dark:text-white focus:ring-1 focus:ring-primary outline-none">
                    <option value="all">All Difficulty</option>
                    <option value="Easy">Easy</option>
                    <option value="Medium">Medium</option>
                    <option value="Hard">Hard</option>
                </select>
            </div>

            <!-- Content Language -->
            <div class="space-y-2">
                <div class="flex items-center gap-2 ml-1">
                    <span class="material-symbols-outlined text-[18px] text-purple-500">language</span>
                    <label class="text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-wider">Content Language</label>
                </div>
                <select id="mobile-filter-lang" onchange="syncFilter('filter-lang', this.value); loadQuestions()"
                    class="w-full bg-slate-50 dark:bg-[#1a252f] border border-slate-200 dark:border-[#324d67] rounded-xl py-3 px-4 text-sm font-medium dark:text-white focus:ring-1 focus:ring-primary outline-none">
                    <option value="all">All Languages</option>
                    <option value="English">English</option>
                    <option value="Bengali">Bengali</option>
                </select>
            </div>

            <button onclick="resetFilters(); toggleQuestionFilterDrawer()" 
                class="w-full py-3.5 bg-red-50 dark:bg-red-500/10 text-red-600 dark:text-red-400 rounded-xl font-bold text-xs flex items-center justify-center gap-2 transition-all active:scale-[0.98] border border-red-100 dark:border-red-500/20">
                <span class="material-symbols-outlined text-sm">restart_alt</span>
                Reset All Filters
            </button>
        </div>
    </div>

    <!-- Filter Drawer -->
    <div id="filter-drawer-overlay" onclick="toggleFilterDrawer()"></div>
    <div id="filter-drawer" class="fixed top-0 right-0 h-full w-[70%] sm:w-[50%] bg-white dark:bg-[#111a22] z-[10001] translate-x-full transition-transform duration-400 cubic-bezier(0.16, 1, 0.3, 1) shadow-2xl border-l border-slate-200 dark:border-slate-800 flex flex-col">
        <div class="p-6 border-b border-slate-100 dark:border-slate-800/60 flex items-center justify-between">
            <div>
                <h3 class="text-lg font-bold dark:text-white">Filters</h3>
                <p class="text-[10px] text-slate-500 dark:text-[#92adc9] uppercase font-bold tracking-widest mt-1">Refine User List</p>
            </div>
            <button onclick="toggleFilterDrawer()" class="close-drawer-btn w-10 h-10 flex items-center justify-center rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800/60 text-slate-400 transition-all">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        
        <div class="flex-1 overflow-y-auto p-6 space-y-8 custom-scrollbar">
            <!-- Filter Section -->
            <div>
                <label class="text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-[0.2em] mb-4 block">Registration Status</label>
                <div class="grid grid-cols-1 gap-2">
                    <button class="filter-pill-drawer active group" data-filter="all" onclick="applyFilter('all', this); setTimeout(toggleFilterDrawer, 150);">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-sm">groups</span>
                            <span>All Users</span>
                        </div>
                        <span class="material-symbols-outlined text-xs opacity-0 group-[.active]:opacity-100 transition-opacity">check</span>
                    </button>
                    <button class="filter-pill-drawer group" data-filter="approved" onclick="applyFilter('approved', this); setTimeout(toggleFilterDrawer, 150);">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-sm text-green-500">verified</span>
                            <span>Approved</span>
                        </div>
                        <span class="material-symbols-outlined text-xs opacity-0 group-[.active]:opacity-100 transition-opacity">check</span>
                    </button>
                    <button class="filter-pill-drawer group" data-filter="pending" onclick="applyFilter('pending', this); setTimeout(toggleFilterDrawer, 150);">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-sm text-amber-500">pending</span>
                            <span>Pending</span>
                        </div>
                        <span class="material-symbols-outlined text-xs opacity-0 group-[.active]:opacity-100 transition-opacity">check</span>
                    </button>
                    <button class="filter-pill-drawer group" data-filter="suspended" onclick="applyFilter('suspended', this); setTimeout(toggleFilterDrawer, 150);">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-sm text-red-500">block</span>
                            <span>Suspended</span>
                        </div>
                        <span class="material-symbols-outlined text-xs opacity-0 group-[.active]:opacity-100 transition-opacity">check</span>
                    </button>
                </div>
            </div>
            
            <!-- Context Hint -->
            <div class="p-4 bg-primary/5 rounded-2xl border border-primary/10">
                <p class="text-[11px] text-slate-500 dark:text-[#92adc9] leading-relaxed">
                    <span class="font-bold text-primary">Note:</span> Filters applied here will persist as you switch between Experts and Aspirants tabs.
                </p>
            </div>
        </div>
        
        <div class="p-6 border-t border-slate-100 dark:border-slate-800/60 bg-slate-50/50 dark:bg-slate-900/20">
            <button onclick="toggleFilterDrawer()" class="w-full py-3.5 bg-slate-900 dark:bg-white text-white dark:text-slate-900 rounded-xl font-bold text-sm shadow-xl transition-all active:scale-[0.98]">
                Close Filters
            </button>
        </div>
    </div>

    <!-- Logout Confirmation Modal -->
    <div id="modal-logout-confirm" class="fixed inset-0 z-[9999] hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <div class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity opacity-0"
            id="modal-logout-backdrop"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto w-screen">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-2xl bg-white dark:bg-[#1a252f] text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-md opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
                    id="modal-logout-panel">
                    <div class="bg-white dark:bg-[#1a252f] px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                        <div class="sm:flex sm:items-start">
                            <div
                                class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 dark:bg-red-900/30 sm:mx-0 sm:h-10 sm:w-10">
                                <span class="material-symbols-outlined text-red-600 dark:text-red-500">logout</span>
                            </div>
                            <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                                <h3 class="text-base font-bold leading-6 text-slate-900 dark:text-white"
                                    id="modal-title">Confirm Logout</h3>
                                <div class="mt-2">
                                    <p class="text-sm text-slate-500 dark:text-[#92adc9]">Are you sure you want to end
                                        your session? You will need to sign in again to access the dashboard.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                        class="bg-slate-50 dark:bg-[#111a22] px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 border-t border-slate-100 dark:border-[#324d67]">
                        <button type="button" onclick="confirmLogout()"
                            class="inline-flex w-full justify-center rounded-xl bg-red-600 px-3 py-2 text-sm font-bold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto transition-all hover:shadow-lg hover:shadow-red-500/30">Yes,
                            Logout</button>
                        <button type="button" onclick="closeLogoutModal()"
                            class="mt-3 inline-flex w-full justify-center rounded-xl bg-white dark:bg-[#1a252f] px-3 py-2 text-sm font-bold text-slate-900 dark:text-white shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] hover:bg-slate-50 dark:hover:bg-[#233648] sm:mt-0 sm:w-auto transition-all">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="global-action-menu" class="dropdown-menu hidden fixed"></div>
</body>

</html>
