<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Prefix Expert Dashboard</title>
    <meta name="description" content="Prefix Expert Dashboard - Manage your questions and contributions." />
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#2b8cee",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101922",
                    },
                    fontFamily: {
                        "display": ["Inter"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                },
            },
        }
        function toggleSidebarMode() {
            const aside = document.querySelector('aside');
            const dot = document.getElementById('sidebar-toggle-dot');
            const toggleBtn = document.getElementById('sidebar-mode-toggle');
            const isPinned = aside.classList.toggle('sidebar-pinned');
            
            if (isPinned) {
                dot.style.backgroundColor = '#ef4444';
                dot.style.boxShadow = '0 0 15px rgba(239, 68, 68, 0.6)';
                toggleBtn.classList.add('pinned');
                toggleBtn.title = "Pinned Mode (Click to Animate)";
                localStorage.setItem('sidebarPinned', 'true');
            } else {
                dot.style.backgroundColor = '#0bda5b';
                dot.style.boxShadow = '0 0 15px rgba(11, 218, 91, 0.6)';
                toggleBtn.classList.remove('pinned');
                toggleBtn.title = "Animated Mode (Click to Pin)";
                localStorage.setItem('sidebarPinned', 'false');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('sidebarPinned') === 'true') {
                toggleSidebarMode();
            }
        });
    </script>
    <style type="text/tailwindcss">
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        *::-webkit-scrollbar {
            display: none !important;
        }
        * {
            -ms-overflow-style: none !important;
            scrollbar-width: none !important;
        }
        .theme-toggle-dark {
            opacity: 0;
            transform: scale(0.5) rotate(-90deg);
            transition: all 0.3s ease;
            position: absolute;
        }
        .theme-toggle-light {
            opacity: 1;
            transform: scale(1) rotate(0deg);
            transition: all 0.3s ease;
        }
        .dark .theme-toggle-dark {
            opacity: 1;
            transform: scale(1) rotate(0deg);
        }
        .dark .theme-toggle-light {
            opacity: 0;
            transform: scale(0.5) rotate(90deg);
        }
        .nav-link.active {
            color: #2b8cee;
            font-weight: 600;
        }
        .nav-link.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 20%;
            height: 60%;
            width: 3px;
            background: #2b8cee;
            border-radius: 0 4px 4px 0;
            box-shadow: 2px 0 8px rgba(43, 140, 238, 0.4);
            z-index: 10;
        }
        .nav-link:not(.active):hover::before {
            content: '';
            position: absolute;
            left: 0;
            top: 35%;
            height: 30%;
            width: 2px;
            background: rgba(43, 140, 238, 0.5);
            border-radius: 0 4px 4px 0;
            animation: bar-slide 0.3s ease-out forwards;
        }
        @keyframes bar-slide {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .nav-link:hover .material-symbols-outlined {
            font-variation-settings: 'FILL' 1;
            filter: drop-shadow(0 0 5px rgba(43, 140, 238, 0.3));
        }
        .nav-link:hover span:not(.material-symbols-outlined) {
            text-shadow: 0 0 10px rgba(43, 140, 238, 0.15);
        }
        aside.sidebar-pinned {
            width: 256px !important;
            transition: width 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        aside.sidebar-pinned > div {
            width: 256px !important;
            box-shadow: 4px 0 20px -10px rgba(0,0,0,0.05) !important;
            backdrop-filter: none !important;
            background-color: rgb(255 255 255);
        }
        .dark aside.sidebar-pinned > div {
            background-color: rgb(17 26 34);
            box-shadow: 4px 0 20px -10px rgba(0,0,0,0.3) !important;
        }
        aside.sidebar-pinned .opacity-0 {
            opacity: 1 !important;
            transform: translateX(0) !important;
        }
        aside:not(.sidebar-pinned) {
            transition: width 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        main {
            transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }
        #sidebar-mode-toggle.pinned {
            transform: rotate(180deg);
            border-color: rgba(239, 68, 68, 0.3);
        }
        .premium-glass {
            background: rgba(255, 255, 255, 0.7) !important;
            backdrop-filter: blur(16px) saturate(180%) !important;
            border: 1px solid rgba(255, 255, 255, 0.45) !important;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.05) !important;
        }
        .dark .premium-glass {
            background: rgba(17, 26, 34, 0.6) !important;
            border: 1px solid rgba(255, 255, 255, 0.08) !important;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3) !important;
        }
        @keyframes scale-in {
            from { opacity: 0; transform: scale(0.95) translateY(-10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        .animate-scale-in { animation: scale-in 0.2s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-slate-100 antialiased overflow-hidden selection:bg-primary/20 selection:text-primary">

    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="w-[72px] flex-shrink-0 hidden md:block relative z-40">
            <div class="group absolute top-0 left-0 h-screen w-[72px] hover:w-64 flex flex-col border-r border-slate-200/60 dark:border-slate-800/60 bg-white/90 dark:bg-[#111a22]/90 backdrop-blur-xl transition-all duration-500 cubic-bezier(0.16, 1, 0.3, 1) overflow-hidden hover:shadow-[10px_0_40px_-15px_rgba(0,0,0,0.1)] dark:hover:shadow-[10px_0_40px_-15px_rgba(0,0,0,0.4)]">
                <div class="py-6 flex flex-col items-start transition-all duration-500">
                    <div class="flex items-center h-12 w-full">
                        <div class="w-[72px] flex-shrink-0 flex items-center justify-center">
                            <span class="material-symbols-outlined text-3xl font-bold text-primary">diamond</span>
                        </div>
                        <div class="flex-1 flex items-center justify-between opacity-0 group-hover:opacity-100 translate-x-4 group-hover:translate-x-0 transition-all duration-500 whitespace-nowrap -ml-2 pr-6">
                            <div class="flex flex-col">
                                <h1 class="text-xl font-bold tracking-tight dark:text-white leading-tight">Prefix</h1>
                                <p class="text-slate-500 dark:text-[#92adc9] text-[10px] font-semibold uppercase tracking-wider">Expert Panel</p>
                            </div>
                            <button onclick="toggleSidebarMode()" id="sidebar-mode-toggle" class="w-6 h-6 rounded-full border border-slate-200 dark:border-slate-800 flex items-center justify-center bg-white dark:bg-[#1a252f] shadow-sm hover:scale-110 active:scale-95 transition-all group/toggle" title="Toggle Sidebar Mode">
                                <div id="sidebar-toggle-dot" class="w-1.5 h-1.5 rounded-full bg-[#0bda5b] shadow-[0_0_10px_rgba(11,218,91,0.8)] animate-pulse"></div>
                            </button>
                        </div>
                    </div>
                </div>
                <nav class="flex-1 px-3 mt-4 space-y-1.5">
                    <button class="nav-link w-full flex items-center gap-4 px-3 py-3 rounded-xl text-slate-500 dark:text-[#92adc9] hover:text-primary transition-all duration-300 active relative group/link overflow-hidden" id="nav-dashboard" onclick="switchPage('dashboard', this)">
                        <span class="material-symbols-outlined shrink-0 transition-all duration-300">dashboard</span>
                        <span class="opacity-0 group-hover:opacity-100 translate-x-4 group-hover:translate-x-0 transition-all duration-500 whitespace-nowrap font-medium">Dashboard</span>
                    </button>
                    <button class="nav-link w-full flex items-center gap-4 px-3 py-3 rounded-xl text-slate-500 dark:text-[#92adc9] hover:text-primary transition-all duration-300 relative group/link overflow-hidden" id="nav-questions" onclick="switchPage('questions', this)">
                        <span class="material-symbols-outlined shrink-0 transition-all duration-300">quiz</span>
                        <span class="opacity-0 group-hover:opacity-100 translate-x-4 group-hover:translate-x-0 transition-all duration-500 whitespace-nowrap font-medium">My Questions</span>
                    </button>
                    <div class="pt-6 mt-6 border-t border-slate-200/60 dark:border-slate-800/60">
                        <button id="nav-settings" onclick="switchPage('settings', this)" class="nav-link w-full flex items-center gap-4 px-3 py-3 rounded-xl text-slate-500 dark:text-[#92adc9] transition-all duration-300 relative group/link overflow-hidden">
                            <span class="material-symbols-outlined shrink-0 transition-all duration-300">settings</span>
                            <span class="opacity-0 group-hover:opacity-100 translate-x-4 group-hover:translate-x-0 transition-all duration-500 whitespace-nowrap font-medium">Settings</span>
                        </button>
                    </div>
                </nav>
                <div class="p-4 bg-primary/5 dark:bg-primary/10 m-3 rounded-2xl border border-primary/10 opacity-0 group-hover:opacity-100 translate-y-4 group-hover:translate-y-0 transition-all duration-500 overflow-hidden">
                    <p class="text-[10px] font-bold text-primary mb-2 whitespace-nowrap uppercase tracking-tighter">Contributor Progress</p>
                    <div class="w-full bg-slate-200 dark:bg-slate-700 h-1.5 rounded-full overflow-hidden">
                        <div class="bg-primary h-full w-[85%] shadow-[0_0_8px_rgba(43,140,238,0.5)]"></div>
                    </div>
                    <div class="flex items-center justify-between mt-2">
                        <p class="text-[0.625rem] text-slate-400 dark:text-slate-500 font-bold">850 / 1000 pts</p>
                        <p class="text-[0.625rem] text-primary font-black">Level 4</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 flex flex-col min-w-0 overflow-hidden">
            <!-- Header -->
            <header class="h-[72px] flex items-center justify-between px-8 bg-white dark:bg-[#111a22] border border-slate-200 dark:border-slate-800 rounded-2xl mx-4 mt-6 mb-2 flex-shrink-0 shadow-sm transition-all duration-300">
                <div class="flex items-center gap-4 flex-1">
                    <button class="md:hidden text-slate-500 hover:text-slate-700 dark:text-[#92adc9] transition-colors" onclick="toggleMobileSidebar()">
                        <span class="material-symbols-outlined">menu</span>
                    </button>
                    <div class="w-full max-w-sm hidden md:block">
                        <div class="relative">
                            <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 dark:text-[#92adc9] text-xl">search</span>
                            <input class="w-full bg-slate-50 dark:bg-[#1a252f] border-none rounded-lg py-2 pl-10 pr-4 text-sm focus:ring-2 focus:ring-primary/50 text-slate-900 dark:text-white placeholder:text-slate-500 dark:placeholder:text-[#92adc9]" placeholder="Search questions, IDs..." type="text"/>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-1">
                    <button class="relative w-10 h-10 flex items-center justify-center text-slate-500 dark:text-[#92adc9] hover:bg-slate-100 dark:hover:bg-[#233648] rounded-lg transition-colors group" onclick="toggleTheme()" title="Toggle Theme">
                        <span class="material-symbols-outlined theme-toggle-dark text-[22px]">light_mode</span>
                        <span class="material-symbols-outlined theme-toggle-light text-[22px]">dark_mode</span>
                    </button>
                    <div class="h-6 w-[1px] bg-slate-200 dark:bg-[#233648] mx-1"></div>
                    <button class="p-2 text-slate-500 dark:text-[#92adc9] hover:bg-slate-100 dark:hover:bg-[#233648] rounded-lg relative">
                        <span class="material-symbols-outlined">notifications</span>
                        <span class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-white dark:border-[#111a22]"></span>
                    </button>
                    <div class="h-8 w-[1px] bg-slate-200 dark:bg-[#233648] mx-2"></div>
                    <div class="relative">
                        <div class="flex items-center gap-3 pl-2 group cursor-pointer" onclick="toggleProfileDropdown()">
                            <div class="text-right hidden sm:block">
                                <p id="expert-name" class="text-sm font-semibold dark:text-white leading-tight">Loading...</p>
                                <p id="expert-role" class="text-[10px] text-slate-500 dark:text-[#92adc9] uppercase font-bold tracking-tight">...</p>
                            </div>
                            <div class="w-9 h-9 rounded-full bg-primary/20 flex items-center justify-center border border-primary/30 overflow-hidden">
                                <img id="expert-avatar" alt="Avatar" src="https://ui-avatars.com/api/?name=User&background=2b8cee&color=fff"/>
                            </div>
                        </div>
                        
                        <!-- Profile Dropdown -->
                        <div id="profile-dropdown" class="absolute right-0 mt-2 w-56 bg-white dark:bg-[#1a252f] rounded-xl shadow-xl border border-slate-200 dark:border-[#324d67] py-1 hidden z-50 animate-scale-in">
                            <div class="px-4 py-3 border-b border-slate-100 dark:border-[#324d67]">
                                <p id="dropdown-expert-name" class="text-sm font-bold dark:text-white truncate">Expert User</p>
                                <p id="dropdown-expert-email" class="text-[10px] text-slate-500 dark:text-[#92adc9] truncate">Loading...</p>
                            </div>
                            <button onclick="switchPage('profile'); fetchExpertProfile(); toggleProfileDropdown();" class="w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-white hover:bg-slate-50 dark:hover:bg-[#233648] flex items-center gap-2">
                                <span class="material-symbols-outlined text-lg">person</span> My Profile
                            </button>
                            <button onclick="switchPage('settings'); toggleProfileDropdown();" class="w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-white hover:bg-slate-50 dark:hover:bg-[#233648] flex items-center gap-2">
                                <span class="material-symbols-outlined text-lg">settings</span> Settings
                            </button>
                            <button onclick="handleLogout()" class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 flex items-center gap-2">
                                <span class="material-symbols-outlined text-lg">logout</span> Logout
                            </button>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Scrollable Content -->
            <div class="flex-1 overflow-y-auto custom-scrollbar p-6 md:p-8 scroll-smooth relative" id="main-scroll">

                <!-- PAGE: Dashboard Overview -->
                <div class="page-content" id="page-dashboard">
                    <div class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4">
                        <div>
                            <h2 class="text-2xl font-bold dark:text-white mb-1">Dashboard Overview</h2>
                            <p class="text-sm text-slate-500 dark:text-slate-400">Welcome back, Robert. Review your
                                latest contributions.</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="window.location.href='../bulk-entry.html'"
                                class="bg-white dark:bg-[#1a252f] text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700 px-4 py-2.5 rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-slate-50 dark:hover:bg-[#233648] transition-all shadow-sm">
                                <span class="material-symbols-outlined text-lg">edit_note</span>
                                <span class="hidden sm:inline">Builder Tool</span>
                            </button>
                            <button onclick="openModal('modal-bulk-upload')"
                                class="bg-white dark:bg-[#1a252f] text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700 px-4 py-2.5 rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-slate-50 dark:hover:bg-[#233648] transition-all shadow-sm">
                                <span class="material-symbols-outlined text-lg">upload_file</span>
                                <span class="hidden sm:inline">Bulk Upload</span>
                            </button>
                            <button onclick="openModal('modal-add-question')"
                                class="bg-primary hover:bg-primary-dark text-white px-5 py-2.5 rounded-lg font-semibold text-sm flex items-center gap-2 transition-all shadow-md shadow-primary/20">
                                <span class="material-symbols-outlined text-lg">add_circle</span>
                                <span>Create Question</span>
                            </button>
                        </div>
                    </div>

                    <!-- Stats Grid -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                        <!-- Card 1 -->
                        <div
                            class="bg-white dark:bg-[#111a22] p-5 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm hover:shadow-md transition-shadow group relative overflow-hidden">
                            <div class="absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity">
                                <span
                                    class="material-symbols-outlined text-6xl text-primary transform rotate-12">library_books</span>
                            </div>
                            <div class="flex justify-between items-start mb-4">
                                <div class="p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-primary">
                                    <span class="material-symbols-outlined text-xl">library_books</span>
                                </div>
                                <span
                                    class="text-emerald-500 text-xs font-bold flex items-center bg-emerald-50 dark:bg-emerald-900/20 px-2 py-1 rounded-full">
                                    +12% <span class="material-symbols-outlined text-[10px] ml-0.5">arrow_upward</span>
                                </span>
                            </div>
                            <p class="text-slate-500 dark:text-slate-400 text-xs font-medium uppercase tracking-wide">
                                Total Questions</p>
                            <h3 id="stat-total-questions" class="text-2xl font-bold dark:text-white mt-1">...</h3>
                        </div>

                        <!-- Card 2 -->
                        <div
                            class="bg-white dark:bg-[#111a22] p-5 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm hover:shadow-md transition-shadow group relative overflow-hidden">
                            <div class="absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity">
                                <span
                                    class="material-symbols-outlined text-6xl text-purple-500 transform rotate-12">checklist</span>
                            </div>
                            <div class="flex justify-between items-start mb-4">
                                <div
                                    class="p-2 bg-purple-50 dark:bg-purple-900/20 rounded-lg text-purple-600 dark:text-purple-400">
                                    <span class="material-symbols-outlined text-xl">checklist</span>
                                </div>
                                <span
                                    class="text-slate-400 text-xs font-bold bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-full">
                                    Total
                                </span>
                            </div>
                            <p class="text-slate-500 dark:text-slate-400 text-xs font-medium uppercase tracking-wide">My
                                Submissions</p>
                            <h3 id="stat-my-submissions" class="text-2xl font-bold dark:text-white mt-1">...</h3>
                        </div>

                        <!-- Card 3 -->
                        <div
                            class="bg-white dark:bg-[#111a22] p-5 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm hover:shadow-md transition-shadow group relative overflow-hidden">
                            <div class="absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity">
                                <span
                                    class="material-symbols-outlined text-6xl text-green-500 transform rotate-12">check_circle</span>
                            </div>
                            <div class="flex justify-between items-start mb-4">
                                <div
                                    class="p-2 bg-green-50 dark:bg-green-900/20 rounded-lg text-green-600 dark:text-green-400">
                                    <span class="material-symbols-outlined text-xl">check_circle</span>
                                </div>
                                <span
                                    class="text-emerald-500 text-xs font-bold bg-emerald-50 dark:bg-emerald-900/20 px-2 py-1 rounded-full">
                                    92% Accepted
                                </span>
                            </div>
                            <p class="text-slate-500 dark:text-slate-400 text-xs font-medium uppercase tracking-wide">
                                Live / Approved</p>
                            <h3 id="stat-approved" class="text-2xl font-bold dark:text-white mt-1">...</h3>
                        </div>

                        <!-- Card 4 -->
                        <div
                            class="bg-white dark:bg-[#111a22] p-5 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm hover:shadow-md transition-shadow group relative overflow-hidden">
                            <div class="absolute right-0 top-0 p-4 opacity-5 group-hover:opacity-10 transition-opacity">
                                <span
                                    class="material-symbols-outlined text-6xl text-orange-500 transform rotate-12">pending</span>
                            </div>
                            <div class="flex justify-between items-start mb-4">
                                <div
                                    class="p-2 bg-orange-50 dark:bg-orange-900/20 rounded-lg text-orange-600 dark:text-orange-400">
                                    <span class="material-symbols-outlined text-xl">pending</span>
                                </div>
                                <span
                                    class="text-orange-500 text-xs font-bold bg-orange-50 dark:bg-orange-900/20 px-2 py-1 rounded-full">
                                    Action Req
                                </span>
                            </div>
                            <p class="text-slate-500 dark:text-slate-400 text-xs font-medium uppercase tracking-wide">
                                Queue</p>
                            <h3 id="stat-queue" class="text-2xl font-bold dark:text-white mt-1">...</h3>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Chart Area -->
                        <div
                            class="lg:col-span-2 bg-white dark:bg-[#111a22] p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h3 class="font-bold text-lg dark:text-white">Activity Overview</h3>
                                    <p class="text-xs text-slate-500 dark:text-slate-400">Visualizing your contribution
                                        consistency.</p>
                                </div>
                                <select
                                    class="bg-slate-50 dark:bg-[#1a252f] border-none text-xs rounded-md text-slate-600 dark:text-slate-300 py-1.5 focus:ring-0 cursor-pointer">
                                    <option>Last 6 Months</option>
                                    <option>Last Year</option>
                                </select>
                            </div>
                            <div id="activity-chart" class="min-h-[200px] w-full"></div>
                        </div>

                        <!-- Side Widget -->
                        <div class="space-y-6">
                            <!-- Guidelines Widget -->
                            <div
                                class="bg-white dark:bg-[#111a22] p-6 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm relative overflow-hidden">
                                <div class="absolute top-0 right-0 p-3">
                                    <span
                                        class="material-symbols-outlined text-8xl text-slate-100 dark:text-slate-800/50 -rotate-12 translate-x-4 -translate-y-4">flag</span>
                                </div>
                                <h3 class="font-bold text-lg dark:text-white mb-4 relative z-10">Submission Rate</h3>
                                <div class="relative z-10">
                                    <div class="flex justify-between text-sm mb-2">
                                        <span class="text-slate-600 dark:text-slate-400">Acceptance Rate</span>
                                        <span class="font-bold text-emerald-500">92%</span>
                                    </div>
                                    <div class="w-full bg-slate-100 dark:bg-slate-800 h-2 rounded-full mb-4">
                                        <div class="bg-emerald-500 h-full w-[92%] rounded-full"></div>
                                    </div>

                                    <div class="flex justify-between text-sm mb-2">
                                        <span class="text-slate-600 dark:text-slate-400">Feedback Score</span>
                                        <span class="font-bold text-primary">4.8/5</span>
                                    </div>
                                    <div class="w-full bg-slate-100 dark:bg-slate-800 h-2 rounded-full mb-6">
                                        <div class="bg-primary h-full w-[96%] rounded-full"></div>
                                    </div>

                                    <button
                                        class="w-full py-2.5 rounded-lg border border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-300 text-sm font-semibold hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                        View Quality Report
                                    </button>
                                </div>
                            </div>

                            <!-- Notice Widget -->
                            <div
                                class="p-4 rounded-xl bg-orange-50 dark:bg-orange-900/10 border border-orange-100 dark:border-orange-900/20">
                                <div class="flex gap-3">
                                    <span class="material-symbols-outlined text-orange-500">info</span>
                                    <div>
                                        <h4 class="text-sm font-bold text-orange-800 dark:text-orange-200">Needs
                                            Attention</h4>
                                        <p class="text-xs text-orange-700 dark:text-orange-300 mt-1 leading-relaxed">
                                            2 questions were returned for review. Please check the "Rejected" tab in My
                                            Questions and update them.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PAGE: My Questions List -->
                <div class="page-content hidden" id="page-questions">
                    <!-- ... (Existing Questions Page Content) ... -->
                    <div class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4">
                        <div>
                            <h2 class="text-2xl font-bold dark:text-white mb-1">My Information Bank</h2>
                            <p class="text-sm text-slate-500 dark:text-slate-400">Manage, edit, and track status of your
                                questions.</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="window.location.href='../bulk-entry.html'"
                                class="bg-white dark:bg-[#1a252f] text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700 px-4 py-2.5 rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-slate-50 dark:hover:bg-[#233648] transition-all shadow-sm">
                                <span class="material-symbols-outlined text-lg">edit_note</span>
                                <span class="hidden sm:inline">Builder Tool</span>
                            </button>
                            <button onclick="openModal('modal-bulk-upload')"
                                class="bg-white dark:bg-[#1a252f] text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700 px-4 py-2.5 rounded-lg font-semibold text-sm flex items-center gap-2 hover:bg-slate-50 dark:hover:bg-[#233648] transition-all shadow-sm">
                                <span class="material-symbols-outlined text-lg">upload_file</span>
                                <span class="hidden sm:inline">Bulk Upload</span>
                            </button>
                            <button onclick="openModal('modal-add-question')"
                                class="bg-primary hover:bg-primary-dark text-white px-5 py-2.5 rounded-lg font-semibold text-sm flex items-center gap-2 transition-all shadow-md shadow-primary/20">
                                <span class="material-symbols-outlined text-lg">add_circle</span>
                                <span>Create Question</span>
                            </button>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div
                        class="bg-white dark:bg-[#111a22] p-4 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm mb-6 flex flex-wrap gap-4 items-center justify-between">
                        <!-- ... (Filters content) ... -->
                        <div
                            class="flex p-1 bg-slate-100 dark:bg-[#0b1117] rounded-xl border border-slate-200 dark:border-slate-800 shadow-inner">
                            <button onclick="filterStatus(this, 'all')"
                                class="status-btn status-active px-4 py-2 rounded-lg text-xs font-bold transition-all duration-200 bg-white dark:bg-primary text-primary dark:text-white shadow-sm ring-1 ring-slate-200 dark:ring-primary/20">
                                All Status
                            </button>
                            <button onclick="filterStatus(this, 'approved')"
                                class="status-btn px-4 py-2 rounded-lg text-xs font-bold transition-all duration-200 text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary">
                                Approved
                            </button>
                            <button onclick="filterStatus(this, 'moderation')"
                                class="status-btn px-4 py-2 rounded-lg text-xs font-bold transition-all duration-200 text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary">
                                Moderation
                            </button>
                            <button onclick="filterStatus(this, 'rejected')"
                                class="status-btn px-4 py-2 rounded-lg text-xs font-bold transition-all duration-200 text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary">
                                Rejected
                            </button>
                        </div>
                        <div class="flex items-center gap-3 w-full sm:w-auto">
                            <div class="relative w-full sm:w-64">
                                <span
                                    class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-lg">filter_alt</span>
                                <select id="filter-subject" onchange="applyFilters()"
                                    class="w-full bg-slate-50 dark:bg-[#1a252f] border border-slate-200 dark:border-slate-700 rounded-lg py-2 pl-10 pr-4 text-sm focus:ring-1 focus:ring-primary text-slate-700 dark:text-slate-300 appearance-none cursor-pointer">
                                    <option value="all">All Subjects</option>
                                    <option value="Chemistry">Chemistry</option>
                                    <option value="Physics">Physics</option>
                                    <option value="Mathematics">Mathematics</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Table -->
                    <div
                        class="bg-white dark:bg-[#111a22] rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full text-left border-collapse">
                                <thead>
                                    <tr
                                        class="bg-slate-50 dark:bg-[#1a252f] border-b border-slate-200 dark:border-slate-800">
                                        <th
                                            class="p-4 text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest w-16">
                                            ID</th>
                                        <th
                                            class="p-4 text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest min-w-[300px]">
                                            Question</th>
                                        <th
                                            class="p-4 text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest w-24 text-center">
                                            Language</th>
                                        <th
                                            class="p-4 text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest w-24 text-center">
                                            Role</th>
                                        <th
                                            class="p-4 text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest w-32 text-center">
                                            Class/Category</th>
                                        <th
                                            class="p-4 text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest w-32 text-center">
                                            Subject</th>
                                        <th
                                            class="p-4 text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest w-28 text-center">
                                            Status</th>
                                        <th
                                            class="p-4 text-[10px] font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest text-center w-28">
                                            Action</th>
                                    </tr>
                                </thead>
                                <tbody id="questions-table-body"
                                    class="divide-y divide-slate-100 dark:divide-slate-800 text-sm">
                                    <!-- Demo Item 1 -->
                                    <tr class="group hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                        <td class="p-4 font-mono text-slate-500 text-[11px]">#Q-1042</td>
                                        <td class="p-4">
                                            <p class="font-medium dark:text-white line-clamp-2 max-w-sm">What happens
                                                when Sodium reacts with water? Briefly explain the chemical reaction.
                                            </p>
                                        </td>
                                        <td class="p-4 text-center">
                                            <span
                                                class="text-xs font-semibold px-2 py-0.5 rounded bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400">English</span>
                                        </td>
                                        <td class="p-4 text-center">
                                            <span
                                                class="text-xs font-semibold text-slate-600 dark:text-slate-400 uppercase tracking-tight">Student</span>
                                        </td>
                                        <td class="p-4 text-center">
                                            <span class="text-xs text-slate-600 dark:text-slate-300">Class 12</span>
                                        </td>
                                        <td class="p-4 text-center text-slate-600 dark:text-slate-300">
                                            <span class="text-xs">Chemistry</span>
                                        </td>
                                        <td class="p-4 text-center">
                                            <span
                                                class="inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-[10px] font-black uppercase tracking-tighter bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400">
                                                <span class="w-1 h-1 rounded-full bg-emerald-500"></span> Approved
                                            </span>
                                        </td>
                                        <td class="p-4 text-center">
                                            <div class="flex justify-center gap-1">
                                                <button onclick="openModal('modal-add-question')"
                                                    class="p-1.5 hover:bg-emerald-500/10 text-emerald-500 rounded-lg transition-all"
                                                    title="Edit">
                                                    <span class="material-symbols-outlined text-lg">edit</span>
                                                </button>
                                                <button
                                                    onclick="Swal.fire({title:'Delete?', text:'This action cannot be undone.', icon:'warning', showCancelButton:true, confirmButtonColor:'#ef4444'})"
                                                    class="p-1.5 hover:bg-red-500/10 text-red-500 rounded-lg transition-all"
                                                    title="Delete">
                                                    <span class="material-symbols-outlined text-lg">delete</span>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>

                                    <!-- Demo Item 2: On Boarding -->
                                    <tr class="group hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                        <td class="p-4 font-mono text-slate-500 text-[11px]">#Q-1055</td>
                                        <td class="p-4">
                                            <p class="font-medium dark:text-white line-clamp-2 max-w-sm">Discuss the
                                                impact of the Industrial Revolution on urban society in the 19th
                                                century.</p>
                                        </td>
                                        <td class="p-4 text-center">
                                            <span
                                                class="text-xs font-semibold px-2 py-0.5 rounded bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400">English</span>
                                        </td>
                                        <td class="p-4 text-center">
                                            <span
                                                class="text-xs font-semibold text-slate-600 dark:text-slate-400 uppercase tracking-tight">Aspirant</span>
                                        </td>
                                        <td class="p-4 text-center">
                                            <span class="text-xs text-slate-600 dark:text-slate-300">WBCS</span>
                                        </td>
                                        <td class="p-4 text-center text-slate-600 dark:text-slate-300">
                                            <span class="text-xs">History</span>
                                        </td>
                                        <td class="p-4 text-center">
                                            <span
                                                class="inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-[10px] font-black uppercase tracking-tighter bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400">
                                                <span class="w-1 h-1 rounded-full bg-amber-500"></span> Moderation
                                            </span>
                                        </td>
                                        <td class="p-4 text-center">
                                            <div class="flex justify-center gap-1">
                                                <button onclick="openModal('modal-add-question')"
                                                    class="p-1.5 hover:bg-emerald-500/10 text-emerald-500 rounded-lg transition-all"
                                                    title="Edit">
                                                    <span class="material-symbols-outlined text-lg">edit</span>
                                                </button>
                                                <button
                                                    onclick="Swal.fire({title:'Delete?', text:'This action cannot be undone.', icon:'warning', showCancelButton:true, confirmButtonColor:'#ef4444'})"
                                                    class="p-1.5 hover:bg-red-500/10 text-red-500 rounded-lg transition-all"
                                                    title="Delete">
                                                    <span class="material-symbols-outlined text-lg">delete</span>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>

                                    <!-- Demo Item 3: Rejected -->
                                    <tr class="group hover:bg-slate-50 dark:hover:bg-[#1a252f] transition-colors">
                                        <td class="p-4 font-mono text-slate-500 text-[11px]">#Q-1061</td>
                                        <td class="p-4">
                                            <p class="font-medium dark:text-white line-clamp-2 max-w-sm">Solve the
                                                quadratic equation: xÂ² - 5x + 6 = 0 and find the roots.</p>
                                        </td>
                                        <td class="p-4 text-center">
                                            <span
                                                class="text-xs font-semibold px-2 py-0.5 rounded bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400">English</span>
                                        </td>
                                        <td class="p-4 text-center">
                                            <span
                                                class="text-xs font-semibold text-slate-600 dark:text-slate-400 uppercase tracking-tight">Student</span>
                                        </td>
                                        <td class="p-4 text-center">
                                            <span class="text-xs text-slate-600 dark:text-slate-300">Class 10</span>
                                        </td>
                                        <td class="p-4 text-center text-slate-600 dark:text-slate-300">
                                            <span class="text-xs">Mathematics</span>
                                        </td>
                                        <td class="p-4 text-center">
                                            <span
                                                class="inline-flex items-center gap-1.5 px-2 py-1 rounded-full text-[10px] font-black uppercase tracking-tighter bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400">
                                                <span class="w-1 h-1 rounded-full bg-red-500"></span> Rejected
                                            </span>
                                        </td>
                                        <td class="p-4 text-center">
                                            <div class="flex justify-center gap-1">
                                                <button onclick="openModal('modal-add-question')"
                                                    class="p-1.5 hover:bg-emerald-500/10 text-emerald-500 rounded-lg transition-all"
                                                    title="Edit">
                                                    <span class="material-symbols-outlined text-lg">edit</span>
                                                </button>
                                                <button
                                                    onclick="Swal.fire({title:'Delete?', text:'This action cannot be undone.', icon:'warning', showCancelButton:true, confirmButtonColor:'#ef4444'})"
                                                    class="p-1.5 hover:bg-red-500/10 text-red-500 rounded-lg transition-all"
                                                    title="Delete">
                                                    <span class="material-symbols-outlined text-lg">delete</span>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div
                            class="p-4 border-t border-slate-200 dark:border-slate-800 flex justify-between items-center">
                            <span id="questions-count" class="text-xs text-slate-500">Showing 1 of 1 questions</span>
                            <div class="flex gap-2">
                                <button
                                    class="px-3 py-1 text-xs font-medium rounded border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-[#1a252f] dark:text-slate-300 disabled:opacity-50"
                                    disabled>Previous</button>
                                <button
                                    class="px-3 py-1 text-xs font-medium rounded border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-[#1a252f] dark:text-slate-300">Next</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PAGE: My Profile -->
                <div class="page-content hidden" id="page-profile">
                    <div class="max-w-4xl mx-auto">
                        <div class="mb-8">
                            <h2 class="text-2xl font-bold dark:text-white mb-1">My Profile</h2>
                            <p class="text-sm text-slate-500 dark:text-slate-400">Manage your account details and public
                                information.</p>
                        </div>

                        <div
                            class="bg-white dark:bg-[#111a22] rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden">
                            <div class="relative h-32 bg-gradient-to-r from-primary to-blue-600">
                                <div class="absolute -bottom-10 left-8">
                                    <div
                                        class="w-24 h-24 rounded-full border-4 border-white dark:border-[#111a22] bg-white dark:bg-[#111a22] overflow-hidden">
                                        <img id="profile-page-avatar"
                                            src="https://ui-avatars.com/api/?name=User&background=random&size=128"
                                            class="w-full h-full object-cover">
                                    </div>
                                </div>
                            </div>
                            <div class="pt-12 px-8 pb-8">
                                <div class="flex justify-between items-start mb-6">
                                    <div>
                                        <h3 id="profile-page-name" class="text-xl font-bold dark:text-white">Loading...
                                        </h3>
                                        <p id="profile-page-role" class="text-sm text-slate-500 dark:text-slate-400">...
                                        </p>
                                    </div>
                                    <!-- Edit Button Removed -->
                                </div>

                                <!-- Profile Grid -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

                                    <!-- Card 1: Identity & Contact -->
                                    <div
                                        class="bg-slate-50 dark:bg-[#1a252f] rounded-xl p-6 border border-slate-200 dark:border-slate-700">
                                        <div
                                            class="flex items-center gap-2 mb-4 text-slate-800 dark:text-white border-b border-slate-200 dark:border-slate-700 pb-2">
                                            <span class="material-symbols-outlined text-primary">badge</span>
                                            <h4 class="font-bold text-sm uppercase tracking-wide">Identity & Contact
                                            </h4>
                                        </div>

                                        <div class="space-y-4">
                                            <!-- Full Name -->
                                            <div
                                                class="flex flex-col relative group hover:bg-slate-100 dark:hover:bg-[#233648] p-2 rounded-lg transition-colors -mx-2">
                                                <span
                                                    class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1 flex items-center gap-2">
                                                    Full Name
                                                    <button
                                                        class="opacity-0 group-hover:opacity-100 transition-opacity text-primary hover:text-primary-dark"
                                                        title="Edit Name">
                                                        <span class="material-symbols-outlined text-[14px]">edit</span>
                                                    </button>
                                                </span>
                                                <p id="profile-page-name-full"
                                                    class="text-sm font-semibold text-slate-700 dark:text-slate-200">
                                                    Loading...</p>
                                            </div>

                                            <!-- Email -->
                                            <div
                                                class="flex flex-col relative group hover:bg-slate-100 dark:hover:bg-[#233648] p-2 rounded-lg transition-colors -mx-2">
                                                <span
                                                    class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1 flex items-center gap-2">
                                                    Email Address
                                                    <button
                                                        class="opacity-0 group-hover:opacity-100 transition-opacity text-primary hover:text-primary-dark"
                                                        title="Edit Email">
                                                        <span class="material-symbols-outlined text-[14px]">edit</span>
                                                    </button>
                                                </span>
                                                <p id="profile-page-email"
                                                    class="text-sm font-semibold text-slate-700 dark:text-slate-200 break-all">
                                                    loading@example.com</p>
                                            </div>

                                            <!-- Phone -->
                                            <div
                                                class="flex flex-col relative group hover:bg-slate-100 dark:hover:bg-[#233648] p-2 rounded-lg transition-colors -mx-2">
                                                <span
                                                    class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1 flex items-center gap-2">
                                                    Phone Number
                                                    <button
                                                        class="opacity-0 group-hover:opacity-100 transition-opacity text-primary hover:text-primary-dark"
                                                        title="Edit Phone">
                                                        <span class="material-symbols-outlined text-[14px]">edit</span>
                                                    </button>
                                                </span>
                                                <p id="profile-page-phone"
                                                    class="text-sm font-semibold text-slate-700 dark:text-slate-200">Not
                                                    Provided</p>
                                            </div>

                                            <!-- Gender -->
                                            <div
                                                class="flex flex-col relative group hover:bg-slate-100 dark:hover:bg-[#233648] p-2 rounded-lg transition-colors -mx-2">
                                                <span
                                                    class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1 flex items-center gap-2">
                                                    Gender
                                                    <button
                                                        class="opacity-0 group-hover:opacity-100 transition-opacity text-primary hover:text-primary-dark"
                                                        title="Edit Gender">
                                                        <span class="material-symbols-outlined text-[14px]">edit</span>
                                                    </button>
                                                </span>
                                                <p id="profile-page-gender"
                                                    class="text-sm font-semibold text-slate-700 dark:text-slate-200">Not
                                                    Specified</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Card 2: Expertise & Credentials -->
                                    <div
                                        class="bg-slate-50 dark:bg-[#1a252f] rounded-xl p-6 border border-slate-200 dark:border-slate-700">
                                        <div
                                            class="flex items-center gap-2 mb-4 text-slate-800 dark:text-white border-b border-slate-200 dark:border-slate-700 pb-2">
                                            <span class="material-symbols-outlined text-purple-500">school</span>
                                            <h4 class="font-bold text-sm uppercase tracking-wide">Expertise &
                                                Credentials</h4>
                                        </div>

                                        <div class="space-y-4">
                                            <!-- Designation -->
                                            <div
                                                class="flex flex-col relative group hover:bg-slate-100 dark:hover:bg-[#233648] p-2 rounded-lg transition-colors -mx-2">
                                                <span
                                                    class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1 flex items-center gap-2">
                                                    Designation
                                                    <button
                                                        class="opacity-0 group-hover:opacity-100 transition-opacity text-primary hover:text-primary-dark"
                                                        title="Edit Designation">
                                                        <span class="material-symbols-outlined text-[14px]">edit</span>
                                                    </button>
                                                </span>
                                                <p id="profile-page-designation"
                                                    class="text-sm font-semibold text-slate-700 dark:text-slate-200">...
                                                </p>
                                            </div>

                                            <!-- Department -->
                                            <div
                                                class="flex flex-col relative group hover:bg-slate-100 dark:hover:bg-[#233648] p-2 rounded-lg transition-colors -mx-2">
                                                <span
                                                    class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1 flex items-center gap-2">
                                                    Department / Institution
                                                    <button
                                                        class="opacity-0 group-hover:opacity-100 transition-opacity text-primary hover:text-primary-dark"
                                                        title="Edit Department">
                                                        <span class="material-symbols-outlined text-[14px]">edit</span>
                                                    </button>
                                                </span>
                                                <p id="profile-page-dept"
                                                    class="text-sm font-semibold text-slate-700 dark:text-slate-200">...
                                                </p>
                                            </div>

                                            <!-- Core Specialization -->
                                            <div
                                                class="flex flex-col relative group hover:bg-slate-100 dark:hover:bg-[#233648] p-2 rounded-lg transition-colors -mx-2">
                                                <span
                                                    class="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1 flex items-center gap-2">
                                                    Core Specialization
                                                    <button
                                                        class="opacity-0 group-hover:opacity-100 transition-opacity text-primary hover:text-primary-dark"
                                                        title="Edit Specialization">
                                                        <span class="material-symbols-outlined text-[14px]">edit</span>
                                                    </button>
                                                </span>
                                                <div class="flex flex-wrap gap-2 mt-1" id="profile-page-spec-container">
                                                    <span id="profile-page-spec"
                                                        class="inline-flex items-center px-2.5 py-0.5 rounded-md text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300">
                                                        ...
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PAGE: Settings -->
                <div class="page-content hidden" id="page-settings">
                    <div class="max-w-2xl mx-auto">
                        <div class="mb-8">
                            <h2 class="text-2xl font-bold dark:text-white mb-1">Account Settings</h2>
                            <p class="text-sm text-slate-500 dark:text-slate-400">Manage your preferences and security.
                            </p>
                        </div>

                        <div
                            class="bg-white dark:bg-[#111a22] rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm divide-y divide-slate-100 dark:divide-slate-800">
                            <!-- Theme -->
                            <div class="p-6 flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium dark:text-white">Appearance</h4>
                                    <p class="text-sm text-slate-500">Customize how the dashboard looks on your device.
                                    </p>
                                </div>
                                <select
                                    onchange="if(this.value === 'dark') { document.documentElement.classList.add('dark'); localStorage.theme = 'dark'; } else { document.documentElement.classList.remove('dark'); localStorage.theme = 'light'; }"
                                    class="bg-slate-50 dark:bg-[#1a252f] border-slate-200 dark:border-slate-700 rounded-lg text-sm p-2 dark:text-white">
                                    <option value="light">Light Mode</option>
                                    <option value="dark">Dark Mode</option>
                                </select>
                            </div>

                            <!-- Password -->
                            <div class="p-6 flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium dark:text-white">Change Password</h4>
                                    <p class="text-sm text-slate-500">Update your password to keep your account secure.
                                    </p>
                                </div>
                                <button
                                    class="px-4 py-2 border border-slate-200 dark:border-slate-700 rounded-lg text-sm font-medium hover:bg-slate-50 dark:hover:bg-[#1a252f] dark:text-slate-300">Update</button>
                            </div>

                            <!-- Notifications -->
                            <div class="p-6 flex items-center justify-between">
                                <div>
                                    <h4 class="font-medium dark:text-white">Email Notifications</h4>
                                    <p class="text-sm text-slate-500">Receive emails about your question status updates.
                                    </p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" value="" class="sr-only peer" checked>
                                    <div
                                        class="w-11 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/20 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary">
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <div id="modal-add-question" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <div class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity opacity-0 modal-backdrop"
            id="modal-backdrop-add" onclick="resetAddQuestionForm(); closeModal('modal-add-question')"></div>
        <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-xl bg-white dark:bg-[#1a252f] text-left shadow-xl transition-all sm:my-8 w-[95%] sm:max-w-6xl min-h-[85vh] opacity-0 translate-y-4 sm:scale-95 modal-panel border border-slate-200 dark:border-[#324d67] flex flex-col"
                    id="modal-panel-add">

                    <!-- Header -->
                    <div
                        class="bg-slate-50 dark:bg-[#111a22] px-6 py-4 border-b border-slate-200 dark:border-[#324d67] flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-bold text-slate-900 dark:text-white">Create New Question</h3>
                            <p class="text-xs text-slate-500 dark:text-[#92adc9]">Configure parameters for the question
                                bank.</p>
                        </div>
                        <button type="button"
                            class="text-slate-400 hover:text-slate-500 dark:hover:text-slate-300 transition-colors"
                            onclick="resetAddQuestionForm(); closeModal('modal-add-question')">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>

                    <!-- Body -->
                    <div class="px-6 py-6 pb-2 flex-1 overflow-y-auto">
                        <form id="form-add-question" class="space-y-6 h-full">
                            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 h-full">

                                <!-- LEFT COLUMN: Parameters (4 cols) -->
                                <div
                                    class="lg:col-span-4 space-y-5 border-r border-slate-100 dark:border-[#324d67] pr-2 lg:pr-6">

                                    <!-- Language Toggle -->
                                    <div class="space-y-2">
                                        <label
                                            class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Language</label>
                                        <div
                                            class="grid grid-cols-2 gap-2 bg-slate-100 dark:bg-[#111a22] p-1 rounded-lg border border-slate-200 dark:border-[#324d67]">
                                            <label class="relative cursor-pointer text-center">
                                                <input type="radio" name="question_lang" value="Bengali"
                                                    class="peer sr-only" checked>
                                                <div
                                                    class="py-2 rounded-md text-xs font-bold transition-all peer-checked:bg-white dark:peer-checked:bg-primary peer-checked:text-primary dark:peer-checked:text-white text-slate-500 dark:text-[#92adc9] shadow-sm peer-checked:shadow">
                                                    Bengali</div>
                                            </label>
                                            <label class="relative cursor-pointer text-center">
                                                <input type="radio" name="question_lang" value="English"
                                                    class="peer sr-only">
                                                <div
                                                    class="py-2 rounded-md text-xs font-bold transition-all peer-checked:bg-white dark:peer-checked:bg-primary peer-checked:text-primary dark:peer-checked:text-white text-slate-500 dark:text-[#92adc9] shadow-sm peer-checked:shadow">
                                                    English</div>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Role Selection -->
                                    <div class="space-y-2">
                                        <label
                                            class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Target
                                            Role</label>
                                        <div class="grid grid-cols-2 gap-2">
                                            <label class="cursor-pointer">
                                                <input type="radio" name="target_role" value="student"
                                                    class="peer sr-only" checked onchange="toggleQRole('student')">
                                                <div
                                                    class="text-center p-2 rounded-lg border border-slate-200 dark:border-[#324d67] peer-checked:border-primary peer-checked:bg-primary/5 dark:peer-checked:bg-primary/10 transition-all">
                                                    <span
                                                        class="block text-xs font-bold text-slate-700 dark:text-white peer-checked:text-primary">Student</span>
                                                </div>
                                            </label>
                                            <label class="cursor-pointer">
                                                <input type="radio" name="target_role" value="aspirant"
                                                    class="peer sr-only" onchange="toggleQRole('aspirant')">
                                                <div
                                                    class="text-center p-2 rounded-lg border border-slate-200 dark:border-[#324d67] peer-checked:border-primary peer-checked:bg-primary/5 dark:peer-checked:bg-primary/10 transition-all">
                                                    <span
                                                        class="block text-xs font-bold text-slate-700 dark:text-white peer-checked:text-primary">Aspirant</span>
                                                </div>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- Dynamic Parameter Sections -->
                                    <div class="relative min-h-[140px]">
                                        <!-- Student Specifics -->
                                        <div id="param-student"
                                            class="space-y-4 transition-all duration-300 transform opacity-100 translate-x-0">
                                            <div class="space-y-2">
                                                <label
                                                    class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Class
                                                    Level</label>
                                                <select name="student_class" id="q-student-class"
                                                    class="w-full bg-slate-50 dark:bg-[#111a22] border-slate-200 dark:border-[#324d67] rounded-lg text-xs p-2.5 dark:text-white focus:ring-primary"
                                                    onchange="handleStudentClassChange(this.options[this.selectedIndex].getAttribute('data-id'))">
                                                    <option value="" selected disabled>Loading Classes...</option>
                                                </select>
                                            </div>
                                            <div class="space-y-2">
                                                <label
                                                    class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Subject</label>
                                                <select name="student_subject" id="q-student-subject"
                                                    class="w-full bg-slate-50 dark:bg-[#111a22] border-slate-200 dark:border-[#324d67] rounded-lg text-xs p-2.5 dark:text-white focus:ring-primary">
                                                    <option value="" selected disabled>Select Class First</option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- Aspirant Specifics -->
                                        <div id="param-aspirant"
                                            class="hidden space-y-4 transition-all duration-300 transform opacity-0 translate-x-4 absolute inset-0">
                                            <div class="space-y-2">
                                                <label
                                                    class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Exam
                                                    Category</label>
                                                <select name="aspirant_exam_category" id="q-aspirant-exam-category"
                                                    class="w-full bg-slate-50 dark:bg-[#111a22] border-slate-200 dark:border-[#324d67] rounded-lg text-xs p-2.5 dark:text-white focus:ring-primary"
                                                    onchange="handleAspirantCategoryChange(this.options[this.selectedIndex].getAttribute('data-id'))">
                                                    <option value="">Loading...</option>
                                                </select>
                                            </div>
                                            <div class="space-y-2">
                                                <label
                                                    class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Subject</label>
                                                <select name="aspirant_subject" id="q-aspirant-subject"
                                                    class="w-full bg-slate-50 dark:bg-[#111a22] border-slate-200 dark:border-[#324d67] rounded-lg text-xs p-2.5 dark:text-white focus:ring-primary">
                                                    <option value="">Loading...</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Difficulty -->
                                    <div class="space-y-2">
                                        <label
                                            class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Difficulty</label>
                                        <div class="flex gap-2">
                                            <label class="cursor-pointer flex-1">
                                                <input type="radio" name="difficulty" value="Easy" class="peer sr-only">
                                                <span
                                                    class="block text-center text-[10px] font-bold py-1.5 rounded bg-slate-100 dark:bg-[#1a252f] text-slate-500 peer-checked:bg-green-100 peer-checked:text-green-600 dark:peer-checked:bg-green-900/30 dark:peer-checked:text-green-400">Easy</span>
                                            </label>
                                            <label class="cursor-pointer flex-1">
                                                <input type="radio" name="difficulty" value="Medium"
                                                    class="peer sr-only" checked>
                                                <span
                                                    class="block text-center text-[10px] font-bold py-1.5 rounded bg-slate-100 dark:bg-[#1a252f] text-slate-500 peer-checked:bg-yellow-100 peer-checked:text-yellow-600 dark:peer-checked:bg-yellow-900/30 dark:peer-checked:text-yellow-400">Medium</span>
                                            </label>
                                            <label class="cursor-pointer flex-1">
                                                <input type="radio" name="difficulty" value="Hard" class="peer sr-only">
                                                <span
                                                    class="block text-center text-[10px] font-bold py-1.5 rounded bg-slate-100 dark:bg-[#1a252f] text-slate-500 peer-checked:bg-red-100 peer-checked:text-red-600 dark:peer-checked:bg-red-900/30 dark:peer-checked:text-red-400">Hard</span>
                                            </label>
                                        </div>
                                    </div>

                                </div>

                                <!-- RIGHT COLUMN: Content (8 cols) -->
                                <div class="lg:col-span-8 space-y-5 h-full flex flex-col">

                                    <div class="space-y-2">
                                        <label
                                            class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Question
                                            Content</label>
                                        <textarea name="question_text" rows="3"
                                            class="w-full bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] rounded-xl text-sm p-4 dark:text-white placeholder:text-slate-400 focus:ring-2 focus:ring-primary/50 outline-none resize-none"
                                            placeholder="Type your question here..."></textarea>
                                    </div>

                                    <div class="space-y-3 flex-1">
                                        <label
                                            class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500 flex justify-between">
                                            <span>Options</span>
                                            <span class="text-[10px] normal-case font-normal text-slate-400">Check the
                                                correct answer</span>
                                        </label>

                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                            <!-- Option A -->
                                            <div class="relative group">
                                                <div
                                                    class="absolute left-3 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-400 group-focus-within:text-primary">
                                                    A</div>
                                                <input type="text" name="option_a"
                                                    class="block w-full rounded-lg border border-slate-200 dark:border-[#324d67] bg-white dark:bg-[#16202a] py-2.5 pl-8 pr-10 text-sm text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary"
                                                    placeholder="Option A">
                                                <div class="absolute right-3 top-1/2 -translate-y-1/2">
                                                    <input type="radio" name="correct_answer" value="a"
                                                        class="h-4 w-4 border-slate-300 text-primary focus:ring-primary cursor-pointer">
                                                </div>
                                            </div>
                                            <!-- Option B -->
                                            <div class="relative group">
                                                <div
                                                    class="absolute left-3 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-400 group-focus-within:text-primary">
                                                    B</div>
                                                <input type="text" name="option_b"
                                                    class="block w-full rounded-lg border border-slate-200 dark:border-[#324d67] bg-white dark:bg-[#16202a] py-2.5 pl-8 pr-10 text-sm text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary"
                                                    placeholder="Option B">
                                                <div class="absolute right-3 top-1/2 -translate-y-1/2">
                                                    <input type="radio" name="correct_answer" value="b"
                                                        class="h-4 w-4 border-slate-300 text-primary focus:ring-primary cursor-pointer">
                                                </div>
                                            </div>
                                            <!-- Option C -->
                                            <div class="relative group">
                                                <div
                                                    class="absolute left-3 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-400 group-focus-within:text-primary">
                                                    C</div>
                                                <input type="text" name="option_c"
                                                    class="block w-full rounded-lg border border-slate-200 dark:border-[#324d67] bg-white dark:bg-[#16202a] py-2.5 pl-8 pr-10 text-sm text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary"
                                                    placeholder="Option C">
                                                <div class="absolute right-3 top-1/2 -translate-y-1/2">
                                                    <input type="radio" name="correct_answer" value="c"
                                                        class="h-4 w-4 border-slate-300 text-primary focus:ring-primary cursor-pointer">
                                                </div>
                                            </div>
                                            <!-- Option D -->
                                            <div class="relative group">
                                                <div
                                                    class="absolute left-3 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-400 group-focus-within:text-primary">
                                                    D</div>
                                                <input type="text" name="option_d"
                                                    class="block w-full rounded-lg border border-slate-200 dark:border-[#324d67] bg-white dark:bg-[#16202a] py-2.5 pl-8 pr-10 text-sm text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary"
                                                    placeholder="Option D">
                                                <div class="absolute right-3 top-1/2 -translate-y-1/2">
                                                    <input type="radio" name="correct_answer" value="d"
                                                        class="h-4 w-4 border-slate-300 text-primary focus:ring-primary cursor-pointer">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="space-y-2">
                                        <label
                                            class="block text-xs font-black dark:text-white uppercase tracking-wider text-slate-500">Explanation
                                            (Optional)</label>
                                        <textarea name="explanation" rows="2"
                                            class="w-full bg-slate-50 dark:bg-[#111a22] border border-slate-200 dark:border-[#324d67] rounded-xl text-xs p-3 dark:text-white placeholder:text-slate-400 focus:ring-primary outline-none"
                                            placeholder="Reasoning for the correct answer..."></textarea>
                                    </div>

                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Footer -->
                    <div
                        class="bg-slate-50 dark:bg-[#111a22] px-6 py-4 sm:flex items-center justify-between border-t border-slate-200 dark:border-[#324d67] mt-auto">
                        <div class="flex gap-2">
                            <input type="file" id="bulk-upload-modal-input" class="hidden" accept=".json"
                                onchange="handleBulkUploadContextual(this)">
                            <button type="button"
                                class="text-xs font-bold text-slate-600 dark:text-[#92adc9] hover:text-primary dark:hover:text-white flex items-center gap-1.5 transition-all"
                                onclick="document.getElementById('bulk-upload-modal-input').click()">
                                <span class="material-symbols-outlined text-lg">upload_file</span>
                                Bulk Upload
                            </button>
                        </div>
                        <div class="flex gap-3 mt-4 sm:mt-0">
                            <button type="button" onclick="handleAddQuestion()"
                                class="inline-flex w-full justify-center rounded-lg bg-primary px-6 py-2.5 text-sm font-bold text-white shadow-lg shadow-primary/20 hover:bg-primary/90 sm:ml-3 sm:w-auto transition-all">Create
                                Question</button>
                            <button type="button"
                                class="mt-3 inline-flex w-full justify-center rounded-lg bg-white dark:bg-[#1a252f] px-6 py-2.5 text-sm font-bold text-slate-700 dark:text-[#92adc9] shadow-sm ring-1 ring-inset ring-slate-300 dark:ring-[#324d67] hover:bg-slate-50 dark:hover:bg-[#233648] sm:mt-0 sm:w-auto transition-all"
                                onclick="resetAddQuestionForm(); closeModal('modal-add-question')">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: BULK UPLOAD -->
    <div id="modal-bulk-upload" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <!-- Backdrop -->
        <div class="fixed inset-0 bg-slate-900/75 backdrop-blur-sm transition-opacity opacity-0 modal-backdrop"
            id="modal-backdrop-bulk" onclick="closeModal('modal-bulk-upload')"></div>

        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center">
                <div class="relative transform overflow-hidden rounded-xl bg-white dark:bg-[#111a22] text-left shadow-2xl transition-all w-full max-w-lg opacity-0 translate-y-4 sm:scale-95 modal-panel"
                    id="modal-panel-bulk">
                    <div class="p-6 pb-0">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold dark:text-white flex items-center gap-2">
                                <span class="material-symbols-outlined text-purple-500">upload_file</span> Bulk Upload
                            </h3>
                            <button onclick="closeModal('modal-bulk-upload')"
                                class="text-slate-400 hover:text-slate-500 dark:hover:text-slate-300">
                                <span class="material-symbols-outlined">close</span>
                            </button>
                        </div>
                    </div>

                    <!-- Parameter Selection for Template -->
                    <div
                        class="px-6 py-4 border-y border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-[#1a252f]/30">
                        <h4
                            class="text-xs font-bold text-primary flex items-center gap-2 uppercase tracking-wider mb-4">
                            <span class="material-symbols-outlined text-sm">tune</span> Template Configuration
                        </h4>

                        <!-- Language -->
                        <div class="mb-4">
                            <label
                                class="block text-[10px] font-bold uppercase tracking-widest text-slate-500 dark:text-slate-400 mb-2">Language</label>
                            <div class="flex gap-4">
                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <input type="radio" name="bulk_lang" value="english"
                                        class="text-primary focus:ring-primary bg-white dark:bg-[#1a252f] border-slate-300 dark:border-slate-600 cursor-pointer"
                                        checked>
                                    <span
                                        class="text-sm text-slate-700 dark:text-slate-300 group-hover:text-primary transition-colors">English</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <input type="radio" name="bulk_lang" value="bengali"
                                        class="text-primary focus:ring-primary bg-white dark:bg-[#1a252f] border-slate-300 dark:border-slate-600 cursor-pointer">
                                    <span
                                        class="text-sm text-slate-700 dark:text-slate-300 group-hover:text-primary transition-colors">Bengali</span>
                                </label>
                            </div>
                        </div>

                        <!-- Role -->
                        <div class="mb-4">
                            <label
                                class="block text-[10px] font-bold uppercase tracking-widest text-slate-500 dark:text-slate-400 mb-2">Audience</label>
                            <div class="flex gap-4">
                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <input type="radio" name="bulk_role" value="aspirant"
                                        class="text-primary focus:ring-primary bg-white dark:bg-[#1a252f] border-slate-300 dark:border-slate-600 cursor-pointer"
                                        checked>
                                    <span
                                        class="text-sm text-slate-700 dark:text-slate-300 group-hover:text-primary transition-colors">Aspirant</span>
                                </label>
                                <label class="flex items-center gap-2 cursor-pointer group">
                                    <input type="radio" name="bulk_role" value="student"
                                        class="text-primary focus:ring-primary bg-white dark:bg-[#1a252f] border-slate-300 dark:border-slate-600 cursor-pointer">
                                    <span
                                        class="text-sm text-slate-700 dark:text-slate-300 group-hover:text-primary transition-colors">Student</span>
                                </label>
                            </div>
                        </div>

                        <!-- Dynamic Fields Container -->
                        <div id="bulk-fields-aspirant" class="grid grid-cols-2 gap-4 mb-4">
                            <!-- Aspirant Fields -->
                            <div>
                                <label
                                    class="block text-[10px] font-bold uppercase tracking-widest text-slate-500 dark:text-slate-400 mb-1">Exam
                                    Category</label>
                                <select id="bulk-exam-cat"
                                    class="w-full bg-white dark:bg-[#111a22] border border-slate-200 dark:border-slate-700 rounded-lg px-2 py-1.5 text-xs text-slate-700 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary outline-none"
                                    onchange="handleBulkCategoryChange(this.options[this.selectedIndex].getAttribute('data-id'))">
                                    <option value="">Select Exam</option>
                                </select>
                            </div>
                            <div>
                                <label
                                    class="block text-[10px] font-bold uppercase tracking-widest text-slate-500 dark:text-slate-400 mb-1">Subject</label>
                                <select id="bulk-exam-sub"
                                    class="w-full bg-white dark:bg-[#111a22] border border-slate-200 dark:border-slate-700 rounded-lg px-2 py-1.5 text-xs text-slate-700 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary outline-none">
                                    <option value="">Select Subject</option>
                                </select>
                            </div>
                        </div>

                        <div id="bulk-fields-student" class="grid grid-cols-2 gap-4 mb-4 hidden">
                            <!-- Student Fields -->
                            <div>
                                <label
                                    class="block text-[10px] font-bold uppercase tracking-widest text-slate-500 dark:text-slate-400 mb-1">Class</label>
                                <select id="bulk-class-cat"
                                    class="w-full bg-white dark:bg-[#111a22] border border-slate-200 dark:border-slate-700 rounded-lg px-2 py-1.5 text-xs text-slate-700 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary outline-none"
                                    onchange="handleBulkClassChange(this.options[this.selectedIndex].getAttribute('data-id'))">
                                    <option value="">Select Class</option>
                                </select>
                            </div>
                            <div>
                                <label
                                    class="block text-[10px] font-bold uppercase tracking-widest text-slate-500 dark:text-slate-400 mb-1">Subject</label>
                                <select id="bulk-class-sub"
                                    class="w-full bg-white dark:bg-[#111a22] border border-slate-200 dark:border-slate-700 rounded-lg px-2 py-1.5 text-xs text-slate-700 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary outline-none">
                                    <option value="">Select Subject</option>
                                </select>
                            </div>
                        </div>

                        <button type="button" onclick="downloadTemplate()"
                            class="w-full py-2 bg-primary hover:bg-primary-dark text-white rounded-lg text-xs font-bold transition-colors shadow-lg shadow-primary/20 flex items-center justify-center gap-2 mb-4">
                            <span class="material-symbols-outlined text-sm">download</span> Download Custom Template
                        </button>

                        <!-- Live Preview (Hidden) -->
                        <div id="bulk-preview-container"
                            class="mt-4 p-3 bg-slate-900 rounded-lg border border-slate-700 overflow-hidden hidden">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Template
                                    Preview</span>
                                <span class="text-[10px] text-primary font-bold">Auto-updates</span>
                            </div>
                            <pre id="template-preview"
                                class="text-[10px] text-emerald-400 font-mono overflow-x-auto max-h-32 custom-scrollbar focus:outline-none">{
    "loading": "Select parameters..."
}</pre>
                        </div>
                    </div>

                    <div class="p-6 pt-4">
                        <div class="border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl p-8 text-center bg-slate-50 dark:bg-[#1a252f]/50 hover:bg-slate-100 dark:hover:bg-[#1a252f] transition-colors cursor-pointer group"
                            onclick="document.getElementById('bulk-upload-input').click()"
                            ondragover="event.preventDefault()" ondrop="handleDrop(event)">
                            <input type="file" id="bulk-upload-input" class="hidden" accept=".json"
                                onchange="handleFileSelect(this)">
                            <span
                                class="material-symbols-outlined text-4xl text-slate-400 group-hover:text-primary transition-colors mb-2">cloud_upload</span>
                            <p id="upload-text" class="text-sm font-semibold text-slate-700 dark:text-slate-300">Click
                                to upload or drag & drop</p>
                            <p class="text-xs text-slate-500 mt-1">JSON files only</p>
                        </div>
                    </div>
                    <div class="bg-slate-50 dark:bg-[#1a252f] px-6 py-4 flex justify-end">
                        <button onclick="processBulkUpload()"
                            class="bg-primary text-white text-sm font-bold px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors">Start
                            Upload</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        // --- Mobile Sidebar Logic ---
        function toggleMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-sidebar-overlay');

            if (sidebar.classList.contains('hidden')) {
                // Show
                sidebar.classList.remove('hidden');
                setTimeout(() => {
                    sidebar.classList.remove('-translate-x-full');
                    overlay.classList.remove('hidden');
                    setTimeout(() => overlay.classList.remove('opacity-0'), 10);
                }, 10);
            } else {
                // Hide
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => {
                    sidebar.classList.add('hidden');
                    overlay.classList.add('hidden');
                }, 300);
            }
        }

        // --- Navigation Logic ---
        function switchPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(el => el.classList.add('hidden'));

            // Show target page
            const target = document.getElementById('page-' + pageId);
            if (target) target.classList.remove('hidden');

            // Update Nav State
            document.querySelectorAll('.nav-link').forEach(el => {
                el.classList.remove('bg-primary/5', 'text-primary', 'active');
                el.querySelector('.material-symbols-outlined').classList.remove('icon-filled');
            });

            const activeBtn = document.getElementById('nav-' + pageId);
            if (activeBtn) {
                activeBtn.classList.add('bg-primary/5', 'text-primary', 'active');
                activeBtn.querySelector('.material-symbols-outlined').classList.add('icon-filled');
            }

            // Mobile menu close (simulated)
        }

        // --- Theme Logic ---
        function toggleTheme() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
            renderActivityChart(); // Re-render chart for color adaptation
        }

        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        // --- Modal Logic ---
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;

            modal.classList.remove('hidden');
            modal.classList.add('flex');

            // Trigger animations
            setTimeout(() => {
                modal.querySelector('.modal-backdrop')?.classList.replace('opacity-0', 'opacity-100');
                modal.querySelector('.modal-panel')?.classList.replace('opacity-0', 'opacity-100');
                modal.querySelector('.modal-panel')?.classList.replace('translate-y-4', 'translate-y-0');
                modal.querySelector('.modal-panel')?.classList.replace('sm:scale-95', 'sm:scale-100');
            }, 10);
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;

            modal.querySelector('.modal-backdrop')?.classList.replace('opacity-100', 'opacity-0');
            modal.querySelector('.modal-panel')?.classList.replace('opacity-100', 'opacity-0');
            modal.querySelector('.modal-panel')?.classList.replace('translate-y-0', 'translate-y-4');
            modal.querySelector('.modal-panel')?.classList.replace('sm:scale-100', 'sm:scale-95');

            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }, 300); // Wait for transition
        }


        function downloadTemplate() {
            try {
                console.log('downloadTemplate triggered');
                const langInput = document.querySelector('input[name="bulk_lang"]:checked');
                const lang = langInput ? langInput.value : 'english';
                const roleInput = document.querySelector('input[name="bulk_role"]:checked');
                const role = roleInput ? roleInput.value : 'aspirant';

                let category = '';
                let subject = '';

                if (role === 'aspirant') {
                    const elCat = document.getElementById('bulk-exam-cat');
                    const elSub = document.getElementById('bulk-exam-sub');
                    category = elCat ? elCat.value : '';
                    subject = elSub ? elSub.value : '';
                } else {
                    const elCat = document.getElementById('bulk-class-cat');
                    const elSub = document.getElementById('bulk-class-sub');
                    category = elCat ? elCat.value : '';
                    subject = elSub ? elSub.value : '';
                }

                if (!category || category.trim() === "" || !subject || subject.trim() === "") {
                    Swal.fire({ title: 'Selection Required', text: 'Please select both a Category/Class and a Subject.', icon: 'warning' });
                    return;
                }

                console.log('Calling generateAndDownloadJSON with:', { role, lang, category, subject });
                generateAndDownloadJSON(role, lang, category, subject);

            } catch (err) {
                console.error('Download initiation failed:', err);
                alert('Download Error: ' + err.message);
            }
        }

        function generateAndDownloadJSON(role, lang, category, subject) {
            try {
                // Create a contextual example based on parameters
                let exampleText = "Sample Question Text";
                const subLower = (subject || '').toString().toLowerCase();

                if (subLower.includes('math')) exampleText = "What is the value of pi to 2 decimal places?";
                else if (subLower.includes('english')) exampleText = "Choose the correct synonym for 'Happy'.";
                else if (subLower.includes('science')) exampleText = "What is the SI unit of force?";
                else if (subLower.includes('history') || subLower.includes('gk')) exampleText = "Who was the first Governor General of India?";

                const template = [
                    {
                        "template_version": "2026.02.09.V5",
                        "question_text": exampleText,
                        "option_a": "Option A",
                        "option_b": "Option B",
                        "option_c": "Option C",
                        "option_d": "Option D",
                        "correct_answer": "A",
                        "explanation": "Explanation of why A is correct...",
                        "language": lang.charAt(0).toUpperCase() + lang.slice(1),
                        "role": role,
                        ...(role === 'student' ? { "class": category } : { "exam_category": category }),
                        "subject": subject
                    }
                ];

                const sanitize = (str) => (str || '').toString().replace(/[^a-z0-9]/gi, '_').toLowerCase();
                const filename = `prefix_template_${role}_${sanitize(category)}_${sanitize(subject)}.json`;

                const blob = new Blob([JSON.stringify(template, null, 2)], { type: 'application/json' });
                const url = window.URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();

                setTimeout(() => {
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                }, 100);

            } catch (err) {
                console.error('File generation failed:', err);
                alert('JSON Error: ' + err.message);
            }
        }


        // --- Charts ---
        let activityChart;
        function renderActivityChart() {
            const isDark = document.documentElement.classList.contains('dark');
            const options = {
                series: [{
                    name: "Approved",
                    data: [31, 40, 28, 51, 42, 109, 100]
                }, {
                    name: "Pending",
                    data: [11, 32, 45, 32, 34, 52, 41]
                }],
                chart: {
                    height: 235,
                    type: 'area',
                    fontFamily: 'Inter, sans-serif',
                    toolbar: { show: false },
                    background: 'transparent'
                },
                colors: ['#2b8cee', '#f59e0b'],
                dataLabels: { enabled: false },
                stroke: {
                    curve: 'smooth',
                    width: 2
                },
                xaxis: {
                    categories: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul"],
                    labels: { style: { colors: isDark ? '#94a3b8' : '#64748b' } },
                    axisBorder: { show: false },
                    axisTicks: { show: false }
                },
                yaxis: {
                    labels: { style: { colors: isDark ? '#94a3b8' : '#64748b' } }
                },
                grid: {
                    borderColor: isDark ? '#334155' : '#e2e8f0',
                    strokeDashArray: 4,
                },
                legend: {
                    labels: { colors: isDark ? '#fff' : '#000' }
                },
                tooltip: {
                    theme: isDark ? 'dark' : 'light'
                }
            };

            const chartEl = document.querySelector("#activity-chart");
            if (chartEl) {
                chartEl.innerHTML = '';
                activityChart = new ApexCharts(chartEl, options);
                activityChart.render();
            }
        }




        // --- Bulk Upload Form Logic ---
        function toggleBulkRoleFields() {
            const roleInput = document.querySelector('input[name="bulk_role"]:checked');
            if (!roleInput) return;

            const role = roleInput.value;
            const fieldsAspirant = document.getElementById('bulk-fields-aspirant');
            const fieldsStudent = document.getElementById('bulk-fields-student');

            if (role === 'aspirant') {
                fieldsAspirant.classList.remove('hidden');
                fieldsStudent.classList.add('hidden');
            } else {
                fieldsAspirant.classList.add('hidden');
                fieldsStudent.classList.remove('hidden');
            }
        }

        // --- Bulk Upload Processing Logic ---
        let selectedFile = null;

        function handleFileSelect(input) {
            if (input.files && input.files[0]) {
                selectedFile = input.files[0];
                document.getElementById('upload-text').innerText = selectedFile.name;
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                selectedFile = e.dataTransfer.files[0];
                document.getElementById('upload-text').innerText = selectedFile.name;

                // Update input for consistency
                const input = document.getElementById('bulk-upload-input');
                input.files = e.dataTransfer.files;
            }
        }

        async function processBulkUpload() {
            if (!selectedFile) {
                Swal.fire({ title: 'No File Selected', text: 'Please choose a JSON file to upload.', icon: 'warning' });
                return;
            }

            const btn = document.querySelector('button[onclick="processBulkUpload()"]');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<span class="material-symbols-outlined animate-spin text-sm">sync</span> Processing...`;

            const reader = new FileReader();
            reader.onload = async function (e) {
                try {
                    const jsonContent = JSON.parse(e.target.result);
                    if (!Array.isArray(jsonContent)) throw new Error("File must be a list of questions (Array).");

                    let successCount = 0;
                    let failCount = 0;
                    const errors = [];

                    for (const q of jsonContent) {
                        try {
                            const payload = {
                                language: q.language || q.lang || 'English',
                                role: q.role || 'aspirant',
                                question_text: q.question_text || q.text,
                                option_a: q.option_a || q.a,
                                option_b: q.option_b || q.b,
                                option_c: q.option_c || q.c,
                                option_d: q.option_d || q.d,
                                correct_answer: q.correct_answer || q.ans,
                                explanation: q.explanation || q.solution || '',
                                // Handle conditional logic for roles
                                ...(q.role === 'student' ? { class: q.class, subject: q.subject } : { exam_category: q.exam_category || q.category, subject: q.subject })
                            };

                            // Fallback to UI Values if missing in JSON
                            if (!payload.language) payload.language = document.querySelector('input[name="bulk_lang"]:checked')?.value || 'English';
                            if (!payload.role) payload.role = document.querySelector('input[name="bulk_role"]:checked')?.value || 'aspirant';

                            if (payload.role === 'aspirant') {
                                if (!payload.exam_category) payload.exam_category = document.getElementById('bulk-exam-cat').value;
                                if (!payload.subject) payload.subject = document.getElementById('bulk-exam-sub').value;
                            } else {
                                if (!payload.class) payload.class = document.getElementById('bulk-class-cat').value;
                                if (!payload.subject) payload.subject = document.getElementById('bulk-class-sub').value;
                            }


                            const response = await fetch('../api/add_question.php', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(payload)
                            });

                            const result = await response.json();
                            if (result.status === 'success') {
                                successCount++;
                            } else {
                                failCount++;
                                errors.push(result.message || 'Unknown Error');
                            }

                        } catch (err) {
                            failCount++;
                            errors.push(err.message);
                        }
                    }

                    if (successCount > 0) {
                        Swal.fire({
                            title: 'Upload Completed',
                            html: `Successfully uploaded <b>${successCount}</b> questions.<br>${failCount > 0 ? `<span class="text-red-500">Failed: ${failCount}</span>` : ''}`,
                            icon: failCount > 0 ? 'warning' : 'success'
                        });
                        closeModal('modal-bulk-upload');
                        // Reset
                        selectedFile = null;
                        document.getElementById('upload-text').innerText = "Click to upload or drag & drop";
                        document.getElementById('bulk-upload-input').value = "";
                        fetchExpertStats(); // Refresh stats
                    } else {
                        Swal.fire({ title: 'Upload Failed', text: `All ${failCount} questions failed.`, icon: 'error' });
                    }

                } catch (err) {
                    console.error(err);
                    Swal.fire({ title: 'Invalid File', text: 'Could not parse JSON. Ensure format is correct.', icon: 'error' });
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }
            };
            reader.readAsText(selectedFile);
        }

        document.querySelectorAll('input[name="bulk_role"], input[name="bulk_lang"], #bulk-exam-cat, #bulk-exam-sub, #bulk-class-cat, #bulk-class-sub').forEach(input => {
            input.addEventListener('change', updateTemplatePreview);
        });

        function updateTemplatePreview() {
            try {
                const langInput = document.querySelector('input[name="bulk_lang"]:checked');
                const lang = langInput?.value || 'english';
                const roleInput = document.querySelector('input[name="bulk_role"]:checked');
                const role = roleInput ? roleInput.value : 'aspirant';

                let category = '';
                let subject = '';

                if (role === 'aspirant') {
                    category = document.getElementById('bulk-exam-cat').value || 'Select Exam';
                    subject = document.getElementById('bulk-exam-sub').value || 'Select Subject';
                } else {
                    category = document.getElementById('bulk-class-cat').value || 'Select Class';
                    subject = document.getElementById('bulk-class-sub').value || 'Select Subject';
                }

                let exampleText = "Sample Question Text";
                const subLower = (subject || '').toLowerCase();
                if (subLower.includes('math')) exampleText = "What is the value of pi to 2 decimal places?";
                else if (subLower.includes('english')) exampleText = "Choose the correct synonym for 'Happy'.";
                else if (subLower.includes('science') || subLower.includes('physics')) exampleText = "What is the SI unit of force?";
                else if (subLower.includes('history') || subLower.includes('gk')) exampleText = "Who was the first Governor General of India?";

                const preview = {
                    "question_text": exampleText,
                    "option_a": "Option A",
                    "option_b": "Option B",
                    "correct_answer": "A",
                    "language": lang.charAt(0).toUpperCase() + lang.slice(1),
                    "role": role,
                    ...(role === 'student' ? { "class": category } : { "exam_category": category }),
                    "subject": subject
                };

                const previewEl = document.getElementById('template-preview');
                if (previewEl) {
                    previewEl.textContent = JSON.stringify([preview], null, 2);
                }
            } catch (err) {
                console.error('Preview update failed:', err);
            }
        }

        // Initialize on load
        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            renderActivityChart();
            // Ensure correct initial state
            toggleBulkRoleFields();
            loadQuestionMetadata(); // NEW: Load taxonomic metadata
            loadBulkUploadMetadata(); // NEW: Load bulk upload metadata
            fetchExpertStats(); // Load Expert Stats from DB
            fetchExpertProfile(); // Load Expert Profile

            // Add listeners for Bulk Role Toggle
            document.querySelectorAll('input[name="bulk_role"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    toggleBulkRoleFields();
                    updateTemplatePreview();
                });
            });

            // Initialize preview once metadata is loaded (handled by updateTemplatePreview)
            setTimeout(updateTemplatePreview, 500);
        });

        // --- NEW: Premium Question Modal Logic from Admin Dashboard ---

        function toggleQRole(role) {
            const student = document.getElementById('param-student');
            const aspirant = document.getElementById('param-aspirant');

            if (role === 'student') {
                // Outgoing: Aspirant (Make it absolute so it doesn't push layout)
                aspirant.classList.add('absolute', 'inset-0');
                aspirant.classList.replace('opacity-100', 'opacity-0');
                aspirant.classList.replace('translate-x-0', 'translate-x-4');

                // Incoming: Student (Make it relative to drive layout)
                student.classList.remove('hidden', 'absolute', 'inset-0');
                setTimeout(() => {
                    student.classList.replace('opacity-0', 'opacity-100');
                    student.classList.replace('-translate-x-4', 'translate-x-0');

                    // Cleanup outgoing
                    setTimeout(() => {
                        aspirant.classList.add('hidden');
                    }, 300);
                }, 10);
            } else {
                // Outgoing: Student
                student.classList.add('absolute', 'inset-0');
                student.classList.replace('opacity-100', 'opacity-0');
                student.classList.replace('translate-x-0', '-translate-x-4');

                // Incoming: Aspirant
                aspirant.classList.remove('hidden', 'absolute', 'inset-0');
                setTimeout(() => {
                    aspirant.classList.replace('opacity-0', 'opacity-100');
                    aspirant.classList.replace('translate-x-4', 'translate-x-0');

                    // Cleanup outgoing
                    setTimeout(() => {
                        student.classList.add('hidden');
                    }, 300);
                }, 10);
            }
        }

        function resetAddQuestionForm() {
            const form = document.getElementById('form-add-question');
            if (form) {
                form.reset();
                toggleQRole('student'); // Reset UI to default state
            }
        }

        async function loadQuestionMetadata() {
            const studentClassSelect = document.getElementById('q-student-class');
            const aspirantCatSelect = document.getElementById('q-aspirant-exam-category');
            const filterSubjectSelect = document.getElementById('filter-subject');

            if (studentClassSelect) studentClassSelect.innerHTML = '<option value="">Loading...</option>';
            if (aspirantCatSelect) aspirantCatSelect.innerHTML = '<option value="">Loading...</option>';

            try {
                const response = await fetch('../api/admin/manage_taxonomy.php');
                const result = await response.json();

                if (result.status === 'success') {
                    const subjectsData = result.data.subject || []; // Effective 'Classes'
                    const categoriesData = result.data.category || [];

                    // Populate Add Question Modal - Student Class
                    const classOptionsHTML = subjectsData.map(s => `<option value="${s.name}" data-id="${s.id}">${s.name}</option>`).join('');
                    if (studentClassSelect) {
                        studentClassSelect.innerHTML = '<option value="" selected disabled>Select Class</option>' + classOptionsHTML;
                    }

                    // Populate Add Question Modal - Exam Category
                    const categoryOptionsHTML = categoriesData.map(c => `<option value="${c.name}" data-id="${c.id}">${c.name}</option>`).join('');
                    if (aspirantCatSelect) {
                        aspirantCatSelect.innerHTML = '<option value="" selected disabled>Select Exam Category</option>' + categoryOptionsHTML;
                    }

                    // Populate dynamic Subject Filter for 'My Questions' section
                    if (filterSubjectSelect) {
                        const allSubjects = new Set();
                        subjectsData.forEach(s => {
                            if (s.subjects && Array.isArray(s.subjects)) {
                                s.subjects.forEach(sub => allSubjects.add(sub));
                            }
                        });
                        categoriesData.forEach(c => {
                            if (c.subjects && Array.isArray(c.subjects)) {
                                c.subjects.forEach(sub => allSubjects.add(sub));
                            }
                        });

                        const sortedSubjects = Array.from(allSubjects).sort();
                        const subjectFilterOptions = sortedSubjects.map(sub => `<option value="${sub}">${sub}</option>`).join('');
                        filterSubjectSelect.innerHTML = '<option value="all">All Subjects</option>' + subjectFilterOptions;
                    }
                }
            } catch (error) {
                console.error('Metadata Load Error:', error);
            }
        }

        async function handleStudentClassChange(classId) {
            const subSelect = document.getElementById('q-student-subject');
            if (!subSelect || !classId) return;

            try {
                subSelect.innerHTML = '<option value="">Loading...</option>';
                const response = await fetch(`../api/admin/manage_taxonomy.php?action=get_category_subjects&category_id=${classId}`);
                const result = await response.json();

                if (result.status === 'success') {
                    const subjects = result.data || [];
                    subSelect.innerHTML = '<option value="" selected disabled>Select Subject</option>' +
                        subjects.map(s => `<option value="${s.name}">${s.name}</option>`).join('');
                }
            } catch (error) {
                console.error(error);
            }
        }

        async function handleAspirantCategoryChange(categoryId) {
            const subSelect = document.getElementById('q-aspirant-subject');
            if (!subSelect || !categoryId) return;

            try {
                subSelect.innerHTML = '<option value="">Loading...</option>';
                const response = await fetch(`../api/admin/manage_taxonomy.php?action=get_category_subjects&category_id=${categoryId}`);
                const result = await response.json();

                if (result.status === 'success') {
                    const subjects = result.data || [];
                    subSelect.innerHTML = '<option value="" selected disabled>Select Subject</option>' +
                        subjects.map(s => `<option value="${s.name}">${s.name}</option>`).join('');
                }
            } catch (error) {
                console.error(error);
            }
        }

        // --- Bulk Upload Taxonomy Logic ---

        async function loadBulkUploadMetadata() {
            const bulkClassSelect = document.getElementById('bulk-class-cat');
            const bulkExamSelect = document.getElementById('bulk-exam-cat');

            if (bulkClassSelect) bulkClassSelect.innerHTML = '<option value="">Loading...</option>';
            if (bulkExamSelect) bulkExamSelect.innerHTML = '<option value="">Loading...</option>';

            try {
                const response = await fetch('../api/admin/manage_taxonomy.php');
                const result = await response.json();

                if (result.status === 'success') {
                    const subjects = result.data.subject || []; // 'subject' array usually holds Class info in this system
                    const categories = result.data.category || [];

                    const classOptionsHTML = subjects.map(s => `<option value="${s.name}" data-id="${s.id}">${s.name}</option>`).join('');
                    if (bulkClassSelect) {
                        bulkClassSelect.innerHTML = '<option value="" selected disabled>Select Class</option>' + classOptionsHTML;
                    }

                    const categoryOptionsHTML = categories.map(c => `<option value="${c.name}" data-id="${c.id}">${c.name}</option>`).join('');
                    if (bulkExamSelect) {
                        bulkExamSelect.innerHTML = '<option value="" selected disabled>Select Exam</option>' + categoryOptionsHTML;
                    }
                }
            } catch (error) {
                console.error('Bulk Metadata Load Error:', error);
            }
        }

        async function handleBulkClassChange(classId) {
            const subSelect = document.getElementById('bulk-class-sub');
            if (!subSelect || !classId) return;

            try {
                subSelect.innerHTML = '<option value="">Loading...</option>';
                const response = await fetch(`../api/admin/manage_taxonomy.php?action=get_category_subjects&category_id=${classId}`);
                const result = await response.json();

                if (result.status === 'success') {
                    const subjects = result.data || [];
                    subSelect.innerHTML = '<option value="" selected disabled>Select Subject</option>' +
                        subjects.map(s => `<option value="${s.name}">${s.name}</option>`).join('');

                    // Auto-update preview
                    setTimeout(updateTemplatePreview, 100);
                }
            } catch (error) {
                console.error(error);
            }
        }

        async function handleBulkCategoryChange(categoryId) {
            const subSelect = document.getElementById('bulk-exam-sub');
            if (!subSelect || !categoryId) return;

            try {
                subSelect.innerHTML = '<option value="">Loading...</option>';
                const response = await fetch(`../api/admin/manage_taxonomy.php?action=get_category_subjects&category_id=${categoryId}`);
                const result = await response.json();

                if (result.status === 'success') {
                    const subjects = result.data || [];
                    subSelect.innerHTML = '<option value="" selected disabled>Select Subject</option>' +
                        subjects.map(s => `<option value="${s.name}">${s.name}</option>`).join('');

                    // Auto-update preview
                    setTimeout(updateTemplatePreview, 100);
                }
            } catch (error) {
                console.error(error);
            }
        }

        async function handleAddQuestion() {
            const form = document.getElementById('form-add-question');
            const btn = document.querySelector('button[onclick="handleAddQuestion()"]');
            const formData = new FormData(form);

            formData.append('action', 'create');

            // --- VALIDATION ---
            const text = formData.get('question_text')?.trim();
            const correct = formData.get('correct_answer');
            const optA = formData.get('option_a')?.trim();
            const optB = formData.get('option_b')?.trim();
            const optC = formData.get('option_c')?.trim();
            const optD = formData.get('option_d')?.trim();

            if (!text || !correct || !optA || !optB || !optC || !optD) {
                Swal.fire({ title: 'Missing Fields', text: 'Please fill all required fields.', icon: 'warning' });
                return;
            }

            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = `<span class="material-symbols-outlined animate-spin text-lg">sync</span> Submitting...`;

            try {
                // Map the new form fields to the API expectations
                const payload = {
                    language: formData.get('question_lang'),
                    role: formData.get('target_role'),
                    question_text: text,
                    option_a: optA,
                    option_b: optB,
                    option_c: optC,
                    option_d: optD,
                    correct_answer: correct.toUpperCase(),
                    explanation: formData.get('explanation'),
                    difficulty: formData.get('difficulty')
                };

                if (payload.role === 'student') {
                    payload.class = formData.get('student_class');
                    payload.subject = formData.get('student_subject');
                } else {
                    payload.exam_category = formData.get('aspirant_exam_category');
                    payload.subject = formData.get('aspirant_subject');
                }

                const response = await fetch('../api/add_question.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();

                if (result.status === 'success') {
                    showToast('Question submitted successfully!');
                    resetAddQuestionForm();
                } else {
                    Swal.fire({ title: 'Error', text: result.message, icon: 'error' });
                }
            } catch (error) {
                console.error(error);
                showToast('Submission failed', 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        function handleBulkUploadContextual(input) {
            if (!input.files || !input.files[0]) return;
            showToast(`Processing file: ${input.files[0].name}`);
            // Logic handled by existing bulk upload script if applicable
        }

        function showToast(message, type = 'success') {
            // Find or create toast container at root body level
            let container = document.getElementById('toast-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'toast-container';
                container.className = 'fixed top-4 right-4 z-[999999] flex flex-col items-end gap-3 pointer-events-none';
                document.body.appendChild(container);
            }

            const toast = document.createElement('div');
            const icon = type === 'success' ? 'check_circle' : 'error';
            const iconColor = type === 'success' ? 'text-[#0bda5b]' : 'text-red-500';
            const borderSide = type === 'success' ? 'border-l-4 border-l-[#0bda5b]' : 'border-l-4 border-l-red-500';

            // Enhanced Toast Styling and Rendering Fixes
            toast.className = `bg-white dark:bg-[#1a252f] ${borderSide} shadow-2xl rounded-xl p-3 flex items-center gap-3 min-w-[300px] transition-all duration-500 transform translate-x-full opacity-0 border border-slate-100 dark:border-slate-800 pointer-events-auto antialiased`;

            // Add forced hardware acceleration to prevent subpixel blur
            toast.style.backfaceVisibility = 'hidden';
            toast.style.transform = 'translateZ(0) translate3d(100%, 0, 0)';

            toast.innerHTML = `
                <div class="flex-shrink-0 flex items-center justify-center w-8 h-8 rounded-lg ${type === 'success' ? 'bg-[#0bda5b]/15' : 'bg-red-500/15'}">
                    <span class="material-symbols-outlined ${iconColor} text-xl">${icon}</span>
                </div>
                <div class="flex-1">
                    <p class="text-xs font-bold text-slate-700 dark:text-white leading-tight">${message}</p>
                </div>
                <button onclick="this.parentElement.remove()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors ml-2">
                    <span class="material-symbols-outlined text-base">close</span>
                </button>
            `;

            container.appendChild(toast);

            // Trigger animation with high-fidelity transform
            setTimeout(() => {
                toast.style.transform = 'translateZ(0) translate3d(0, 0, 0)';
                toast.classList.remove('opacity-0');
            }, 10);

            setTimeout(() => {
                toast.style.transform = 'translateZ(0) translate3d(100%, 0, 0)';
                toast.classList.add('opacity-0');
                setTimeout(() => toast.remove(), 500);
            }, 4000);
        }

        async function fetchExpertStats() {
            try {
                // Fetch stats from API
                const response = await fetch('../api/expert/get_stats.php');
                const result = await response.json();

                if (result.status === 'success') {
                    const data = result.data;

                    const totalEl = document.getElementById('stat-total-questions');
                    const subEl = document.getElementById('stat-my-submissions');
                    const appEl = document.getElementById('stat-approved');
                    const queueEl = document.getElementById('stat-queue');

                    if (totalEl) animateValue(totalEl, 0, data.total_questions, 1000);
                    if (subEl) animateValue(subEl, 0, data.my_submissions, 1000);
                    if (appEl) animateValue(appEl, 0, data.my_approved, 1000);
                    if (queueEl) animateValue(queueEl, 0, data.my_queue, 1000);
                }
            } catch (error) {
                console.error('Stats Error:', error);
            }
        }

        function animateValue(obj, start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString();
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        async function fetchExpertProfile() {
            try {
                const response = await fetch('../api/expert/get_profile.php');
                const result = await response.json();

                if (result.status === 'success') {
                    const user = result.data;

                    // Navbar Profile
                    const nameEl = document.getElementById('expert-name');
                    const roleEl = document.getElementById('expert-role');
                    const avatarEl = document.getElementById('expert-avatar');

                    if (nameEl) nameEl.textContent = user.name;
                    
                    const dNameEl = document.getElementById('dropdown-expert-name');
                    const dEmailEl = document.getElementById('dropdown-expert-email');
                    if (dNameEl) dNameEl.textContent = user.name;
                    if (dEmailEl) dEmailEl.textContent = user.email;

                    let roleDisplay = (user.specialization && user.specialization !== 'General') ? user.specialization + ' Expert' : user.role;
                    if (user.profession && user.profession.toLowerCase() !== 'expert') {
                        roleDisplay = user.profession;
                    }
                    if (roleEl) roleEl.textContent = roleDisplay;
                    if (avatarEl) avatarEl.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=random&size=100`;

                    // Profile Page
                    const pName = document.getElementById('profile-page-name');
                    const pRole = document.getElementById('profile-page-role');
                    const pAvatar = document.getElementById('profile-page-avatar');

                    const pNameFull = document.getElementById('profile-page-name-full');
                    const pEmail = document.getElementById('profile-page-email');
                    const pPhone = document.getElementById('profile-page-phone');
                    const pGender = document.getElementById('profile-page-gender');

                    const pDesignation = document.getElementById('profile-page-designation');
                    const pDept = document.getElementById('profile-page-dept');
                    const pSpec = document.getElementById('profile-page-spec');

                    if (pName) pName.textContent = user.name;
                    if (pRole) pRole.textContent = roleDisplay;
                    if (pAvatar) pAvatar.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=random&size=200`;

                    // Card 1
                    if (pNameFull) pNameFull.textContent = user.name;
                    if (pEmail) pEmail.textContent = user.email;
                    if (pPhone) pPhone.textContent = user.phone || 'Not Provided';
                    if (pGender) pGender.textContent = user.gender || 'Not Specified';

                    // Card 2
                    if (pDesignation) pDesignation.textContent = user.role || 'Expert';
                    if (pDept) pDept.textContent = user.department || 'Not Specified';
                    if (pSpec) pSpec.textContent = user.specialization || 'General';
                }
            } catch (error) {
                console.error('Profile Load Error:', error);
            }
        }

        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profile-dropdown');
            if (!dropdown) return;

            if (dropdown.classList.contains('hidden')) {
                dropdown.classList.remove('hidden');
                requestAnimationFrame(() => {
                    dropdown.classList.remove('opacity-0', 'scale-95');
                    dropdown.classList.add('opacity-100', 'scale-100');
                });
            } else {
                dropdown.classList.add('opacity-0', 'scale-95');
                dropdown.classList.remove('opacity-100', 'scale-100');
                setTimeout(() => dropdown.classList.add('hidden'), 200);
            }
        }

        let currentStatusFilter = 'all';

        function filterStatus(btn, status) {
            currentStatusFilter = status;

            // Update UI using classList for stability
            document.querySelectorAll('.status-btn').forEach(b => {
                b.classList.remove('status-active', 'bg-white', 'dark:bg-primary', 'text-primary', 'dark:text-white', 'shadow-sm', 'ring-1', 'ring-slate-200', 'dark:ring-primary/20');
                b.classList.add('text-slate-500', 'dark:text-slate-400', 'hover:text-primary', 'dark:hover:text-primary');
            });

            // Set active style
            btn.classList.add('status-active', 'bg-white', 'dark:bg-primary', 'text-primary', 'dark:text-white', 'shadow-sm', 'ring-1', 'ring-slate-200', 'dark:ring-primary/20');
            btn.classList.remove('text-slate-500', 'dark:text-slate-400', 'hover:text-primary', 'dark:hover:text-primary');

            applyFilters();
        }

        function applyFilters() {
            const subject = document.getElementById('filter-subject').value.toLowerCase();
            const status = currentStatusFilter.toLowerCase();
            const rows = document.querySelectorAll('#questions-table-body tr');
            const totalRows = rows.length;

            let visibleCount = 0;
            rows.forEach(row => {
                const rowSubject = row.cells[5]?.textContent.trim().toLowerCase();
                const rowStatus = row.cells[6]?.textContent.trim().toLowerCase();

                const matchesSubject = (subject === 'all' || rowSubject.includes(subject));
                const matchesStatus = (status === 'all' || rowStatus.includes(status));

                if (matchesSubject && matchesStatus) {
                    row.classList.remove('hidden');
                    visibleCount++;
                } else {
                    row.classList.add('hidden');
                }
            });

            // Update count display with proper pluralization
            const counter = document.getElementById('questions-count');
            if (counter) {
                const qText = visibleCount === 1 ? 'question' : 'questions';
                counter.textContent = `Showing ${visibleCount} of ${totalRows} ${qText}`;
            }
        }

        async function handleLogout() {
            const isDark = document.documentElement.classList.contains('dark');
            const result = await Swal.fire({
                title: 'Logout?',
                text: 'End your session?',
                icon: 'question',
                iconColor: '#ef4444',
                showCancelButton: true,
                confirmButtonText: 'Yes, Logout',
                cancelButtonText: 'Cancel',
                reverseButtons: true,
                width: '320px',
                padding: '1rem',
                background: isDark ? '#111a22' : '#ffffff',
                color: isDark ? '#ffffff' : '#0f172a',
                confirmButtonColor: '#2b8cee',
                cancelButtonColor: 'transparent',
                customClass: {
                    popup: 'rounded-2xl border border-slate-200 dark:border-slate-800 shadow-2xl',
                    title: 'text-base font-black tracking-tight mb-1',
                    icon: 'mt-2 mb-2 scale-75',
                    htmlContainer: 'text-[11px] text-slate-500 dark:text-slate-400 mb-4',
                    confirmButton: 'px-4 py-2 rounded-xl font-bold text-[11px] tracking-tight shadow-md shadow-primary/10',
                    cancelButton: 'px-4 py-2 rounded-xl font-bold text-[11px] tracking-tight text-slate-500 dark:text-slate-400 border border-slate-200 dark:border-slate-800 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors'
                }
            });

            if (result.isConfirmed) {
                try {
                    const response = await fetch('../api/logout.php');
                    const data = await response.json();
                    if (data.status === 'success') {
                        window.location.href = '../index.html';
                    }
                } catch (error) {
                    console.error('Logout failed:', error);
                    window.location.href = '../index.html';
                }
            }
        }

        window.addEventListener('click', (e) => {
            const dropdown = document.getElementById('profile-dropdown');
            const trigger = e.target.closest('[onclick="toggleProfileDropdown()"]');

            if (!trigger && dropdown && !dropdown.classList.contains('hidden')) {
                dropdown.classList.add('opacity-0', 'scale-95');
                dropdown.classList.remove('opacity-100', 'scale-100');
                setTimeout(() => dropdown.classList.add('hidden'), 200);
            }
        });
    </script>
</body>

</html>